(function(){var t,e,r,n,i,o,s,a;this.taiga=a={},a.emojis=window.emojis,this.taigaContribPlugins=this.taigaContribPlugins||window.taigaContribPlugins||[],a.generateHash=function(t){return null==t&&(t=[]),t=_.map(t,function(t){return JSON.stringify(t)}),hex_sha1(t.join(":"))},a.generateUniqueSessionIdentifier=function(){var t,e;return t=(new Date).getTime(),e=Math.floor(150994944*Math.random()),a.generateHash([t,e])},a.sessionId=a.generateUniqueSessionIdentifier(),t=function(t,e,r,n,i,o,s,c,u){var l,p,d,h,f,g,m,v,y;return u.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/),g=t.when,t.when=function(e,r){return r.resolve||(r.resolve={}),angular.extend(r.resolve,{languageLoad:["$q","$translate",function(t,e){var r;return r=t.defer(),e().then(function(){return r.resolve()}),r.promise}],projectLoaded:["$q","tgProjectService","$route",function(t,e,r){var n,i;return n=t.defer(),e.setSection(null!=(i=r.current.$$route)?i.section:void 0),r.current.params.pslug?e.setProjectBySlug(r.current.params.pslug).then(n.resolve):(e.cleanProject(),n.resolve()),n.promise}]}),g.call(t,e,r)},t.when("/",{templateUrl:"home/home.html",controller:"Home",controllerAs:"vm",loader:!0,title:"HOME.PAGE_TITLE",loader:!0,description:"HOME.PAGE_DESCRIPTION",joyride:"dashboard"}),t.when("/discover",{templateUrl:"discover/discover-home/discover-home.html",controller:"DiscoverHome",controllerAs:"vm",title:"PROJECT.NAVIGATION.DISCOVER",loader:!0}),t.when("/discover/search",{templateUrl:"discover/discover-search/discover-search.html",title:"PROJECT.NAVIGATION.DISCOVER",loader:!0,controller:"DiscoverSearch",controllerAs:"vm",reloadOnSearch:!1}),t.when("/projects/",{templateUrl:"projects/listing/projects-listing.html",access:{requiresLogin:!0},title:"PROJECTS.PAGE_TITLE",description:"PROJECTS.PAGE_DESCRIPTION",loader:!0,controller:"ProjectsListing",controllerAs:"vm"}),t.when("/project/new",{title:"PROJECT.CREATE.TITLE",templateUrl:"projects/create/create-project.html",loader:!0,controller:"CreateProjectCtrl",controllerAs:"vm"}),t.when("/project/new/scrum",{title:"PROJECT.CREATE.TITLE",template:'<tg-create-project-form type="scrum"></tg-create-project-form>',loader:!0}),t.when("/project/new/kanban",{title:"PROJECT.CREATE.TITLE",template:'<tg-create-project-form type="kanban"></tg-create-project-form>',loader:!0}),t.when("/project/new/duplicate",{title:"PROJECT.CREATE.TITLE",template:"<tg-duplicate-project></tg-duplicate-project>",loader:!0}),t.when("/project/new/import/:platform?",{title:"PROJECT.CREATE.TITLE",template:"<tg-import-project></tg-import-project>",loader:!0}),t.when("/project/:pslug/",{template:"",loader:!0,controller:"ProjectRouter"}),t.when("/project/:pslug/timeline",{templateUrl:"projects/project/project.html",loader:!0,controller:"Project",controllerAs:"vm",section:"project-timeline"}),t.when("/project/:pslug/t/:ref",{loader:!0,controller:"DetailController",template:""}),t.when("/project/:pslug/search",{templateUrl:"search/search.html",reloadOnSearch:!1,section:"search",loader:!0}),t.when("/project/:pslug/epics",{section:"epics",templateUrl:"epics/dashboard/epics-dashboard.html",loader:!0,controller:"EpicsDashboardCtrl",controllerAs:"vm"}),t.when("/project/:pslug/epic/:epicref",{templateUrl:"epic/epic-detail.html",loader:!0,section:"epics"}),t.when("/project/:pslug/backlog",{templateUrl:"backlog/backlog.html",loader:!0,section:"backlog",joyride:"backlog"}),t.when("/project/:pslug/kanban",{templateUrl:"kanban/kanban.html",loader:!0,section:"kanban",joyride:"kanban"}),t.when("/project/:pslug/taskboard/:sslug",{templateUrl:"taskboard/taskboard.html",loader:!0,section:"backlog"}),t.when("/project/:pslug/us/:usref",{templateUrl:"us/us-detail.html",loader:!0,section:"backlog-kanban"}),t.when("/project/:pslug/task/:taskref",{templateUrl:"task/task-detail.html",loader:!0,section:"backlog-kanban"}),t.when("/project/:pslug/wiki",{redirectTo:function(t){return"/project/"+t.pslug+"/wiki/home"}}),t.when("/project/:pslug/wiki-list",{templateUrl:"wiki/wiki-list.html",loader:!0,section:"wiki"}),t.when("/project/:pslug/wiki/:slug",{templateUrl:"wiki/wiki.html",loader:!0,section:"wiki"}),t.when("/project/:pslug/team",{templateUrl:"team/team.html",loader:!0,section:"team"}),t.when("/project/:pslug/issues",{templateUrl:"issue/issues.html",loader:!0,section:"issues"}),t.when("/project/:pslug/issue/:issueref",{templateUrl:"issue/issues-detail.html",loader:!0,section:"issues"}),t.when("/project/:pslug/admin/project-profile/details",{templateUrl:"admin/admin-project-profile.html",section:"admin"}),t.when("/project/:pslug/admin/project-profile/default-values",{templateUrl:"admin/admin-project-default-values.html",section:"admin"}),t.when("/project/:pslug/admin/project-profile/modules",{templateUrl:"admin/admin-project-modules.html",section:"admin"}),t.when("/project/:pslug/admin/project-profile/export",{templateUrl:"admin/admin-project-export.html",section:"admin"}),t.when("/project/:pslug/admin/project-profile/reports",{templateUrl:"admin/admin-project-reports.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/status",{templateUrl:"admin/admin-project-values-status.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/points",{templateUrl:"admin/admin-project-values-points.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/priorities",{templateUrl:"admin/admin-project-values-priorities.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/severities",{templateUrl:"admin/admin-project-values-severities.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/types",{templateUrl:"admin/admin-project-values-types.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/custom-fields",{templateUrl:"admin/admin-project-values-custom-fields.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/tags",{templateUrl:"admin/admin-project-values-tags.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/due-dates",{templateUrl:"admin/admin-project-values-due-dates.html",section:"admin"}),t.when("/project/:pslug/admin/memberships",{templateUrl:"admin/admin-memberships.html",section:"admin"}),t.when("/project/:pslug/admin/roles",{templateUrl:"admin/admin-roles.html",section:"admin"}),t.when("/project/:pslug/admin/third-parties/webhooks",{templateUrl:"admin/admin-third-parties-webhooks.html",section:"admin"}),t.when("/project/:pslug/admin/third-parties/github",{templateUrl:"admin/admin-third-parties-github.html",section:"admin"}),t.when("/project/:pslug/admin/third-parties/gitlab",{templateUrl:"admin/admin-third-parties-gitlab.html",section:"admin"}),t.when("/project/:pslug/admin/third-parties/bitbucket",{templateUrl:"admin/admin-third-parties-bitbucket.html",section:"admin"}),t.when("/project/:pslug/admin/third-parties/gogs",{templateUrl:"admin/admin-third-parties-gogs.html",section:"admin"}),t.when("/project/:pslug/admin/contrib/:plugin",{templateUrl:"contrib/main.html"}),t.when("/project/:pslug/transfer/:token",{templateUrl:"projects/transfer/transfer-page.html",loader:!0,controller:"Project",controllerAs:"vm"}),t.when("/user-settings/user-profile",{templateUrl:"user/user-profile.html"}),t.when("/user-settings/user-change-password",{templateUrl:"user/user-change-password.html"}),t.when("/user-settings/user-project-settings",{templateUrl:"user/user-project-settings.html"}),t.when("/user-settings/mail-notifications",{templateUrl:"user/mail-notifications.html"}),t.when("/user-settings/live-notifications",{templateUrl:"user/live-notifications.html"}),t.when("/user-settings/web-notifications",{templateUrl:"user/web-notifications.html"}),t.when("/change-email/:email_token",{templateUrl:"user/change-email.html"}),t.when("/cancel-account/:cancel_token",{templateUrl:"user/cancel-account.html"}),t.when("/user-settings/contrib/:plugin",{templateUrl:"contrib/user-settings.html"}),t.when("/profile",{templateUrl:"profile/profile.html",loader:!0,access:{requiresLogin:!0},controller:"Profile",controllerAs:"vm"}),t.when("/notifications",{templateUrl:"notifications/notifications.html",loader:!0,access:{requiresLogin:!0},controller:"Notifications",controllerAs:"vm"}),t.when("/profile/:slug",{templateUrl:"profile/profile.html",loader:!0,controller:"Profile",controllerAs:"vm"}),t.when("/login",{templateUrl:"auth/login.html",title:"LOGIN.PAGE_TITLE",description:"LOGIN.PAGE_DESCRIPTION",disableHeader:!0,controller:"LoginPage"}),t.when("/register",{templateUrl:"auth/register.html",title:"REGISTER.PAGE_TITLE",description:"REGISTER.PAGE_DESCRIPTION",disableHeader:!0}),t.when("/forgot-password",{templateUrl:"auth/forgot-password.html",title:"FORGOT_PASSWORD.PAGE_TITLE",description:"FORGOT_PASSWORD.PAGE_DESCRIPTION",disableHeader:!0}),t.when("/change-password/:token",{templateUrl:"auth/change-password-from-recovery.html",title:"CHANGE_PASSWORD.PAGE_TITLE",description:"CHANGE_PASSWORD.PAGE_TITLE",disableHeader:!0}),t.when("/invitation/:token",{templateUrl:"auth/invitation.html",title:"INVITATION.PAGE_TITLE",description:"INVITATION.PAGE_DESCRIPTION",disableHeader:!0}),t.when("/external-apps",{templateUrl:"external-apps/external-app.html",title:"EXTERNAL_APP.PAGE_TITLE",description:"EXTERNAL_APP.PAGE_DESCRIPTION",controller:"ExternalApp",controllerAs:"vm",disableHeader:!0,mobileViewport:!0}),t.when("/blocked-project/:pslug/",{templateUrl:"projects/project/blocked-project.html",loader:!0}),t.when("/error",{templateUrl:"error/error.html"}),t.when("/not-found",{templateUrl:"error/not-found.html"}),t.when("/permission-denied",{templateUrl:"error/permission-denied.html"}),t.otherwise({templateUrl:"error/not-found.html"}),e.html5Mode({enabled:!0,requireBase:!1}),h={"Content-Type":"application/json","Accept-Language":window.taigaConfig.defaultLanguage||"en","X-Session-Id":a.sessionId},r.defaults.headers.delete=h,r.defaults.headers.patch=h,r.defaults.headers.post=h,r.defaults.headers.put=h,r.defaults.headers.get={"X-Session-Id":a.sessionId},r.useApplyAsync(!0),i.setSessionId(a.sessionId),l=function(t,e,r,n,i){return{responseError:function(o){var s,a;return 0===o.status||-1===o.status&&!o.config.cancelable?(n.closeAll(),i.error()):401===o.status&&-1===e.url().indexOf("/login")&&(s=e.url(),(a=e.search()).force_next?e.url(r.resolve("login")).search("force_next",a.force_next):e.url(r.resolve("login")).search({unauthorized:!0,next:s})),t.reject(o)}}},n.factory("authHttpIntercept",["$q","$location","$tgNavUrls","lightboxService","tgErrorHandlingService",l]),r.interceptors.push("authHttpIntercept"),f=function(t,e){return{request:function(t){return e.logRequest(),t},requestError:function(r){return e.logResponse(),t.reject(r)},responseError:function(r){return e.logResponse(),t.reject(r)},response:function(t){return e.logResponse(),t}}},n.factory("loaderIntercept",["$q","tgLoader",f]),r.interceptors.push("loaderIntercept"),y=function(t){return{responseError:function(e){return 400===e.status&&e.data.version&&angular.element("body").injector().invoke(["$tgConfirm","$translate",function(t,e){var r;return r=e.instant("ERROR.VERSION_ERROR"),t.notify("error",r,null,1e4)}]),t.reject(e)}}},n.factory("versionCheckHttpIntercept",["$q",y]),r.interceptors.push("versionCheckHttpIntercept"),p=function(t,e){var r;return r=function(){return e.block()},{response:function(t){return t.data.blocked_code&&r(),t},responseError:function(e){return 451===e.status&&r(),t.reject(e)}}},n.factory("blockingIntercept",["$q","tgErrorHandlingService",p]),r.interceptors.push("blockingIntercept"),o.debugInfoEnabled(window.taigaConfig.debugInfo||!1),localStorage.userInfo&&(v=JSON.parse(localStorage.userInfo)),m=(null!=v?v.lang:void 0)||window.taigaConfig.defaultLanguage||"en",c.addPart("taiga"),s.useLoader("$translatePartialLoader",{urlTemplate:"/"+window._version+"/locales/{part}/locale-{lang}.json"}).useSanitizeValueStrategy("escapeParameters").addInterpolation("$translateMessageFormatInterpolation").preferredLanguage(m),s.fallbackLanguage(m),d=window.getDecorators(),_.each(d,function(t){return n.decorator(t.provider,t.decorator)})},e=function(t,e){var r;return moment.locale(t),"en"!==t&&ljs.load("/"+window._version+"/locales/moment-locales/"+t+".js"),r={defaultMessage:e.instant("COMMON.FORM_ERRORS.DEFAULT_MESSAGE"),type:{email:e.instant("COMMON.FORM_ERRORS.TYPE_EMAIL"),url:e.instant("COMMON.FORM_ERRORS.TYPE_URL"),urlstrict:e.instant("COMMON.FORM_ERRORS.TYPE_URLSTRICT"),number:e.instant("COMMON.FORM_ERRORS.TYPE_NUMBER"),digits:e.instant("COMMON.FORM_ERRORS.TYPE_DIGITS"),dateIso:e.instant("COMMON.FORM_ERRORS.TYPE_DATEISO"),alphanum:e.instant("COMMON.FORM_ERRORS.TYPE_ALPHANUM"),phone:e.instant("COMMON.FORM_ERRORS.TYPE_PHONE")},notnull:e.instant("COMMON.FORM_ERRORS.NOTNULL"),notblank:e.instant("COMMON.FORM_ERRORS.NOT_BLANK"),required:e.instant("COMMON.FORM_ERRORS.REQUIRED"),regexp:e.instant("COMMON.FORM_ERRORS.REGEXP"),min:e.instant("COMMON.FORM_ERRORS.MIN"),max:e.instant("COMMON.FORM_ERRORS.MAX"),range:e.instant("COMMON.FORM_ERRORS.RANGE"),minlength:e.instant("COMMON.FORM_ERRORS.MIN_LENGTH"),maxlength:e.instant("COMMON.FORM_ERRORS.MAX_LENGTH"),rangelength:e.instant("COMMON.FORM_ERRORS.RANGE_LENGTH"),mincheck:e.instant("COMMON.FORM_ERRORS.MIN_CHECK"),maxcheck:e.instant("COMMON.FORM_ERRORS.MAX_CHECK"),rangecheck:e.instant("COMMON.FORM_ERRORS.RANGE_CHECK"),equalto:e.instant("COMMON.FORM_ERRORS.EQUAL_TO"),linewidth:e.instant("COMMON.FORM_ERRORS.LINEWIDTH"),pikaday:e.instant("COMMON.FORM_ERRORS.PIKADAY")},checksley.updateMessages("default",r)},r=function(t,r,n,i,o,s,c,u,l,p,d,h,f,g,m){var v,y;return t.debug("Initialize application"),r.$on("$translatePartialLoaderStructureChanged",function(){return s.refresh()}),y={linewidth:function(t,e){var r;return r=a.nl2br(t).split("<br />"),_.every(r,function(t){return t.length<e})},pikaday:function(t){var e;return e=s.instant("COMMON.PICKERDATE.FORMAT"),moment(t,e).isValid()},url:function(t){return new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i").test(t)}},checksley.updateValidators(y),r.contribPlugins=this.taigaContribPlugins,r.adminPlugins=_.filter(this.taigaContribPlugins,{type:"admin"}),r.userSettingsPlugins=_.filter(this.taigaContribPlugins,{type:"userSettings"}),r.$on("$translateChangeEnd",function(t,n){var i,o;return i=n.language,e(i,s),o=g.get("rtlLanguages",[]),r.isRTL=o.indexOf(i)>-1}),Promise.setScheduler(function(t){return r.$evalAsync(t)}),i.setupConnection(),n.isAuthenticated()&&(n.getUser(),n.showTerms()),o.initialize(),r.$on("$locationChangeStart",function(t){var e;if(h.init(),(null!=(e=m.project)?e.get("blocked_code"):void 0)&&(m.setProject(null),h.block()),f.getLightboxOpen().length)return t.preventDefault(),f.closeAll()}),v=r.$on("$routeChangeStart",function(t,e){return e.loader&&p.start(!0),v()}),r.$on("$routeChangeSuccess",function(t,e){var r,i;return e.loader&&p.start(!0),e.access&&e.access.requiresLogin&&(n.isAuthenticated()||c.path(u.resolve("login"))),(e.title||e.description)&&(i=s.instant(e.title||""),r=s.instant(e.description||""),l.setAll(i,r)),e.mobileViewport?l.addMobileViewport():l.removeMobileViewport(),e.disableHeader?d.disableHeader():d.enableHeader()})},angular.module("infinite-scroll").value("THROTTLE_MILLISECONDS",500),s=_.filter(this.taigaContribPlugins,function(t){return t.module}),o=_.map(s,function(t){return t.module}),i=["taigaBase","taigaCommon","taigaResources","taigaResources2","taigaAuth","taigaEvents","taigaHome","taigaNavigationBar","taigaProjects","taigaRelatedTasks","taigaBacklog","taigaTaskboard","taigaKanban","taigaIssues","taigaUserStories","taigaTasks","taigaTeam","taigaWiki","taigaSearch","taigaAdmin","taigaProject","taigaUserSettings","taigaFeedback","taigaPlugins","taigaIntegrations","taigaComponents","taigaProfile","taigaHome","taigaUserTimeline","taigaExternalApps","taigaDiscover","taigaHistory","taigaNotifications","taigaWikiHistory","taigaEpics","taigaUtils","templates","ngSanitize","ngRoute","ngAnimate","ngAria","pascalprecht.translate","infinite-scroll","tgRepeat"].concat(o),(n=angular.module("taiga",i)).config(["$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider",t]),n.run(["$log","$rootScope","$tgAuth","$tgEvents","$tgAnalytics","$translate","$tgLocation","$tgNavUrls","tgAppMetaService","tgLoader","tgNavigationBarService","tgErrorHandlingService","lightboxService","$tgConfig","tgProjectService",r])}).call(this),function(){var t,e,r,n=function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty,o=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){return function(){}}(),r=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return n(r,t),r}(),e=function(e){function r(){return this.onInitialDataError=o(this.onInitialDataError,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.onInitialDataError=function(t){return t&&(404===t.status?this.errorHandlingService.notfound():403===t.status&&this.errorHandlingService.permissionDenied()),this.q.reject(t)},r}(),this.taiga.Base=t,this.taiga.Service=r,this.taiga.Controller=e}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,b,S,j,k,$,I,E,C,T,A,P,w,O,R,M,U=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},D=[].slice,N={}.hasOwnProperty;e=function(t,e){return t.classList?t.classList.add(e):t.className+=" "+e},v=function(t){return"<br />",(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},r=function(t){var e,r;return e=_.keys(t),r=[],_.forIn(t,function(t,n){if(U.call(e,n)<0&&_.isFunction(t))return r.push(n)}),_.bindAll(t,r)},n=function(t,e,r){var n,i;return void 0!==(i=t.$eval(e))?r(i):(n=null,n=t.$watch(e,function(t){if(void 0!==t)return r(t),n?n():void 0}))},m=function(){var t,e,r,n,i,o,s;for(e=arguments[0],i=2<=arguments.length?D.call(arguments,1):[],t=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return function(t,e){for(var r in e)N.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,e),r}(),r=i.length-1;r>=0;r+=-1)for(o in s=i[r].prototype)n=s[o],t.prototype[o]=n;return t},O=function(t,e){return _.trim(t,e)},I=function(t){return t.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")},M=function(t){return t?_.capitalize(t.replace(/-/g," ")):t},w=function(t,e){var r,n;return(null==(r=t.data("nextTextPosition"))||r>=e.length)&&(r=0),n=e[r],t.data("nextTextPosition",r+1),t.text(n)},p=function(t,e){var r,n,i,o;for(o={},r=0,i=t.length;r<i;r++)o[e(n=t[r])]=n;return o},A=function(t,e){return window.setTimeout(e,t)},i=function(t){return window.clearTimeout(t)},k=function(t,e){return _.defer(function(){return t.$apply(e)})},P=function(t){return _.isNumber(t)?t+"":_.isString(t)?t:_.isPlainObject(t)?JSON.stringify(t):_.isUndefined(t)?"":t.toString()},g=function(t,e){return e.join(t)},o=function(t,e){return _.debounce(e,t,{leading:!0,trailing:!1})},s=function(t,e){return _.debounce(e,t,{leading:!1,trailing:!0})},E=function(t,e){return _.startsWith(t,e)},R=function(t,e,r){var n;return null==r&&(r="..."),"string"==typeof t||t instanceof String?((n=t.slice(0)).length>e&&(n=(n=n.substring(0,e+1)).substring(0,Math.min(n.length,n.lastIndexOf(" "))),n+=r),n):t},$=function(t,e){var r,n;return null==e&&(e=1),isNaN(parseFloat(t))||!isFinite(t)?"-":0===t?"0 bytes":(n=["bytes","KB","MB","GB","TB","PB"],(r=Math.floor(Math.log(t)/Math.log(1024)))>5&&(r=5),(t/Math.pow(1024,r)).toFixed(e)+" "+n[r])},C=function(t,e){var r;return e?(r=new RegExp("<(?!"+e+"s*/?)[^>]+>","gi"),String(t).replace(r,"")):String(t).replace(/<\/?[^>]+>/g,"")},j=function(t,e,r){var n;return n=new RegExp("<("+e+")>","gi"),t=t.replace(n,"<"+r+">"),n=new RegExp("</("+e+")>","gi"),t=t.replace(n,"</"+r+">")},a=function(t,e,r){return Object.defineProperty(t,e,{get:function(){var t;if(!_.isFunction(r))throw"defineImmutableProperty third param must be a function";if((t=r())&&_.isObject(t)&&void 0===t.size)throw"defineImmutableProperty must return immutable data";return t}})},_.mixin({removeKeys:function(t,e){return _.chain([e]).flatten().reduce(function(t,e){return delete t[e],t},t).value()},cartesianProduct:function(){return _.reduceRight(arguments,function(t,e){return _.flatten(_.map(t,function(t){return _.map(e,function(e){return[e].concat(t)})}),!0)},[[]])}}),h=function(t){return null!==t.match(/\.(jpe?g|png|gif|gifv|webm|svg|psd)/i)},d=function(t){return null!=t&&null!==t.match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},f=function(t){return null!==t.match(/\.(pdf)/i)},b=function(t,e){var r;return r={},e.forEach(function(e,n){if(e!==t.get(n))return e.toJS?r[n]=e.toJS():r[n]=e}),r},t=["#fce94f","#edd400","#c4a000","#8ae234","#73d216","#4e9a06","#d3d7cf","#fcaf3e","#f57900","#ce5c00","#729fcf","#3465a4","#204a87","#888a85","#ad7fa8","#75507b","#5c3566","#ef2929","#cc0000","#a40000","#222222"],l=function(){return _.sample(t)},c=function(){return _.clone(t)},u=function(t,e,r){var n,i;for(r||(r=1),i=[],n=null;n=e.exec(t);)-1===r?i.push(n):i.push(n[r]);return i},S=function(t,e){var r;return r=e-t,t+Math.floor(Math.random()*(r+1))},y=function(t){return t.replace("Á","A").replace("Ä","A").replace("À","A").replace("É","E").replace("Ë","E").replace("È","E").replace("Í","I").replace("Ï","I").replace("Ì","I").replace("Ó","O").replace("Ö","O").replace("Ò","O").replace("Ú","U").replace("Ü","U").replace("Ù","U")},(T=this.taiga).addClass=e,T.nl2br=v,T.bindMethods=r,T.bindOnce=n,T.mixOf=m,T.trim=O,T.slugify=I,T.unslugify=M,T.toggleText=w,T.groupBy=p,T.timeout=A,T.cancelTimeout=i,T.scopeDefer=k,T.toString=P,T.joinStr=g,T.truncate=R,T.debounce=o,T.debounceLeading=s,T.startswith=E,T.sizeFormat=$,T.stripTags=C,T.replaceTags=j,T.defineImmutableProperty=a,T.isImage=h,T.isEmail=d,T.isPdf=f,T.patch=b,T.getRandomDefaultColor=l,T.getDefaulColorList=c,T.getMatches=u,T.randomInt=S,T.normalizeString=y}.call(this),function(){var t,e,r,n,i,o,s;o=this.taiga,n=this.taiga.groupBy,i=this.taiga.joinStr,s=this.taiga.trim,this.taiga.toString,e=function(){function t(){}return t.prototype.fillUsersAndRoles=function(t,e){var r,i;return r=_.filter(t,function(t){return t.is_active}),this.scope.activeUsers=_.sortBy(r,"full_name_display"),this.scope.activeUsersById=n(this.scope.activeUsers,function(t){return t.id}),this.scope.users=_.sortBy(t,"full_name_display"),this.scope.usersById=n(t,function(t){return t.id}),this.scope.roles=_.sortBy(e,"order"),i=_(this.scope.project.members).map("role").uniq().value(),this.scope.computableRoles=_(e).filter("computable").filter(function(t){return _.includes(i,t.id)}).value()},t.prototype.loadUsersAndRoles=function(){var t;return this.q.all([this.rs.projects.usersList(this.scope.projectId),this.rs.projects.rolesList(this.scope.projectId)]).then((t=this,function(e){var r,n;return n=e[0],r=e[1],t.fillUsersAndRoles(n,r),e}))},t}(),o.PageMixin=e,t=function(){function t(){}return t.prototype.excludePrefix="exclude_",t.prototype.selectFilter=function(t,e,r,n){var a,c;if(null==r&&(r=!1),null==n&&(n="include"),c=this.location.search(),"exclude"===n&&(t=this.excludePrefix.concat(t)),void 0!==c[t]&&"page"!==t&&((a=_.map(o.toString(c[t]).split(","),function(t){return s(t)})).push(o.toString(e)),a=_.compact(a),e=i(",",_.uniq(a))),!this.location.isInCurrentRouteParams(t,e))return(r?this.location:this.location.noreload(this.scope)).search(t,e)},t.prototype.replaceFilter=function(t,e,r){if(null==r&&(r=!1),!this.location.isInCurrentRouteParams(t,e))return(r?this.location:this.location.noreload(this.scope)).search(t,e)},t.prototype.replaceAllFilters=function(t,e){return null==e&&(e=!1),(e?this.location:this.location.noreload(this.scope)).search(t)},t.prototype.unselectFilter=function(t,e,r,n){var a,c,u;if(null==r&&(r=!1),null==n&&(n="include"),c=this.location.search(),"exclude"===n&&(t=this.excludePrefix.concat(t)),void 0!==c[t])return void 0!==e&&null!==e||delete c[t],u=_.map(o.toString(c[t]).split(","),function(t){return s(t)}),a=_.reject(u,function(t){return t===o.toString(e)}),a=_.compact(a),e=_.isEmpty(a)?null:i(",",_.uniq(a)),(r?this.location:this.location.noreload(this.scope)).search(t,e)},t.prototype.applyStoredFilters=function(t,e){var r;return!(!_.isEmpty(this.location.search())||(r=this.getFilters(t,e),!Object.keys(r).length))&&(this.location.search(r),this.location.replace(),!0)},t.prototype.storeFilters=function(t,e,r){var n,i;return i=t+":"+r,n=o.generateHash([t,i]),this.storage.set(n,e)},t.prototype.getFilters=function(t,e){var r,n;return n=t+":"+e,r=o.generateHash([t,n]),this.storage.get(r)||{}},t.prototype.formatSelectedFilters=function(t,e,r,n){var i,o,s,a,c;return null==n&&(n="include"),a=r.split(","),s=_.filter(e,function(t){return-1!==a.indexOf(_.toString(t.id))}),o=_.filter(a,function(t){return!_.find(s,function(e){return _.toString(e.id)===t})}),i=_.map(o,function(e){return{id:e,key:t+":"+e,dataType:t,name:e,mode:n}}),c=_.map(s,function(e){return{id:e.id,key:t+":"+e.id,dataType:t,name:e.name,color:e.color,mode:n}}),i.concat(c)},t}(),o.FiltersMixin=t,r=function(){function t(){}return t.prototype.excludePrefix="exclude_",t.prototype.filterCategories=["tags","status","assigned_users","assigned_to","owner","epic","role"],t.prototype.changeQ=function(t){return this.replaceFilter("q",t),this.filtersReloadContent(),this.generateFilters()},t.prototype.removeFilter=function(t){return this.unselectFilter(t.dataType,t.id,!1,t.mode),this.filtersReloadContent(),this.generateFilters()},t.prototype.addFilter=function(t){return this.selectFilter(t.category.dataType,t.filter.id,!1,t.mode),this.filtersReloadContent(),this.generateFilters()},t.prototype.selectCustomFilter=function(t){return this.replaceAllFilters(t.filter),this.filtersReloadContent(),this.generateFilters()},t.prototype.saveCustomFilter=function(t){var e,r,n,i,o,s,a,c;for(r={},a=this.location.search(),n=0,o=(s=this.filterCategories).length;n<o;n++)i=s[n],e=this.excludePrefix.concat(i),r[i]=a[i],r[e]=a[e];return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.storeCustomFiltersName).then((c=this,function(e){return e[t]=r,c.filterRemoteStorageService.storeFilters(c.scope.projectId,e,c.storeCustomFiltersName).then(c.generateFilters)}))},t.prototype.removeCustomFilter=function(t){return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.storeCustomFiltersName).then((e=this,function(r){return delete r[t.id],e.filterRemoteStorageService.storeFilters(e.scope.projectId,r,e.storeCustomFiltersName).then(e.generateFilters),e.generateFilters()}));var e},t.prototype.isFilterDataTypeSelected=function(t){var e,r,n;for(e=0,r=(n=this.selectedFilters).length;e<r;e++)if(n[e].dataType===t)return!0;return!1},t.prototype.generateFilters=function(t){var e,r,n,i,o,s,a,c;for(this.storeFilters(this.params.pslug,this.location.search(),this.storeFiltersName),a=this.location.search(),(o={}).project=this.scope.projectId,o.q=a.q,r=0,i=(s=this.filterCategories).length;r<i;r++)n=s[r],e=this.excludePrefix.concat(n),o[n]=a[n],o[e]=a[e];return o.milestone="null",t&&(o.milestone=t),this.q.all([this.rs.userstories.filtersData(o),this.filterRemoteStorageService.getFilters(this.scope.projectId,this.storeCustomFiltersName)]).then((c=this,function(t){var r,i,s,a,u,l,p,d;for(i=t[0],r=t[1],(s={}).status=_.map(i.statuses,function(t){return t.id=t.id.toString(),t}),s.tags=_.map(i.tags,function(t){return t.id=t.name,t}),d=_.filter(s.tags,function(t){return t.count>0}),s.assigned_users=_.map(i.assigned_users,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),s.assigned_to=_.map(i.assigned_to,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),s.role=_.map(i.roles,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.name||"Unassigned",t}),s.owner=_.map(i.owners,function(t){return t.id=t.id.toString(),t.name=t.full_name,t}),s.epic=_.map(i.epics,function(t){return t.id?(t.id=t.id.toString(),t.name="#"+t.ref+" "+t.subject):(t.id="null",t.name="Not in an epic"),t}),c.selectedFilters=[],a=0,u=(l=c.filterCategories).length;a<u;a++)n=l[a],e=c.excludePrefix.concat(n),o[n]&&(p=c.formatSelectedFilters(n,s[n],o[n]),c.selectedFilters=c.selectedFilters.concat(p)),o[e]&&(p=c.formatSelectedFilters(n,s[n],o[e],"exclude"),c.selectedFilters=c.selectedFilters.concat(p));return c.filterQ=o.q,c.filters=[{title:c.translate.instant("COMMON.FILTERS.CATEGORIES.STATUS"),dataType:"status",content:s.status},{title:c.translate.instant("COMMON.FILTERS.CATEGORIES.TAGS"),dataType:"tags",content:s.tags,hideEmpty:!0,totalTaggedElements:d.length},{title:c.translate.instant("COMMON.FILTERS.CATEGORIES.ASSIGNED_USERS"),dataType:"assigned_users",content:s.assigned_users},{title:c.translate.instant("COMMON.FILTERS.CATEGORIES.ROLE"),dataType:"role",content:s.role},{title:c.translate.instant("COMMON.FILTERS.CATEGORIES.CREATED_BY"),dataType:"owner",content:s.owner},{title:c.translate.instant("COMMON.FILTERS.CATEGORIES.EPIC"),dataType:"epic",content:s.epic}],c.customFilters=[],_.forOwn(r,function(t,e){return c.customFilters.push({id:e,name:e,filter:t})})}))},t}(),o.UsFiltersMixin=r}.call(this),function(){angular.module("taigaAdmin",[])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h={}.hasOwnProperty;d=this.taiga,l=this.taiga.debounce,p=angular.module("taigaAuth",["taigaResources"]),a=function(){function t(t,e,r,n,i){var o;t.isAuthenticated()&&(n.force_login||(o=r.resolve("home"),n.next&&(o=decodeURIComponent(n.next),e.search("next",null)),n.unauthorized?(i.clear(),i.removeToken()):e.url(o)))}return t.$inject=["tgCurrentUserService","$location","$tgNavUrls","$routeParams","$tgAuth"],t}(),p.controller("LoginPage",a),t=function(t){function e(t,r,n,i,o,s,a,c,u,l,p,d){var h;this.rootscope=t,this.storage=r,this.model=n,this.rs=i,this.http=o,this.urls=s,this.config=a,this.translate=c,this.currentUserService=u,this.themeService=l,this.analytics=p,this.termsAnnouncementService=d,e.__super__.constructor.call(this),h=this.getUser(),this._currentTheme=this._getUserTheme(),this.setUserdata(h)}return function(t,e){for(var r in e)h.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,d.Service),e.$inject=["$rootScope","$tgStorage","$tgModel","$tgResources","$tgHttp","$tgUrls","$tgConfig","$translate","tgCurrentUserService","tgThemeService","$tgAnalytics","tgTermsAnnouncementService"],e.prototype.setUserdata=function(t){return t?(this.userData=Immutable.fromJS(t.getAttrs()),this.currentUserService.setUser(this.userData)):this.userData=null,this.analytics.setUserId()},e.prototype._getUserTheme=function(){var t;return(null!=(t=this.rootscope.user)?t.theme:void 0)||this.config.get("defaultTheme")||"taiga"},e.prototype._setTheme=function(){var t;if(t=this._getUserTheme(),this._currentTheme!==t)return this._currentTheme=t,this.themeService.use(this._currentTheme)},e.prototype._setLocales=function(){var t,e;return t=(null!=(e=this.rootscope.user)?e.lang:void 0)||this.config.get("defaultLanguage")||"en",this.translate.preferredLanguage(t),this.translate.use(t)},e.prototype.getUser=function(){var t,e;return this.rootscope.user?this.rootscope.user:(e=this.storage.get("userInfo"))?(t=this.model.make_model("users",e),this.rootscope.user=t,this._setLocales(),this._setTheme(),t):(this._setTheme(),null)},e.prototype.setUser=function(t){return this.rootscope.auth=t,this.storage.set("userInfo",t.getAttrs()),this.rootscope.user=t,this.setUserdata(t),this._setLocales(),this._setTheme()},e.prototype.clear=function(){return this.rootscope.auth=null,this.rootscope.user=null,this.storage.remove("userInfo")},e.prototype.setToken=function(t){return this.storage.set("token",t)},e.prototype.getToken=function(){return this.storage.get("token")},e.prototype.removeToken=function(){return this.storage.remove("token")},e.prototype.isAuthenticated=function(){return null!==this.getUser()},e.prototype.refresh=function(){var t,e;return t=this.urls.resolve("user-me"),this.http.get(t).then((e=this,function(t,r){var n;return(n=t.data).token=e.getUser().auth_token,n=e.model.make_model("users",n),e.setUser(n),e.rootscope.$broadcast("auth:refresh",n),n}))},e.prototype.login=function(t,e){var r,n;return r=this.urls.resolve("auth"),(t=_.clone(t,!1)).type=e||"normal",this.removeToken(),this.http.post(r,t).then((n=this,function(t,e){var r;return r=n.model.make_model("users",t.data),n.setToken(r.auth_token),n.setUser(r),n.rootscope.$broadcast("auth:login",r),r}))},e.prototype.logout=function(){return this.removeToken(),this.clear(),this.currentUserService.removeUser(),this._setTheme(),this._setLocales(),this.rootscope.$broadcast("auth:logout"),this.analytics.setUserId()},e.prototype.register=function(t,e,r){var n,i;return n=this.urls.resolve("auth-register"),(t=_.clone(t,!1)).type=e||"public","private"===e&&(t.existing=r||!1),this.removeToken(),this.http.post(n,t).then((i=this,function(t){var e;return e=i.model.make_model("users",t.data),i.setToken(e.auth_token),i.setUser(e),i.rootscope.$broadcast("auth:register",e),e}))},e.prototype.getInvitation=function(t){return this.rs.invitations.get(t)},e.prototype.acceptInvitiationWithNewUser=function(t){return this.register(t,"private",!1)},e.prototype.forgotPassword=function(t){var e;return e=this.urls.resolve("users-password-recovery"),t=_.clone(t,!1),this.removeToken(),this.http.post(e,t)},e.prototype.changePasswordFromRecovery=function(t){var e;return e=this.urls.resolve("users-change-password-from-recovery"),t=_.clone(t,!1),this.removeToken(),this.http.post(e,t)},e.prototype.changeEmail=function(t){var e;return e=this.urls.resolve("users-change-email"),t=_.clone(t,!1),this.http.post(e,t)},e.prototype.cancelAccount=function(t){var e;return e=this.urls.resolve("users-cancel-account"),t=_.clone(t,!1),this.http.post(e,t)},e.prototype.exportProfile=function(){var t;return t=this.urls.resolve("users-export"),this.http.post(t)},e.prototype.showTerms=function(t){var e;if((e=this.getUser())&&!e.read_new_terms)return this.termsAnnouncementService.show()},e}(),p.service("$tgAuth",t),c=function(t,e,r,n){var i;return i=n.get("auth/login-text.html",!0),{restrict:"AE",scope:{},template:function(){var n;return t.get("publicRegisterEnabled")?(n=e.resolve("register"),r.force_next&&(n+="?next="+encodeURIComponent(r.force_next)),i({url:n})):""}}},p.directive("tgPublicRegisterMessage",["$tgConfig","$tgNavUrls","$routeParams","$tgTemplate",c]),s=function(t,e,r,n,i,o,s,a,c,u){return{link:function(p,d,h){var f,g,m,v;return f=new checksley.Form(d.find("form.login-form")),i.next&&i.next!==o.resolve("login")?p.nextUrl=decodeURIComponent(i.next):p.nextUrl=o.resolve("home"),i.force_next&&(p.nextUrl=decodeURIComponent(i.force_next)),m=function(e){return s.setupConnection(),u.trackEvent("auth","login","user login",1),t.showTerms(),0===p.nextUrl.indexOf("http")?c.location.href=p.nextUrl:r.url(p.nextUrl)},g=function(t){return e.notify("light-error",a.instant("LOGIN_FORM.ERROR_AUTH_INCORRECT"))},p.onKeyUp=function(t){var e;if(e=angular.element(t.currentTarget).val(),p.iscapsLockActivated=!1,e!==e.toLowerCase())return p.iscapsLockActivated=!0},v=l(2e3,function(e){var r,i;if(e.preventDefault(),f.validate())return r={username:d.find("form.login-form input[name=username]").val(),password:d.find("form.login-form input[name=password]").val()},i=n.get("loginFormType","normal"),t.login(r,i).then(m,g)}),d.on("submit","form",v),window.prerenderReady=!0,p.$on("$destroy",function(){return d.off()})}}},p.directive("tgLogin",["$tgAuth","$tgConfirm","$tgLocation","$tgConfig","$routeParams","$tgNavUrls","$tgEvents","$translate","$window","$tgAnalytics",s]),u=function(t,e,r,n,i,o,s,a,c){return{link:function(u,p,d){var h,f,g,m;return i.get("publicRegisterEnabled")||(r.path(n.resolve("not-found")),r.replace()),u.data={},h=p.find("form").checksley({onlyOneErrorElement:!0}),o.next&&o.next!==n.resolve("login")?u.nextUrl=decodeURIComponent(o.next):u.nextUrl=n.resolve("home"),g=function(t){return s.trackEvent("auth","register","user registration",1),0===u.nextUrl.indexOf("http")?c.location.href=u.nextUrl:r.url(u.nextUrl)},f=function(t){var r;return t.data._error_message&&(r=a.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),e.notify("light-error",r)),h.setErrors(t.data)},m=l(2e3,function(e){if(e.preventDefault(),h.validate())return t.register(u.data).then(g,f)}),p.on("submit","form",m),u.$on("$destroy",function(){return p.off()}),window.prerenderReady=!0}}},p.directive("tgRegister",["$tgAuth","$tgConfirm","$tgLocation","$tgNavUrls","$tgConfig","$routeParams","$tgAnalytics","$translate","$window",u]),i=function(t,e,r,n,i){return{link:function(o,s,a){var c,u,p,d;return o.data={},c=s.find("form").checksley(),p=function(t){var o,s;return r.path(n.resolve("login")),s=i.instant("FORGOT_PASSWORD_FORM.SUCCESS_TITLE"),o=i.instant("FORGOT_PASSWORD_FORM.SUCCESS_TEXT"),e.success(s,o)},u=function(t){var r;return r=i.instant("FORGOT_PASSWORD_FORM.ERROR"),e.notify("light-error",r)},d=l(2e3,function(e){if(e.preventDefault(),c.validate())return t.forgotPassword(o.data).then(p,u)}),s.on("submit","form",d),o.$on("$destroy",function(){return s.off()}),window.prerenderReady=!0}}},p.directive("tgForgotPassword",["$tgAuth","$tgConfirm","$tgLocation","$tgNavUrls","$translate",i]),n=function(t,e,r,n,i,o){return{link:function(s,a,c){var u,p,d,h,f;return s.data={},null!=n.token?(s.tokenInParams=!0,s.data.token=n.token):(r.path(i.resolve("login")),f=o.instant("CHANGE_PASSWORD_RECOVERY_FORM.ERROR"),e.notify("light-error",f)),u=a.find("form").checksley(),d=function(t){return r.path(i.resolve("login")),f=o.instant("CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS"),e.success(f)},p=function(t){return f=o.instant("CHANGE_PASSWORD_RECOVERY_FORM.ERROR"),e.notify("light-error",f)},h=l(2e3,function(e){if(e.preventDefault(),u.validate())return t.changePasswordFromRecovery(s.data).then(d,p)}),a.on("submit","form",h),s.$on("$destroy",function(){return a.off()})}}},p.directive("tgChangePasswordFromRecovery",["$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$translate",n]),o=function(t,e,r,n,i,o,s,a,c){return{link:function(u,p,d){var h,f,g,m,v,y,_,b,S,j;return j=i.token,(y=t.getInvitation(j)).then(function(t){return u.invitation=t,u.publicRegisterEnabled=c.get("publicRegisterEnabled")}),y.then(null,function(t){var n;return r.path(o.resolve("login")),n=a.instant("INVITATION_LOGIN_FORM.NOT_FOUND"),e.notify("light-error",n)}),u.dataLogin={token:j},h=p.find("form.login-form").checksley({onlyOneErrorElement:!0}),m=function(t){var n;return s.trackEvent("auth","invitationAccept","invitation accept with existing user",1),r.path(o.resolve("project",{project:u.invitation.project_slug})),n=a.instant("INVITATION_LOGIN_FORM.SUCCESS",{project_name:u.invitation.project_name}),e.notify("success",n)},f=function(t){return e.notify("light-error",t.data._error_message)},b=l(2e3,function(e){var r,i;if(e.preventDefault(),h.validate())return i=n.get("loginFormType","normal"),r=u.dataLogin,(y=t.login({username:r.username,password:r.password,invitation_token:r.token},i)).then(m,f)}),p.on("submit","form.login-form",b),p.on("click",".button-login",b),u.dataRegister={token:j},_=p.find("form.register-form").checksley({onlyOneErrorElement:!0}),v=function(t){var n;return s.trackEvent("auth","invitationAccept","invitation accept with new user",1),r.path(o.resolve("project",{project:u.invitation.project_slug})),n=a.instant("INVITATION_LOGIN_FORM.SUCCESS",{project_name:u.invitation.project_name}),e.notify("success",n)},g=function(t){var r;return t.data._error_message&&(r=a.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),e.notify("light-error",r)),_.setErrors(t.data)},S=l(2e3,function(e){if(e.preventDefault(),_.validate())return(y=t.acceptInvitiationWithNewUser(u.dataRegister)).then(v,g)}),p.on("submit","form.register-form",S),p.on("click",".button-register",S),u.$on("$destroy",function(){return p.off()})}}},p.directive("tgInvitation",["$tgAuth","$tgConfirm","$tgLocation","$tgConfig","$routeParams","$tgNavUrls","$tgAnalytics","$translate","$tgConfig",o]),r=function(t,e,r,n,i,o,s,a){return{link:function(e,c,u){var l,p,d,h;return e.data={},e.data.email_token=o.email_token,l=c.find("form").checksley(),d=function(e){var o;return r.isAuthenticated()?t.queryOne("users",r.getUser().id).then(function(t){return r.setUser(t),i.path(s.resolve("home")),i.replace()}):(i.path(s.resolve("login")),i.replace()),o=a.instant("CHANGE_EMAIL_FORM.SUCCESS"),n.success(o)},p=function(t){var e;return e=a.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),n.notify("light-error",e)},h=function(){if(l.validate())return r.changeEmail(e.data).then(d,p)},c.on("submit",function(t){return t.preventDefault(),h()}),c.on("click","a.button-change-email",function(t){return t.preventDefault(),h()}),e.$on("$destroy",function(){return c.off()})}}},p.directive("tgChangeEmail",["$tgRepo","$tgModel","$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$translate",r]),e=function(t,e,r,n,i,o,s){return{link:function(t,e,a){var c,u,p,d;return t.data={},t.data.cancel_token=o.cancel_token,c=e.find("form").checksley(),p=function(t){var e;return r.logout(),i.path(s.resolve("home")),e=$translate.instant("CANCEL_ACCOUNT.SUCCESS"),n.success(e)},u=function(t){var e;return e=$translate.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),n.notify("error",e)},d=l(2e3,function(e){if(e.preventDefault(),c.validate())return r.cancelAccount(t.data).then(p,u)}),e.on("submit","form",d),t.$on("$destroy",function(){return e.off()})}}},p.directive("tgCancelAccount",["$tgRepo","$tgModel","$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls",e])}.call(this),function(){angular.module("taigaBacklog",[])}.call(this),function(){var t,e,r,n;this.taiga,this.taiga.groupBy,this.taiga.bindOnce,t=function(t,e){return{link:function(r,n,i){return e.onresize=function(){return t.$broadcast("resize")}}}},(r=angular.module("taigaBase",[])).directive("tgMain",["$rootScope","$window",t]),n={home:"/",projects:"/projects",error:"/error","not-found":"/not-found","permission-denied":"/permission-denied",discover:"/discover","discover-search":"/discover/search",login:"/login","forgot-password":"/forgot-password","change-password":"/change-password/:token","change-email":"/change-email/:token","cancel-account":"/cancel-account/:token",register:"/register",invitation:"/invitation/:token","create-project":"/project/new","create-project-scrum":"/project/new/scrum","create-project-kanban":"/project/new/kanban","create-project-duplicate":"/project/new/duplicate","create-project-import":"/project/new/import","create-project-import-platform":"/project/new/import/:platform",profile:"/profile","user-profile":"/profile/:username","blocked-project":"/blocked-project/:project",project:"/project/:project","project-detail-ref":"/project/:project/t/:ref","project-backlog":"/project/:project/backlog","project-taskboard":"/project/:project/taskboard/:sprint","project-kanban":"/project/:project/kanban","project-issues":"/project/:project/issues","project-epics":"/project/:project/epics","project-search":"/project/:project/search","project-timeline":"/project/:project/timeline","project-epics-detail":"/project/:project/epic/:ref","project-userstories-detail":"/project/:project/us/:ref","project-tasks-detail":"/project/:project/task/:ref","project-issues-detail":"/project/:project/issue/:ref","project-wiki":"/project/:project/wiki","project-wiki-list":"/project/:project/wiki-list","project-wiki-page":"/project/:project/wiki/:slug","project-team":"/project/:project/team","project-admin-home":"/project/:project/admin/project-profile/details","project-admin-project-profile-details":"/project/:project/admin/project-profile/details","project-admin-project-profile-default-values":"/project/:project/admin/project-profile/default-values","project-admin-project-profile-modules":"/project/:project/admin/project-profile/modules","project-admin-project-profile-export":"/project/:project/admin/project-profile/export","project-admin-project-profile-reports":"/project/:project/admin/project-profile/reports","project-admin-project-values-status":"/project/:project/admin/project-values/status","project-admin-project-values-points":"/project/:project/admin/project-values/points","project-admin-project-values-priorities":"/project/:project/admin/project-values/priorities","project-admin-project-values-severities":"/project/:project/admin/project-values/severities","project-admin-project-values-types":"/project/:project/admin/project-values/types","project-admin-project-values-custom-fields":"/project/:project/admin/project-values/custom-fields","project-admin-project-values-tags":"/project/:project/admin/project-values/tags","project-admin-project-values-due-dates":"/project/:project/admin/project-values/due-dates","project-admin-memberships":"/project/:project/admin/memberships","project-admin-roles":"/project/:project/admin/roles","project-admin-third-parties-webhooks":"/project/:project/admin/third-parties/webhooks","project-admin-third-parties-github":"/project/:project/admin/third-parties/github","project-admin-third-parties-gitlab":"/project/:project/admin/third-parties/gitlab","project-admin-third-parties-bitbucket":"/project/:project/admin/third-parties/bitbucket","project-admin-third-parties-gogs":"/project/:project/admin/third-parties/gogs","project-admin-contrib":"/project/:project/admin/contrib/:plugin","user-settings-user-profile":"/user-settings/user-profile","user-settings-user-change-password":"/user-settings/user-change-password","user-settings-user-avatar":"/user-settings/user-avatar","user-settings-user-project-settings":"/user-settings/user-project-settings","user-settings-mail-notifications":"/user-settings/mail-notifications","user-settings-live-notifications":"/user-settings/live-notifications","user-settings-web-notifications":"/user-settings/web-notifications","user-settings-contrib":"/user-settings/contrib/:plugin",notifications:"/notifications"},e=function(t,e){return t.debug("Initialize navigation urls"),e.update(n)},r.run(["$log","$tgNavUrls",e])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v=[].slice,y={}.hasOwnProperty;m=this.taiga,s=function(t,e,r){return{get:function(){var n,i,o;return i=(null!=(o=r.getUser())?o.lang:void 0)||t.preferredLanguage(),n=e.get("rtlLanguages",[]).indexOf(i)>-1,{i18n:{previousMonth:t.instant("COMMON.PICKERDATE.PREV_MONTH"),nextMonth:t.instant("COMMON.PICKERDATE.NEXT_MONTH"),months:[t.instant("COMMON.PICKERDATE.MONTHS.JAN"),t.instant("COMMON.PICKERDATE.MONTHS.FEB"),t.instant("COMMON.PICKERDATE.MONTHS.MAR"),t.instant("COMMON.PICKERDATE.MONTHS.APR"),t.instant("COMMON.PICKERDATE.MONTHS.MAY"),t.instant("COMMON.PICKERDATE.MONTHS.JUN"),t.instant("COMMON.PICKERDATE.MONTHS.JUL"),t.instant("COMMON.PICKERDATE.MONTHS.AUG"),t.instant("COMMON.PICKERDATE.MONTHS.SEP"),t.instant("COMMON.PICKERDATE.MONTHS.OCT"),t.instant("COMMON.PICKERDATE.MONTHS.NOV"),t.instant("COMMON.PICKERDATE.MONTHS.DEC")],weekdays:[t.instant("COMMON.PICKERDATE.WEEK_DAYS.SUN"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.MON"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.TUE"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.WED"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.THU"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.FRI"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.SAT")],weekdaysShort:[t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT")]},isRTL:n,firstDay:parseInt(t.instant("COMMON.PICKERDATE.FIRST_DAY_OF_WEEK"),10),format:t.instant("COMMON.PICKERDATE.FORMAT")}}}},(g=angular.module("taigaCommon",[])).factory("tgDatePickerConfigService",["$translate","$tgConfig","$tgAuth",s]),p=function(t,e){return{get:function(){return t.getSelection?t.getSelection().toString():e.selection?e.selection.createRange().text:""}}},g.factory("$selectedText",["$window","$document",p]),(n=function(t){var e;return e=function(t,e,r){if(e&&r&&e.get("my_permissions").indexOf(r)>-1)return t.removeClass("hidden")},{link:function(r,n,i){var o,s,a;return n.addClass("hidden"),o=i.tgCheckPermission,a=r.$watch(function(){return t.project},function(){if(t.project)return e(n,t.project,o),a()}),s=i.$observe("tgCheckPermission",function(r){if(r)return e(n,t.project,r),s()}),r.$on("$destroy",function(){return n.off()})}}}).$inject=["tgProjectService"],g.directive("tgCheckPermission",n),i=function(){var t;return t="tgClassPermission",{link:function(e,r,n){var i,o,s;return i=function(t,e,n){var i;return(i="!"===n[0])&&(n=n.slice(1)),i&&-1===t.my_permissions.indexOf(n)?r.addClass(e):i||-1===t.my_permissions.indexOf(n)?r.removeClass(e):r.addClass(e)},o=function(r){var o,a,c,u;if(r){for(o in s(),u=[],a=e.$eval(n[t]))c=a[o],u.push(i(r,o,c));return u}},s=e.$watch("project",o)}}},g.directive("tgClassPermission",i),t=function(){var t,e,r;return t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,e=function(n){if(r.shift()(),r.length)return t(e)},r=[],{add:function(){var n,i,o,s;for(s=[],i=0,o=arguments.length;i<o;i++)n=arguments[i],r.push(n),1===r.length?s.push(t(e)):s.push(void 0);return s}}},g.factory("animationFrame",t),f=function(){return{link:function(t,e,r){return e.find("textarea").on("focus",function(){return e.addClass("active")})}}},g.directive("tgToggleComment",f),c=function(t){return{get:function(e){var r;return e.toJS&&(e=e.toJS()),r={project:e.slug},e.is_backlog_activated&&e.my_permissions.indexOf("view_us")>-1?t.resolve("project-backlog",r):e.is_kanban_activated&&e.my_permissions.indexOf("view_us")>-1?t.resolve("project-kanban",r):e.is_wiki_activated&&e.my_permissions.indexOf("view_wiki_pages")>-1?t.resolve("project-wiki",r):e.is_issues_activated&&e.my_permissions.indexOf("view_issues")>-1?t.resolve("project-issues",r):t.resolve("project",r)}}},g.factory("$projectUrl",["$tgNavUrls",c]),u=function(t){var e,r,n,i;return(e=t.defer()).resolve(),r=e.promise,n={bindAdd:(i=this,function(t){return function(){var e;return e=1<=arguments.length?v.call(arguments,0):[],r=r.then(function(){return t.apply(i,e)})}}),add:function(t){return r=r?r.then(t):t(),n}}},g.factory("$tgQqueue",["$q",u]),l=function(t){function e(t,e,r,n){this.qqueue=t,this.repo=e,this.q=r,this.model=n}return function(t,e){for(var r in e)y.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,m.Service),e.$inject=["$tgQqueue","$tgRepo","$q","$tgModel"],e.prototype.setObject=function(t,e){this.scope=t,this.prop=e},e.prototype.clone=function(){var t;return t=_.cloneDeep(this.scope[this.prop]._attrs),this.model.make_model(this.scope[this.prop]._name,t)},e.prototype.getObj=function(){return this.scope[this.prop]},e.prototype.save=function(t){var e,r;return e=this.q.defer(),this.qqueue.add((r=this,function(){var n,i,o,s,a;return i=(s=r.getObj()).comment,s.comment="",n=r.clone(),o=_.omit(s._modifiedAttrs,["version"]),n=_.assign(n,o),t(n),i.length&&(n.comment=i),a=function(){return r.scope[r.prop]=n,e.resolve.apply(null,arguments)},r.repo.save(n).then(a,e.reject)})),e.promise},e}(),g.service("$tgQueueModelTransformation",l),h=function(t){return{get:function(e,r){var n;return null==r&&(r=!1),n=t.get(e),r&&(n=_.template(n)),n}}},g.factory("$tgTemplate",["$templateCache",h]),r=function(){return{template:"<tg-svg class=\"capslock\" ng-if=\"capslockIcon && iscapsLockActivated\" svg-icon='icon-capslock' svg-title='COMMON.CAPSLOCK_WARNING'></tg-svg>"}},g.directive("tgCapslock",[r]),a=function(){return{scope:{onClose:"&"},link:function(t,e,r){},template:'<a class="close" ng-click="onClose()" href="" title="{{\'COMMON.CLOSE\' | translate}}">\n    <tg-svg svg-icon="icon-close"></tg-svg>\n</a>'}},g.directive("tgLightboxClose",[a]),d=function(){return{scope:{svgIcon:"@",svgTitle:"@",svgTitleTranslate:"@",svgTitleTranslateValues:"=",svgFill:"="},template:'<svg class="{{ \'icon \' + svgIcon }}" style="fill: {{ svgFill }}">\n    <use xlink:href="" ng-attr-xlink:href="{{ \'#\' + svgIcon }}" href="{{ \'#\' + svgIcon }}">\n        <title ng-if="svgTitle">{{svgTitle}}</title>\n        <title ng-if="svgTitleTranslate">{{svgTitleTranslate | translate: svgTitleTranslateValues}}</title>\n    </use>\n</svg>'}},g.directive("tgSvg",[d]),e=function(t,e,r){return{restrict:"A",link:function(r,n,i){var o;return i.ngShow?(o=e(i.ngShow),r.$watch(o,function(e){if(!0===e)return t(function(){return n[0].focus()})})):t(function(){return n[0].focus()})}}},g.directive("tgAutofocus",["$timeout","$parse","animationFrame",e]),g.directive("tgPreloadImage",function(){var t,e;return e="<img class='loading-spinner' src='/"+window._version+"/svg/spinner-circle.svg' alt='loading...' />",t=function(t,e){var r;return(r=new Image).onload=e,r.src=t,r},{template:"<div>\n    <ng-transclude></ng-transclude>\n</div>",transclude:!0,replace:!0,link:function(r,n,i){var o,s,a;return o=n.find("img:last"),a=null,s=function(){if(n.find(".loading-spinner").remove(),o.show(),a)return clearTimeout(a),a=null},i.$observe("preloadSrc",function(r){return a&&clearTimeout(a),n.find(".loading-spinner").remove(),a=setTimeout(function(){return n.prepend(e)},200),o.hide(),t(r,s)})}}}),o=function(){return{link:function(t,e,r){return e.on("click",function(t){if(t.ctrlKey||t.metaKey)return t.preventDefault()})}}},g.directive("tgCtrlClickDisable",o)}.call(this),function(){var t,e;this.taiga,this.taiga.mixOf,this.taiga.toString,this.taiga.joinStr,this.taiga.groupBy,this.taiga.bindOnce,this.taiga.bindMethods,e=angular.module("taigaCommon"),t=function(){function t(t,e,r,n,i){var o;this.params=t,this.repo=e,this.projectService=r,this.navurls=n,this.location=i,this.repo.resolve({pslug:this.params.pslug,ref:this.params.ref}).then((o=this,function(t){var e;return t.issue?e=o.navurls.resolve("project-issues-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.task?e=o.navurls.resolve("project-tasks-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.us?e=o.navurls.resolve("project-userstories-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.epic?e=o.navurls.resolve("project-epics-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.wikipage&&(e=o.navurls.resolve("project-wiki-page",{project:o.projectService.project.get("slug"),slug:o.params.ref})),o.location.path(e)}))}return t.$inject=["$routeParams","$tgRepo","tgProjectService","$tgNavUrls","$location"],t}(),e.controller("DetailController",t)}.call(this),function(){angular.module("taigaEpics",[])}.call(this),function(){var t,e,r,n,i,o,s=function(t,e){return function(){return t.apply(e,arguments)}};o=this.taiga,i=this.taiga.startswith,r=this.taiga.bindMethods,n=angular.module("taigaEvents",[]),e=function(){function t(t,e,n,i,o,a){this.win=t,this.log=e,this.config=n,this.auth=i,this.liveAnnouncementService=o,this.rootScope=a,this.processMessage=s(this.processMessage,this),r(this)}return t.prototype.initialize=function(t){if(this.sessionId=t,this.subscriptions={},this.connected=!1,this.error=!1,this.pendingMessages=[],this.missedHeartbeats=0,this.heartbeatInterval=null,void 0===this.win.WebSocket)return this.log.info("WebSockets not supported on your browser")},t.prototype.setupConnection=function(){var t,e,r,n;if(this.stopExistingConnection(),n=this.config.get("eventsUrl"))return i(n,"ws:")||i(n,"wss:")||(r="https:"===(t=this.win.location).protocol?"wss:":"ws:",e=_.trimStart(n,"/"),n=r+"//"+t.host+"/"+e),this.error=!1,this.ws=new this.win.WebSocket(n),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("error",this.onError),this.ws.addEventListener("close",this.onClose)},t.prototype.stopExistingConnection=function(){if(void 0!==this.ws)return this.ws.removeEventListener("open",this.onOpen),this.ws.removeEventListener("close",this.onClose),this.ws.removeEventListener("error",this.onError),this.ws.removeEventListener("message",this.onMessage),this.stopHeartBeatMessages(),this.ws.close(),delete this.ws},t.prototype.notifications=function(){return this.subscribe(null,"notifications",(t=this,function(e){return t.liveAnnouncementService.show(e.title,e.desc),t.rootScope.$digest()}));var t},t.prototype.liveNotifications=function(){var t,e,r;if(null!=this.auth.userData)return e=this.auth.userData.get("id"),r=this,t=function(){return r.subscribe(null,"live_notifications."+e,function(t){var e;if((e=new Notification(t.title,{icon:"/"+window._version+"/images/favicon.png",body:t.body,tag:t.id})).onshow=function(){if(t.timeout&&t.timeout>0)return setTimeout(function(){return e.close()},t.timeout)},t.url)return e.onclick=function(){return window.open(t.url)}})},Notification?"granted"===Notification.permission?t():"denied"!==Notification.permission?Notification.requestPermission(function(e){if("granted"===e)return t()}):void 0:console.log("This browser does not support desktop notification")},t.prototype.webNotifications=function(){var t,e;if(null!=this.auth.userData)return t="web_notifications."+this.auth.userData.get("id"),o.randomInt(700,1e3),this.subscribe(null,t,(e=this,function(t){return e.rootScope.$broadcast("notifications:new")}))},t.prototype.startHeartBeatMessages=function(){var t,e,r;if(!this.heartbeatInterval)return e=this.config.get("eventsMaxMissedHeartbeats",5),t=this.config.get("eventsHeartbeatIntervalTime",6e4),this.config.get("eventsReconnectTryInterval",1e4),this.missedHeartbeats=0,this.heartbeatInterval=setInterval((r=this,function(){var t;try{if(r.missedHeartbeats>=e)throw new Error("Too many missed heartbeats PINGs.");return r.missedHeartbeats++,r.sendMessage({cmd:"ping"}),r.log.debug("HeartBeat send PING")}catch(e){return t=e,r.log.error("HeartBeat error: "+t.message),r.setupConnection()}}),t),this.log.debug("HeartBeat enabled")},t.prototype.stopHeartBeatMessages=function(){if(this.heartbeatInterval)return clearInterval(this.heartbeatInterval),this.heartbeatInterval=null,this.log.debug("HeartBeat disabled")},t.prototype.processHeartBeatPongMessage=function(t){return this.missedHeartbeats=0,this.log.debug("HeartBeat recived PONG")},t.prototype.serialize=function(t){return _.isObject(t)?JSON.stringify(t):t},t.prototype.sendMessage=function(t){var e,r,n,i,o;if(this.pendingMessages.push(t),this.connected){for(n=_.map(this.pendingMessages,this.serialize),this.pendingMessages=[],o=[],e=0,r=n.length;e<r;e++)i=n[e],o.push(this.ws.send(i));return o}},t.prototype.processMessage=function(t){var e,r;if(e=t.routing_key,null!=this.subscriptions[e])return(r=this.subscriptions[e]).scope?r.scope.$apply(function(){return r.callback(t.data)}):r.callback(t.data)},t.prototype.subscribe=function(t,e,r){var n,i,o;if(!this.error)return this.log.debug("Subscribe to: "+e),i={scope:t,routingKey:e,callback:r},n={cmd:"subscribe",routing_key:e},this.subscriptions[e]=i,this.sendMessage(n),t?t.$on("$destroy",(o=this,function(){return o.unsubscribe(e)})):void 0},t.prototype.unsubscribe=function(t){var e;if(!this.error)return this.log.debug("Unsubscribe from: "+t),e={cmd:"unsubscribe",routing_key:t},this.sendMessage(e)},t.prototype.onOpen=function(){var t;return this.connected=!0,this.log.debug("WebSocket connection opened"),t={cmd:"auth",data:{token:this.auth.getToken(),sessionId:this.sessionId}},this.sendMessage(t),this.startHeartBeatMessages(),this.notifications(),this.liveNotifications(),this.webNotifications()},t.prototype.onMessage=function(t){var e;return this.log.debug("WebSocket message received: "+t.data),"pong"===(e=JSON.parse(t.data)).cmd?this.processHeartBeatPongMessage(e):this.processMessage(e)},t.prototype.onError=function(t){return this.log.error("WebSocket error: "+t),this.error=!0,setTimeout(this.setupConnection,this.reconnectTryInterval)},t.prototype.onClose=function(){return this.log.debug("WebSocket closed."),this.connected=!1,this.stopHeartBeatMessages(),setTimeout(this.setupConnection,this.reconnectTryInterval)},t}(),t=function(){function t(){}return t.prototype.setSessionId=function(t){return this.sessionId=t},t.prototype.$get=function(t,r,n,i,o,s){var a;return(a=new e(t,r,n,i,o,s)).initialize(this.sessionId),a},t.prototype.$get.$inject=["$window","$log","$tgConfig","$tgAuth","tgLiveAnnouncementService","$rootScope"],t}(),n.provider("$tgEvents",t)}.call(this),function(){var t,e;this.taiga,this.taiga.groupBy,this.taiga.bindOnce,this.taiga.mixOf,e=this.taiga.debounce,this.taiga.trim,t=function(t,r,n,i,o){return{link:function(o,s,a){var c,u,l,p;return c=s.find("form").checksley(),l=e(2e3,function(e){var a,u;if(e.preventDefault(),c.validate())return a=i().target(p).start(),(u=r.create("feedback",o.feedback)).then(function(e){return a.finish(),t.close(s),n.notify("success","\\o/ we'll be happy to read your")}),u.then(null,function(){return a.finish(),n.notify("error")})}),p=s.find(".submit-button"),s.on("submit","form",l),u=function(){return o.feedback={},t.open(s),s.find("textarea").focus()},o.$on("$destroy",function(){return s.off()}),u()},templateUrl:"common/lightbox-feedback.html",scope:{}}},angular.module("taigaFeedback",[]).directive("tgLbFeedback",["lightboxService","$tgRepo","$tgConfirm","$tgLoading","tgFeedbackService",t])}.call(this),function(){angular.module("taigaIntegrations",[])}.call(this),function(){angular.module("taigaIssues",[])}.call(this),function(){angular.module("taigaKanban",[])}.call(this),function(){angular.module("taigaPlugins",["ngRoute"])}.call(this),function(){angular.module("taigaProject",[])}.call(this),function(){var t,e,r,n,i,o,s,a;a=this.taiga,this.taiga.trim,o=this.taiga.debounce,n=function(t,e,r,n,i,s,a,c){var u,l;return l=s.get("task/related-task-row.html",!0),u=s.get("task/related-task-row-edit.html",!0),{link:function(s,p,d,h){var f,g,m;return this.childScope=s.$new(),m=o(2e3,function(e){var o,s;return e.subject=p.find("input").val(),o=i().target(p.find(".task-name")).start(),(s=t.save(e)).then(function(){return o.finish(),n.$broadcast("related-tasks:update")}),s.then(null,function(){return o.finish(),p.find("input").val(e.subject),r.notify("error")}),s}),f=function(t){return this.childScope.$destroy(),this.childScope=s.$new(),p.off(),p.html(e(u({task:t}))(childScope)),p.find(".task-name input").val(t.subject),p.on("keyup","input",function(t){return 13===t.keyCode?m(h.$modelValue).then(function(){return g(h.$modelValue)}):27===t.keyCode?g(h.$modelValue):void 0}),p.on("click",".save-task",function(t){return m(h.$modelValue).then(function(){return g(h.$modelValue)})}),p.on("click",".cancel-edit",function(t){return g(h.$modelValue)})},g=function(n){var i;return i={modify_task:-1!==s.project.my_permissions.indexOf("modify_task"),delete_task:-1!==s.project.my_permissions.indexOf("delete_task")},p.html(e(l({task:n,perms:i,emojify:function(t){return c.replaceEmojiNameByHtmlImgs(_.escape(t))}}))(s)),p.on("click",".edit-task",function(){return f(h.$modelValue),p.find("input").focus().select()}),p.on("click",".delete-task",function(e){var i,o;return o=a.instant("TASK.TITLE_DELETE_ACTION"),i=(n=h.$modelValue).subject,r.askOnDelete(o,i).then(function(e){var i;return(i=t.remove(n)).then(function(){return e.finish(),s.$emit("related-tasks:delete")}),i.then(null,function(){return e.finish(!1),r.notify("error")})})})},s.$watch(d.ngModel,function(t){if(t)return g(t)}),s.$on("related-tasks:assigned-to-changed",function(){return n.$broadcast("related-tasks:update")}),s.$on("related-tasks:status-changed",function(){return n.$broadcast("related-tasks:update")}),s.$on("$destroy",function(){return p.off()})},require:"ngModel"}},(s=angular.module("taigaRelatedTasks",[])).directive("tgRelatedTaskRow",["$tgRepo","$compile","$tgConfirm","$rootScope","$tgLoading","$tgTemplate","$translate","$tgEmojis",n]),r=function(t,e,r,n,i,o){var s;return s={subject:"",assigned_to:null},{scope:!0,link:function(e,c,u){var l,p,d,h;return p=function(n){var s,a;return n.subject=c.find("input").val(),n.assigned_to=e.newTask.assigned_to,n.status=e.newTask.status,e.newTask.status=e.project.default_task_status,e.newTask.assigned_to=null,s=i().target(c.find(".task-name")).start(),(a=t.create("tasks",n)).then(function(){return o.trackEvent("task","create","create task on userstory",1),s.finish(),e.$emit("related-tasks:add")}),a.then(null,function(){return c.find("input").val(n.subject),s.finish(),r.notify("error")}),a},l=function(){return c.off(),e.openNewRelatedTask=!1},h=function(){return(s={subject:"",assigned_to:null}).status=e.project.default_task_status,s.project=e.project.id,s.user_story=e.us.id,e.newTask=n.make_model("tasks",s)},d=function(){if(!e.openNewRelatedTask)return e.openNewRelatedTask=!0,c.on("keyup","input",function(t){return 13===t.keyCode?p(s).then(function(){return h(),c.find("input").focus()}):27===t.keyCode?e.$apply(function(){return l()}):void 0})},e.save=function(){return p(s).then(function(){return l()})},a.bindOnce(e,"us",h),e.$on("related-tasks:show-form",function(){return e.$apply(d)}),e.$on("$destroy",function(){return c.off()})},templateUrl:"task/related-task-create-form.html"}},s.directive("tgRelatedTaskCreateForm",["$tgRepo","$compile","$tgConfirm","$tgModel","$tgLoading","$tgAnalytics",r]),e=function(t,e,r,n,i){var o;return o=i.get("common/components/add-button.html",!0),{link:function(t,r,n){return t.$watch("project",function(n){if(n)return r.off(),-1!==t.project.my_permissions.indexOf("add_task")?r.html(e(o())(t)):r.html(""),r.on("click",".add-button",function(e){return t.$emit("related-tasks:add-new-clicked")})}),t.$on("$destroy",function(){return r.off()})}}},s.directive("tgRelatedTaskCreateButton",["$tgRepo","$compile","$tgConfirm","$tgModel","$tgTemplate",e]),i=function(t,e,r){return{link:function(t,n,i){var o,s,c;return c=function(){return e.tasks.list(t.projectId,null,t.usId).then(function(t){return Immutable.fromJS(t.data)})},s=function(){return!!t.project&&-1!==t.project.my_permissions.indexOf("view_tasks")},o=function(){return!!t.project&&-1!==t.project.my_permissions.indexOf("modify_task")},t.reorderTask=function(t,e){return r.$broadcast("task:reorder",t,e)},t.showRelatedTasks=function(){var e;return s()&&(o()||(null!=(e=t.tasks)?e.length:void 0))},t.$on("related-tasks:add",function(){return c().then(function(){return r.$broadcast("related-tasks:update")})}),t.$on("related-tasks:reordered",function(){return c()}),t.$on("related-tasks:delete",function(){return c().then(function(){return r.$broadcast("related-tasks:update")})}),t.$on("related-tasks:add-new-clicked",function(){return t.$broadcast("related-tasks:show-form")}),a.bindOnce(t,"us",function(t){return c()}),t.$on("$destroy",function(){return n.off()})}}},s.directive("tgRelatedTasks",["$tgRepo","$tgResources","$rootScope",i]),t=function(t,e,r,n){var i;return i=_.template('<img style="background-color: <%- bg %>" src="<%- imgurl %>" alt="<%- name %>"/>\n<figcaption><%- name %></figcaption>'),{link:function(s,c,u){var l,p,d,h;return h=function(t){var e,o,a;return o={name:r.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED")},a=s.usersById[t.assigned_to],e=n.getAvatar(a),o.imgurl=e.url,o.bg=e.bg,a&&(o.name=a.full_name_display),c.find(".avatar").html(i(o)),c.find(".task-assignedto").attr("title",o.name)},c.controller(),d=s.$eval(u.tgRelatedTaskAssignedToInlineEdition),p=s.$eval(u.notAutoSave),l=!p,s.$watch(u.tgRelatedTaskAssignedToInlineEdition,function(){return d=s.$eval(u.tgRelatedTaskAssignedToInlineEdition),h(d)}),h(d),c.on("click",".task-assignedto",function(t){return e.$broadcast("assigned-to:add",d)}),a.bindOnce(s,"project",function(t){if(-1===t.my_permissions.indexOf("modify_task"))return c.unbind("click"),c.find("a").addClass("not-clickable")}),s.$on("assigned-to:added",o(2e3,function(e,r,n){if(n.id===d.id)return n.assigned_to=r,l&&t.save(n).then(function(){return s.$emit("related-tasks:assigned-to-changed")}),h(n)})),s.$on("$destroy",function(){return c.off()})}}},s.directive("tgRelatedTaskAssignedToInlineEdition",["$tgRepo","$rootScope","$translate","tgAvatarService",t])}.call(this),function(){var t,e,r,n,i,o,s={}.hasOwnProperty;i=this.taiga,t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,i.Service),e}(),o={auth:"/auth","auth-register":"/auth/register",invitations:"/invitations",users:"/users",by_username:"/users/by_username","users-password-recovery":"/users/password_recovery","users-change-password-from-recovery":"/users/change_password_from_recovery","users-change-password":"/users/change_password","users-change-email":"/users/change_email","users-cancel-account":"/users/cancel","users-export":"/users/export","user-stats":"/users/%s/stats","user-liked":"/users/%s/liked","user-voted":"/users/%s/voted","user-watched":"/users/%s/watched","user-contacts":"/users/%s/contacts","user-me":"/users/me",permissions:"/permissions","notify-policies":"/notify-policies",notifications:"/web-notifications","user-project-settings":"/user-project-settings","user-storage":"/user-storage",memberships:"/memberships","bulk-create-memberships":"/memberships/bulk_create",roles:"/roles",permissions:"/permissions",resolver:"/resolver",projects:"/projects","project-templates":"/project-templates","project-modules":"/projects/%s/modules","bulk-update-projects-order":"/projects/bulk_update_order","project-like":"/projects/%s/like","project-unlike":"/projects/%s/unlike","project-watch":"/projects/%s/watch","project-unwatch":"/projects/%s/unwatch","project-contact":"contact","project-transfer-validate-token":"/projects/%s/transfer_validate_token","project-transfer-accept":"/projects/%s/transfer_accept","project-transfer-reject":"/projects/%s/transfer_reject","project-transfer-request":"/projects/%s/transfer_request","project-transfer-start":"/projects/%s/transfer_start","epic-statuses":"/epic-statuses","userstory-statuses":"/userstory-statuses","userstory-due-dates":"/userstory-due-dates","userstory-due-dates-create-default":"/userstory-due-dates/create_default",points:"/points","task-statuses":"/task-statuses","task-due-dates":"/task-due-dates","task-due-dates-create-default":"/task-due-dates/create_default","issue-statuses":"/issue-statuses","issue-due-dates":"/issue-due-dates","issue-due-dates-create-default":"/issue-due-dates/create_default","issue-types":"/issue-types",priorities:"/priorities",severities:"/severities",milestones:"/milestones","move-userstories-to-milestone":"/milestones/%s/move_userstories_to_sprint","move-tasks-to-milestone":"/milestones/%s/move_tasks_to_sprint","move-issues-to-milestone":"/milestones/%s/move_issues_to_sprint",epics:"/epics","epic-upvote":"/epics/%s/upvote","epic-downvote":"/epics/%s/downvote","epic-watch":"/epics/%s/watch","epic-unwatch":"/epics/%s/unwatch","epic-related-userstories":"/epics/%s/related_userstories","epic-related-userstories-bulk-create":"/epics/%s/related_userstories/bulk_create",userstories:"/userstories","bulk-create-us":"/userstories/bulk_create","bulk-update-us-backlog-order":"/userstories/bulk_update_backlog_order","bulk-update-us-milestone":"/userstories/bulk_update_milestone","bulk-update-us-miles-order":"/userstories/bulk_update_sprint_order","bulk-update-us-kanban-order":"/userstories/bulk_update_kanban_order","userstories-filters":"/userstories/filters_data","userstory-upvote":"/userstories/%s/upvote","userstory-downvote":"/userstories/%s/downvote","userstory-watch":"/userstories/%s/watch","userstory-unwatch":"/userstories/%s/unwatch",tasks:"/tasks","bulk-create-tasks":"/tasks/bulk_create","bulk-update-task-taskboard-order":"/tasks/bulk_update_taskboard_order","bulk-update-task-milestone":"/tasks/bulk_update_milestone","task-upvote":"/tasks/%s/upvote","task-downvote":"/tasks/%s/downvote","task-watch":"/tasks/%s/watch","task-unwatch":"/tasks/%s/unwatch","task-filters":"/tasks/filters_data",issues:"/issues","bulk-create-issues":"/issues/bulk_create","bulk-update-issue-milestone":"/issues/bulk_update_milestone","issues-filters":"/issues/filters_data","issue-upvote":"/issues/%s/upvote","issue-downvote":"/issues/%s/downvote","issue-watch":"/issues/%s/watch","issue-unwatch":"/issues/%s/unwatch",wiki:"/wiki","wiki-restore":"/wiki/%s/restore","wiki-links":"/wiki-links","history/epic":"/history/epic","history/us":"/history/userstory","history/issue":"/history/issue","history/task":"/history/task","history/wiki":"/history/wiki","attachments/epic":"/epics/attachments","attachments/us":"/userstories/attachments","attachments/issue":"/issues/attachments","attachments/task":"/tasks/attachments","attachments/wiki_page":"/wiki/attachments","custom-attributes/epic":"/epic-custom-attributes","custom-attributes/userstory":"/userstory-custom-attributes","custom-attributes/task":"/task-custom-attributes","custom-attributes/issue":"/issue-custom-attributes","custom-attributes-values/epic":"/epics/custom-attributes-values","custom-attributes-values/userstory":"/userstories/custom-attributes-values","custom-attributes-values/task":"/tasks/custom-attributes-values","custom-attributes-values/issue":"/issues/custom-attributes-values",webhooks:"/webhooks","webhooks-test":"/webhooks/%s/test",webhooklogs:"/webhooklogs","webhooklogs-resend":"/webhooklogs/%s/resend","epics-csv":"/epics/csv?uuid=%s","userstories-csv":"/userstories/csv?uuid=%s","tasks-csv":"/tasks/csv?uuid=%s","issues-csv":"/issues/csv?uuid=%s","timeline-profile":"/timeline/profile","timeline-user":"/timeline/user","timeline-project":"/timeline/project",search:"/search",exporter:"/exporter",importer:"/importer/load_dump",feedback:"/feedback",locales:"/locales",applications:"/applications","application-tokens":"/application-tokens","stats-discover":"/stats/discover","importers-trello-auth-url":"/importers/trello/auth_url","importers-trello-authorize":"/importers/trello/authorize","importers-trello-list-projects":"/importers/trello/list_projects","importers-trello-list-users":"/importers/trello/list_users","importers-trello-import-project":"/importers/trello/import_project","importers-jira-auth-url":"/importers/jira/auth_url","importers-jira-authorize":"/importers/jira/authorize","importers-jira-list-projects":"/importers/jira/list_projects","importers-jira-list-users":"/importers/jira/list_users","importers-jira-import-project":"/importers/jira/import_project","importers-github-auth-url":"/importers/github/auth_url","importers-github-authorize":"/importers/github/authorize","importers-github-list-projects":"/importers/github/list_projects","importers-github-list-users":"/importers/github/list_users","importers-github-import-project":"/importers/github/import_project","importers-asana-auth-url":"/importers/asana/auth_url","importers-asana-authorize":"/importers/asana/authorize","importers-asana-list-projects":"/importers/asana/list_projects","importers-asana-list-users":"/importers/asana/list_users","importers-asana-import-project":"/importers/asana/import_project"},r=function(t,e){return t.debug("Initialize api urls"),e.update(o)},e=function(t,e){var r,n,i,o,s;for(t.debug("Initialize resources"),s=[],r=0,n=(o=_.toArray(arguments).slice(2)).length;r<n;r++)i=o[r],s.push(i(e));return s},(n=angular.module("taigaResources",["taigaBase"])).service("$tgResources",t),n.run(["$log","$tgUrls",r]),n.run(["$log","$tgResources","$tgProjectsResourcesProvider","$tgCustomAttributesResourcesProvider","$tgCustomAttributesValuesResourcesProvider","$tgMembershipsResourcesProvider","$tgNotifyPoliciesResourcesProvider","$tgInvitationsResourcesProvider","$tgRolesResourcesProvider","$tgUserProjectSettingsResourcesProvider","$tgUserSettingsResourcesProvider","$tgSprintsResourcesProvider","$tgEpicsResourcesProvider","$tgUserstoriesResourcesProvider","$tgTasksResourcesProvider","$tgIssuesResourcesProvider","$tgWikiResourcesProvider","$tgSearchResourcesProvider","$tgMdRenderResourcesProvider","$tgHistoryResourcesProvider","$tgKanbanResourcesProvider","$tgModulesResourcesProvider","$tgWebhooksResourcesProvider","$tgWebhookLogsResourcesProvider","$tgLocalesResourcesProvider","$tgUsersResourcesProvider",e])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p={}.hasOwnProperty;u=this.taiga,s=this.taiga.groupBy,n=this.taiga.bindOnce,a=this.taiga.mixOf,o=this.taiga.debounceLeading,l=this.taiga.trim,i=this.taiga.debounce,c=angular.module("taigaSearch",[]),e=function(t){function e(t,e,r,i,s,a,c,u,l,p,d){var h,f,g;this.scope=t,this.repo=e,this.rs=r,this.params=i,this.q=s,this.location=a,this.appMetaService=c,this.navUrls=u,this.translate=l,this.errorHandlingService=p,this.projectService=d,this.scope.sectionName="Search",this.loadInitialData(),f=this.translate.instant("SEARCH.PAGE_TITLE",{projectName:this.scope.project.name}),h=this.translate.instant("SEARCH.PAGE_DESCRIPTION",{projectName:this.scope.project.name,projectDescription:this.scope.project.description}),this.appMetaService.setAll(f,h),this.scope.searchTerm=null,o(100,(g=this,function(t){return g.loadSearchData(t)})),n(this.scope,"projectId",function(t){return function(e){if(!t.scope.searchResults&&t.scope.searchTerm)return t.loadSearchData()}}(this)),this.scope.$watch("searchTerm",function(t){return function(e){if(void 0!==e&&t.scope.projectId)return t.loadSearchData(e)}}(this))}return function(t,e){for(var r in e)p.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,a(u.Controller,u.PageMixin)),e.$inject=["$scope","$tgRepo","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$translate","tgErrorHandlingService","tgProjectService"],e.prototype.loadFilters=function(){var t;return(t=this.q.defer()).resolve(),t.promise},e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.epicStatusById=s(t.epic_statuses,function(t){return t.id}),this.scope.issueStatusById=s(t.issue_statuses,function(t){return t.id}),this.scope.taskStatusById=s(t.task_statuses,function(t){return t.id}),this.scope.severityById=s(t.severities,function(t){return t.id}),this.scope.priorityById=s(t.priorities,function(t){return t.id}),this.scope.usStatusById=s(t.us_statuses,function(t){return t.id}),t},e.prototype.loadSearchData=function(t){return null==t&&(t=""),this.scope.loading=!0,this._loadSearchData(t).then((e=this,function(t){return e.scope.searchResults=t,e.scope.loading=!1}));var e},e.prototype._loadSearchData=function(t){return null==t&&(t=""),this._promise&&this._promise.abort(),this._promise=this.rs.search.do(this.scope.projectId,t),this._promise},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),this.scope.projectId=t.id,this.fillUsersAndRoles(t.members,t.roles)},e}(),c.controller("SearchController",e),(t=function(t,e,r,n,o){return{templateUrl:"search/lightbox-search.html",link:function(s,a,c){var u,l,p;return l=null,p=i(2e3,function(t){var i,c;if(t.preventDefault(),a.find("form").checksley().validate())return i=a.find("#search-text").val(),c=r.resolve("project-search",{project:l.get("slug")}),s.$apply(function(){return e.close(a),n.path(c),n.search("text",i).path(c),o.reload()})}),u=function(){return l=t.project,e.open(a).then(function(){return a.find("#search-text").focus()})},a.on("submit","form",p),u()}}}).$inject=["tgProjectService","lightboxService","$tgNavUrls","$tgLocation","$route"],c.directive("tgSearchBox",t),r=function(t,e,r,n,i,o){var s;return s=function(t,n,s,a){var c,u,p,d,h,f,g,m,v;return u=!0,c="userstories",m=n.find(".search-filter"),p=null,d=function(t){var e,r,n,i,o,s,a;if(n=0,(s={}).name="userstories",s.value=[],!u)return s.name=c,s.value=t[c],s;if(t)for(e=0,r=(o=["userstories","epics","issues","tasks","wikipages"]).length;e<r;e++)if((a=t[i=o[e]]).length>n){n=a.length,s.name=i,s.value=a;break}return s},f=function(t){var e,r,n;for(e in r=[],t)n=t[e],m.find("li."+e).show(),r.push(m.find("li."+e+" .num").html(n.length));return r},h=function(t){return m.find("a.active").removeClass("active"),m.find("li."+t.name+" a").addClass("active"),u=!1,c=t.name},v={epics:r.get("search-epics"),issues:r.get("search-issues"),tasks:r.get("search-tasks"),userstories:r.get("search-userstories"),wikipages:r.get("search-wikipages")},g=function(r){var i,o,s,a,c;return(s=(o=n.find(".search-result-table").children()).scope())&&(s.$destroy(),o.remove()),(a=t.$new())[r.name]=r.value,c=angular.element.parseHTML(l(v[r.name])),i=e(c)(a),n.find(".search-result-table").html(i)},t.$watch("searchResults",function(t){var e;if(p=t)return e=d(t),f(t),g(e),h(e)}),t.$watch("searchTerm",function(t){return void 0!==t&&i.search("text",t),o.trackPage(i.url(),"Search")}),n.on("click",".search-filter li > a",function(e){var r,n,i;return e.preventDefault(),i=angular.element(e.currentTarget).parent().data("name"),n=p?p[i]:[],r={name:i,value:n},t.$apply(function(){return g(r),h(r)})})},{link:function(t,e,r){var i;return e.controller(),s(t,e),i=n.text,t.$watch("projectId",function(e){if(null!=e)return t.searchTerm=i})}}},c.directive("tgSearch",["$log","$compile","$templateCache","$routeParams","$tgLocation","$tgAnalytics",r])}.call(this),function(){angular.module("taigaTaskboard",[])}.call(this),function(){angular.module("taigaTasks",[])}.call(this),function(){angular.module("taigaTeam",[])}.call(this),function(){angular.module("taigaUserSettings",[])}.call(this),function(){angular.module("taigaUserStories",[])}.call(this),function(){angular.module("taigaWiki",[])}.call(this),function(){var t,e,r,n={}.hasOwnProperty;r=this.taiga,e=angular.module("taigaCommon"),t=function(t){function e(t,e,r,n,i,o){var s;this.rootscope=t,this.log=e,this.config=r,this.win=n,this.doc=i,this.location=o,this.initialized=!1,s=this.config.get("analytics",{}),this.accountId=s.accountId,this.pageEvent=s.pageEvent||"$routeChangeSuccess",this.trackRoutes=s.trackRoutes||!0,this.ignoreFirstPageLoad=s.ignoreFirstPageLoad||!1}return function(t,e){for(var r in e)n.call(e,r)&&(t[r]=e[r]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,r.Service),e.$inject=["$rootScope","$log","$tgConfig","$window","$document","$location"],e.prototype.initialize=function(){var t;if(this.accountId)return this.injectAnalytics(),this.win.ga("create",this.accountId,"auto"),this.win.ga("require","ec"),this.win.ga("require","displayfeatures"),this.trackRoutes&&!this.ignoreFirstPageLoad&&this.win.ga("send","pageview",this.getUrl()),this.trackRoutes&&this.rootscope.$on(this.pageEvent,(t=this,function(){return t.trackPage(t.getUrl(),"Taiga")})),this.initialized=!0,this.setUserId();this.log.debug("Analytics: no acount id provided. Disabling.")},e.prototype.setUserId=function(){var t,e;if(this.initialized&&this.win.ga)return this.win.ga("set","userId",null!=(t=this.rootscope)&&null!=(e=t.user)?e.uuid:void 0)},e.prototype.getUrl=function(){return this.location.path()},e.prototype.injectAnalytics=function(){return function(t,e,r,n,i,o,s){t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){(t[i].q=t[i].q||[]).push(arguments)},t[i].l=1*new Date,o=e.createElement(r),s=e.getElementsByTagName(r)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga")},e.prototype.trackPage=function(t,e){if(this.initialized&&this.win.ga)return e=e||this.doc[0].title,this.win.ga("send","pageview",{page:t,title:e})},e.prototype.trackEvent=function(t,e,r,n){if(this.initialized&&this.win.ga)return this.win.ga("send","event",t,e,r,n)},e.prototype.ecViewPlan=function(t){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t.plan_id,name:t.name,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","detail"),this.trackEvent("ecommerce","view-product-detail",t.name,t.plan_id)},e.prototype.ecClickPlan=function(t){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t.plan_id,name:t.name,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","click"),this.trackEvent("ecommerce","click-product",t.name,t.plan_id)},e.prototype.ecListPlans=function(t,e){var r,n,i,o,s;if(o=t[0],this.initialized&&this.win.ga){for(s=1,r=0,n=o.length;r<n;r++)i=o[r],this.win.ga("ec:addImpression",{id:i.plan_id,name:i.name,list:e,position:s}),s++;return this.trackEvent("ecommerce","list-plans")}},e.prototype.ecAddToCart=function(t,e,r){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","add"),this.trackEvent("ecommerce","add-to-cart","Collect Payment Info",null)},e.prototype.ecConfirmChange=function(t,e,r){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","checkout",{step:1}),this.trackEvent("ecommerce","start-checkout","start",1)},e.prototype.ecPurchase=function(t,e,r){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","checkout",{step:2}),this.trackEvent("ecommerce","end-checkout","end",2),this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","purchase",{id:t,revenue:r}),this.trackEvent("ecommerce","checkout","Plan checkout",null)},e}(),e.service("$tgAnalytics",t)}.call(this),function(){var t;t=function(t){return t.debugInfo||(jQuery.fn.scope=function(){return this.data("scope")}),{link:function(e,r){if(!t.debugInfo)return r.data("scope",e).addClass("tg-scope")}}},angular.module("taigaCommon").directive("tgBindScope",["$tgConfig",t])}.call(this),function(){var t;(t=function(t){return{link:function(e,r,n){return e.$watch(n.tgCompileHtml,function(n,i){return r.html(n),t(r.contents())(e)})}}}).$inject=["$compile"],angular.module("taigaCommon").directive("tgCompileHtml",t)}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,b;this.taiga,y=this.taiga.bindOnce,r=function(t){var e;return e=function(e,r,n){var i,o,s;return s=t.instant("BACKLOG.SPRINTS.DATE"),o=moment(r).format(s),i=moment(n).format(s),e.html(o+"-"+i)},{link:function(t,r,n){var i,o,s;return i=(o=n.tgDateRange.split(","))[0],s=o[1],y(t,i,function(n){return y(t,s,function(t){return e(r,n,t)})})}}},(b=angular.module("taigaCommon")).directive("tgDateRange",["$translate",r]),n=function(t,e){return{link:function(r,n,i,o){var s,a;return null,s=function(){var t;return t=e.get(),_.merge(t,{field:n[0]}),n.picker=new Pikaday(t)},a=t.$on("$translateChangeEnd",function(t){return n.picker&&n.picker.destroy(),s()}),i.$observe("pickerValue",function(t){return n.val(t),null!=t&&(n.picker&&n.picker.destroy(),s()),n.picker.setDate(t)}),r.$on("$destroy",function(){return n.off(),a(),n.picker.destroy()})}}},b.directive("tgDateSelector",["$rootScope","tgDatePickerConfigService",n]),h=function(){var t;return t=function(t,e,r){return t.hasClass(".current-progress")?t.css("width",e+"%"):(t.find(".current-progress").css("width",r+"%"),t.find(".number").html(e+" %"))},{link:function(e,r,n){return y(e,n.tgSprintProgressbar,function(e){var n,i,o,s;return n=e.closed_points,i=0,0!==(o=e.total_points)&&(i=Math.round(n/o*100)),s=0,0!==o&&(s=Math.round(n/o*98)),t(r,i,s)}),e.$on("$destroy",function(){return r.off()})}}},b.directive("tgSprintProgressbar",h),e=function(t,e,r,n,i){return{link:function(t,e,o){return y(t,o.ngModel,function(e){var o,s;if(null!=e)return o=i.getAvatar(e.owner_extra_info),t.owner=e.owner_extra_info||{full_name_display:r.instant("COMMON.EXTERNAL_USER")},t.owner.avatar=o.url,t.owner.bg=o.bg,t.url=(null!=(s=t.owner)?s.is_active:void 0)?n.resolve("user-profile",{username:t.owner.username}):"",t.date=moment(e.created_date).format(r.instant("COMMON.DATETIME"))}),t.$on("$destroy",function(){return e.off()})},restrict:"EA",require:"ngModel",scope:!0,templateUrl:"common/components/created-by.html"}},b.directive("tgCreatedByDisplay",["$tgTemplate","$compile","$translate","$tgNavUrls","tgAvatarService",e]),m=function(t,e,r,n,i){return{link:function(t,e,o){var s,a;return a=o.tgUserId,t.user=t.usersById[a]||{full_name_display:r.instant("COMMON.EXTERNAL_USER")},s=i.getAvatar(t.usersById[a]||null),t.user.avatar=s.url,t.user.bg=s.bg,t.url=t.user.is_active?n.resolve("user-profile",{username:t.user.username}):"",t.$on("$destroy",function(){return e.off()})},restrict:"EA",scope:!0,templateUrl:"common/components/user-display.html"}},b.directive("tgUserDisplay",["$tgTemplate","$compile","$translate","$tgNavUrls","tgAvatarService",m]),v=function(t,e,r,n,i,o,s){return{scope:!0,templateUrl:"common/components/watchers.html",link:function(r,i,o,a){var c,u,l,p;return u=function(){var t,e;return-1!==(null!=(t=r.project)&&null!=(e=t.my_permissions)?e.indexOf(o.requiredPerm):void 0)},p=function(i){var o;return(o=n.save(function(t){return t.watchers=i,t})).then(function(){return i=_.map(i,function(t){return r.usersById[t]}),l(i),t.$broadcast("object:updated")}),o.then(null,function(){return e.notify("error")})},c=function(i){var o;return(o=n.save(function(t){return t.watchers=i,t})).then(function(){var e,i;return e=n.getObj(),i=_.map(e.watchers,function(t){return r.usersById[t]}),l(i),t.$broadcast("object:updated")}),o.then(null,function(){return item.revert(),e.notify("error")})},l=function(t){return r.watchers=t,r.isEditable=u()},i.on("click",".js-delete-watcher",function(t){var n,i,o,l;if(t.preventDefault(),u())return i=angular.element(t.currentTarget),l=i.data("watcher-id"),o=s.instant("COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER"),n=r.usersById[l].full_name_display,e.askOnDelete(o,n).then(function(t){var e;return t.finish(),e=_.clone(a.$modelValue.watchers,!1),e=_.pull(e,l),c(e)})}),r.$on("watcher:added",function(t,e){var r;return(r=_.clone(a.$modelValue.watchers,!1)).push(e),r=_.uniq(r),p(r)}),r.$watch(o.ngModel,function(t){var e;if(null!=t)return e=_.map(t.watchers,function(t){return r.usersById[t]}),e=_.filter(e,function(t){return!!t}),l(e)}),r.$on("$destroy",function(){return i.off()})},require:"ngModel"}},b.directive("tgWatchers",["$rootScope","$tgConfirm","$tgRepo","$tgQueueModelTransformation","$tgTemplate","$compile","$translate",v]),t=function(t,e,r){var n;return n=r.get("common/components/block-button.html"),{link:function(r,n,i,o){var s;return s=function(){return-1!==r.project.my_permissions.indexOf("modify_us")},r.$watch(i.ngModel,function(t){if(t)return s()&&n.find(".item-block").addClass("editable"),t.is_blocked?(n.find(".item-block").removeClass("is-active"),n.find(".item-unblock").addClass("is-active")):(n.find(".item-block").addClass("is-active"),n.find(".item-unblock").removeClass("is-active"))}),n.on("click",".item-block",function(e){return e.preventDefault(),t.$broadcast("block",o.$modelValue)}),n.on("click",".item-unblock",function(r){var i,s;return r.preventDefault(),i=e().target(n.find(".item-unblock")).start(),s=function(){return i.finish()},t.$broadcast("unblock",o.$modelValue,s)}),r.$on("$destroy",function(){return n.off()})},restrict:"EA",require:"ngModel",template:n}},b.directive("tgBlockButton",["$rootScope","$tgLoading","$tgTemplate",t]),i=function(t,e,r,n,i){var o;return o=i.get("common/components/delete-button.html"),{link:function(i,o,s,a){return s.onDeleteGoToUrl?s.onDeleteTitle?(o.on("click",".button-delete",function(t){var o,c;return c=s.onDeleteTitle,o=a.$modelValue.subject,r.askOnDelete(c,o).then(function(t){var o;return(o=e.remove(a.$modelValue)).then(function(){var e;return t.finish(),e=i.$eval(s.onDeleteGoToUrl),n.path(e)}),o.then(null,function(){return t.finish(!1),r.notify("error")})})}),i.$on("$destroy",function(){return o.off()})):t.error("DeleteButtonDirective requires on-delete-title set in scope."):t.error("DeleteButtonDirective requires on-delete-go-to-url set in scope.")},restrict:"EA",require:"ngModel",template:o}},b.directive("tgDeleteButton",["$log","$tgRepo","$tgConfirm","$tgLocation","$tgTemplate",i]),s=function(){return{link:function(t,e,r){var n;return n=t.$eval(r.tgListitemEpicStatus),y(t,"epicStatusById",function(t){return e.html(t[n.status].name)})}}},b.directive("tgListitemEpicStatus",s),d=function(){return{link:function(t,e,r){var n;return n=t.$eval(r.tgListitemUsStatus),y(t,"usStatusById",function(t){return e.html(t[n.status].name)})}}},b.directive("tgListitemUsStatus",d),l=function(){return{link:function(t,e,r){var n;return n=t.$eval(r.tgListitemTaskStatus),y(t,"taskStatusById",function(t){return e.html(t[n.status].name)})}}},b.directive("tgListitemTaskStatus",l),o=function(t,e,r){var n;return n=t.get("common/components/list-item-assigned-to-avatar.html",!0),{link:function(t,i,o){return y(t,"usersById",function(s){var a,c,u,l;return u=t.$eval(o.tgListitemAssignedto),c={name:e.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED")},l=s[u.assigned_to],a=r.getAvatar(l),c.imgurl=a.url,c.bg=a.bg,l&&(c.name=l.full_name_display),i.html(n(c))})}}},b.directive("tgListitemAssignedto",["$tgTemplate","$translate","tgAvatarService",o]),a=function(){return{link:function(t,e,r){var n;return n=t.$eval(r.tgListitemIssueStatus),y(t,"issueStatusById",function(t){return e.html(t[n.status].name)})}}},b.directive("tgListitemIssueStatus",a),p=function(){return{link:function(t,e,r){var n;return n=function(t,r){var n,i;return i=t[r.type],(n=e.find(".level")).css("background-color",i.color),n.attr("title",i.name)},y(t,"issueTypeById",function(e){var i;return i=t.$eval(r.tgListitemType),n(e,i)}),t.$watch(r.tgListitemType,function(e){return n(t.issueTypeById,e)})},templateUrl:"common/components/level.html"}},b.directive("tgListitemType",p),c=function(){return{link:function(t,e,r){var n;return n=function(t,r){var n,i;return i=t[r.priority],(n=e.find(".level")).css("background-color",i.color),n.attr("title",i.name)},y(t,"priorityById",function(e){var i;return i=t.$eval(r.tgListitemPriority),n(e,i)}),t.$watch(r.tgListitemPriority,function(e){return n(t.priorityById,e)})},templateUrl:"common/components/level.html"}},b.directive("tgListitemPriority",c),u=function(){return{link:function(t,e,r){var n;return n=function(t,r){var n,i;return i=t[r.severity],(n=e.find(".level")).css("background-color",i.color),n.attr("title",i.name)},y(t,"severityById",function(e){var i;return i=t.$eval(r.tgListitemSeverity),n(e,i)}),t.$watch(r.tgListitemSeverity,function(e){return n(t.severityById,e)})},templateUrl:"common/components/level.html"}},b.directive("tgListitemSeverity",u),g=function(t){var e,r;return r=t.get("common/components/progress-bar.html",!0),e=function(t,e){return t.html(r({percentage:e}))},{link:function(t,r,n){return angular.element(r),t.$watch(n.tgProgressBar,function(t){return t=_.max([0,t]),t=_.min([100,t]),e(r,t)}),t.$on("$destroy",function(){return r.off()})}}},b.directive("tgProgressBar",["$tgTemplate",g]),f=function(t){return{link:function(t,e,r){return r.$observe("i18nSectionName",function(e){return t.sectionName=e}),t.$on("$destroy",function(){return e.off()})},templateUrl:"common/components/main-title.html",scope:{projectName:"=projectName"}}},b.directive("tgMainTitle",["$translate",f])}.call(this),function(){var t,e,r,n,i,o,s,a={}.hasOwnProperty;o=this.taiga,s=this.taiga.timeout,n=this.taiga.cancelTimeout,i=this.taiga.debounce,r=this.taiga.bindMethods,e={success:{title:"NOTIFICATION.OK",message:"NOTIFICATION.SAVED"},error:{title:"NOTIFICATION.WARNING",message:"NOTIFICATION.WARNING_TEXT"},"light-error":{title:"NOTIFICATION.WARNING",message:"NOTIFICATION.WARNING_TEXT"}},t=function(t){function c(t,e,n,i,o){this.q=t,this.lightboxService=e,this.loading=n,this.translate=i,this.filter=o,r(this)}return function(t,e){for(var r in e)a.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(c,o.Service),c.$inject=["$q","lightboxService","$tgLoading","$translate","$filter"],c.prototype.hide=function(t){if(t)return this.lightboxService.close(t),t.off(".confirm-dialog")},c.prototype.ask=function(t,e,r,n){var o,s,a,c;return null==n&&(n=".lightbox-generic-ask"),o=this.q.defer(),(s=angular.element(n)).find(".title").text(t||""),s.find(".subtitle").text(e||""),r&&(r=this.filter("textToHTML")(r)),s.find(".message").html(r||""),s.on("click.confirm-dialog",".button-green",i(2e3,(c=this,function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=c.loading().target(r).start(),o.resolve({finish:function(t){if(null==t&&(t=!0),e.finish(),t)return c.hide(s)}})}))),s.on("click.confirm-dialog",".button-red",function(t){return function(e){return e.preventDefault(),o.reject(),t.hide(s)}}(this)),a=function(t){return function(){return t.hide(s)}}(this),this.lightboxService.open(s,null,a),o.promise},c.prototype.askOnDelete=function(t,e,r){return null==r&&(r=this.translate.instant("NOTIFICATION.ASK_DELETE")),this.ask(t,r,e)},c.prototype.askChoice=function(t,e,r,n,o,s){var a,c,u,l;return null==s&&(s=".lightbox-ask-choice"),c=this.q.defer(),(u=angular.element(s)).find(".title").text(t),u.find(".subtitle").text(e),n?u.find(".replacement").text(n):u.find(".replacement").remove(),o?u.find(".warning").text(o):u.find(".warning").remove(),(a=u.find(".choices")).html(""),_.each(r,function(t,e){return t=_.escape(t),a.append(angular.element("<option value='"+e+"'>"+t+"</option>"))}),u.on("click.confirm-dialog","a.button-green",i(2e3,(l=this,function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=l.loading().target(r).start(),c.resolve({selected:a.val(),finish:function(t){if(null==t&&(t=!0),e.finish(),t)return l.hide(u)}})}))),u.on("click.confirm-dialog",".button-red",function(t){return function(e){return e.preventDefault(),c.reject(),t.hide(u)}}(this)),this.lightboxService.open(u),c.promise},c.prototype.error=function(t){var e,r,n;return e=this.q.defer(),(r=angular.element(".lightbox-generic-error")).find(".title").html(t),r.on("click.confirm-dialog",".button-green",(n=this,function(t){return t.preventDefault(),e.resolve(),n.hide(r)})),r.on("click.confirm-dialog",".close",function(t){return function(n){return n.preventDefault(),e.resolve(),t.hide(r)}}(this)),this.lightboxService.open(r),e.promise},c.prototype.success=function(t,e,r,n){var i,s,a,c,u,l;return i=this.q.defer(),(a=angular.element(".lightbox-generic-success")).find("img").remove(),a.find("svg").remove(),r&&("img"===r.type?s=$("<img>").addClass("lb-icon").attr("src",r.name):"svg"===r.type&&(s=document.createElement("div"),o.addClass(s,"icon"),o.addClass(s,r.name),o.addClass(s,"lb-icon"),c=document.createElementNS("http://www.w3.org/2000/svg","svg"),(u=document.createElementNS("http://www.w3.org/2000/svg","use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+r.name),s.appendChild(c).appendChild(u)),s&&a.find("section").prepend(s)),t&&a.find(".title").html(t),e&&a.find(".message").html(e),n&&(a.find(".button-green").html(n),a.find(".button-green").attr("title",n)),a.on("click.confirm-dialog",".button-green",(l=this,function(t){return t.preventDefault(),i.resolve(),l.hide(a)})),a.on("click.confirm-dialog",".close",function(t){return function(e){return e.preventDefault(),i.resolve(),t.hide(a)}}(this)),this.lightboxService.open(a),i.promise},c.prototype.loader=function(t,e,r){var n,i;return null==r&&(r=!1),n=angular.element(".lightbox-generic-loading"),t&&n.find(".title").html(t),e&&n.find(".message").html(e),r&&n.find(".spin").removeClass("hidden"),{start:(i=this,function(){return i.lightboxService.open(n)}),stop:function(t){return function(){return t.lightboxService.close(n)}}(this),update:function(t,e,r,i){return e&&n.find(".title").html(e),r&&n.find(".message").html(r),i?(n.find(".spin").addClass("hidden"),n.find(".progress-bar-wrapper").removeClass("hidden"),n.find(".progress-bar-wrapper > .bar").width(i+"%"),n.find(".progress-bar-wrapper > span").html(i+"%").css("left",i-9+"%")):(n.find(".spin").removeClass("hidden"),n.find(".progress-bar-wrapper").addClass("hidden"))}}},c.prototype.notify=function(t,r,i,o){var a,c,u,l;if(u=".notification-message-"+t,!(c=angular.element(u)).hasClass("active"))return i?c.find("h4").html(i):c.find("h4").html(this.translate.instant(e[t].title)),r?c.find("p").html(r):c.find("p").html(this.translate.instant(e[t].message)),(a=angular.element("body")).find(".notification-message .notification-light").removeClass("active").addClass("inactive"),a.find(u).removeClass("inactive").addClass("active"),this.tsem&&n(this.tsem),o||(o="error"===t||"light-error"===t?3500:1500),this.tsem=s(o,(l=this,function(){return a.find(u).removeClass("active").addClass("inactive").one("animationend",function(){return $(this).removeClass("inactive")}),delete l.tsem})),c.on("click",".icon-close, .close",function(t){return a.find(u).removeClass("active").addClass("inactive")})},c}(),angular.module("taigaCommon").service("$tgConfirm",t)}.call(this),function(){var t,e,r,n,i,o,s,a,c,u={}.hasOwnProperty;c=this.taiga,n=this.taiga.bindMethods,i=this.taiga.bindOnce,o=this.taiga.debounce,s=c.generateHash,a=angular.module("taigaCommon"),e=function(t){function e(t,e,r,i,o,s){this.scope=t,this.rootscope=e,this.repo=r,this.rs=i,this.confirm=o,this.q=s,n(this),this.type=null,this.objectId=null,this.projectId=null,this.customAttributes=[],this.customAttributesValues=null}return function(t,e){for(var r in e)u.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,c.Controller),e.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$tgConfirm","$q"],e.prototype.initialize=function(t,e){return this.project=this.scope.project,this.type=t,this.objectId=e,this.projectId=this.scope.projectId},e.prototype.loadCustomAttributesValues=function(){return this.objectId?this.rs.customAttributesValues[this.type].get(this.objectId).then((t=this,function(e){return t.customAttributes=t.project[t.type+"_custom_attributes"],t.customAttributesValues=e,e})):this.customAttributesValues;var t},e.prototype.getAttributeValue=function(t){var e;return(e=_.clone(t,!1)).value=this.customAttributesValues.attributes_values[t.id],e},e.prototype.updateAttributeValue=function(t){var e,r,n,i;return i=this,n=function(){return i.rootscope.$broadcast("custom-attributes-values:edit")},r=function(t){return function(e){return t.confirm.notify("error"),t.q.reject()}}(this),(e=_.clone(this.customAttributesValues.attributes_values,!0))[t.id]=t.value,this.customAttributesValues.attributes_values=e,this.customAttributesValues.id=this.objectId,this.repo.save(this.customAttributesValues).then(n,r)},e}(),r=function(t,r){var n,o;return o=t.get("custom-attributes/custom-attributes-values.html",!0),n=function(t){return s(["custom-attributes-collapsed",t])},{require:["tgCustomAttributesValues","ngModel"],controller:e,controllerAs:"ctrl",restrict:"AE",scope:!0,link:function(t,e,o,s){var a,c;return a=s[0],s[1],c=n(o.type),t.collapsed=r.get(c)||!1,i(t,o.ngModel,function(t){return a.initialize(o.type,t.id),a.loadCustomAttributesValues()}),t.toggleCollapse=function(){return t.collapsed=!t.collapsed,r.set(c,t.collapsed)},t.$on("$destroy",function(){return e.off()})},template:function(t,e){return o({requiredEditionPerm:e.requiredEditionPerm})}}},a.directive("tgCustomAttributesValues",["$tgTemplate","$tgStorage","$translate",r]),t=function(t,e,r,n,i,s){var a,c;return a=t.get("custom-attributes/custom-attribute-value.html",!0),c=t.get("custom-attributes/custom-attribute-value-edit.html",!0),{link:function(t,u,l,p){var d,h,f,g,m,v;return f=n.instant("COMMON.PICKERDATE.FORMAT"),g=function(e,n){var o,l,p,d,g,m;return null==n&&(n=!1),"date"===e.type&&e.value&&(m=moment(e.value,"YYYY-MM-DD").format(f)),m="number"===e.type&&e.value?parseFloat(e.value):e.value,p=h(),o={id:e.id,name:e.name,description:e.description,value:m,type:e.type,isEditable:p},(g=t.$new()).attributeHtml=s.getHTML(m),g.extra=e.extra,g.model=m,!p||!n&&m?(d=a(o),d=r(d)(g),u.html(d)):(d=c(o),d=r(d)(g),u.html(d),"date"===e.type?(l=i.get(),_.merge(l,{field:u.find("input[name=value]")[0],onSelect:function(t){return t},onOpen:function(){if("undefined"!=typeof selectedDate&&null!==selectedDate)return u.picker.setDate(selectedDate)}}),u.picker=new Pikaday(l)):void 0)},h=function(){var e,r;return e=t.project.my_permissions,r=l.requiredEditionPerm,e.indexOf(r)>-1},t.saveCustomRichText=function(t,e){return d.value=t,p.updateAttributeValue(d).then(function(){return e(),g(d,!1)})},t.cancelCustomRichText=function(){return g(d,!1),null},v=o(2e3,function(e){var r;if(e.preventDefault(),u.find("form").checksley().validate())return"dropdown"===d.type?(r=u.find("select[name='value']"),d.value=r.val()):"checkbox"===d.type?(r=u.find("input[name=value]"),d.value=r[0].checked):(r=u.find("input[name=value], textarea[name='value']"),d.value=r.val(),"date"===d.type&&moment(d.value,f).isValid()&&(d.value=moment(d.value,f).format("YYYY-MM-DD")),"number"===d.type&&(d.value=parseFloat(d.value))),t.$apply(function(){return p.updateAttributeValue(d).then(function(){return g(d,!1)})})}),m=function(){return u.find("input[name='value'], textarea[name='value']").focus().select()},null!==(d=t.$eval(l.tgCustomAttributeValue)).value&&void 0!==d.value||(d.value=""),t.customAttributeValue=d,g(d),u.on("click",".js-value-view-mode span a",function(t){return t.stopPropagation()}),u.on("click",".js-value-view-mode",function(){if(h()&&!e.get().length)return g(d,!0),m()}),u.on("click",".js-edit-description",function(t){return t.preventDefault(),g(d,!0),m()}),u.on("keyup","input[name=value], textarea[name='value']",function(t){return 13===t.keyCode&&"textarea"!==t.currentTarget.type?v(t):27===t.keyCode?g(d,!1):void 0}),u.on("submit","form",v),u.on("click",".js-save-description",v),t.$on("$destroy",function(){return u.off()})},require:"^tgCustomAttributesValues",restrict:"AE"}},a.directive("tgCustomAttributeValue",["$tgTemplate","$selectedText","$compile","$translate","tgDatePickerConfigService","tgWysiwygService",t])}.call(this),function(){var t,e,r,n=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty;r=this.taiga,e=angular.module("taigaCommon"),t=function(t){function e(){this.replaceEmojiNameByHtmlImgs=n(this.replaceEmojiNameByHtmlImgs,this),this.replaceEmojiNameByImgs=n(this.replaceEmojiNameByImgs,this),this.replaceImgsByEmojiName=n(this.replaceImgsByEmojiName,this),this.getEmojiByName=n(this.getEmojiByName,this),this.getEmojiById=n(this.getEmojiById,this),this.searchByName=n(this.searchByName,this),this.emojis=_.map(r.emojis,function(t){return t.image="/"+window._version+"/emojis/"+t.image,t}),this.emojisById=_.keyBy(this.emojis,"id"),this.emojisByName=_.keyBy(this.emojis,"name")}return function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,r.Service),e.$inject=[],e.prototype.searchByName=function(t){return _.filter(this.emojis,function(e){return-1!==e.name.indexOf(t)})},e.prototype.getEmojiById=function(t){return this.emojisById[t]},e.prototype.getEmojiByName=function(t){return this.emojisByName[t]},e.prototype.replaceImgsByEmojiName=function(t){var e,n,i,o,s,a;for(o=0,s=(i=r.getMatches(t,/emojis\/([^"]+).png"/gi)).length;o<s;o++)n=i[o],a=new RegExp("<img(.*)"+n+"[^>]+>","g"),e=this.getEmojiById(n),t=t.replace(a,":"+e.name+":");return t},e.prototype.replaceEmojiNameByImgs=function(t){var e,n,i,o,s,a;for(o=0,s=(i=r.getMatches(t,/:([\w +-]*):/g)).length;o<s;o++)n=i[o],a=new RegExp(":"+n+":","g"),(e=this.getEmojiByName(n))&&(t=t.replace(a,"![alt]("+e.image+")"));return t},e.prototype.replaceEmojiNameByHtmlImgs=function(t){var e,n,i,o,s,a;for(o=0,s=(i=r.getMatches(t,/:([\w +-]*):/g)).length;o<s;o++)n=i[o],a=new RegExp(":"+_.escapeRegExp(n)+":","g"),(e=this.getEmojiByName(n))&&(t=t.replace(a,'<img src="'+e.image+'" />'));return t},e}(),e.service("$tgEmojis",t)}.call(this),function(){var t,e,r,n,i,o=function(t,e){return function(){return t.apply(e,arguments)}};this.taiga,n=this.taiga.groupBy,e=function(t,e,r,n,i){return{link:function(e,r,o,s){return e.$watch(o.ngModel,function(o){var a;if(o)return(a=t.create(r,o,e.project)).onSelectedPointForRole=function(t,r,n){return o.points=n,a.render(),e.$apply(function(){return s.$setViewValue(o)})},a.render=function(){var t,r,o;return t={totalPoints:this.calculateTotalPoints(),roles:this.calculateRoles(),editable:this.isEditable,loading:!1},o="common/estimation/us-estimation-points-per-role.html",r=n.get(o,!0)(t),r=i(r)(e),this.$el.html(r)},a.render()}),e.$on("$destroy",function(){return r.off()})},restrict:"EA",require:"ngModel"}},(i=angular.module("taigaCommon")).directive("tgLbUsEstimation",["$tgEstimationsService","$rootScope","$tgRepo","$tgTemplate","$compile",e]),r=function(t,e,r,n,i,o,s){return{link:function(r,a,c,u){var l;return l=function(t){var e;return e=function(){return s.notify("error")},o.save(function(e){return e.points=t,e}).then(null,e)},r.$watchCollection(function(){return u.$modelValue&&u.$modelValue.points},function(){var o,s;if(s=u.$modelValue)return(o=t.create(a,s,r.project)).onSelectedPointForRole=function(t,r,n){return o.loading=t,o.render(),l(n).then(function(){return o.loading=!1,e.$broadcast("object:updated"),o.render()})},o.render=function(){var t,e,s;return t={totalPoints:this.calculateTotalPoints(),roles:this.calculateRoles(),editable:this.isEditable,loading:o.loading},s="common/estimation/us-estimation-points-per-role.html",e=n.get(s,!0)(t),e=i(e)(r),this.$el.html(e)},o.render()}),r.$on("$destroy",function(){return a.off()})},restrict:"EA",require:"ngModel"}},i.directive("tgUsEstimation",["$tgEstimationsService","$rootScope","$tgRepo","$tgTemplate","$compile","$tgQueueModelTransformation","$tgConfirm",r]),t=function(t,e,r,i,s){var a,c;return c=t.get("common/estimation/us-estimation-points.html",!0),a=function(){function t(t,e,r){this.$el=t,this.us=e,this.project=r,this.bindClickEvents=o(this.bindClickEvents,this),this.isEditable=-1!==this.project.my_permissions.indexOf("modify_us"),this.roles=this.project.roles,this.points=this.project.points,this.loading=!1,this.pointsById=n(this.points,function(t){return t.id}),this.onSelectedPointForRole=function(t,e){},this.render=function(){}}return t.prototype.save=function(t,n){var o,a;return o=i.defer(),s.add((a=this,function(){var t,n;return n=function(){return o.resolve(),a.render()},t=function(){return r.notify("error"),a.us.revert(),a.render(),o.reject()},e.save(a.us).then(n,t)})),o.promise},t.prototype.calculateTotalPoints=function(){var t,e,r;return 0===(e=_.map(this.us.points,(r=this,function(t,e){var n;return null!=(n=r.pointsById[t])?n.value:void 0}))).length?"?":0===(t=_.filter(e,function(t){return null!=t})).length?"?":_.reduce(t,function(t,e){return t+e})},t.prototype.calculateRoles=function(){var t,e;return t=_.filter(this.project.roles,"computable"),_.map(t,(e=this,function(t){var r,n;return r=e.us.points[t.id],n=e.pointsById[r],(t=_.clone(t,!0)).points=null!=n&&null!=n.name?n.name:"?",t}))},t.prototype.bindClickEvents=function(){var t;return this.$el.on("click",".total.clickable",(t=this,function(e){var r,n;return e.preventDefault(),e.stopPropagation(),r=(n=angular.element(e.currentTarget)).data("role-id"),t.renderPointsSelector(r,n),n.siblings().removeClass("active"),n.addClass("active")})),this.$el.on("click",".point",function(t){return function(e){var r,n,i,o;return e.preventDefault(),e.stopPropagation(),i=(o=angular.element(e.currentTarget)).data("role-id"),r=o.data("point-id"),t.$el.find(".popover").popover().close(),(n=_.clone(t.us.points,!0))[i]=r,t.onSelectedPointForRole(i,r,n)}}(this))},t.prototype.renderPointsSelector=function(t,e){var r,n,i,o,s;if(i=_.map(this.points,(s=this,function(e){return(e=_.clone(e,!0)).selected=s.us.points[t]!==e.id,e})),5,r=_.some(i,function(t){return t.name.length>5}),n=c({points:i,roleId:t,horizontal:r}),this.$el.find(".popover").popover().close(),this.$el.find(".pop-points-open").remove(),null!=e?this.$el.find(e).append(n):this.$el.append(n),this.$el.find(".pop-points-open").popover().open(function(){return $(this).removeClass("active").closest("li").removeClass("active")}),this.$el.find(".pop-points-open").show(),(o=this.$el.find(".pop-points-open")).offset().top+o.height()>document.body.clientHeight)return o.addClass("pop-bottom")},t}(),{create:function(t,e,r){var n;return t.unbind("click"),(n=new a(t,e,r)).isEditable&&n.bindClickEvents(),n}}},i.factory("$tgEstimationsService",["$tgTemplate","$tgRepo","$tgConfirm","$q","$tgQqueue",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g;l=this.taiga,r=function(){return function(t,e){return t===[null,void 0]?e:t}},(s=angular.module("taigaCommon")).filter("default",r),f=function(t){return function(e){return e?t.instant("COMMON.YES"):t.instant("COMMON.NO")}},s.filter("yesNo",["$translate",f]),h=function(){return l.unslugify},s.filter("unslugify",h),a=function(){return function(t,e){return t?moment(t).format(e):""}},s.filter("momentFormat",a),c=function(){return function(t,e){return t?moment(t).fromNow(e||!1):""}},s.filter("momentFromNow",c),g=this,u=function(){return g.taiga.sizeFormat},s.filter("sizeFormat",u),d=function(){var t,e;return e=function(t){return t.toJS()},t=_.memoize(e),function(e){return e instanceof Immutable.List?t(e):e}},s.filter("toMutable",d),t=function(t){return function(e,r){var n;return(null!=r?r.startsWith("#"):void 0)?(n=r.substr(1),_.filter(e,function(t){return String(t.ref).startsWith(n)})):t(e,r)}},s.filter("byRef",["filterFilter",t]),e=function(){return function(t,e){var r,n,i,o,s,a;for((t=new String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0,s="#",r=0,n=0,0,255,i=0,o=(a=[0,1,2]).length;i<o;i++)n=a[i],r=parseInt(t.substr(2*n,2),16),s+=("00"+(r=Math.round(Math.min(Math.max(0,r+255*e),255)).toString(16))).substr(r.length);return s}},s.filter("darker",e),o=function(t){return function(e){return e?t.getHTML(e):""}},s.filter("markdownToHTML",["tgWysiwygService",o]),i=function(t){return function(e,r,n){if(r)return t("filter")(e,function(t){return-1!==r.indexOf(t[n])})}},s.filter("inArray",["$filter",i]),n=function(t){return function(e){return e?t.replaceEmojiNameByHtmlImgs(_.escape(e)):""}},s.filter("emojify",["$tgEmojis",n]),p=function(t){return function(t){return t?t.replace(/\<(?!(\/?)(strong|br)(\/?)).*?\>/g,""):""}},s.filter("textToHTML",["$filter",p])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v,y=function(t,e){for(var r in e)b.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},b={}.hasOwnProperty,S=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};m=angular.module("taigaCommon"),this.taiga.bindOnce,this.taiga.timeout,h=this.taiga.debounce,this.taiga.sizeFormat,v=this.taiga.trim,this.taiga.normalizeString,u=function(t){function e(t,e,r){this.animationFrame=t,this.q=e,this.rootScope=r}return y(e,t),e.prototype.open=function(t,e,r,n){var i,o,s;return this.onClose=e,_.isString(t)&&(t=$(t)),i=this.q.defer(),(o=t.children().not(".close")).hide(),this.animationFrame.add(function(){return t.css("display","flex")}),this.animationFrame.add(function(){return t.addClass("open"),t.one("transitionend",function(){var e;return(e=t.find("input:not(.no-focus),textarea:not(.no-focus)").first()).length?e.focus():document.activeElement?$(document.activeElement).blur():void 0})}),this.animationFrame.add(function(){return o.show(),i.resolve()}),n||angular.element(document).on("keydown.lightbox",(s=this,function(e){if(27===(e.keyCode?e.keyCode:e.which))return r?s.rootScope.$applyAsync(r):s.close(t)})),i.promise},e.prototype.close=function(t){return new Promise((e=this,function(r){var n,i;if(_.isString(t)&&(t=$(t)),(n=angular.element(document)).off(".lightbox"),n.off(".keyboard-navigation"),t.addClass("close-started"),e.animationFrame.add(function(){return t.addClass("close"),t.one("transitionend",function(){return t.removeAttr("style"),t.removeClass("open").removeClass("close").removeClass("close-started"),e.onClose&&e.rootScope.$apply(e.onClose),r()})}),t.hasClass("remove-on-close"))return(i=t.data("scope"))&&i.$destroy(),t.remove()}));var e},e.prototype.getLightboxOpen=function(){return $(".lightbox.open:not(.close-started)")},e.prototype.closeAll=function(){var t,e,r,n,i;for(i=[],t=0,e=(n=angular.element(document).find(".lightbox.open")).length;t<e;t++)r=n[t],i.push(this.close($(r)));return i},e}(taiga.Service),m.service("lightboxService",["animationFrame","$q","$rootScope",u]),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return y(e,t),e.prototype.stop=function(){return angular.element(document).off(".keyboard-navigation")},e.prototype.dispatch=function(t,e){var r,n,i;if(r=t.find(".selected"),13===e)return 1===t.find(".user-list-single").length?t.find(".user-list-single:first").trigger("click"):r.trigger("click");if(40===e){if(!r.length)return t.find('.user-list-single:not(".is-active"):first').addClass("selected");if((n=r.next(".user-list-single")).length)return r.removeClass("selected"),n.addClass("selected")}else if(38===e){if(!r.length)return t.find(".user-list-single:last").addClass("selected");if((i=r.prev('.user-list-single:not(".is-active")')).length)return r.removeClass("selected"),i.addClass("selected")}},e.prototype.init=function(t){var e;return this.stop(),angular.element(document).on("keydown.keyboard-navigation",(e=this,function(r){var n;if(40===(n=r.keyCode?r.keyCode:r.which)||38===n||13===n)return r.preventDefault(),e.dispatch(t,n)}))},e}(taiga.Service),m.service("lightboxKeyboardNavigationService",a),s=function(t){return{restrict:"C",link:function(e,r,n){if(!n.$attr.visible)return r.on("click",".close",function(e){return e.preventDefault(),t.close(r)})}}},m.directive("lightbox",["lightboxService",s]),r=function(t,e,r,n,i,o,s){return{templateUrl:"common/lightbox/lightbox-block.html",link:function(e,a,c,u){var l,p,d;return p=s.instant(c.title),a.find("h2.title").text(p),d=function(e){var n;return(n=o.save(function(t){return t.is_blocked=!1,t.blocked_note="",t})).then(function(){return r.notify("success"),t.$broadcast("object:updated"),e()}),n.then(null,function(){return r.notify("error"),item.revert()}),n.finally(function(){return e()}),n},l=function(){var e,s;return e=i().target(a.find(".button-green")).start(),(s=o.save(function(t){return t.is_blocked=!0,t.blocked_note=a.find(".reason").val(),t})).then(function(){return r.notify("success"),t.$broadcast("object:updated")}),s.then(null,function(){return r.notify("error")}),s.finally(function(){return e.finish(),n.close(a)})},e.$on("block",function(){return a.find(".reason").val(u.$modelValue.blocked_note),n.open(a)}),e.$on("unblock",function(t,e,r){return d(r)}),e.$on("$destroy",function(){return a.off()}),a.on("click",".button-green",function(t){return t.preventDefault(),l()})},require:"ngModel"}},m.directive("tgLbBlock",["$rootScope","$tgRepo","$tgConfirm","lightboxService","$tgLoading","$tgQueueModelTransformation","$translate",r]),n=function(t,e,r){var n;return n=e.get("common/lightbox/lightbox-blocking-message-input.html",!0),{template:function(t,e){return n({ngmodel:e.ngModel})},link:function(e,r,n,i){return n.watch?e.$watch(n.watch,function(t){return!0===t&&!0===t?r.find(".blocked-note").removeClass("hidden"):r.find(".blocked-note").addClass("hidden")}):t.error("No watch attribute on tg-blocking-message-input directive")},require:"ngModel",restrict:"EA"}},m.directive("tgBlockingMessageInput",["$log","$tgTemplate","$compile",n]),i=function(t,e,r,n,i,o){return{link:function(t,s,a){var c,u,l;return c=null,t.$on("usform:bulk",function(e,r,i){return c&&c.reset(),t.new={projectId:r,statusId:i,bulk:""},n.open(s)}),u=h(2e3,function(a){var u,p;if(a.preventDefault(),(c=s.find("form").checksley({onlyOneErrorElement:!0})).validate())return u=i().target(l).start(),(p=e.userstories.bulkCreate(t.new.projectId,t.new.statusId,t.new.bulk)).then(function(t){return t=_.map(t.data,function(t){return o.make_model("userstories",t)}),u.finish(),r.$broadcast("usform:bulk:success",t),n.close(s)}),p.then(null,function(t){if(u.finish(),c.setErrors(t),t._error_message)return $confirm.notify("error",t._error_message)})}),l=s.find(".submit-button"),s.on("submit","form",u),t.$on("$destroy",function(){return s.off()})}}},m.directive("tgLbCreateBulkUserstories",["$tgRepo","$tgResources","$rootScope","lightboxService","$tgLoading","$tgModel",i]),t=function(t,e,r,n,i,o){return{templateUrl:"common/lightbox/lightbox-assigned-to.html",link:function(s,a,c){var u,l,p,d,h;return d=null,p=null,h=r.get("common/lightbox/lightbox-assigned-to-users.html",!0),l=function(t,e){var r,c,u,l;return u=o.searchUsers(e,t),l=_.slice(u,0,5),l=_.map(l,function(t){return t.avatar=i.getAvatar(t)}),t&&t&&(t.avatar=i.getAvatar(t)),r={selected:t,users:_.slice(u,0,5),showMore:u.length>5},c=h(r),c=n(c)(s),a.find(".assigned-to-list").html(c)},u=function(){return e.stop(),t.close(a)},s.$on("assigned-to:add",function(r,n){var i;return p=n,i=n.assigned_to,d=s.usersById[i],l(d),t.open(a).then(function(){return a.find("input").focus(),e.init(a)})}),s.$watch("usersSearch",function(t){if(null!=t)return l(d,t),a.find("input").focus()}),a.on("click",".user-list-single",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),u(),s.$apply(function(){return s.$broadcast("assigned-to:added",e.data("user-id"),p),s.usersSearch=null})}),a.on("click",".remove-assigned-to",function(t){return t.preventDefault(),t.stopPropagation(),u(),s.$apply(function(){return s.usersSearch=null,s.$broadcast("assigned-to:added",null,p)})}),a.on("click",".close",function(t){return t.preventDefault(),u(),s.$apply(function(){return s.usersSearch=null})}),s.$on("$destroy",function(){return a.off()})}}},m.directive("tgLbAssignedto",["lightboxService","lightboxKeyboardNavigationService","$tgTemplate","$compile","tgAvatarService","tgUserListService",t]),e=function(t,e,r,n,i,o,s){return{templateUrl:"common/lightbox/lightbox-assigned-users.html",link:function(t,a,c){var u,l,p,d,f;return d=[],p=null,f=n.get("common/lightbox/lightbox-assigned-users-users.html",!0),l=function(e,r){var n,c,u,l,p;return l=s.searchUsers(r),u=[],_.map(l,function(t){var r;if(r=t.id,S.call(e,r)>=0)return t.avatar=o.getAvatar(t),u.push(t)}),p=[],_.map(l,function(t){var r;if(r=t.id,S.call(e,r)<0)return t.avatar=o.getAvatar(t),p.push(t)}),n={selected:u,users:_.slice(p,0,5),showMore:l.length>5},c=f(n),c=i(c)(t),a.find(".assigned-to-list").html(c)},u=function(){return r.stop(),e.close(a)},t.$on("assigned-user:add",function(t,n){return p=n,d=n.assigned_users,l(d),e.open(a).then(function(){return a.find("input").focus(),r.init(a)})}),t.$watch("usersSearch",function(t){if(null!=t)return l(d,t),a.find("input").focus()}),a.on("click",".user-list-single",h(200,function(e){var r;return u(),e.preventDefault(),r=angular.element(e.currentTarget),t.$apply(function(){return t.usersSearch=null,t.$broadcast("assigned-user:added",r.data("user-id"),p)})})),a.on("click",".remove-assigned-to",function(e){var r;return e.preventDefault(),r=angular.element(e.currentTarget),e.stopPropagation(),t.$apply(function(){return t.usersSearch=null,t.$broadcast("assigned-user:deleted",r.data("user-id"),p)}),u()}),a.on("click",".close",function(t){return t.preventDefault(),u()}),t.$on("$destroy",function(){return a.off()})}}},m.directive("tgLbAssignedUsers",["$tgRepo","lightboxService","lightboxKeyboardNavigationService","$tgTemplate","$compile","tgAvatarService","tgUserListService",e]),d=function(t,e,r,n,i,o){return{templateUrl:"common/lightbox/lightbox-users.html",link:function(t,s,a){var c,u,l,p,d;return p=null,d=n.get("common/lightbox/lightbox-assigned-to-users.html",!0),u=function(e){var r,n;return null==e&&(e=""),r=function(t,e){var r;return(!p||!_.find(p.watchers,function(t){return t===e.id}))&&(r=e.full_name_display.toUpperCase(),t=t.toUpperCase(),_.includes(r,t))},n=_.clone(t.activeUsers,!0),n=_.filter(n,_.partial(r,e))},l=function(e){var r,n,a;return a=_.slice(e,0,5),r={selected:!1,users:a=_.map(a,function(t){return t.avatar=o.getAvatar(t),t}),showMore:e.length>5},n=d(r),n=i(n)(t),s.find(".ticket-watchers").html(n)},c=function(){return r.stop(),e.close(s)},t.$on("watcher:add",function(t,n){var i;return p=n,i=u(),l(i),e.open(s).then(function(){return s.find("input").focus(),r.init(s)})}),t.$watch("usersSearch",function(t){var e;if(null!=t)return e=u(t),l(e),s.find("input").focus()}),s.on("click",".user-list-single",h(200,function(e){var r;return c(),e.preventDefault(),r=angular.element(e.currentTarget),t.$apply(function(){return t.usersSearch=null,t.$broadcast("watcher:added",r.data("user-id"))})})),s.on("click",".close",function(e){return e.preventDefault(),c(),t.$apply(function(){return t.usersSearch=null})}),t.$on("$destroy",function(){return s.off()})}}},m.directive("tgLbWatchers",["$tgRepo","lightboxService","lightboxKeyboardNavigationService","$tgTemplate","$compile","tgAvatarService",d]),c=function(t,e,r){return{templateUrl:"common/lightbox/lightbox-leave-project-warning.html",link:function(e,r,n){return t.open(r)},scope:!0}},m.directive("tgLightboxLeaveProjectWarning",["lightboxService",c]),p=function(t,e,r,n,i,o){return{templateUrl:"common/lightbox/lightbox-due-date.html",link:function(s,a,c){var u,l,p;return u=n.instant("COMMON.PICKERDATE.FORMAT"),e.open(a),s.object.due_date&&(s.new_due_date=moment(s.object.due_date).format(u)),a.on("click",".suggestion",function(t){var e,r,n,i;return e=(r=angular.element(t.currentTarget)).data("quantity"),n=r.data("unit"),i=moment().add(e,n).format(u),a.find(".due-date").val(i)}),p=function(){var n,c,l;return n=r().target(a.find(".submit-button")).start(),s.notAutoSave?(c=$(".due-date").val(),s.object.due_date=c?moment(c,u).format("YYYY-MM-DD"):null,s.$apply(),n.finish(),void e.close(a)):((l=o.save(function(t){return c=$(".due-date").val(),t.due_date=c?moment(c,u).format("YYYY-MM-DD"):null,t})).then(function(){return i.notify("success")}),l.then(null,function(){return i.notify("error")}),l.finally(function(){return n.finish(),e.close(a),t.$broadcast("object:updated")}))},a.on("click",".submit-button",function(t){return t.preventDefault(),p()}),l=function(){var t,r,o;return o=n.instant("LIGHTBOX.DELETE_DUE_DATE.TITLE"),r=n.instant("LIGHTBOX.DELETE_DUE_DATE.SUBTITLE"),t=moment(s.object.due_date).format(u),i.askOnDelete(o,t,r).then(function(t){return t.finish(),$(".due-date").val(null),s.object.due_date_reason=null,s.notAutoSave?(s.object.due_date=null,e.close(a)):p()})},a.on("click",".delete-due-date",function(t){return t.preventDefault(),l()})},scope:!0}},m.directive("tgLbSetDueDate",["$rootScope","lightboxService","$tgLoading","$translate","$tgConfirm","$tgQueueModelTransformation",p]),g=this.taiga.groupBy,o=function(t,e,r,n,i,o,s,a,c,u,l,p,d){return{link:function(f,m,y){var b,j,k,$,I,E,C,T,A,P,w,O,R,M,U,D,N,x,L;return U=null,null,T=null,j=Immutable.List(),k=Immutable.List(),D={us:{objName:"User Story",model:"userstories",params:{include_attachments:!0,include_tasks:!0},data:function(t){return{translationID:"US",translationIDPlural:"US",statusList:_.sortBy(t.us_statuses,"order")}},initialData:function(t){return{project:t.project.id,subject:"",description:"",tags:[],points:{},status:t.statusId?t.statusId:t.project.default_us_status,is_archived:!1}}},task:{objName:"Task",model:"tasks",params:{include_attachments:!0},data:function(t){return{translationID:"TASK",translationIDPlural:"TASKS",statusList:_.sortBy(t.task_statuses,"order")}},initialData:function(t){return{project:t.project.id,subject:"",description:"",assigned_to:null,tags:[],milestone:t.sprintId,status:t.project.default_task_status,user_story:t.usId,is_archived:!1}}},issue:{objName:"Issue",model:"issues",params:{include_attachments:!0},data:function(t){return{translationID:"ISSUE",translationIDPlural:"ISSUES",project:t,statusList:_.sortBy(t.issue_statuses,"order"),typeById:g(t.issue_types,function(t){return t.id}),typeList:_.sortBy(t.issue_types,"order"),severityById:g(t.severities,function(t){return t.id}),severityList:_.sortBy(t.severities,"order"),priorityById:g(t.priorities,function(t){return t.id}),priorityList:_.sortBy(t.priorities,"order"),milestonesById:g(t.milestones,function(t){return t.id})}},initialData:function(t){return{assigned_to:null,milestone:t.sprintId,priority:t.project.default_priority,project:t.project.id,severity:t.project.default_severity,status:t.project.default_issue_status,subject:"",tags:[],type:t.project.default_issue_type}}}},f.setMode=function(t){return f.mode=t},f.$on("genericform:new",function(t,e){return A(e),f.mode="new",f.getOrCreate=!1,w(e)}),f.$on("genericform:new-or-existing",function(t,e){return A(e),f.mode="add-existing",f.getOrCreate=!0,f.existingFilterText="",n[U.model].listInAllProjects({project:f.project.id},!0).then(function(t){return f.existingItems=angular.copy(t)}),w(e)}),f.$on("genericform:edit",function(t,e){return A(e),f.mode="edit",f.getOrCreate=!1,w(e)}),A=function(e){return _.map(e,function(t,e){return f[e]=t}),f.objType&&D[f.objType]?U=D[f.objType]:t.error("Invalid objType `"+f.objType+"` for `genericform` event")},w=function(t){return f.objName=U.objName,"edit"===f.mode?(f.obj=t.obj,f.attachments=Immutable.fromJS(t.attachments)):(f.obj=r.make_model(U.model,U.initialData(t)),f.attachments=Immutable.List()),_.map(U.data(f.project),function(t,e){return f[e]=t}),T&&T.reset(),R(),N(f.obj.status),O(),f.lightboxOpen=!0,o.open(m,null,null,!0)},R=function(){return j=Immutable.List(),k=Immutable.List()},f.addAttachment=function(t){return j=j.push(t)},f.deleteAttachment=function(t){if(j=j.filter(function(e){return e.get("name")!==t.get("name")}),t.get("id"))return k=k.push(t)},f.addTag=function(t,e){var r,n,i,o;if(o=v(t.toLowerCase()),i=f.project.tags,n=f.project.tags_colors,null==i&&(i=[]),null==n&&(n={}),S.call(i,o)<0&&i.push(o),n[t]=e||null,f.project.tags=i,r=_.clone(f.obj.tags),!_.find(r,function(t){return t[0]===o}))return r.push([o,e]),f.obj.tags=r},f.deleteTag=function(t){var e,r;return r=v(t[0].toLowerCase()),f.project.tags,e=_.clone(f.obj.tags),_.remove(e,function(t){return t[0]===r}),f.obj.tags=e,_.pull(f.obj.tags,r)},E=function(t){var e;return e=_.map(j.toJS(),function(e){return l.upload(e.file,t.id,f.obj.project,f.objType)}),u.all(e)},C=function(t){var e;return e=_.map(k.toJS(),function(t){return l.delete(f.objType,t.id)}),u.all(e)},b=function(t){return s().target(m.find(".add-existing-button")).start(),t.milestone?x(t):M(t,function(){return I(),i.$broadcast(f.objType+"form:add:success",t)},function(){return I()})},x=function(t){var e,r,n,s;return n=f.milestonesById[t.milestone].name,r=f.milestonesById[f.relatedObjectId].name,s=a.instant("ISSUES.CONFIRM_CHANGE_FROM_SPRINT.TITLE"),e=a.instant("ISSUES.CONFIRM_CHANGE_FROM_SPRINT.MESSAGE",{issue:t.subject,oldSprintName:n,newSprintName:r}),c.ask(s,null,e).then(function(e){return M(t,function(){return e.finish(),o.closeAll(),f.lightboxOpen=!1,i.$broadcast(f.objType+"form:add:success",t)},function(){return e.finish(!1),c.notify("error")})})},M=function(t,r,n){return t.setAttr(f.relatedField,f.relatedObjectId),e.save(t,!0).then(r,n)},P=function(t){return t&&t[f.relatedField]===f.relatedObjectId},f.isDisabledExisting=function(t){return P(t)},f.addExistingToSprint=function(t){return b(t)},L=h(2e3,function(t){var r,o,u;if((T=m.find("form").checksley()).validate())return o=s().target(m.find(".submit-button")).start(),"new"===f.mode?(u=e.create(U.model,f.obj),r=f.objType+"form:new:success"):(f.obj.due_date instanceof moment&&(a.instant("COMMON.PICKERDATE.FORMAT"),f.obj.due_date=f.obj.due_date.format("YYYY-MM-DD")),u=e.save(f.obj,!0),r=f.objType+"form:edit:success"),u.then(function(t){return C().then(function(){return E(t).then(function(){if(o.finish(),I(),t.ref)return n[U.model].getByRef(t.project,t.ref,U.params).then(function(t){return i.$broadcast(r,t)})})})}),u.then(null,function(t){if(o.finish(),T.setErrors(t),t._error_message)return c.notify("error",t._error_message)})}),$=function(){return f.obj.isModified()?c.ask(a.instant("LIGHTBOX.CREATE_EDIT.CONFIRM_CLOSE")).then(function(t){return t.finish(),I()}):(I(),f.$apply(function(){return f.obj.revert()}))},I=function(){return o.closeAll(),f.lightboxOpen=!1},angular.element(document).on("keydown.lightbox-create-edit",function(t){if(f.lightboxOpen&&(t.stopPropagation(),27===(t.keyCode?t.keyCode:t.which)))return $()}),m.on("submit","form",L),m.find(".close").on("click",function(t){return t.preventDefault(),t.stopPropagation(),$()}),m.on("click",".status-dropdown",function(t){return t.preventDefault(),t.stopPropagation(),m.find(".pop-status").popover().open()}),m.on("click",".status",function(t){return t.preventDefault(),t.stopPropagation(),N(angular.element(t.currentTarget).data("status-id")),f.$apply(),f.$broadcast("status:changed",f.obj.status),m.find(".pop-status").popover().close()}),m.on("click",".team-requirement",function(t){return f.obj.team_requirement=!f.obj.team_requirement,f.$apply()}),m.on("click",".client-requirement",function(t){return f.obj.client_requirement=!f.obj.client_requirement,f.$apply()}),m.on("click",".is-blocked",function(t){return f.obj.is_blocked=!f.obj.is_blocked,f.$apply()}),m.on("click",".iocaine",function(t){return f.obj.is_iocaine=!f.obj.is_iocaine,f.$broadcast("isiocaine:changed",f.obj)}),f.isTeamRequirement=function(){var t;return null!=(t=f.obj)?t.team_requirement:void 0},f.isClientRequirement=function(){var t;return null!=(t=f.obj)?t.client_requirement:void 0},N=function(t){return f.obj.status=t,f.selectedStatus=_.find(f.statusList,function(e){return e.id===t}),f.obj.is_closed=f.selectedStatus.is_closed},O=function(t){var e,r,n;return r=p.get("common/lightbox/lightbox-create-edit/lb-create-edit.html"),n=f.$new(),e=d(r)(n),m.html(e)}}}},m.directive("tgLbCreateEdit",["$log","$tgRepo","$tgModel","$tgResources","$rootScope","lightboxService","$tgLoading","$translate","$tgConfirm","$q","tgAttachmentsService","$tgTemplate","$compile",o]),f=this.taiga.debounceLeading,l=function(t,e,r,n,i,o,s,a){return{templateUrl:"common/lightbox/lightbox-relate-to-epic.html",link:function(o,c,u){var l,p,d,h,g,m;return m=null,o.projects=null,o.projectEpics=Immutable.List(),o.loading=!1,o.selectedProject=o.project.id,h=c.find(".new-epic-form").checksley(),l=c.find(".existing-epic-form").checksley(),d=function(){if(null===o.projects)return o.projects=n.projects.get("unblocked")},p=function(t,e){return i.epics.listInAllProjects({is_epics_activated:!0,project__blocked_code:"null",project:t,q:e},!0).then(function(t){var e,r;return e=[],m.epics&&(e=m.epics.map(function(t){return t.id})),r=t.filter(function(t){return-1===e.indexOf(t.get("id"))}),o.projectEpics=r})},g=function(t){return o.selectedEpic=null,o.searchEpic="",p(t,o.searchEpic)},c.on("click",".close",function(t){return t.preventDefault(),r.close(c)}),o.$on("relate-to-epic:add",function(t,e){return m=e,o.selectedEpic=null,o.searchEpic="",d(),p(o.selectedProject,o.searchEpic).then(function(){return r.open(c).then(function(){return c.find("input").focus})})}),o.$on("$destroy",function(){return c.off()}),o.selectProject=function(t){return g(t)},o.onUpdateSearchEpic=f(300,function(){return o.selectedEpic=null,p(o.selectedProject,o.searchEpic)}),o.saveRelatedEpic=function(n,s){var u,p,d;if(l.validate())return o.loading=!0,u=function(t){return o.loading=!1,e.notify("error"),l.setErrors(t)},p=function(e){return a.trackEvent("user story related epic","create","create related epic on user story",1),o.loading=!1,t.$broadcast("related-epics:changed",m),r.close(c)},d=m.id,i.epics.addRelatedUserstory(n,d).then(p,u)},o.createEpic=function(n,u){var l,p,d;if(h.validate())return this.loading=!0,p=function(t){return o.loading=!1,e.notify("error"),h.setErrors(errors)},d=function(){return a.trackEvent("user story related epic","create","create related epic on user story",1),o.loading=!1,t.$broadcast("related-epics:changed",m),r.close(c)},l=function(t){var e,r;return e=t.get("id"),r=m.id,i.epics.addRelatedUserstory(e,r).then(d,p)},s.createEpic({subject:u},null,n).then(l,p)}}}},m.directive("tgLbRelatetoepic",["$rootScope","$tgConfirm","lightboxService","tgCurrentUserService","tgResources","$tgResources","tgEpicsService","$tgAnalytics",l])}.call(this),function(){var t,e,r,n;this.taiga,this.taiga.sizeFormat,n=this.taiga.timeout,e=function(t,e){return{link:function(e,r,n){return t.onStart(function(){return $(document.body).addClass("loader-active"),r.addClass("active")}),t.onEnd(function(){return $(document.body).removeClass("loader-active"),r.removeClass("active")})}}},(r=angular.module("taigaCommon")).directive("tgLoader",["tgLoader","$rootScope",e]),(t=function(t){var e,r,i,o,s,a,c,u;return r={minTime:300},o=!1,u=0,a=0,i=0,e=function(){var t;return t=setInterval(function(){if(i&&0===a)return s(),clearInterval(t)},50)},c=function(){return u=(new Date).getTime(),t.$broadcast("loader:start"),o=!0},{pageLoaded:s=function(e){var s,c;return null==e&&(e=!1),u&&(c=0,e||(s=(new Date).getTime()-u)<r.minTime&&(c=r.minTime-s),n(c,function(){return t.$broadcast("loader:end"),o=!1,window.prerenderReady=!0})),u=0,a=0,i=0},open:function(){return o},start:function(t){if(null==t&&(t=!1),!o&&(c(),t))return e()},onStart:function(e){return t.$on("loader:start",e)},onEnd:function(e){return t.$on("loader:end",e)},logRequest:function(){return a++},logResponse:function(){return a--,i=(new Date).getTime()}}}).$inject=["$rootScope"],r.factory("tgLoader",t)}.call(this),function(){var t,e,r,n=[].slice;r=angular.module("taigaCommon"),(e=function(t){var e;return e="<img class='loading-spinner' src='/"+window._version+"/svg/spinner-circle.svg' alt='loading...' />",function(){var r;return r={settings:{target:null,scope:null,classes:[],timeout:0,template:null},target:function(t){return r.settings.target=t,r},scope:function(t){return r.settings.scope=t,r},template:function(t){return r.settings.template=t,r},removeClasses:function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],r.settings.classes=t,r},timeout:function(t){return r.settings.timeout=t,r},start:function(){var t,n;return t=r.settings.target,r.settings.classes.map(function(e){return t.removeClass(e)}),t.hasClass("loading")||r.settings.template||(r.settings.template=t.html()),n=setTimeout(function(){if(!t.hasClass("loading"))return t.addClass("loading"),t.html(e)},r.settings.timeout),r.settings.timeoutId=n,r},finish:function(){var e,n;return e=r.settings.target,(n=r.settings.timeoutId)&&(clearTimeout(n),r.settings.classes.map(function(t){return r.settings.target.addClass(t)}),e.html(r.settings.template),e.removeClass("loading"),r.settings.scope&&t(e.contents())(r.settings.scope)),r}}}}).$inject=["$compile"],r.factory("$tgLoading",e),t=function(t){return{priority:99999,link:function(e,r,n){var i,o;return i=null,o=r.html(),e.$watch(n.tgLoading,function(n){return n?i=t().target(r).timeout(100).template(o).scope(e).start():i?i.finish():void 0})}}},r.directive("tgLoading",["$tgLoading",t])}.call(this),function(){var t,e,r,n,i,o;o=this.taiga,r=this.taiga.bindOnce,n=this.taiga.debounce,e=function(t,e){var i;return i=e.get("common/popover/popover-us-status.html",!0),{link:function(e,o,s){var a,c;return o.controller(),a=function(t){var r,n,i;if(i=o.find(".us-status"),n=o.find(".us-status .us-status-bind"),(r=e.usStatusById)[t.status])return n.text(r[t.status].name),i.css("color",r[t.status].color)},o.on("click",".us-status",function(t){return t.preventDefault(),t.stopPropagation(),o.find(".pop-status").popover().open()}),o.on("click",".status",n(2e3,function(r){var n,i;return r.preventDefault(),r.stopPropagation(),n=angular.element(r.currentTarget),(i=e.$eval(s.tgUsStatus)).status=n.data("status-id"),a(i),o.find(".pop-status").popover().close(),e.$apply(function(){return t.save(i).then(function(){return e.$eval(s.onUpdate)})})})),e.$on("userstories:loaded",function(){return a(e.$eval(s.tgUsStatus))}),e.$on("$destroy",function(){return o.off()}),c=e.$eval(s.tgUsStatus),a(c),r(e,"project",function(t){var r;if(r=i({statuses:t.us_statuses}),o.append(r),-1===e.project.my_permissions.indexOf("modify_us"))return o.unbind("click"),o.find("a").addClass("not-clickable")})}}},(i=angular.module("taigaCommon")).directive("tgUsStatus",["$tgRepo","$tgTemplate",e]),t=function(t,e){var r,i;return r=e.get("common/popover/popover-related-task-status.html",!0),i=function(t,e,r){var n,i;if(i=t.find(".us-status"),n=t.find(".task-status .task-status-bind"),r[e.status])return n.text(r[e.status].name),i.css("color",r[e.status].color)},{link:function(e,s,a){var c,u,l;return s.controller(),l=e.$eval(a.tgRelatedTaskStatus),u=e.$eval(a.notAutoSave),c=!u,s.on("click",".task-status",function(t){return t.preventDefault(),t.stopPropagation(),s.find(".pop-status").popover().open()}),s.on("click",".status",n(2e3,function(r){var n;if(r.preventDefault(),r.stopPropagation(),n=angular.element(r.currentTarget),l.status=n.data("status-id"),s.find(".pop-status").popover().close(),i(s,l,e.taskStatusById),c)return e.$apply(function(){return t.save(l).then(function(){return e.$eval(a.onUpdate),e.$emit("related-tasks:status-changed")})})})),e.$watch(a.tgRelatedTaskStatus,function(){return l=e.$eval(a.tgRelatedTaskStatus),i(s,l,e.taskStatusById)}),o.bindOnce(e,"project",function(t){if(s.append(r({statuses:t.task_statuses})),i(s,l,e.taskStatusById),-1===t.my_permissions.indexOf("modify_task"))return s.unbind("click"),s.find("a").addClass("not-clickable")}),e.$on("$destroy",function(){return s.off()})}}},i.directive("tgRelatedTaskStatus",["$tgRepo","$tgTemplate",t]),$.fn.popover=function(){var t,e,r,n,i;return t=this,i=function(){var e,r,n,i,o,s,a,c;return t.css({display:"block",visibility:"hidden"}),e=(n=$(window).scrollTop())+$(window).height(),r=$(window).width(),i=(a=t.offset().top)+t.height(),c=t.width(),o=t.offset().left,s=t.offset().left+c,t.css({display:"none",visibility:"visible"}),i<=e&&a>=n&&o>=0&&s<=r},n=function(e){return e&&e.call(t),t.fadeOut(function(){return t.removeClass("active").removeClass("fix")}),t.off("popup:close")},{open:function(o){return t.hasClass("active")?e():(r(),i()||t.addClass("fix"),t.fadeIn(function(){return t.addClass("active"),$(document.body).off("popover"),$(document.body).one("click.popover",function(){return r()})}),t.on("popup:close",function(t){return n(o)}))},close:e=function(){return t.trigger("popup:close")},closeAll:r=function(){return $(".popover.active").each(function(){return $(this).trigger("popup:close")})}}}}.call(this),function(){var t;this.taiga,t=function(t,e){var r;return this.config=e,(r=this.config.get("ravenConfig",null))?(t.debug("Using the RavenJS exception handler."),Raven.config(r).install(),function(e,r){return t.error.apply(t,arguments),Raven.captureException(e)}):(t.debug("Using the default logging exception handler."),function(e,r){return t.error.apply(t,arguments)})},angular.module("taigaCommon").factory("$exceptionHandler",["$log","$tgConfig",t])}.call(this),function(){var t,e,r={}.hasOwnProperty;e=angular.module("taigaCommon"),t=function(t){var e;function n(t,r){var i;this.translate=t,this.currentUserService=r,n.__super__.constructor.call(this),_.map(e,(i=this,function(t){return t.title=i.translate.instant("PROJECT.SECTION."+t.title)}))}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(n,taiga.Service),n.$inject=["$translate","tgCurrentUserService"],e={1:{id:1,title:"TIMELINE",path:"timeline",enabled:""},2:{id:2,title:"EPICS",path:"epics",enabled:"is_epics_activated"},3:{id:3,title:"BACKLOG",path:"backlog",enabled:"is_backlog_activated"},4:{id:4,title:"KANBAN",path:"kanban",enabled:"is_kanban_activated"},5:{id:5,title:"ISSUES",path:"issues",enabled:"is_issues_activated"},6:{id:6,title:"WIKI",path:"wiki",enabled:"is_wiki_activated"}},n.prototype.list=function(){return e},n.prototype.getPath=function(t,r){var n,i,o,s;return"timeline",(i=null!=(o=this.currentUserService.projects)?o.get("all"):void 0)&&(n=i.find(function(e){return e.get("slug")===t}))?(r||(r=n.get("my_homepage")),(s=_.find(e,{id:r}))&&!1!==(null!=n?n.get(s.enabled):void 0)?s.path:"timeline"):"timeline"},n}(),e.service("$tgSections",t)}.call(this),function(){var e,r,n,i,o,s,a=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};this.taiga,s=this.taiga.trim,i=this.taiga.bindOnce,n=function(){var t,e;return t=function(t){return _.isArray(t)?t.join(", "):""},e=function(t){return t?_(t.split(",")).map(function(t){return _.trim(t)}).value():[]},{require:"ngModel",link:function(r,n,i,o){return o.$formatters.push(t),o.$parsers.push(e),r.$on("$destroy",function(){return n.off()})}}},(o=angular.module("taigaCommon")).directive("tgTags",n),e=function(t){var e;return e=_.template('<% _.each(tags, function(tag) { %>\n    <% if (tag[1] !== null) { %>\n    <span class="tag"\n          style="border-left: 5px solid <%- tag[1] %>"\n          title="<%- tag[0] %>">\n          <%= emojify(tag[0]) %>\n    </span>\n    <% } %>\n<% }) %>\n<% _.each(tags, function(tag) { %>\n    <% if (tag[1] === null) { %>\n    <span class="tag"\n          title="<%- tag[0] %>">\n          <%= emojify(tag[0]) %>\n    </span>\n    <% } %>\n<% }) %>'),{link:function(r,n,i,o){var s;return s=function(r){var i;return i=e({tags:r,emojify:function(e){return t.replaceEmojiNameByHtmlImgs(_.escape(e))}}),n.html(i)},r.$watch(i.tgColorizeBacklogTags,function(t){if(null!=t)return s(t)}),r.$on("$destroy",function(){return n.off()})}}},o.directive("tgColorizeBacklogTags",["$tgEmojis",e]),r=function(e,r,n){var o,c;return 13,188,c=r.get("common/tag/lb-tag-line-tags.html",!0),o=null,{link:function(e,r,u,l){var p,d,h,f,g,m,v,y;return y=_.has(u,"withoutColors"),f=function(i,o){var s,a,u;return null==o&&(o=[]),s=y?null:o[t],a={tags:_.map(i,function(t){return{name:t,style:s?"border-left: 5px solid "+s:""}})},u=n(c(a))(e),r.find(".tags-container").html(u)},v=function(){return r.find(".save").removeClass("hidden")},h=function(){return r.find(".save").addClass("hidden")},g=function(){return r.find("input").val(""),o.close()},p=function(t){var r;if(0!==(t=s(t.toLowerCase())).length)return null==(r=_.clone(l.$modelValue,!1))&&(r=[]),a.call(r,t)<0&&r.push(t),e.$apply(function(){return l.$setViewValue(r)}),h()},d=function(t){var r;if(0!==(t=s(t.toLowerCase())).length)return r=_.clone(l.$modelValue,!1),r=_.pull(r,t),e.$apply(function(){return l.$setViewValue(r)})},m=function(){var t;return t=r.find("input").val(),p(t),g()},r.on("keypress","input",function(t){var e;return e=angular.element(t.currentTarget),13===t.keyCode?(t.preventDefault(),m()):","===String.fromCharCode(t.keyCode)?(t.preventDefault(),m()):e.val().length?v():h()}),r.on("click",".save",function(t){return t.preventDefault(),m()}),r.on("click",".remove-tag",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget).siblings(".tag-name").text(),d(e)}),i(e,"project",function(t){var e;return e=r.find("input"),o=new Awesomplete(e[0],{list:_.keys(t.tags_colors)}),e.on("awesomplete-selectcomplete",function(){return p(e.val()),e.val("")})}),e.$watch(u.ngModel,function(t){var r,n;return n=(null!=(r=e.project)?r.tags_colors:void 0)||[],f(t,n)}),e.$on("$destroy",function(){return r.off()})},require:"ngModel",templateUrl:"common/tag/lb-tag-line.html"}},o.directive("tgLbTagLine",["$tgResources","$tgTemplate","$compile",r])}.call(this),function(){var t,e;this.taiga,this.taiga.bindOnce,e=this.taiga.debounce,t=function(t,r,n,i,o,s,a){return{link:function(n,c,u){var l,p,d,h,f,g,m,v;return h=!1,l=!0,p=null,n.newSprint={},v=null,g=function(){return p&&p.reset(),n.newSprint={project:null,name:null,estimated_start:null,estimated_finish:null}},m=e(2e3,function(e){var u,d,f,g,m,y,b,S;return e.preventDefault(),angular.element(e.currentTarget),y=a.instant("COMMON.PICKERDATE.FORMAT"),S=c.find(".submit-button"),(p=c.find("form").checksley()).validate()?(h=!1,u=null,g=$(".date-start").val(),f=$(".date-end").val(),l?((m=angular.copy(n.newSprint)).estimated_start=moment(g,y).format("YYYY-MM-DD"),m.estimated_finish=moment(f,y).format("YYYY-MM-DD"),b=t.create("milestones",m),u="sprintform:create:success"):((m=n.newSprint.realClone()).estimated_start=moment(g,y).format("YYYY-MM-DD"),m.estimated_finish=moment(f,y).format("YYYY-MM-DD"),b=t.save(m),u="sprintform:edit:success"),d=s().target(S).start(),b.then(function(t){return d.finish(),l&&(n.sprintsCounter+=1),n.sprints=_.map(n.sprints,function(e){return e.id===t.id?t:e}),"sprintform:create:success"===u&&v?i.$broadcast(u,t,v):i.$broadcast(u,t),o.close(c)}),b.then(null,function(t){return d.finish(),p.setErrors(t),t._error_message?r.notify("light-error",t._error_message):t.__all__?r.notify("light-error",t.__all__[0]):void 0})):(h=!0,void c.find(".last-sprint-name").addClass("disappear"))}),f=function(){var e,s;return s=a.instant("LIGHTBOX.DELETE_SPRINT.TITLE"),e=n.newSprint.name,r.askOnDelete(s,e).then(function(e){var s,a;return a=function(){return e.finish(),n.milestonesCounter-=1,o.close(c),i.$broadcast("sprintform:remove:success",n.newSprint)},s=function(){return e.finish(!1),r.notify("error")},t.remove(n.newSprint).then(a,s)})},d=function(){var t,e;return t=_.filter(n.sprints,function(t){return!t.closed}),(e=_.sortBy(t,function(t){return moment(t.estimated_finish,"YYYY-MM-DD").format("X")}))[e.length-1]},n.$on("sprintform:create",function(t,e,r){var i,s,u,h,f,m;return v=r,g(),(p=c.find("form").checksley()).reset(),l=!0,f=a.instant("COMMON.PICKERDATE.FORMAT"),n.newSprint.project=e,n.newSprint.name=null,n.newSprint.slug=null,u=d(),s=moment(),u?s=moment(u.estimated_finish):n.newSprint.estimated_start&&(s=moment(n.newSprint.estimated_start)),n.newSprint.estimated_start=s.format(f),i=moment().add(2,"weeks"),u?i=moment(u.estimated_finish).add(2,"weeks"):n.newSprint.estimated_finish&&(i=moment(n.newSprint.estimated_finish)),n.newSprint.estimated_finish=i.format(f),h=c.find(".last-sprint-name"),null!=(null!=u?u.name:void 0)&&(m=a.instant("LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME",{lastSprint:u.name}),h.html(m)),c.find(".delete-sprint").addClass("hidden"),m=a.instant("LIGHTBOX.ADD_EDIT_SPRINT.TITLE"),c.find(".title").text(m),m=a.instant("COMMON.CREATE"),c.find(".button-green").text(m),o.open(c),c.find(".sprint-name").focus(),c.find(".last-sprint-name").removeClass("disappear")}),n.$on("sprintform:edit",function(t,e){var r,i,s;return g(),l=!1,i=a.instant("COMMON.PICKERDATE.FORMAT"),n.$apply(function(){return n.newSprint=e.realClone(),n.newSprint.estimated_start=moment(n.newSprint.estimated_start).format(i),n.newSprint.estimated_finish=moment(n.newSprint.estimated_finish).format(i)}),c.find(".delete-sprint").removeClass("hidden"),r=a.instant("BACKLOG.EDIT_SPRINT"),c.find(".title").text(r),s=a.instant("COMMON.SAVE"),c.find(".button-green").text(s),o.open(c),c.find(".sprint-name").focus().select(),c.find(".last-sprint-name").addClass("disappear")}),c.on("keyup",".sprint-name",function(t){return c.find(".sprint-name").val().length>0||h?c.find(".last-sprint-name").addClass("disappear"):c.find(".last-sprint-name").removeClass("disappear")}),c.on("submit","form",m),c.on("click",".delete-sprint",function(t){return t.preventDefault(),f()}),n.$on("$destroy",function(){return c.off()}),g()}}},angular.module("taigaBacklog").directive("tgLbCreateEditSprint",["$tgRepo","$tgConfirm","$tgResources","$rootScope","lightboxService","$tgLoading","$translate",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v={}.hasOwnProperty;f=this.taiga,p=this.taiga.mixOf,m=this.taiga.toggleText,h=this.taiga.scopeDefer,c=this.taiga.bindOnce,l=this.taiga.groupBy,g=this.taiga.timeout,a=this.taiga.bindMethods,u=this.taiga.generateHash,d=angular.module("taigaBacklog"),t=function(t){function e(t,e,r,n,i,o,s,c,u,l,p,d,h,f,g,m,v,y,_,b){var S,j;(this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=c,this.appMetaService=u,this.navUrls=l,this.events=p,this.analytics=d,this.translate=h,this.loading=f,this.rs2=g,this.modelTransform=m,this.errorHandlingService=v,this.storage=y,this.filterRemoteStorageService=_,this.projectService=b,a(this),this.backlogOrder={},this.milestonesOrder={},this.page=1,this.disablePagination=!1,this.firstLoadComplete=!1,this.scope.userstories=[],this.applyStoredFilters(this.params.pslug,"backlog-filters"))||(this.scope.sectionName=this.translate.instant("BACKLOG.SECTION_NAME"),this.showTags=!1,this.activeFilters=!1,this.scope.showGraphPlaceholder=null,this.displayVelocity=!1,this.initializeEventHandlers(),(S=this.loadInitialData()).then((j=this,function(){var t,e;if(j.firstLoadComplete=!0,e=j.translate.instant("BACKLOG.PAGE_TITLE",{projectName:j.scope.project.name}),t=j.translate.instant("BACKLOG.PAGE_DESCRIPTION",{projectName:j.scope.project.name,projectDescription:j.scope.project.description}),j.appMetaService.setAll(e,t),j.rs.userstories.getShowTags(j.scope.projectId))return j.showTags=!0,j.scope.$broadcast("showTags",j.showTags)})),S.then(null,this.onInitialDataError.bind(this)))}return function(t,e){for(var r in e)v.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,p(f.Controller,f.PageMixin,f.FiltersMixin,f.UsFiltersMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","$tgLoading","tgResources","$tgQueueModelTransformation","tgErrorHandlingService","$tgStorage","tgFilterRemoteStorageService","tgProjectService"],e.prototype.storeCustomFiltersName="backlog-custom-filters",e.prototype.storeFiltersName="backlog-filters",e.prototype.backlogOrder={},e.prototype.milestonesOrder={},e.prototype.filtersReloadContent=function(){return this.loadUserstories(!0)},e.prototype.initializeEventHandlers=function(){var t;return this.scope.$on("usform:bulk:success",(t=this,function(){return t.loadUserstories(!0),t.loadProjectStats(),t.confirm.notify("success"),t.analytics.trackEvent("userstory","create","bulk create userstory on backlog",1)})),this.scope.$on("sprintform:create:success",function(t){return function(e,r,n){return t.loadSprints().then(function(){return t.scope.$broadcast("sprintform:create:success:callback",n)}),t.loadProjectStats(),t.confirm.notify("success"),t.analytics.trackEvent("sprint","create","create sprint on backlog",1)}}(this)),this.scope.$on("usform:new:success",function(t){return function(){return t.loadUserstories(!0),t.loadProjectStats(),t.rootscope.$broadcast("filters:update"),t.confirm.notify("success"),t.analytics.trackEvent("userstory","create","create userstory on backlog",1)}}(this)),this.scope.$on("sprintform:edit:success",function(t){return function(){return t.loadProjectStats()}}(this)),this.scope.$on("sprintform:remove:success",function(t){return function(e,r){return t.loadSprints(),t.loadProjectStats(),t.loadUserstories(!0),r.closed&&t.loadClosedSprints(),t.rootscope.$broadcast("filters:update")}}(this)),this.scope.$on("usform:edit:success",function(t){return function(e,r){var n;return n=_.findIndex(t.scope.userstories,function(t){return t.id===r.id}),t.scope.userstories[n]=r,t.rootscope.$broadcast("filters:update")}}(this)),this.scope.$on("sprint:us:move",this.moveUs),this.scope.$on("sprint:us:moved",function(t){return function(){return t.loadSprints(),t.loadProjectStats()}}(this)),this.scope.$on("backlog:load-closed-sprints",this.loadClosedSprints),this.scope.$on("backlog:unload-closed-sprints",this.unloadClosedSprints)},e.prototype.initializeSubscription=function(){var t,e,r;return t="changes.project."+this.scope.projectId+".userstories",this.events.subscribe(this.scope,t,(r=this,function(t){return r.loadAllPaginatedUserstories(),r.loadSprints()})),e="changes.project."+this.scope.projectId+".milestones",this.events.subscribe(this.scope,e,function(t){return function(e){return t.loadSprints()}}(this))},e.prototype.toggleShowTags=function(){return this.scope.$apply((t=this,function(){return t.showTags=!t.showTags,t.rs.userstories.storeShowTags(t.scope.projectId,t.showTags)}));var t},e.prototype.toggleActiveFilters=function(){return this.activeFilters=!this.activeFilters},e.prototype.toggleVelocityForecasting=function(){return this.displayVelocity=!this.displayVelocity,this.displayVelocity?this.scope.visibleUserStories=_.map(this.forecastedStories,function(t){return t.ref}):this.scope.visibleUserStories=_.map(this.scope.userstories,function(t){return t.ref}),h(this.scope,(t=this,function(){return t.scope.$broadcast("userstories:loaded")}));var t},e.prototype.loadProjectStats=function(){return this.rs.projects.stats(this.scope.projectId).then((t=this,function(e){var r;return t.scope.stats=e,r=e.total_points?e.total_points:e.defined_points,t.scope.stats.completedPercentage=r?Math.round(100*e.closed_points/r):0,t.scope.showGraphPlaceholder=!(null!=e.total_points&&null!=e.total_milestones),t.calculateForecasting(),e}));var t},e.prototype.setMilestonesOrder=function(t){var e,r,n,i,o;for(i=[],r=0,n=t.length;r<n;r++)o=t[r],this.milestonesOrder[o.id]={},i.push(function(){var t,r,n,i;for(i=[],t=0,r=(n=o.user_stories).length;t<r;t++)e=n[t],i.push(this.milestonesOrder[o.id][e.id]=e.sprint_order);return i}.call(this));return i},e.prototype.unloadClosedSprints=function(){return this.scope.$apply((t=this,function(){return t.scope.closedSprints=[],t.rootscope.$broadcast("closed-sprints:reloaded",[])}));var t},e.prototype.loadClosedSprints=function(){var t,e;return t={closed:!0},this.rs.sprints.list(this.scope.projectId,t).then((e=this,function(t){var r,n,i,o;for(o=t.milestones,e.setMilestonesOrder(o),e.scope.totalClosedMilestones=t.closed,r=0,n=o.length;r<n;r++)(i=o[r]).user_stories=_.sortBy(i.user_stories,"sprint_order");return e.scope.closedSprints=o,e.scope.closedSprintsById=l(o,function(t){return t.id}),e.rootscope.$broadcast("closed-sprints:reloaded",o),o}))},e.prototype.loadSprints=function(){var t,e;return t={closed:!1},this.rs.sprints.list(this.scope.projectId,t).then((e=this,function(t){var r,n,i,o;for(o=t.milestones,e.setMilestonesOrder(o),e.scope.totalMilestones=o,e.scope.totalClosedMilestones=t.closed,e.scope.totalOpenMilestones=t.open,e.scope.totalMilestones=e.scope.totalOpenMilestones+e.scope.totalClosedMilestones,r=0,n=o.length;r<n;r++)(i=o[r]).user_stories=_.sortBy(i.user_stories,"sprint_order");return e.scope.sprints=o,e.scope.closedSprints||(e.scope.closedSprints=[]),e.scope.sprintsCounter=o.length,e.scope.sprintsById=l(o,function(t){return t.id}),e.rootscope.$broadcast("sprints:loaded",o),e.scope.currentSprint=e.findCurrentSprint(),o}))},e.prototype.openSprints=function(){return _.filter(this.scope.sprints,function(t){return!t.closed}).reverse()},e.prototype.loadAllPaginatedUserstories=function(){var t,e;return t=this.page,this.loadUserstories(!0,this.scope.userstories.length).then((e=this,function(){return e.page=t}))},e.prototype.loadUserstories=function(t,e){var r,n;return null==t&&(t=!1),this.scope.projectId?(this.loadingUserstories=!0,this.disablePagination=!0,r=_.clone(this.location.search()),this.rs.userstories.storeQueryParams(this.scope.projectId,r),t&&(this.page=1),r.page=this.page,this.rs.userstories.listUnassigned(this.scope.projectId,r,e).then((n=this,function(e){var r,i,o,s,a,c;for(c=e[0],r=e[1],t&&(n.scope.userstories=[]),n.scope.userstories=n.scope.userstories.concat(_.sortBy(c,"backlog_order")),n.scope.visibleUserStories=_.map(n.scope.userstories,function(t){return t.ref}),o=0,s=(a=n.scope.userstories).length;o<s;o++)i=a[o],n.backlogOrder[i.id]=i.backlog_order;return n.loadingUserstories=!1,r("x-pagination-next")&&(n.disablePagination=!1,n.page++),h(n.scope,function(){return n.scope.$broadcast("userstories:loaded")}),c}))):null},e.prototype.loadBacklog=function(){return this.q.all([this.loadProjectStats(),this.loadSprints(),this.loadUserstories()]).then(this.calculateForecasting)},e.prototype.calculateForecasting=function(){var t,e,r,n,i,o,s;for((o=this.scope.stats).total_points,o.assigned_points,t=0,this.forecastedStories=[],i=[],e=0,r=(n=this.scope.userstories).length;e<r&&((s=n[e]).total_points,t+=s.total_points,this.forecastedStories.push(s),!(o.speed>0&&t>o.speed));e++)i.push(void 0);return i},e.prototype.loadProject=function(){var t;return(t=this.projectService.project.toJS()).is_backlog_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.closedMilestones=!!t.total_closed_milestones,this.scope.$emit("project:loaded",t),this.scope.points=_.sortBy(t.points,"order"),this.scope.pointsById=l(t.points,function(t){return t.id}),this.scope.usStatusById=l(t.us_statuses,function(t){return t.id}),this.scope.usStatusList=_.sortBy(t.us_statuses,"id"),t},e.prototype.loadInitialData=function(){var t,e;return t=this.loadProject(),this.fillUsersAndRoles(t.members,t.roles),this.initializeSubscription(),this.loadBacklog().then((e=this,function(){return e.generateFilters("null")})).then(function(t){return function(){return t.scope.$emit("backlog:loaded")}}(this))},e.prototype.prepareBulkUpdateData=function(t,e){return null==e&&(e="backlog_order"),_.map(t,function(t){return{us_id:t.id,order:t[e]}})},e.prototype.moveUs=function(t,e,r,n){var i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,b,S,j,k,$,I,E,C,T,A,P,w,O,R,M,U,D,N,x,L,F,B,H,q,G,V,z;if(C=e[0].milestone,M=e[0].project,C&&(q=this.scope.sprintsById[C]||this.scope.closedSprintsById[C]),n&&(I=this.scope.sprintsById[n]||this.scope.closedSprintsById[n]),s=n!==C?n:C,P=null,A="",n!==C)if(null===n){for(l=u=0,d=e.length;u<d;l=++u)V=e[l],_.remove(q.user_stories,function(t){return t.id===V.id});A="backlog_order",P=this.backlogOrder,o=_.slice(this.scope.userstories,0,r),i=_.slice(this.scope.userstories,r),this.scope.userstories=this.scope.userstories.concat(e)}else{for(p=0,h=e.length;p<h;p++)V=e[p],_.remove(this.scope.userstories,function(t){return t.id===V.id});A="sprint_order",P=this.milestonesOrder[I.id],o=_.slice(I.user_stories,0,r),i=_.slice(I.user_stories,r),I.user_stories=I.user_stories.concat(e)}else null===C?(A="backlog_order",P=this.backlogOrder,S=_.filter(this.scope.userstories,function(t){return!_.find(e,function(e){return t.id===e.id})}),o=_.slice(S,0,r),i=_.slice(S,r)):(A="sprint_order",P=this.milestonesOrder[q.id],S=_.filter(I.user_stories,function(t){return!_.find(e,function(e){return t.id===e.id})}),o=_.slice(S,0,r),i=_.slice(S,r));for(H=[],(O=o[o.length-1])?O&&(G=P[O.id]+1,(R=_.filter(o,function(t){return t[A]===P[O.id]})).length>1&&(H=_.map(R,function(t){return{us_id:t.id,order:P[t.id]}}))):G=0,k=[],l=j=0,f=e.length;j<f;l=++j)(V=e[l]).milestone=s,V[A]=G+l,P[V.id]=V[A],k.push({us_id:V.id,order:V[A]});for(G=P[e[e.length-1].id],l=$=0,g=i.length;$<g;l=++$)c=i[l],P[c.id]=G+l+1;for(F=_.map(i,function(t){return{us_id:t.id,order:P[t.id]}}),this.scope.userstories=_.sortBy(this.scope.userstories,(z=this,function(t){return z.backlogOrder[t.id]})),this.scope.visibleUserStories=_.map(this.scope.userstories,function(t){return t.ref}),E=0,m=(x=this.scope.sprints).length;E<m;E++)(q=x[E]).user_stories=_.sortBy(q.user_stories,function(t){return function(e){return t.milestonesOrder[q.id][e.id]}}(this));for(w=0,v=(L=this.scope.closedSprints).length;w<v;w++)(q=L[w]).user_stories=_.sortBy(q.user_stories,function(t){return function(e){return t.milestonesOrder[q.id][e.id]}}(this));if(e.length>1&&n!==C)a=k.concat(H,F),U=this.rs.userstories.bulkUpdateMilestone(M,n,a);else if(e.length>1)a=k.concat(H,F),U=this.rs.userstories.bulkUpdateBacklogOrder(M,a);else{for(B={},D=0,y=H.length;D<y;D++)B[(c=H[D]).us_id]=c.order;for(N=0,b=F.length;N<b;N++)B[(c=F[N]).us_id]=c.order;T={headers:{"set-orders":JSON.stringify(B)}},U=this.repo.save(e[0],!0,{},T,!0)}return U.then(function(t){return function(){if(t.rootscope.$broadcast("sprint:us:moved"),t.scope.closedSprintsById&&t.scope.closedSprintsById[C])return t.rootscope.$broadcast("backlog:load-closed-sprints")}}(this)),U},e.prototype.updateUserStoryStatus=function(){return this.generateFilters().then((t=this,function(){if(t.rootscope.$broadcast("filters:update"),t.loadProjectStats(),t.isFilterDataTypeSelected("status"))return t.filtersReloadContent()}));var t},e.prototype.editUserStory=function(t,e,r){var n,i,o;return i=$(r.target),n=this.loading().target(i).removeClasses("edit-story").timeout(200).start(),this.rs.userstories.getByRef(t,e).then((o=this,function(e){return o.rs2.attachments.list("us",e.id,t).then(function(t){return o.rootscope.$broadcast("genericform:edit",{objType:"us",obj:e,attachments:t.toJS()}),n.finish()})}))},e.prototype.deleteUserStory=function(t){var e,r,n;return r=this.translate.instant("US.TITLE_DELETE_ACTION"),e=t.subject,this.confirm.askOnDelete(r,e).then((n=this,function(e){var r;return n.scope.userstories=_.without(n.scope.userstories,t),(r=n.repo.remove(t)).then(function(){return e.finish(),n.q.all([n.loadProjectStats(),n.loadSprints()])}),r.then(null,function(){return e.finish(!1),n.confirm.notify("error")})}))},e.prototype.addNewUs=function(t){switch(t){case"standard":return this.rootscope.$broadcast("genericform:new",{objType:"us",project:this.scope.project});case"bulk":return this.rootscope.$broadcast("usform:bulk",this.scope.projectId,this.scope.project.default_us_status)}},e.prototype.addNewSprint=function(){return this.rootscope.$broadcast("sprintform:create",this.scope.projectId)},e.prototype.findCurrentSprint=function(){var t;return t=(new Date).getTime(),_.find(this.scope.sprints,function(e){var r,n;return n=moment(e.estimated_start,"YYYY-MM-DD").format("x"),r=moment(e.estimated_finish,"YYYY-MM-DD").format("x"),t>=n&&t<=r})},e}(),d.controller("BacklogController",t),e=function(t,e,r,n){var i,o,s,a,c,u,l;return i=_.template('<div class="doom-line"><span><%- text %></span></div>'),o=function(t,e,n,o){var s,a,c;return a=function(){var r,n,i,o,a,u,l,p,d;if(t.displayVelocity&&c(),null!=t.stats&&null!=t.stats.total_points&&0!==t.stats.total_points&&null==t.displayVelocity){if(c(),d=(p=t.stats).total_points,r=p.assigned_points,!t.userstories)return;for(l=[],i=o=0,a=(u=t.userstories).length;o<a;i=++o){if((r+=u[i].total_points)>d){n=e.find(".backlog-table-body .us-item-row")[i],s(n);break}l.push(void 0)}return l}},c=function(){return e.find(".doom-line").remove()},s=function(t){var e;return e=r.instant("BACKLOG.DOOMLINE"),$(t).before(i({text:e}))},function(){var t;return t=e.find(".backlog-table-body .us-item-row"),_.map(t,function(t){return angular.element(t)})},t.$on("userstories:loaded",a),t.$on("userstories:forecast",c),t.$watch("stats",a)},a=function(t,r,i,o){var s,a,c,u,p,d,h;return a=function(){var e;return e=r.find(".backlog-table-body input:checkbox:checked"),_.map(e,function(e){var r;return(r=(e=$(e).closest(".tg-scope")).scope()).us.milestone=t.sprints[0].id,r.us})},d=function(e,i){var s,a,c,u;return u=_(t.userstories),t.userstories=u.without.apply(u,e).value(),a=_.map(e,function(t,e){return t.total_points}),c=_.reduce(a,function(t,e){return t+e}),i.user_stories=_.union(i.user_stories,e),i.total_points+=c,s=_.map(e,function(t){return{us_id:t.id,order:t.sprint_order}}),n.userstories.bulkUpdateMilestone(t.project.id,t.sprints[0].id,s).then(function(){return o.loadSprints(),o.loadProjectStats(),o.toggleVelocityForecasting(),o.calculateForecasting()}),r.find(".move-to-sprint").hide()},u=function(e){return d(e,t.currentSprint)},p=function(e){return d(e,t.sprints[0])},t.$on("sprintform:create:success:callback",function(t,e){return _.partial(u,e)()}),h=!1,c=null,s=function(e){var n;return c=e.closest(".us-item-row"),e.closest(".us-item-row").toggleClass("ui-multisortable-multiple"),n=r.find(".move-to-sprint"),r.find(".backlog-table-body input:checkbox:checked").length>0&&t.sprints.length>0?n.show():n.hide()},$(window).on("keydown.shift-pressed keyup.shift-pressed",function(t){return h=!!t.shiftKey,!0}),r.on("change",".backlog-table-body input:checkbox",function(t){var e,r,n,i,o;return c&&h&&(r=[],e=$(t.currentTarget).closest(".us-item-row"),n=c.nextAll(),i=c.prevAll(),_.some(n,function(t){return t===e[0]})?r=c.nextUntil(e):_.some(i,function(t){return t===e[0]})&&(r=c.prevUntil(e)),_.map(r,function(t){var e;return(e=$(t).find("input:checkbox")).prop("checked",!0),s(e)})),(o=angular.element(t.currentTarget)).closest(".us-item-row").toggleClass("is-checked"),s(o)}),r.on("click","#move-to-latest-sprint",function(e){var r;return r=a(),t.$apply(_.partial(p,r))}),r.on("click","#move-to-current-sprint",function(e){var r;return r=a(),t.$apply(_.partial(u,r))}),r.on("click","#show-tags",function(t){return t.preventDefault(),o.toggleShowTags(),l(o)}),r.on("click",".forecasting-add-sprint",function(r){var n,i;return i=o.forecastedStories,t.currentSprint?(n=_.map(i,function(e,r){return e.milestone=t.currentSprint.id,e.order=r,e}),t.$apply(_.partial(u,n))):(n=_.map(i,function(t,e){return t.order=e,t}),e.$broadcast("sprintform:create",t.projectId,n))})},l=function(t){var e,n;return e=angular.element("#show-tags"),t.showTags?(e.addClass("active"),n=r.instant("BACKLOG.TAGS.HIDE"),e.text(n)):(e.removeClass("active"),n=r.instant("BACKLOG.TAGS.SHOW"),e.text(n))},c=function(t,e,r){return e.find("sidebar.backlog-filter").addClass("active"),r.activeFilters=!0},u=function(t,n,i){var o,s,a,c;return(a=n.find("sidebar.backlog-filter")).one("transitionend",function(){return g(150,function(){return e.$broadcast("resize"),$(".burndown").css("visibility","visible")})}),c=angular.element("#show-filters-button"),$(".burndown").css("visibility","hidden"),a.toggleClass("active"),c.toggleClass("active"),o=r.instant("BACKLOG.FILTERS.HIDE"),s=r.instant("BACKLOG.FILTERS.SHOW"),m(c,[o,s]),i.toggleActiveFilters()},s=function(t,e,r,n){return t.filtersSearch={},e.on("click","#show-filters-button",function(r){return r.preventDefault(),t.$apply(function(){return u(0,e,n)})})},{link:function(t,e,r,n){var i,u;return i=e.controller(),a(t,e,0,i),s(t,e,0,i),o(t,e),((u=i.location.search()).status||u.tags||u.q||u.assigned_to||u.owner)&&c(0,e,i),t.$on("showTags",function(){return l(i)}),t.$on("$destroy",function(){return e.off(),$(window).off(".shift-pressed")})}}},d.directive("tgBacklog",["$tgRepo","$rootScope","$translate","$tgResources",e]),s=function(t,e,r,n){var i;return i=e.get("backlog/us-role-points-popover.html",!0),{link:function(e,o,s){return c(e,"project",function(t){var n;return n=_.filter(t.roles,"computable"),_.size(n)>1?o.append(r(i({roles:n}))(e)):(o.find(".icon-arrow-down").remove(),o.find(".header-points").addClass("not-clickable"))}),e.$on("uspoints:select",function(t,e,r){return o.find(".popover").popover().close(),o.find(".header-points").html(r+"/<span>Total</span>")}),e.$on("uspoints:clear-selection",function(t,e){var r;return o.find(".popover").popover().close(),r=n.instant("COMMON.FIELDS.POINTS"),o.find(".header-points").text(r)}),o.on("click",function(t){var e;return((e=angular.element(t.target)).is("span")||e.is("div"))&&t.stopPropagation(),o.find(".popover").popover().open()}),o.on("click",".clear-selection",function(e){return e.preventDefault(),e.stopPropagation(),t.$broadcast("uspoints:clear-selection")}),o.on("click",".role",function(e){var r;return e.preventDefault(),e.stopPropagation(),(r=angular.element(e.currentTarget)).scope(),t.$broadcast("uspoints:select",r.data("role-id"),r.text())}),e.$on("$destroy",function(){return o.off()})}}},d.directive("tgUsRolePointsSelector",["$rootScope","$tgTemplate","$compile","$translate",s]),o=function(t,e,r){var n;return n=r.get("common/estimation/us-points-roles-popover.html",!0),{link:function(e,i,o){var s,a,c,u,l,p;return s=i.controller(),p=null,l=null,null,c=null,e.$on("uspoints:select",function(t,r,n){return e.$eval(o.tgBacklogUsPoints),l=r,c.render()}),e.$on("uspoints:clear-selection",function(t){return e.$eval(o.tgBacklogUsPoints),l=null,c.render()}),e.$watch(o.tgBacklogUsPoints,function(n){var o;if(n)return c=t.create(i,n,e.project),0===(o=c.calculateRoles()).length?(i.find(".icon-arrow-bottom").remove(),i.find("a.us-points").addClass("not-clickable")):1===o.length&&(l=_.keys(n.points)[0]),c.isEditable&&a(),c.onSelectedPointForRole=function(t,e,r){return n.points=r,c.render(),this.save(t,e).then(function(){return s.loadProjectStats()})},c.render=function(){var t,e,n,i,s,a,c,u;return u=this.calculateTotalPoints(),null==l||1===o.length?(a=u,c=u):(i=this.us.points[l],a=(s=this.pointsById[i]).name+" / <span>"+u+"</span>",c=s.name+" / "+u),t={totalPoints:u,roles:this.calculateRoles(),editable:this.isEditable,text:a,title:c},n="common/estimation/us-estimation-total.html",e=r.get(n,!0)(t),this.$el.html(e)},c.render()}),u=function(){var t,e;return e=c.calculateRoles(),t=n({roles:e}),i.append(t),i.find(".pop-role").popover().open(function(){return $(this).remove()})},a=function(){return i.on("click","a.us-points",function(t){return t.preventDefault(),t.stopPropagation(),e.$eval(o.tgBacklogUsPoints),p=l,null!=l?c.renderPointsSelector(l):u()}),i.on("click",".role",function(t){var r,n;return t.preventDefault(),t.stopPropagation(),n=angular.element(t.currentTarget),e.$eval(o.tgBacklogUsPoints),p=n.data("role-id"),(r=i.find(".pop-role")).find("a").removeClass("active"),r.find("a[data-role-id='"+p+"']").addClass("active"),c.renderPointsSelector(p)})},e.$on("$destroy",function(){return i.off()})}}},d.directive("tgBacklogUsPoints",["$tgEstimationsService","$tgRepo","$tgTemplate",o]),i=function(t){var e,r;return e=function(){return $(".js-burndown-graph").removeClass("shown"),$(".js-toggle-burndown-visibility-button").removeClass("active"),$(".js-burndown-graph").removeClass("open")},r=function(t){return $(".js-toggle-burndown-visibility-button").addClass("active"),t?$(".js-burndown-graph").addClass("shown"):$(".js-burndown-graph").addClass("open")},{link:function(n,i,o){var s,a,c;return s=!0,a=u(["is-burndown-grpahs-collapsed"]),n.isBurndownGraphCollapsed=t.get(a)||!1,c=function(){return n.isBurndownGraphCollapsed?e():r(s),s=!1},n.$watch("showGraphPlaceholder",function(){if(null!=n.showGraphPlaceholder)return n.isBurndownGraphCollapsed=n.isBurndownGraphCollapsed||n.showGraphPlaceholder,c()}),i.on("click",".js-toggle-burndown-visibility-button",function(){return n.isBurndownGraphCollapsed=!n.isBurndownGraphCollapsed,t.set(a,n.isBurndownGraphCollapsed),c()}),n.$on("$destroy",function(){return i.off()})}}},d.directive("tgToggleBurndownVisibility",["$tgStorage",i]),r=function(t){var e;return e=function(e,r){var n,i,o,s,a,c,u,l,p,d,h;return d=e.width(),e.height(d/6),a=function(){l=[];for(var t=0,e=r.milestones.length-1;0<=e?t<=e:t>=e;0<=e?t++:t--)l.push(t);return l}.apply(this),o=[],h=_.map(r.milestones,function(t){return 0}),o.push({data:_.zip(a,h),lines:{fillColor:"rgba(0,0,0,0)"},points:{show:!1}}),c=_.map(r.milestones,function(t){return t.optimal}),o.push({data:_.zip(a,c),lines:{fillColor:"rgba(120,120,120,0.2)"}}),s=_.filter(_.map(r.milestones,function(t){return t.evolution}),function(t){return null!=t}),o.push({data:_.zip(a,s),lines:{fillColor:"rgba(102,153,51,0.3)"}}),n=_.map(r.milestones,function(t){return-t["team-increment"]-t["client-increment"]}),o.push({data:_.zip(a,n),lines:{fillColor:"rgba(255,51,51,0.3)"}}),p=_.map(r.milestones,function(t){return-t["team-increment"]}),o.push({data:_.zip(a,p),lines:{fillColor:"rgba(153,51,51,0.3)"}}),i=["rgba(0,0,0,1)","rgba(120,120,120,0.2)","rgba(102,153,51,1)","rgba(153,51,51,1)","rgba(255,51,51,1)"],u={grid:{borderWidth:{top:0,right:1,left:0,bottom:0},borderColor:"#ccc",hoverable:!0},xaxis:{ticks:r.milestones.length,axisLabel:t.instant("BACKLOG.CHART.XAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5,tickFormatter:function(t,e){return""}},yaxis:{axisLabel:t.instant("BACKLOG.CHART.YAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},series:{shadowSize:0,lines:{show:!0,fill:!0},points:{show:!0,fill:!0,radius:4,lineWidth:2}},colors:i,tooltip:!0,tooltipOpts:{content:function(e,n,i,o){var s;return 1===o.seriesIndex?(s={sprintName:r.milestones[n].name,value:Math.abs(i)},t.instant("BACKLOG.CHART.OPTIMAL",s)):2===o.seriesIndex?(s={sprintName:r.milestones[n].name,value:Math.abs(i)},t.instant("BACKLOG.CHART.REAL",s)):3===o.seriesIndex?(s={sprintName:r.milestones[n].name,value:Math.abs(i)},t.instant("BACKLOG.CHART.INCREMENT_CLIENT",s)):(s={sprintName:r.milestones[n].name,value:Math.abs(i)},t.instant("BACKLOG.CHART.INCREMENT_TEAM",s))}}},e.empty(),e.plot(o,u).data("plot")},{link:function(t,r,n){var i;return i=angular.element(r),t.$watch("stats",function(r){if(null!=t.stats)return e(i,t.stats),t.$on("resize",function(){return e(i,t.stats)})}),t.$on("$destroy",function(){return r.off()})}}},d.directive("tgBurndownBacklogGraph",["$translate",r]),n=function(t,e){var r,n,i;return i=t.get("backlog/progress-bar.html",!0),n=function(t,r,n,o){var s;return s=i({projectPointsPercentaje:n,closedPointsPercentaje:o}),s=e(s)(t),r.html(s)},r=function(t){var e;return e=_.max([0,t]),e=_.min([100,e]),Math.round(e)},{link:function(t,e,i){return angular.element(e),t.$watch(i.tgBacklogProgressBar,function(i){var o,s,a,c,u;if(null!=i)return u=i.total_points?i.total_points:i.defined_points,a=i.defined_points,o=i.closed_points,a>u?(c=100*u/a,s=100*o/a):(c=100,s=100*o/u),c=r(c-3),s=r(s-3),n(t,e,c,s)}),t.$on("$destroy",function(){return e.off()})}}},d.directive("tgBacklogProgressBar",["$tgTemplate","$compile",n])}.call(this),function(){var t,e,r,n;this.taiga,e=this.taiga.bindOnce,n=angular.module("taigaBacklog"),r=function(t){return $(t).scope().$destroy(),$(t).off(),$(t).remove()},t=function(){return{link:function(t,n,i){return e(t,"project",function(e){var i,o;if(e.my_permissions.indexOf("modify_us")>-1)return o=!1,(i=dragula([n[0],$(".js-empty-backlog")[0]],{copySortSource:!1,copy:!1,isContainer:function(t){return t.classList.contains("sprint-table")},moves:function(t){return!!$(t).hasClass("row")}})).on("drag",function(t,e){var r;return r=$(t).parent(),o=r.hasClass("backlog-table-body"),$(document.body).addClass("drag-active"),$(t).find("input[type='checkbox']").is(":checked"),window.dragMultiple.start(t,e)}),i.on("cloned",function(t){return $(t).addClass("multiple-drag-mirror")}),i.on("dragend",function(e){var n,i,s,a,c,u,l,p;return c=$(e).parent(),$(".doom-line").remove(),a=(c=$(e).parent()).hasClass("backlog-table-body")||c.hasClass("js-empty-backlog"),u=o||a?o===a:$(e).scope().sprint.id===c.scope().sprint.id,n=window.dragMultiple.stop(),$(document.body).removeClass("drag-active"),l=null,i=n.length?n[0]:e,a?s=$(i).index(".backlog-table-body .row"):(s=$(i).index(),l=c.scope().sprint.id),u?p=n.length?_.map(n,function(t){return $(t).scope().us}):[$(e).scope().us]:(p=n.length?_.map(n,function(t){return $(t).scope().us}):[$(e).scope().us],n.length?_.each(n,function(t){return r(t)}):r(e)),t.$emit("sprint:us:move",p,s,l)}),autoScroll([window],{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&i.dragging}}),t.$on("$destroy",function(){return n.off(),i.destroy()})})}}},n.directive("tgBacklogSortable",t)}.call(this),function(){var t,e,r,n;this.taiga,t=function(t,e){var r,n;return 50,r={duration:500,easing:"linear"},n=function(t){var e;return e=t.find(".sprint-table"),t.find(".compact-sprint").toggleClass("active"),e.toggleClass("open")},{link:function(t,i,o){return t.$watch(o.tgBacklogSprint,function(e){return t.$eval(o.tgBacklogSprint).closed?i.addClass("sprint-closed"):n(i)}),i.on("click",".sprint-name > .compact-sprint",function(t){return t.preventDefault(),n(i),i.find(".sprint-table").slideToggle(r)}),i.on("click",".edit-sprint",function(r){var n;return r.preventDefault(),n=t.$eval(o.tgBacklogSprint),e.$broadcast("sprintform:edit",n)}),t.$on("$destroy",function(){return i.off()})}}},(n=angular.module("taigaBacklog")).directive("tgBacklogSprint",["$tgRepo","$rootScope",t]),e=function(t,e,r,n){var i;return i=e.get("backlog/sprint-header.html"),{link:function(e,o,s,a){var c,u,l,p;return l=n.instant("BACKLOG.SPRINTS.DATE"),c=function(){return-1!==e.project.my_permissions.indexOf("modify_milestone")},u=function(){return-1!==e.project.my_permissions.indexOf("view_milestones")},p=function(n){var s,a,p,d,h;return d=t.resolve("project-taskboard",{project:e.project.slug,sprint:n.slug}),p=moment(n.estimated_start).format(l)+"-"+moment(n.estimated_finish).format(l),a={name:n.name,taskboardUrl:d,estimatedDateRange:p,closedPoints:n.closed_points||0,totalPoints:n.total_points||0,isVisible:u(),isEditable:c()},h=e.$new(),_.assign(h,a),s=r(i)(h),o.html(s)},e.$watch("sprint",function(t){return p(t)}),e.$on("$destroy",function(){return o.off()})},restrict:"EA"}},n.directive("tgBacklogSprintHeader",["$tgNavUrls","$tgTemplate","$compile","$translate",e]),r=function(t,e,r){var n;return n=!0,{link:function(i,o,s){var a,c;return c=$("<div>"),o.after(c),a=null,o.on("click",function(r){return r.preventDefault(),n=!n,a=e().target(c).start(),n?t.$broadcast("backlog:unload-closed-sprints"):t.$broadcast("backlog:load-closed-sprints")}),i.$on("$destroy",function(){return o.off()}),i.$on("closed-sprints:reloaded",function(t,e){var n,i;return a.finish(),n=e.length>0?"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS":"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS",i=r.instant(n),o.find(".text").text(i)})}}},n.directive("tgBacklogToggleClosedSprintsVisualization",["$rootScope","$tgLoading","$translate",r])}.call(this),function(){var t,e;this.taiga,this.taiga.mixOf,this.taiga.toggleText,this.taiga.scopeDefer,this.taiga.bindOnce,this.taiga.groupBy,e=this.taiga.timeout,t=function(t){var r;return r=function(e,r){var n,i,o;return e.width(),e.height(240),i=_.map(r,function(t){return moment.utc(t.day)}),(n=[]).unshift({data:_.zip(i,_.map(r,function(t){return t.optimal_points})),lines:{fillColor:"rgba(120,120,120,0.2)"}}),n.unshift({data:_.zip(i,_.map(r,function(t){return t.open_points})),lines:{fillColor:"rgba(102,153,51,0.3)"}}),o={grid:{borderWidth:{top:0,right:1,left:0,bottom:0},borderColor:"#ccc",hoverable:!0},xaxis:{tickSize:[1,"day"],min:i[0],max:_.last(i),mode:"time",daysNames:i,axisLabel:t.instant("TASKBOARD.CHARTS.XAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},yaxis:{min:0,axisLabel:t.instant("TASKBOARD.CHARTS.YAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},series:{shadowSize:0,lines:{show:!0,fill:!0},points:{show:!0,fill:!0,radius:4,lineWidth:2}},colors:["rgba(102,153,51,1)","rgba(120,120,120,0.2)"],tooltip:!0,tooltipOpts:{content:function(e,r,n,i){var o,s;return o=moment(r).format(t.instant("TASKBOARD.CHARTS.DATE")),s=Math.round(n),1===i.seriesIndex?t.instant("TASKBOARD.CHARTS.OPTIMAL",{formattedDate:o,roundedValue:s}):t.instant("TASKBOARD.CHARTS.REAL",{formattedDate:o,roundedValue:s})}}},e.empty(),e.plot(n,o).data("plot")},{link:function(t,n,i){var o;return o=angular.element(n),t.$on("resize",function(){if(t.stats)return r(o,t.stats.days)}),t.$on("taskboard:graph:toggle-visibility",function(){return n.parent().toggleClass("open"),e(100,function(){if(t.stats)return r(o,t.stats.days)})}),t.$watch("stats",function(e){if(null!=t.stats)return r(o,t.stats.days)}),t.$on("$destroy",function(){return n.off()})}}},angular.module("taigaTaskboard").directive("tgSprintGraph",["$translate",t])}.call(this),function(){var t,e;this.taiga,this.taiga.bindOnce,e=this.taiga.debounce,this.taiga.trim,t=function(t,r,n,i,o,s){return{link:function(t,a,c){var u,l;return t.form={data:"",usId:null},u=e(2e3,function(e){var c,u,p,d,h,f;if(e.preventDefault(),a.find("form").checksley().validate())return c=i().target(l).start(),u=t.form.data,p=t.projectId,h=t.form.sprintId,f=t.form.usId,(d=r.tasks.bulkCreate(p,h,f,u)).then(function(t){return t=_.map(t,function(t){return s.make_model("tasks",t)}),c.finish(),n.$broadcast("taskform:bulk:success",t),o.close(a)}),d.then(null,function(){return c.finish()})}),t.$on("taskform:bulk",function(e,r,n){return o.open(a),t.form={data:"",sprintId:r,usId:n}}),l=a.find(".submit-button"),a.on("submit","form",u),t.$on("$destroy",function(){return a.off()})}}},angular.module("taigaTaskboard").directive("tgLbCreateBulkTasks",["$tgRepo","$tgResources","$rootScope","$tgLoading","lightboxService","$tgModel",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u={}.hasOwnProperty;c=this.taiga,this.taiga.toggleText,s=this.taiga.mixOf,o=this.taiga.groupBy,this.taiga.bindOnce,this.taiga.scopeDefer,this.taiga.timeout,n=this.taiga.bindMethods,i=this.taiga.debounceLeading,a=angular.module("taigaTaskboard"),t=function(t){function e(t,e,r,i,o,s,a,u,l,p,d,h,f,g,m,v,y,_,b){var S;(this.scope=t,this.rootscope=e,this.repo=r,this.confirm=i,this.rs=o,this.rs2=s,this.params=a,this.q=u,this.appMetaService=l,this.location=p,this.navUrls=d,this.events=h,this.analytics=f,this.translate=g,this.errorHandlingService=m,this.taskboardTasksService=v,this.taskboardIssuesService=y,this.storage=_,this.filterRemoteStorageService=b,n(this),this.taskboardTasksService.reset(),this.scope.userstories=[],this.openFilter=!1,this.applyStoredFilters(this.params.pslug,"tasks-filters"))||(this.scope.sectionName=this.translate.instant("TASKBOARD.SECTION_NAME"),this.initializeEventHandlers(),c.defineImmutableProperty(this.scope,"usTasks",(S=this,function(){return S.taskboardTasksService.usTasks})),c.defineImmutableProperty(this.scope,"milestoneIssues",function(t){return function(){return t.taskboardIssuesService.milestoneIssues}}(this)))}return function(t,e){for(var r in e)u.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,s(c.Controller,c.PageMixin,c.FiltersMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","tgResources","$routeParams","$q","tgAppMetaService","$tgLocation","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","tgErrorHandlingService","tgTaskboardTasks","tgTaskboardIssues","$tgStorage","tgFilterRemoteStorageService"],e.prototype.excludePrefix="exclude_",e.prototype.filterCategories=["tags","status","assigned_to","owner","role"],e.prototype.firstLoad=function(){var t,e;return(t=this.loadInitialData()).then((e=this,function(){return e._setMeta()})),t.then(null,this.onInitialDataError.bind(this))},e.prototype.setZoom=function(t,e){var r,n;return this.zoomLevel===t?null:(this.isFirstLoad=!this.zoomLevel,r=this.zoomLevel,this.zoomLevel=t,this.zoom=e,this.isFirstLoad?this.firstLoad().then((n=this,function(){return n.isFirstLoad=!1,n.taskboardTasksService.resetFolds()})):this.zoomLevel>1&&r<=1&&(this.zoomLoading=!0,this.q.all([this.loadTasks(),this.loadIssues()]).then(function(t){return function(){return t.zoomLoading=!1,t.taskboardTasksService.resetFolds()}}(this))),"0"===this.zoomLevel?this.rootscope.$broadcast("sprint:zoom0"):void 0)},e.prototype.changeQ=function(t){return this.replaceFilter("q",t),this.loadTasks(),this.generateFilters()},e.prototype.removeFilter=function(t){return this.unselectFilter(t.dataType,t.id,!1,t.mode),this.loadTasks(),this.generateFilters()},e.prototype.addFilter=function(t){return this.selectFilter(t.category.dataType,t.filter.id,!1,t.mode),this.loadTasks(),this.generateFilters()},e.prototype.selectCustomFilter=function(t){return this.replaceAllFilters(t.filter),this.loadTasks(),this.generateFilters()},e.prototype.removeCustomFilter=function(t){return this.filterRemoteStorageService.getFilters(this.scope.projectId,"tasks-custom-filters").then((e=this,function(r){return delete r[t.id],e.filterRemoteStorageService.storeFilters(e.scope.projectId,r,"tasks-custom-filters").then(e.generateFilters)}));var e},e.prototype.isFilterDataTypeSelected=function(t){var e,r,n;for(e=0,r=(n=this.selectedFilters).length;e<r;e++)if(n[e].dataType===t)return!0;return!1},e.prototype.saveCustomFilter=function(t){var e,r,n,i,o,s,a,c;for(r={},a=this.location.search(),n=0,o=(s=this.filterCategories).length;n<o;n++)i=s[n],e=this.excludePrefix.concat(i),r[i]=a[i],r[e]=a[e];return this.filterRemoteStorageService.getFilters(this.scope.projectId,"tasks-custom-filters").then((c=this,function(e){return e[t]=r,c.filterRemoteStorageService.storeFilters(c.scope.projectId,e,"tasks-custom-filters").then(c.generateFilters)}))},e.prototype.generateFilters=function(){var t,e,r,n,i,o,s,a;for(this.storeFilters(this.params.pslug,this.location.search(),"tasks-filters"),s=this.location.search(),(i={}).project=this.scope.projectId,i.milestone=this.scope.sprintId,i.q=s.q,e=0,n=(o=this.filterCategories).length;e<n;e++)r=o[e],t=this.excludePrefix.concat(r),i[r]=s[r],i[t]=s[t];return this.q.all([this.rs.tasks.filtersData(i),this.filterRemoteStorageService.getFilters(this.scope.projectId,"tasks-custom-filters")]).then((a=this,function(e){var n,o,s,c,u,l,p,d;for(o=e[0],n=e[1],(s={}).status=_.map(o.statuses,function(t){return t.id=t.id.toString(),t}),s.tags=_.map(o.tags,function(t){return t.id=t.name,t}),d=_.filter(s.tags,function(t){return t.count>0}),s.assigned_to=_.map(o.assigned_to,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),s.role=_.map(o.roles,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.name||"Unassigned",t}),s.owner=_.map(o.owners,function(t){return t.id=t.id.toString(),t.name=t.full_name,t}),a.selectedFilters=[],c=0,u=(l=a.filterCategories).length;c<u;c++)r=l[c],t=a.excludePrefix.concat(r),i[r]&&(p=a.formatSelectedFilters(r,s[r],i[r]),a.selectedFilters=a.selectedFilters.concat(p)),i[t]&&(p=a.formatSelectedFilters(r,s[r],i[t],"exclude"),a.selectedFilters=a.selectedFilters.concat(p));return a.filterQ=i.q,a.filters=[{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.STATUS"),dataType:"status",content:s.status},{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.TAGS"),dataType:"tags",content:s.tags,hideEmpty:!0,totalTaggedElements:d.length},{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.ASSIGNED_TO"),dataType:"assigned_to",content:s.assigned_to},{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.ROLE"),dataType:"role",content:s.role},{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.CREATED_BY"),dataType:"owner",content:s.owner}],a.customFilters=[],_.forOwn(n,function(t,e){return a.customFilters.push({id:e,name:e,filter:t})})}))},e.prototype._setMeta=function(){var t,e,r;return e=this.translate.instant("BACKLOG.SPRINTS.DATE"),r=this.translate.instant("TASKBOARD.PAGE_TITLE",{projectName:this.scope.project.name,sprintName:this.scope.sprint.name}),t=this.translate.instant("TASKBOARD.PAGE_DESCRIPTION",{projectName:this.scope.project.name,sprintName:this.scope.sprint.name,startDate:moment(this.scope.sprint.estimated_start).format(e),endDate:moment(this.scope.sprint.estimated_finish).format(e),completedPercentage:this.scope.stats.completedPercentage||"0",completedPoints:this.scope.stats.completedPointsSum||"--",totalPoints:this.scope.stats.totalPointsSum||"--",openTasks:this.scope.stats.openTasks||"--",totalTasks:this.scope.stats.total_tasks||"--"}),this.appMetaService.setAll(r,t)},e.prototype.initializeEventHandlers=function(){var t;return this.scope.$on("taskform:bulk:success",(t=this,function(e,r){return t.refreshTagsColors().then(function(){return t.taskboardTasksService.add(r)}),t.analytics.trackEvent("task","create","bulk create task on taskboard",1)})),this.scope.$on("taskform:new:success",function(t){return function(e,r){return t.refreshTagsColors().then(function(){return t.taskboardTasksService.add(r)}),t.analytics.trackEvent("task","create","create task on taskboard",1)}}(this)),this.scope.$on("taskform:edit:success",function(t){return function(e,r){return t.refreshTagsColors().then(function(){return t.taskboardTasksService.replaceModel(r)})}}(this)),this.scope.$on("issueform:new:success",function(t){return function(e,r){return t.refreshTagsColors().then(function(){return t.taskboardIssuesService.add(r)}),t.analytics.trackEvent("issue","create","create issue on taskboard",1)}}(this)),this.scope.$on("issueform:add:success",function(t){return function(e,r){return t.refreshTagsColors().then(function(){return t.taskboardIssuesService.add(r)})}}(this)),this.scope.$on("issueform:edit:success",function(t){return function(e,r){return t.refreshTagsColors().then(function(){return t.taskboardIssuesService.replaceModel(r)})}}(this)),this.scope.$on("taskboard:task:deleted",function(t){return function(e,r){return t.loadTasks()}}(this)),this.scope.$on("taskboard:issue:deleted",function(t){return function(e,r){return t.loadIssues()}}(this)),this.scope.$on("taskboard:task:move",this.taskMove),this.scope.$on("assigned-to:added",this.onAssignedToChanged),this.scope.$on("taskboard:items:move",function(t){return function(e,r){return r.uss?t.firstLoad():(r.tasks&&t.loadTasks(),r.issues?t.loadIssues():void 0)}}(this))},e.prototype.onAssignedToChanged=function(t,e,r){var n;if("tasks"===r.getName()&&(r.assigned_to=e,this.taskboardTasksService.replaceModel(r),this.repo.save(r).then((n=this,function(){if(n.generateFilters(),n.isFilterDataTypeSelected("assigned_to")||n.isFilterDataTypeSelected("role"))return n.loadTasks()}))),"issues"===r.getName())return r.assigned_to=e,this.taskboardIssuesService.replaceModel(r),this.repo.save(r).then(function(t){return function(){if(t.generateFilters(),t.isFilterDataTypeSelected("assigned_to")||t.isFilterDataTypeSelected("role"))return t.loadIssues()}}(this))},e.prototype.initializeSubscription=function(){var t,e,r;return t="changes.project."+this.scope.projectId+".tasks",this.events.subscribe(this.scope,t,i(500,(r=this,function(t){return r.loadTaskboard()}))),t="changes.project."+this.scope.projectId+".issues",this.events.subscribe(this.scope,t,i(500,function(t){return function(e){return t.loadIssues()}}(this))),e="changes.project."+this.scope.projectId+".userstories",this.events.subscribe(this.scope,e,function(t){return function(e){return t.refreshTagsColors(),t.loadSprintStats(),t.loadSprint()}}(this))},e.prototype.loadProject=function(){return this.rs.projects.get(this.scope.projectId).then((t=this,function(e){return e.is_backlog_activated||t.errorHandlingService.permissionDenied(),t.scope.project=e,t.scope.pointsList=_.sortBy(e.points,"order"),t.scope.pointsById=o(e.points,function(t){return t.id}),t.scope.roleById=o(e.roles,function(t){return t.id}),t.scope.taskStatusList=_.sortBy(e.task_statuses,"order"),t.scope.usStatusList=_.sortBy(e.us_statuses,"order"),t.scope.usStatusById=o(e.us_statuses,function(t){return t.id}),t.scope.issueStatusById=o(e.issue_statuses,function(t){return t.id}),t.scope.$emit("project:loaded",e),t.fillUsersAndRoles(e.members,e.roles),e}));var t},e.prototype.loadSprintStats=function(){return this.rs.sprints.stats(this.scope.projectId,this.scope.sprintId).then((t=this,function(e){var r,n,i,o;return n=(o=_.reduce(_.values(e.total_points),function(t,e){return t+e},0))-(r=_.reduce(_.values(e.completed_points),function(t,e){return t+e},0)),i=e.total_tasks-e.completed_tasks,t.scope.stats=e,t.scope.stats.totalPointsSum=o,t.scope.stats.completedPointsSum=r,t.scope.stats.remainingPointsSum=n,t.scope.stats.remainingTasks=i,e.totalPointsSum?t.scope.stats.completedPercentage=Math.round(100*e.completedPointsSum/e.totalPointsSum):t.scope.stats.completedPercentage=0,t.scope.stats.openTasks=e.total_tasks-e.completed_tasks,e}));var t},e.prototype.refreshTagsColors=function(){return this.rs.projects.tagsColors(this.scope.projectId).then((t=this,function(e){return t.scope.project.tags_colors=e._attrs}));var t},e.prototype.loadSprint=function(){return this.rs.sprints.get(this.scope.projectId,this.scope.sprintId).then((t=this,function(e){return t.scope.sprint=e,t.scope.userstories=_.sortBy(e.user_stories,"sprint_order"),t.taskboardTasksService.setUserstories(t.scope.userstories),e}));var t},e.prototype.loadIssues=function(){var t,e;return t={},this.zoomLevel>1&&(t.include_attachments=1),t=_.merge(t,this.location.search()),this.rs.issues.listInProject(this.scope.projectId,this.scope.sprintId,t).then((e=this,function(t){return e.taskboardIssuesService.init(e.scope.project,e.scope.usersById,e.scope.issueStatusById),e.taskboardIssuesService.set(t),e.scope.taskBoardLoading=!1}))},e.prototype.loadTasks=function(){var t,e;return t={},this.zoomLevel>1&&(t.include_attachments=1),t=_.merge(t,this.location.search()),this.rs.tasks.list(this.scope.projectId,this.scope.sprintId,null,t).then((e=this,function(t){return e.taskboardTasksService.init(e.scope.project,e.scope.usersById),e.taskboardTasksService.set(t)}))},e.prototype.loadTaskboard=function(){return this.q.all([this.refreshTagsColors(),this.loadSprintStats(),this.loadSprint().then((t=this,function(){return t.loadTasks(),t.loadIssues()}))]);var t},e.prototype.loadInitialData=function(){var t,e;return t={pslug:this.params.pslug,sslug:this.params.sslug},this.repo.resolve(t).then((e=this,function(t){return e.scope.projectId=t.project,e.scope.sprintId=t.milestone,e.initializeSubscription(),t})).then(function(t){return function(){return t.loadProject()}}(this)).then(function(t){return function(){return t.generateFilters(),t.loadTaskboard().then(function(){return t.setRolePoints()})}}(this))},e.prototype.showPlaceHolder=function(t,e){return!(this.taskboardTasksService.tasksRaw.length||this.scope.taskStatusList[0].id!==t||this.scope.userstories.length&&this.scope.userstories[0].id!==e)},e.prototype.editTask=function(t){var e,r;return e=(e=this.taskboardTasksService.getTask(t)).set("loading-edit",!0),this.taskboardTasksService.replace(e),this.rs.tasks.getByRef(e.getIn(["model","project"]),e.getIn(["model","ref"])).then((r=this,function(t){return r.rs2.attachments.list("task",e.get("id"),e.getIn(["model","project"])).then(function(n){return r.rootscope.$broadcast("genericform:edit",{objType:"task",obj:t,project:r.scope.project,sprintId:r.scope.sprintId,attachments:n.toJS()}),e=e.set("loading-edit",!1),r.taskboardTasksService.replace(e)})}))},e.prototype.editIssue=function(t){var e,r;return e=(e=this.taskboardIssuesService.getIssue(t)).set("loading-edit",!0),this.rs.issues.getByRef(e.getIn(["model","project"]),e.getIn(["model","ref"])).then((r=this,function(t){return r.rs2.attachments.list("issue",e.get("id"),e.getIn(["model","project"])).then(function(n){return r.rootscope.$broadcast("genericform:edit",{objType:"issue",obj:t,project:r.scope.project,sprintId:r.scope.sprintId,attachments:n.toJS()}),e=e.set("loading-edit",!1)})}))},e.prototype.deleteTask=function(t){var e,r;return e=(e=this.taskboardTasksService.getTask(t)).set("loading-delete",!0),this.rs.tasks.getByRef(e.getIn(["model","project"]),e.getIn(["model","ref"])).then((r=this,function(t){var n,i;return e=e.set("loading-delete",!1),i=r.translate.instant("TASK.TITLE_DELETE_ACTION"),n=t.subject,r.confirm.askOnDelete(i,n).then(function(e){var n;return(n=r.repo.remove(t)).then(function(){return r.scope.$broadcast("taskboard:task:deleted"),e.finish()}),n.then(null,function(){return e.finish(!1),this.confirm.notify("error")})})}))},e.prototype.deleteIssue=function(t){var e,r;return e=(e=this.taskboardIssuesService.getIssue(t)).set("loading-delete",!0),this.rs.issues.getByRef(e.getIn(["model","project"]),e.getIn(["model","ref"])).then((r=this,function(t){var n,i;return e=e.set("loading-delete",!1),i=r.translate.instant("ISSUES.ACTION_DELETE"),n=t.subject,r.confirm.askOnDelete(i,n).then(function(e){var n;return(n=r.repo.remove(t)).then(function(){return r.scope.$broadcast("taskboard:issue:deleted"),e.finish()}),n.then(null,function(){return e.finish(!1),this.confirm.notify("error")})})}))},e.prototype.removeIssueFromSprint=function(t){var e,r;return e=(e=this.taskboardIssuesService.getIssue(t)).set("loading-delete",!0),this.rs.issues.getByRef(e.getIn(["model","project"]),e.getIn(["model","ref"])).then((r=this,function(t){var n,i;return e=e.set("loading-delete",!1),i=r.translate.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.TITLE"),r.translate.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.MESSAGE"),n=r.translate.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.MESSAGE",{sprintName:r.scope.sprint.name}),r.confirm.ask(i,null,n).then(function(e){var n;return t.milestone=null,(n=r.repo.save(t)).then(function(){return r.taskboardIssuesService.remove(t),e.finish()}),n.then(null,function(){return e.finish(!1),this.confirm.notify("error")})})}))},e.prototype.taskMove=function(t,e,r,n,i,o){var s,a,c,u;return this.scope.movingTask=!0,e=this.taskboardTasksService.getTaskModel(e.get("id")),s=this.taskboardTasksService.move(e.id,n,i,o),c={status__is_archived:!1,include_attachments:!0},a={headers:{"set-orders":JSON.stringify(s.set_orders)}},this.repo.save(e,!0,c,a,!0).then((u=this,function(t){var e;if(t[0].user_story&&u.reloadUserStory(t[0].user_story),u.scope.movingTask=!1,(e=t[1])&&e["taiga-info-order-updated"]&&(o=JSON.parse(e["taiga-info-order-updated"]),u.taskboardTasksService.assignOrders(o)),u.loadSprintStats(),u.generateFilters(),u.isFilterDataTypeSelected("status"))return u.loadTasks()}))},e.prototype.reloadUserStory=function(t){return this.rs.userstories.get(this.scope.project.id,t).then((e=this,function(t){return e.scope.userstories=_.map(e.scope.userstories,function(e){return e.id===t.id?t:e})}));var e},e.prototype.addNewTask=function(t,e){switch(t){case"standard":return this.rootscope.$broadcast("genericform:new",{objType:"task",project:this.scope.project,sprintId:this.scope.sprintId,usId:null!=e?e.id:void 0});case"bulk":return this.rootscope.$broadcast("taskform:bulk",this.scope.sprintId,null!=e?e.id:void 0)}},e.prototype.addNewIssue=function(t,e){switch(t){case"standard":return this.rootscope.$broadcast("genericform:new-or-existing",{objType:"issue",project:this.scope.project,sprintId:this.scope.sprintId,relatedField:"milestone",relatedObjectId:this.scope.sprintId,targetName:this.scope.sprint.name});case"standard":return this.rootscope.$broadcast("taskform:new",this.scope.sprintId,null!=e?e.id:void 0);case"bulk":return this.rootscope.$broadcast("issueform:bulk",this.scope.projectId,this.scope.sprintId)}},e.prototype.toggleFold=function(t,e){return"issues"===e?this.taskboardIssuesService.toggleFold(t):"tasks"===e?this.taskboardTasksService.toggleFold(t):void 0},e.prototype.changeTaskAssignedTo=function(t){var e;return e=this.taskboardTasksService.getTaskModel(t),this.rootscope.$broadcast("assigned-to:add",e)},e.prototype.changeIssueAssignedTo=function(t){var e;return e=this.taskboardIssuesService.getIssueModel(t),this.rootscope.$broadcast("assigned-to:add",e)},e.prototype.setRolePoints=function(){var t,e,r,n,i;return t=_.filter(this.scope.project.roles,"computable"),r=function(e){return e=parseInt(e,10),_.find(t,function(t){return t.id===e})},i=this,e=function(t){return parseInt(t,10),_.find(i.scope.project.points,function(e){return e.id===t})},n=_.reduce(this.scope.userstories,function(t,n,i){return _.forOwn(n.points,function(n,i){var o,s;return s=r(i),o=e(n),t[s.id]||(t[s.id]=s,t[s.id].points=0),t[s.id].points+=o.value}),t},{}),this.scope.pointsByRole=Object.keys(n).map(function(t){return n[t]})},e}(),a.controller("TaskboardController",t),e=function(t){return{link:function(e,r,n){return r.controller(),r.on("click",".toggle-analytics-visibility",function(e){return e.preventDefault(),angular.element(e.currentTarget).toggleClass("active"),t.$broadcast("taskboard:graph:toggle-visibility")}),r.find(".taskboard-table-body").on("scroll",function(t){var e;return e=angular.element(t.currentTarget),r.find(".taskboard-table-header .taskboard-table-inner").css("left",-1*e.scrollLeft())}),e.$on("$destroy",function(){return r.off()})}}},a.directive("tgTaskboard",["$rootScope",e]),r=function(t){return 40,300,{link:function(e,r,n){var i,o,s,a,c;return e.$on("sprint:zoom0",function(){return s()}),e.$on("sprint:task:moved",function(){return s()}),e.$watch("usTasks",function(){if(e.project)return e.statusesFolded=t.tasks.getStatusColumnModes(e.project.id),e.usFolded=t.tasks.getUsRowModes(e.project.id,e.sprintId),s()}),e.foldStatus=function(r){return e.statusesFolded[r.id]=!e.statusesFolded[r.id],t.tasks.storeStatusColumnModes(e.projectId,e.statusesFolded),s()},e.foldUs=function(r){return e.usFolded[r]=!e.usFolded[r],t.tasks.storeUsRowModes(e.projectId,e.sprintId,e.usFolded),s()},i=function(t,r){var n;return n=t?e.usTasks.getIn([t.toString(),r.toString()]).size:e.usTasks.getIn(["null",r.toString()]).size,e.statusesFolded[r]?n&&e.usFolded[t]?40*Math.round(Math.sqrt(n)):40:0},c=function(t,n){var i;return i=r.find(".squish-status-"+t),n?i.css("max-width",n):"0"===e.ctrl.zoomLevel?i.css("max-width",148):i.css("max-width",300)},a=function(){var t,n,i,o;return n=r.find(".taskboard-table-header .task-colum-name"),t=_.map(n,function(t){return $(t).outerWidth(!0)}),o=_.reduce(t,function(t,e){return t+e}),r.find(".taskboard-table-inner").css("width",o),r.find(".issues-row .taskboard-row-title-box").outerWidth(!0),r.find(".issues-row").css("width",o),i="0"===e.ctrl.zoomLevel?128:280,r.find(".issues-row .taskboard-cards-box .card").css("max-width",i)},o=function(t){var r;return r=i(null,t),_.forEach(e.userstories,function(e){var n;if((n=i(e.id,t))>r)return r=n}),c(t,r)},s=function(){_.forEach(e.taskStatusList,function(t){return o(t.id)}),a()}}}},a.directive("tgTaskboardSquishColumn",["$tgResources",r])}.call(this),function(){var t;this.taiga,this.taiga.mixOf,this.taiga.toggleText,this.taiga.scopeDefer,this.taiga.bindOnce,this.taiga.groupBy,t=function(t,e,r,n){return{link:function(t,e,i){var o;return o=t.$watch("usTasks",function(i){var s,a,c,u,l,p,d;if(i&&i.size&&(o(),t.project.my_permissions.indexOf("modify_task")>-1))return d=null,p=null,l=null,e,u=function(){var t;return t=n.instant("BACKLOG.SORTABLE_FILTER_ERROR"),$tgConfirm.notify("error",t)},a=function(t){return t.scope().$destroy(),t.off(),t.remove()},s=_.map(e.find(".taskboard-column"),function(t){return t}),(c=dragula(s,{copySortSource:!1,copy:!1,accepts:function(t,e){return!$(e).hasClass("taskboard-row-title-box")},moves:function(t){return $(t).is("tg-card")}})).on("drag",function(t){if(d=$(t).parent().scope(),e.hasClass("active-filters"))return u(),setTimeout(function(){return c.cancel(!0)},0),!1}),c.on("dragend",function(e){var n,i,o,s,c,u,h;return h=$(e).parent(),l=$(e),i=l.scope().task,n=l.index(),p=h.scope(),u=d.us?d.us.id:null,c=d.st.id,s=p.us?p.us.id:null,(o=p.st.id)===c&&s===u||a(l),t.$apply(function(){return r.$broadcast("taskboard:task:move",i,i.getIn(["model","status"]),s,o,n)})}),autoScroll([$(".taskboard-table-body")[0]],{margin:100,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&c.dragging}}),t.$on("$destroy",function(){return e.off(),c.destroy()})})}}},angular.module("taigaBacklog").directive("tgTaskboardSortable",["$tgRepo","$tgResources","$rootScope","$translate",t])}.call(this),function(){var t,e={}.hasOwnProperty;this.taiga.groupBy,t=function(t){function r(){this.reset()}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=[],r.prototype.reset=function(){return this.foldStatusChanged={},this.issuesRaw=[]},r.prototype.init=function(t,e,r){return this.issueStatusById=r,this.project=t,this.usersById=e},r.prototype.resetFolds=function(){return this.foldStatusChanged={},this.refresh()},r.prototype.toggleFold=function(t){return this.foldStatusChanged[t]=!this.foldStatusChanged[t],this.refresh()},r.prototype.add=function(t){return this.issuesRaw=this.issuesRaw.concat(t),this.refresh()},r.prototype.remove=function(t){var e,r,n;for(r in n=this.issuesRaw)if(e=n[r],t.id===e.id)return this.issuesRaw.splice(r,1),void this.refresh()},r.prototype.set=function(t){return this.issuesRaw=t,this.refresh()},r.prototype.getIssue=function(t){return this.milestoneIssues.find(function(e){return e.get("id")===t})},r.prototype.getIssueModel=function(t){return _.find(this.issuesRaw,function(e){return e.id===t})},r.prototype.replaceModel=function(t){return this.issuesRaw=_.map(this.issuesRaw,function(e){return t.id===e.id?t:e}),this.refresh()},r.prototype.refresh=function(){var t,e,r,n,i,o;for(n=[],t=0,i=(o=this.issuesRaw).length;t<i;t++)r=o[t],(e={}).foldStatusChanged=this.foldStatusChanged[r.id],e.model=r.getAttrs(),e.modelName=r.getName(),e.id=r.id,e.status=this.issueStatusById[r.status],e.images=_.filter(e.model.attachments,function(t){return!!t.thumbnail_card_url}),e.assigned_to=this.usersById[r.assigned_to],e.colorized_tags=_.map(e.model.tags,function(t){return{name:t[0],color:t[1]}}),n.push(e);return this.milestoneIssues=Immutable.fromJS(n)},r}(),angular.module("taigaKanban").service("tgTaskboardIssues",t)}.call(this),function(){var t,e={}.hasOwnProperty;this.taiga.groupBy,t=function(t){function r(){this.reset()}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=[],r.prototype.reset=function(){return this.tasksRaw=[],this.foldStatusChanged={},this.usTasks=Immutable.Map()},r.prototype.init=function(t,e){return this.project=t,this.usersById=e},r.prototype.resetFolds=function(){return this.foldStatusChanged={},this.refresh()},r.prototype.toggleFold=function(t){return this.foldStatusChanged[t]=!this.foldStatusChanged[t],this.refresh()},r.prototype.add=function(t){return this.tasksRaw=this.tasksRaw.concat(t),this.refresh()},r.prototype.set=function(t){return this.tasksRaw=t,this.refreshRawOrder(),this.refresh()},r.prototype.setUserstories=function(t){return this.userstories=t},r.prototype.refreshRawOrder=function(){var t,e,r,n,i;for(this.order={},n=[],t=0,e=(r=this.tasksRaw).length;t<e;t++)i=r[t],n.push(this.order[i.id]=i.taskboard_order);return n},r.prototype.assignOrders=function(t){return t=_.invert(t),this.order=_.assign(this.order,t),this.refresh()},r.prototype.getTask=function(t){var e;return e=null,this.usTasks.forEach(function(r){if(r.forEach(function(r){if(e=r.find(function(e){return e.get("id")===t}))return!1}),e)return!1}),e},r.prototype.replace=function(t){return this.usTasks=this.usTasks.map(function(e){return e.map(function(r){var n;return-1!==(n=r.findIndex(function(t){return t.get("id")===e.get("id")}))&&(r=r.set(n,t)),r})})},r.prototype.getTaskModel=function(t){return _.find(this.tasksRaw,function(e){return e.id===t})},r.prototype.replaceModel=function(t){return this.tasksRaw=_.map(this.tasksRaw,function(e){return t.id===e.id?t:e}),this.refresh()},r.prototype.move=function(t,e,r,n){var i,o,s,a,c,u,l,p,d,h,f,g,m,v,y;if(m=this.getTaskModel(t),v=_.filter(this.tasksRaw,function(t){return t.status===r&&t.user_story===e}),v=_.sortBy(v,(y=this,function(t){return y.order[t.id]})),g=_.filter(v,function(e){return e.id!==t}),o=_.slice(g,0,n),i=_.slice(g,n),f={},d=o[o.length-1],(h=_.filter(o,function(t){return function(e){return t.order[e.id]===t.order[d.id]}}(this))).length>1)for(s=0,l=h.length;s<l;s++)f[(a=h[s]).id]=this.order[a.id];for(d?d&&(this.order[m.id]=this.order[d.id]+1):this.order[m.id]=0,u=c=0,p=i.length;c<p;u=++c)a=i[u],this.order[a.id]=this.order[m.id]+u+1;return m.status=r,m.user_story=e,m.taskboard_order=this.order[m.id],this.refresh(),{task_id:m.id,order:this.order[m.id],set_orders:f}},r.prototype.refresh=function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f;if(this.project){var g;for(this.tasksRaw=_.sortBy(this.tasksRaw,(g=this,function(t){return g.order[t.id]})),d=this.tasksRaw,p=_.sortBy(this.project.task_statuses,"order"),f={},t=0,n=(a=_.union(this.userstories,[{id:null}])).length;t<n;t++)for(f[(h=a[t]).id]={},e=0,i=p.length;e<i;e++)c=p[e],f[h.id][c.id]=[];for(r=0,o=d.length;r<o;r++)null!=f[(l=d[r]).user_story]&&null!=f[l.user_story][l.status]&&(u={},s=l.getAttrs(),u.foldStatusChanged=this.foldStatusChanged[l.id],u.model=s,u.images=_.filter(s.attachments,function(t){return!!t.thumbnail_card_url}),u.id=l.id,u.assigned_to=this.usersById[l.assigned_to],u.colorized_tags=_.map(u.model.tags,function(t){return{name:t[0],color:t[1]}}),f[l.user_story][l.status].push(u));return this.usTasks=Immutable.fromJS(f)}},r}(),angular.module("taigaKanban").service("tgTaskboardTasks",t)}.call(this),function(){var t,e={}.hasOwnProperty;this.taiga.groupBy,t=function(t){function r(){this.reset()}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=[],r.prototype.reset=function(){return this.userstoriesRaw=[],this.archivedStatus=[],this.statusHide=[],this.foldStatusChanged={},this.usByStatus=Immutable.Map()},r.prototype.init=function(t,e){return this.project=t,this.usersById=e},r.prototype.resetFolds=function(){return this.foldStatusChanged={},this.refresh()},r.prototype.toggleFold=function(t){return this.foldStatusChanged[t]=!this.foldStatusChanged[t],this.refresh()},r.prototype.set=function(t){return this.userstoriesRaw=t,this.refreshRawOrder(),this.refresh()},r.prototype.add=function(t){return this.userstoriesRaw=this.userstoriesRaw.concat(t),this.refreshRawOrder(),this.refresh()},r.prototype.addArchivedStatus=function(t){return this.archivedStatus.push(t)},r.prototype.isUsInArchivedHiddenStatus=function(t){var e;return e=this.getUsModel(t),-1!==this.archivedStatus.indexOf(e.status)&&-1!==this.statusHide.indexOf(e.status)},r.prototype.hideStatus=function(t){return this.deleteStatus(t),this.statusHide.push(t)},r.prototype.showStatus=function(t){return _.remove(this.statusHide,function(e){return e===t})},r.prototype.getStatus=function(t){return _.filter(this.userstoriesRaw,function(e){return e.status===t})},r.prototype.deleteStatus=function(t){var e;return _.filter(this.userstoriesRaw,function(e){return e.status===t}),e=_.map(function(t){return t.id}),this.archived=_.difference(this.archived,e),this.userstoriesRaw=_.filter(this.userstoriesRaw,function(e){return e.status!==t}),this.refresh()},r.prototype.refreshRawOrder=function(){var t,e,r,n,i;for(this.order={},i=[],t=0,r=(n=this.userstoriesRaw).length;t<r;t++)e=n[t],i.push(this.order[e.id]=e.kanban_order);return i},r.prototype.assignOrders=function(t){return this.order=_.assign(this.order,t),this.refresh()},r.prototype.move=function(t,e,r){var n,i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,b,S,j,k,$,I,E,C;if(s=t.length,I=_.filter(this.userstoriesRaw,function(t){return t.status===e}),I=_.sortBy(I,(C=this,function(t){return C.order[t.id]})),E=_.filter(I,function(e){return!_.find(t,function(t){return e.id===t.id})}),i=_.slice(E,0,r),n=_.slice(E,r),S={},v=i[i.length-1],(y=_.filter(i,function(t){return function(e){return t.order[e.id]===t.order[v.id]}}(this))).length>1)for(o=0,d=y.length;o<d;o++)S[(a=y[o]).id]=this.order[a.id];if(m=[],j=[],b=[],-1!==this.archivedStatus.indexOf(e)&&-1!==this.statusHide.indexOf(e))k=(new Date).getTime();else if(v){if(v){for(k=this.order[v.id]+1,y=_.filter(i,function(t){return function(e){return e.kanban_order===t.order[v.id]}}(this)),l=u=0,f=n.length;u<f;l=++u)a=n[l],this.order[a.id]=this.order[v.id]+l+s+1,a.kanban_order=this.order[a.id];b=_.map(n,function(t){return function(e){return{us_id:e.id,order:t.order[e.id]}}}(this)),y.length>1&&(j=_.map(y,function(t){return function(e){return{us_id:e.id,order:t.order[e.id]}}}(this)))}}else{for(k=0,l=c=0,h=n.length;c<h;l=++c)a=n[l],this.order[a.id]=l+s+1,a.kanban_order=this.order[a.id];b=_.map(n,function(t){return function(e){return{us_id:e.id,order:t.order[e.id]}}}(this))}for(l=p=0,g=t.length;p<g;l=++p)($=t[l]).status=e,$.kanban_order=k+l,this.order[$.id]=$.kanban_order,m.push({us_id:$.id,order:$.kanban_order});return this.refresh(),{bulkOrders:m.concat(j,b),usList:m,set_orders:S}},r.prototype.moveToEnd=function(t,e){var r;return r=this.getUsModel(t),this.order[r.id]=-1,r.status=e,r.kanban_order=this.order[r.id],this.refresh(),{us_id:r.id,order:-1}},r.prototype.replace=function(t){return this.usByStatus=this.usByStatus.map(function(e){var r;return-1!==(r=e.findIndex(function(e){return e.get("id")===t.get("id")}))&&(e=e.set(r,t)),e})},r.prototype.replaceModel=function(t){return this.userstoriesRaw=_.map(this.userstoriesRaw,function(e){return t.id===e.id?t:e}),this.refresh()},r.prototype.getUs=function(t){var e;return e=null,this.usByStatus.forEach(function(r){if(e=r.find(function(e){return e.get("id")===t}))return!1}),e},r.prototype.getUsModel=function(t){return _.find(this.userstoriesRaw,function(e){return e.id===t})},r.prototype.refresh=function(){var t,e,r;return this.userstoriesRaw=_.sortBy(this.userstoriesRaw,(r=this,function(t){return r.order[t.id]})),e=this.userstoriesRaw,e=_.map(e,function(t){return function(e){var r,n;return n={},r=e.getAttrs(),n.foldStatusChanged=t.foldStatusChanged[e.id],n.model=r,n.images=_.filter(r.attachments,function(t){return!!t.thumbnail_card_url}),n.id=e.id,n.assigned_to=t.usersById[e.assigned_to],n.assigned_users=[],e.assigned_users.forEach(function(e){var r;return r=t.usersById[e],n.assigned_users.push(r)}),n.colorized_tags=_.map(n.model.tags,function(t){return{name:t[0],color:t[1]}}),n}}(this)),t=_.groupBy(e,function(t){return t.model.status}),this.usByStatus=Immutable.fromJS(t)},r}(),angular.module("taigaKanban").service("tgKanbanUserstories",t)}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h={}.hasOwnProperty,f=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};d=this.taiga,u=this.taiga.mixOf,this.taiga.toggleText,p=this.taiga.scopeDefer,this.taiga.bindOnce,c=this.taiga.groupBy,this.taiga.timeout,s=this.taiga.bindMethods,a=this.taiga.debounceLeading,l=angular.module("taigaKanban"),r=function(t){function e(t,e,r,n,i,o,a,c,u,l,p,h,f,g,m,v,y,_,b,S){var j;(this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.rs2=o,this.params=a,this.q=c,this.location=u,this.appMetaService=l,this.navUrls=p,this.events=h,this.analytics=f,this.translate=g,this.errorHandlingService=m,this.model=v,this.kanbanUserstoriesService=y,this.storage=_,this.filterRemoteStorageService=b,this.projectService=S,s(this),this.kanbanUserstoriesService.reset(),this.openFilter=!1,this.selectedUss={},this.applyStoredFilters(this.params.pslug,"kanban-filters"))||(this.scope.sectionName=this.translate.instant("KANBAN.SECTION_NAME"),this.initializeEventHandlers(),d.defineImmutableProperty(this.scope,"usByStatus",(j=this,function(){return j.kanbanUserstoriesService.usByStatus})))}return function(t,e){for(var r in e)h.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,u(d.Controller,d.PageMixin,d.FiltersMixin,d.UsFiltersMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","tgErrorHandlingService","$tgModel","tgKanbanUserstories","$tgStorage","tgFilterRemoteStorageService","tgProjectService"],e.prototype.storeCustomFiltersName="kanban-custom-filters",e.prototype.storeFiltersName="kanban-filters",e.prototype.cleanSelectedUss=function(){var t,e;for(t in e=[],this.selectedUss)e.push(this.selectedUss[t]=!1);return e},e.prototype.toggleSelectedUs=function(t){return this.selectedUss[t]=!this.selectedUss[t]},e.prototype.firstLoad=function(){var t,e;return(t=this.loadInitialData()).then((e=this,function(){var t,r;return r=e.translate.instant("KANBAN.PAGE_TITLE",{projectName:e.scope.project.name}),t=e.translate.instant("KANBAN.PAGE_DESCRIPTION",{projectName:e.scope.project.name,projectDescription:e.scope.project.description}),e.appMetaService.setAll(r,t)})),t.then(null,this.onInitialDataError.bind(this))},e.prototype.setZoom=function(t,e){var r,n;return this.zoomLevel===t?null:(this.isFirstLoad=!this.zoomLevel,r=this.zoomLevel,this.zoomLevel=t,this.zoom=e,this.isFirstLoad?this.firstLoad().then((n=this,function(){return n.isFirstLoad=!1,n.kanbanUserstoriesService.resetFolds()})):this.zoomLevel>2&&r<=2?(this.zoomLoading=!0,this.loadUserstories().then(function(t){return function(){return t.zoomLoading=!1,t.kanbanUserstoriesService.resetFolds()}}(this))):void 0)},e.prototype.filtersReloadContent=function(){return this.loadUserstories().then((t=this,function(){var e,r,n,i,o;if((n=_.difference(t.kanbanUserstoriesService.archivedStatus,t.kanbanUserstoriesService.statusHide)).length){for(i=[],e=0,r=n.length;e<r;e++)o=n[e],i.push(t.loadUserStoriesForStatus({},o));return i}}));var t},e.prototype.initializeEventHandlers=function(){var t;return this.scope.$on("usform:new:success",(t=this,function(e,r){return t.refreshTagsColors().then(function(){return t.kanbanUserstoriesService.add(r)}),t.analytics.trackEvent("userstory","create","create userstory on kanban",1)})),this.scope.$on("usform:bulk:success",function(t){return function(e,r){return t.refreshTagsColors().then(function(){return t.kanbanUserstoriesService.add(r)}),t.analytics.trackEvent("userstory","create","bulk create userstory on kanban",1)}}(this)),this.scope.$on("usform:edit:success",function(t){return function(e,r){return t.refreshTagsColors().then(function(){return t.kanbanUserstoriesService.replaceModel(r)})}}(this)),this.scope.$on("kanban:us:deleted",function(t){return function(e,r){return t.filtersReloadContent()}}(this)),this.scope.$on("assigned-to:added",this.onAssignedToChanged),this.scope.$on("assigned-user:added",this.onAssignedUsersChanged),this.scope.$on("assigned-user:deleted",this.onAssignedUsersDeleted),this.scope.$on("kanban:us:move",this.moveUs),this.scope.$on("kanban:show-userstories-for-status",this.loadUserStoriesForStatus),this.scope.$on("kanban:hide-userstories-for-status",this.hideUserStoriesForStatus)},e.prototype.addNewUs=function(t,e){switch(t){case"standard":return this.rootscope.$broadcast("genericform:new",{objType:"us",project:this.scope.project,statusId:e});case"bulk":return this.rootscope.$broadcast("usform:bulk",this.scope.projectId,e)}},e.prototype.editUs=function(t){var e,r;return e=(e=this.kanbanUserstoriesService.getUs(t)).set("loading-edit",!0),this.kanbanUserstoriesService.replace(e),this.rs.userstories.getByRef(e.getIn(["model","project"]),e.getIn(["model","ref"])).then((r=this,function(t){return r.rs2.attachments.list("us",e.get("id"),e.getIn(["model","project"])).then(function(e){return r.rootscope.$broadcast("genericform:edit",{objType:"us",obj:t,statusList:r.scope.usStatusList,attachments:e.toJS()})}),e=e.set("loading-edit",!1),r.kanbanUserstoriesService.replace(e)}))},e.prototype.deleteUs=function(t){var e,r;return e=(e=this.kanbanUserstoriesService.getUs(t)).set("loading-delete",!0),this.rs.userstories.getByRef(e.getIn(["model","project"]),e.getIn(["model","ref"])).then((r=this,function(t){var n,i;return e=e.set("loading-delete",!1),i=r.translate.instant("US.TITLE_DELETE_ACTION"),n=t.subject,r.confirm.askOnDelete(i,n).then(function(e){var n;return(n=r.repo.remove(t)).then(function(){return r.scope.$broadcast("kanban:us:deleted"),e.finish()}),n.then(null,function(){return e.finish(!1),this.confirm.notify("error")})})}))},e.prototype.showPlaceHolder=function(t){return this.scope.usStatusList[0].id===t&&!this.kanbanUserstoriesService.userstoriesRaw.length},e.prototype.toggleFold=function(t){return this.kanbanUserstoriesService.toggleFold(t)},e.prototype.isUsInArchivedHiddenStatus=function(t){return this.kanbanUserstoriesService.isUsInArchivedHiddenStatus(t)},e.prototype.changeUsAssignedTo=function(t){var e;return e=this.kanbanUserstoriesService.getUsModel(t),this.rootscope.$broadcast("assigned-to:add",e)},e.prototype.changeUsAssignedUsers=function(t){var e;return e=this.kanbanUserstoriesService.getUsModel(t),this.rootscope.$broadcast("assigned-user:add",e)},e.prototype.onAssignedToChanged=function(t,e,r){return r.assigned_to=e,this.kanbanUserstoriesService.replaceModel(r),this.repo.save(r).then((n=this,function(){if(n.generateFilters(),n.isFilterDataTypeSelected("assigned_to")||n.isFilterDataTypeSelected("role"))return n.filtersReloadContent()}));var n},e.prototype.onAssignedUsersChanged=function(t,e,r){var n,i;return(n=_.clone(r.assigned_users,!1)).push(e),n=_.uniq(n),r.assigned_users=n,r.assigned_to||(r.assigned_to=e),this.kanbanUserstoriesService.replaceModel(r),this.repo.save(r).then((i=this,function(){if(i.generateFilters(),i.isFilterDataTypeSelected("assigned_users")||i.isFilterDataTypeSelected("role"))return i.filtersReloadContent()}))},e.prototype.onAssignedUsersDeleted=function(t,e,r){var n,i,o;return n=_.clone(r.assigned_users,!1),n=_.pull(n,e),n=_.uniq(n),r.assigned_users=n,i=r.assigned_to,f.call(n,i)<0&&n.length>0&&(r.assigned_to=n[0]),0===n.length&&(r.assigned_to=null),this.kanbanUserstoriesService.replaceModel(r),this.repo.save(r).then((o=this,function(){if(o.generateFilters(),o.isFilterDataTypeSelected("assigned_users")||o.isFilterDataTypeSelected("role"))return o.filtersReloadContent()}))},e.prototype.refreshTagsColors=function(){return this.rs.projects.tagsColors(this.scope.projectId).then((t=this,function(e){return t.scope.project.tags_colors=e._attrs}));var t},e.prototype.loadUserstories=function(){var t,e,r;return t={status__is_archived:!1},this.zoomLevel>2&&(t.include_attachments=1,t.include_tasks=1),t=_.merge(t,this.location.search()),(e=this.rs.userstories.listAll(this.scope.projectId,t).then((r=this,function(t){return r.kanbanUserstoriesService.init(r.scope.project,r.scope.usersById),r.kanbanUserstoriesService.set(t),p(r.scope,function(){return r.scope.$broadcast("userstories:loaded",t)}),t}))).then(function(t){return function(){return t.scope.$broadcast("redraw:wip")}}(this)),e},e.prototype.loadUserStoriesForStatus=function(t,e){var r,n,i;if(!(r=this.location.search().status)||-1!==(r=r.split(",").map(function(t){return parseInt(t,10)})).indexOf(e))return n={status:e,include_attachments:!0,include_tasks:!0},n=_.merge(n,this.location.search()),this.rs.userstories.listAll(this.scope.projectId,n).then((i=this,function(t){return i.scope.$broadcast("kanban:shown-userstories-for-status",e,t),t}))},e.prototype.hideUserStoriesForStatus=function(t,e){return this.scope.$broadcast("kanban:hidden-userstories-for-status",e)},e.prototype.loadKanban=function(){return this.q.all([this.refreshTagsColors(),this.loadUserstories()])},e.prototype.loadProject=function(){var t;return(t=this.projectService.project.toJS()).is_kanban_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.projectId=t.id,this.scope.points=_.sortBy(t.points,"order"),this.scope.pointsById=c(t.points,function(t){return t.id}),this.scope.usStatusById=c(t.us_statuses,function(t){return t.id}),this.scope.usStatusList=_.sortBy(t.us_statuses,"order"),this.scope.$emit("project:loaded",t),t},e.prototype.initializeSubscription=function(){var t,e,r;return e="changes.project."+this.scope.projectId+".userstories",t=d.randomInt(700,1e3),this.events.subscribe(this.scope,e,a(t,(r=this,function(t){return r.loadUserstories()})))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),this.fillUsersAndRoles(t.members,t.roles),this.initializeSubscription(),this.loadKanban(),this.generateFilters()},e.prototype.prepareBulkUpdateData=function(t,e){return null==e&&(e="kanban_order"),_.map(t,function(t){return{us_id:t.id,order:t[e]}})},e.prototype.moveUs=function(t,e,r,n){var i,o,s;return this.cleanSelectedUss(),e=_.map(e,(s=this,function(t){return s.kanbanUserstoriesService.getUsModel(t.id)})),i=this.kanbanUserstoriesService.move(e,r,n),(o=this.rs.userstories.bulkUpdateKanbanOrder(this.scope.projectId,r,i.bulkOrders)).then(function(t){return function(){var r,n,s;return r={headers:{"set-orders":JSON.stringify(i.setOrders)}},n={include_attachments:!0,include_tasks:!0},s=_.map(e,function(e){return t.repo.save(e,!0,n,r,!0)}),(o=t.q.all(s)).then(function(e){var r,n;return(r=e[1])&&r["taiga-info-order-updated"]&&(n=JSON.parse(r["taiga-info-order-updated"]),t.kanbanUserstoriesService.assignOrders(n)),t.scope.$broadcast("redraw:wip"),t.generateFilters(),t.isFilterDataTypeSelected("status")&&t.filtersReloadContent(),o})}}(this))},e}(),l.controller("KanbanController",r),n=function(t,e){return{link:function(t,e,r){return e.find(".kanban-table-body").on("scroll",function(t){var r;return r=angular.element(t.currentTarget),e.find(".kanban-table-header .kanban-table-inner").css("left",-1*r.scrollLeft())}),t.$on("$destroy",function(){return e.off()})}}},l.directive("tgKanban",["$tgRepo","$rootScope",n]),t=function(t,e,r){var n,i;return i=e.instant("KANBAN.ACTION_SHOW_ARCHIVED"),n=e.instant("KANBAN.ACTION_HIDE_ARCHIVED"),{link:function(e,o,s){var a,c;return c=e.$eval(s.tgKanbanArchivedStatusHeader),a=!0,r.addArchivedStatus(c.id),r.hideStatus(c.id),e.class="icon-watch",e.title=i,o.on("click",function(o){return a=!a,e.$apply(function(){return a?(e.class="icon-watch",e.title=i,t.$broadcast("kanban:hide-userstories-for-status",c.id),r.hideStatus(c.id)):(e.class="icon-unwatch",e.title=n,t.$broadcast("kanban:show-userstories-for-status",c.id),r.showStatus(c.id))})}),e.$on("$destroy",function(){return o.off()})}}},l.directive("tgKanbanArchivedStatusHeader",["$rootScope","$translate","tgKanbanUserstories",t]),e=function(t,e){return[],{link:function(r,n,i){var o,s,a;return o=t.instant("KANBAN.HIDDEN_USER_STORIES"),s=r.$eval(i.tgKanbanArchivedStatusIntro),n.text(o),a=function(t){return t?n.text(""):n.text(o)},r.$on("kanban:us:move",function(t,r,n,i,o){var s;return s=!!e.getStatus(i).length,a(s)}),r.$on("kanban:shown-userstories-for-status",function(t,r,n){var i;if(r===s.id)return e.deleteStatus(r),e.add(n),i=!!e.getStatus(r).length,a(i)}),r.$on("kanban:hidden-userstories-for-status",function(t,e){if(e===s.id)return a(!1)}),r.$on("$destroy",function(){return n.off()})}}},l.directive("tgKanbanArchivedStatusIntro",["$translate","tgKanbanUserstories",e]),i=function(t,e){return{link:function(r,n,i){var o,s;return r.foldStatus=function(e){r.folds[e.id]=!r.folds[e.id],t.kanban.storeStatusColumnModes(r.projectId,r.folds),s()},s=function(){var t,e;return t=_.map(r.usStatusList,function(t){return r.folds[t.id]?40:310}),e=_.reduce(t,function(t,e){return t+e}),n.find(".kanban-table-inner").css("width",e)},o=r.$watch("usByStatus",function(n){if(n.size)return r.folds=t.kanban.getStatusColumnModes(e.project.get("id")),s(),o()})}}},l.directive("tgKanbanSquishColumn",["$tgResources","tgProjectService",i]),o=function(t){return{link:function(e,r,n){var i,o;return i=function(){return r.find(".kanban-wip-limit").remove(),t(function(){var t;if(t=r.find("tg-card")[o.wip_limit])return angular.element(t).before("<div class='kanban-wip-limit'></div>")})},(o=e.$eval(n.tgKanbanWipLimit))&&!o.is_archived&&(e.$on("redraw:wip",i),e.$on("kanban:us:move",i),e.$on("usform:new:success",i),e.$on("usform:bulk:success",i)),e.$on("$destroy",function(){return r.off()})}}},l.directive("tgKanbanWipLimit",["$timeout",o])}.call(this),function(){var t;this.taiga,this.taiga.mixOf,this.taiga.toggleText,this.taiga.scopeDefer,this.taiga.bindOnce,this.taiga.groupBy,this.taiga.timeout,t=function(t,e,r){return{link:function(t,e,n){var i;return i=t.$watch("usByStatus",function(n){var o,s,a,c,u;if(n&&n.size&&(i(),t.project.my_permissions.indexOf("modify_us")>-1))return u=null,c=null,e,s=function(t){return t.scope().$destroy(),t.off(),t.remove()},o=_.map(e.find(".taskboard-column"),function(t){return t}),(a=dragula(o,{copySortSource:!1,copy:!1,moves:function(t){return $(t).is("tg-card")}})).on("drag",function(t){return window.dragMultiple.start(t,o)}),a.on("cloned",function(t,e){return $(t).addClass("multiple-drag-mirror")}),a.on("dragend",function(e){var n,i,o,a,l,p,d;return p=$(e).parent(),(u=p.scope()).s.id,(n=window.dragMultiple.stop()).length||(n=[e]),o=n[0],a=$(p).find("tg-card").index(o),l=u.s.id,d=_.map(n,function(t){return $(t).scope().us}),i=_.map(d,function(t){return{id:t.get("id"),oldStatusId:t.getIn(["model","status"])}}),t.$apply(function(){return _.each(d,function(t,e){var r;if(r=t.getIn(["model","status"]),l!==r)return c=$(n[e]),s(c)}),r.$broadcast("kanban:us:move",i,l,a)})}),autoScroll(o,{margin:100,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&a.dragging}}),t.$on("$destroy",function(){return e.off(),a.destroy()})})}}},angular.module("taigaKanban").directive("tgKanbanSortable",["$tgRepo","$tgResources","$rootScope",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c={}.hasOwnProperty;a=this.taiga,o=this.taiga.mixOf,this.taiga.toString,this.taiga.joinStr,i=this.taiga.groupBy,this.taiga.bindOnce,n=this.taiga.bindMethods,s=angular.module("taigaEpics"),t=function(t){function e(t,e,r,i,o,s,a,c,u,l,p,d,h,f,g,m,v){var y,_;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=i,this.rs=o,this.rs2=s,this.params=a,this.q=c,this.location=u,this.log=l,this.appMetaService=p,this.analytics=d,this.navUrls=h,this.translate=f,this.modelTransform=g,this.errorHandlingService=m,this.projectService=v,n(this),this.scope.epicRef=this.params.epicref,this.scope.sectionName=this.translate.instant("EPIC.SECTION_NAME"),this.initializeEventHandlers(),(y=this.loadInitialData()).then((_=this,function(){return _._setMeta(),_.initializeOnDeleteGoToUrl()})),y.then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)c.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,o(a.Controller,a.PageMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgAnalytics","$tgNavUrls","$translate","$tgQueueModelTransformation","tgErrorHandlingService","tgProjectService"],e.prototype._setMeta=function(){var t,e,r;return r=this.translate.instant("EPIC.PAGE_TITLE",{epicRef:"#"+this.scope.epic.ref,epicSubject:this.scope.epic.subject,projectName:this.scope.project.name}),t=this.translate.instant("EPIC.PAGE_DESCRIPTION",{epicStatus:(null!=(e=this.scope.statusById[this.scope.epic.status])?e.name:void 0)||"--",epicDescription:angular.element(this.scope.epic.description_html||"").text()}),this.appMetaService.setAll(r,t)},e.prototype.initializeEventHandlers=function(){var t;return this.scope.$on("attachment:create",(t=this,function(){return t.analytics.trackEvent("attachment","create","create attachment on epic",1)})),this.scope.$on("comment:new",function(t){return function(){return t.loadEpic()}}(this)),this.scope.$on("custom-attributes-values:edit",function(t){return function(){return t.rootscope.$broadcast("object:updated")}}(this))},e.prototype.initializeOnDeleteGoToUrl=function(){var t;return t={project:this.scope.project.slug},this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-epics",t)},e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),this.scope.projectId=t.id,this.scope.project=t,this.scope.immutableProject=this.projectService.project,this.scope.$emit("project:loaded",t),this.scope.statusList=t.epic_statuses,this.scope.statusById=i(t.epic_statuses,function(t){return t.id}),t},e.prototype.loadEpic=function(){return this.rs.epics.getByRef(this.scope.projectId,this.params.epicref).then((t=this,function(e){var r,n,i;if(t.scope.epic=e,t.scope.immutableEpic=Immutable.fromJS(e._attrs),t.scope.epicId=e.id,t.scope.commentModel=e,t.modelTransform.setObject(t.scope,"epic"),null!=(null!=(n=t.scope.epic.neighbors.previous)?n.ref:void 0)&&(r={project:t.scope.project.slug,ref:t.scope.epic.neighbors.previous.ref},t.scope.previousUrl=t.navUrls.resolve("project-epics-detail",r)),null!=(null!=(i=t.scope.epic.neighbors.next)?i.ref:void 0))return r={project:t.scope.project.slug,ref:t.scope.epic.neighbors.next.ref},t.scope.nextUrl=t.navUrls.resolve("project-epics-detail",r)}));var t},e.prototype.loadUserstories=function(){return this.rs2.userstories.listInEpic(this.scope.epicId).then((t=this,function(e){return t.scope.userstories=e}));var t},e.prototype.loadInitialData=function(){var t,e;return t=this.loadProject(),this.fillUsersAndRoles(t.members,t.roles),this.loadEpic().then((e=this,function(){return e.loadUserstories()}))},e.prototype.onUpvote=function(){var t,e,r;return r=this,e=function(){return r.loadEpic(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.epics.upvote(this.scope.epicId).then(e,t)},e.prototype.onDownvote=function(){var t,e,r;return r=this,e=function(){return r.loadEpic(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.epics.downvote(this.scope.epicId).then(e,t)},e.prototype.onWatch=function(){var t,e,r;return r=this,e=function(){return r.loadEpic(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.epics.watch(this.scope.epicId).then(e,t)},e.prototype.onUnwatch=function(){var t,e,r;return r=this,e=function(){return r.loadEpic(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.epics.unwatch(this.scope.epicId).then(e,t)},e.prototype.onSelectColor=function(t){var e,r,n;return n=this,r=function(){return n.rootscope.$broadcast("object:updated"),n.confirm.notify("success")},e=function(t){return function(){return t.confirm.notify("error")}}(this),this.modelTransform.save(function(e){return e.color=t,e}).then(r,e)},e}(),s.controller("EpicDetailController",t),r=function(t,e){var r;return r=t.get("common/components/status-display.html",!0),{link:function(t,n,i){var o;return o=function(i){var o,s;return s=t.statusById[i.status],o=r({is_closed:s.is_closed,status:s}),o=e(o)(t),n.html(o)},t.$watch(i.ngModel,function(t){if(null!=t)return o(t)}),t.$on("$destroy",function(){return n.off()})},restrict:"EA",require:"ngModel"}},s.directive("tgEpicStatusDisplay",["$tgTemplate","$compile",r]),e=function(t,e,r,n,i,o,s,a){var c;return c=a.get("common/components/status-button.html",!0),{link:function(e,s,a,u){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_epic")},p=function(t){var r,n;return n=e.statusById[t.status],r=o(c({status:n,statuses:e.statusList,editable:l()}))(e),s.html(r)},d=function(e){var o,a,c;return o=n().target(s).start(),c=function(){return t.$broadcast("object:updated"),o.finish()},a=function(){return r.notify("error"),o.finish()},i.save(function(t){return t.status=e,t}).then(c,a)},s.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),l())return s.find(".pop-status").popover().open()}),s.on("click",".status",function(t){var e;if(t.preventDefault(),t.stopPropagation(),l())return e=angular.element(t.currentTarget),$.fn.popover().closeAll(),d(e.data("status-id"))}),e.$watch(function(){var t;return null!=(t=u.$modelValue)?t.status:void 0},function(){var t;if(t=u.$modelValue)return p(t)}),e.$on("$destroy",function(){return s.off()})},restrict:"EA",require:"ngModel"}},s.directive("tgEpicStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$compile","$translate","$tgTemplate",e])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h={}.hasOwnProperty;d=this.taiga,u=this.taiga.mixOf,this.taiga.toString,this.taiga.joinStr,c=this.taiga.groupBy,this.taiga.bindOnce,a=this.taiga.bindMethods,p=this.taiga.normalizeString,l=angular.module("taigaIssues"),e=function(t){function e(t,e,r,n,i,o,s,c,u,l,p,d,h,f,g,m){var v,y;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=c,this.log=u,this.appMetaService=l,this.analytics=p,this.navUrls=d,this.translate=h,this.modelTransform=f,this.errorHandlingService=g,this.projectService=m,a(this),this.scope.issueRef=this.params.issueref,this.scope.sectionName=this.translate.instant("ISSUES.SECTION_NAME"),this.initializeEventHandlers(),(v=this.loadInitialData()).then((y=this,function(){return y._setMeta(),y.initializeOnDeleteGoToUrl()})),v.then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)h.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,u(d.Controller,d.PageMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgAnalytics","$tgNavUrls","$translate","$tgQueueModelTransformation","tgErrorHandlingService","tgProjectService"],e.prototype._setMeta=function(){var t,e,r,n,i,o;return o=this.translate.instant("ISSUE.PAGE_TITLE",{issueRef:"#"+this.scope.issue.ref,issueSubject:this.scope.issue.subject,projectName:this.scope.project.name}),t=this.translate.instant("ISSUE.PAGE_DESCRIPTION",{issueStatus:(null!=(e=this.scope.statusById[this.scope.issue.status])?e.name:void 0)||"--",issueType:(null!=(r=this.scope.typeById[this.scope.issue.type])?r.name:void 0)||"--",issueSeverity:(null!=(n=this.scope.severityById[this.scope.issue.severity])?n.name:void 0)||"--",issuePriority:(null!=(i=this.scope.priorityById[this.scope.issue.priority])?i.name:void 0)||"--",issueDescription:angular.element(this.scope.issue.description_html||"").text()}),this.appMetaService.setAll(o,t)},e.prototype.initializeEventHandlers=function(){var t;return this.scope.$on("attachment:create",(t=this,function(){return t.analytics.trackEvent("attachment","create","create attachment on issue",1)})),this.scope.$on("promote-issue-to-us:success",function(t){return function(){return t.analytics.trackEvent("issue","promoteToUserstory","promote issue to userstory",1),t.rootscope.$broadcast("object:updated"),t.loadIssue()}}(this)),this.scope.$on("comment:new",function(t){return function(){return t.loadIssue()}}(this)),this.scope.$on("custom-attributes-values:edit",function(t){return function(){return t.rootscope.$broadcast("object:updated")}}(this)),this.scope.$on("assign-sprint-to-issue:success",function(t){return function(e,r){return t.scope.issue.milestone=r,t.rootscope.$broadcast("object:updated"),r?t.loadSprint():t.scope.sprint=null}}(this))},e.prototype.initializeOnDeleteGoToUrl=function(){var t;return t={project:this.scope.project.slug},this.scope.project.is_issues_activated?this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-issues",t):this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t)},e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.statusList=t.issue_statuses,this.scope.statusById=c(t.issue_statuses,function(t){return t.id}),this.scope.typeById=c(t.issue_types,function(t){return t.id}),this.scope.typeList=_.sortBy(t.issue_types,"order"),this.scope.severityList=t.severities,this.scope.severityById=c(t.severities,function(t){return t.id}),this.scope.priorityList=t.priorities,this.scope.priorityById=c(t.priorities,function(t){return t.id}),t},e.prototype.loadIssue=function(){return this.rs.issues.getByRef(this.scope.projectId,this.params.issueref).then((t=this,function(e){var r,n,i;if(t.scope.issue=e,t.scope.issueId=e.id,t.scope.commentModel=e,t.modelTransform.setObject(t.scope,"issue"),null!=(null!=(n=t.scope.issue.neighbors.previous)?n.ref:void 0)&&(r={project:t.scope.project.slug,ref:t.scope.issue.neighbors.previous.ref},t.scope.previousUrl=t.navUrls.resolve("project-issues-detail",r)),null!=(null!=(i=t.scope.issue.neighbors.next)?i.ref:void 0))return r={project:t.scope.project.slug,ref:t.scope.issue.neighbors.next.ref},t.scope.nextUrl=t.navUrls.resolve("project-issues-detail",r)}));var t},e.prototype.loadSprint=function(){if(this.scope.issue.milestone)return this.rs.sprints.get(this.scope.issue.project,this.scope.issue.milestone).then((t=this,function(e){return t.scope.sprint=e,e}));var t},e.prototype.loadInitialData=function(){var t,e;return t=this.loadProject(),this.fillUsersAndRoles(t.members,t.roles),this.loadIssue().then((e=this,function(){return e.loadSprint()}))},e.prototype.onUpvote=function(){var t,e,r;return r=this,e=function(){return r.loadIssue(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.issues.upvote(this.scope.issueId).then(e,t)},e.prototype.onDownvote=function(){var t,e,r;return r=this,e=function(){return r.loadIssue(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.issues.downvote(this.scope.issueId).then(e,t)},e.prototype.onWatch=function(){var t,e,r;return r=this,e=function(){return r.loadIssue(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.issues.watch(this.scope.issueId).then(e,t)},e.prototype.onUnwatch=function(){var t,e,r;return r=this,e=function(){return r.loadIssue(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.issues.unwatch(this.scope.issueId).then(e,t)},e}(),l.controller("IssueDetailController",e),o=function(t,e){var r;return r=t.get("common/components/status-display.html",!0),{link:function(t,n,i){var o;return o=function(i){var o,s;return s=t.statusById[i.status],o=r({is_closed:s.is_closed,status:s}),o=e(o)(t),n.html(o)},t.$watch(i.ngModel,function(t){if(null!=t)return o(t)}),t.$on("$destroy",function(){return n.off()})},restrict:"EA",require:"ngModel"}},l.directive("tgIssueStatusDisplay",["$tgTemplate","$compile",o]),i=function(t,e,r,n,i,o,s){var a;return a=o.get("common/components/status-button.html",!0),{link:function(e,o,c,u){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_issue")},p=function(t){var r,n;return n=e.statusById[t.status],r=a({status:n,statuses:e.statusList,editable:l()}),r=s(r)(e),o.html(r)},d=function(e){var s,a,c;return $.fn.popover().closeAll(),s=n().target(o).start(),c=function(){return t.$broadcast("object:updated"),s.finish()},a=function(){return r.notify("error"),s.finish()},i.save(function(t){return t.status=e,t}).then(c,a)},o.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),l())return o.find(".pop-status").popover().open()}),o.on("click",".status",function(t){var e;if(t.preventDefault(),t.stopPropagation(),l())return e=angular.element(t.currentTarget),d(e.data("status-id"))}),e.$watch(function(){var t;return null!=(t=u.$modelValue)?t.status:void 0},function(){var t;if(t=u.$modelValue)return p(t)}),e.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},l.directive("tgIssueStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",i]),s=function(t,e,r,n,i,o,s){var a;return a=o.get("issue/issue-type-button.html",!0),{link:function(e,o,c,u){var l,p,d,h;return p=e.$eval(c.notAutoSave),l=function(){return-1!==e.project.my_permissions.indexOf("modify_issue")},d=function(t){var r,n;return n=e.typeById[t.type],r=a({type:n,typees:e.typeList,editable:l()}),r=s(r)(e),o.html(r)},h=function(s){var a,c,l;return $.fn.popover().closeAll(),p?(u.$modelValue.type=s,void e.$apply()):(a=n().target(o.find(".level-name")).start(),l=function(){return t.$broadcast("object:updated"),a.finish()},c=function(){return r.notify("error"),a.finish()},i.save(function(t){return t.type=s,t}).then(l,c))},o.on("click",".type-data",function(t){if(t.preventDefault(),t.stopPropagation(),l())return o.find(".pop-type").popover().open()}),o.on("click",".type",function(t){var e;if(t.preventDefault(),t.stopPropagation(),l())return e=angular.element(t.currentTarget).data("type-id"),h(e)}),e.$watch(function(){var t;return null!=(t=u.$modelValue)?t.type:void 0},function(){var t;if(t=u.$modelValue)return d(t)}),e.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},l.directive("tgIssueTypeButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",s]),n=function(t,e,r,n,i,o,s){var a;return a=o.get("issue/issue-severity-button.html",!0),{link:function(e,o,c,u){var l,p,d,h;return p=e.$eval(c.notAutoSave),l=function(){return-1!==e.project.my_permissions.indexOf("modify_issue")},d=function(t){var r,n;return n=e.severityById[t.severity],r=a({severity:n,severityes:e.severityList,editable:l()}),r=s(r)(e),o.html(r)},h=function(s){var a,c,l;return $.fn.popover().closeAll(),p?(u.$modelValue.severity=s,void e.$apply()):(a=n().target(o.find(".level-name")).start(),l=function(){return t.$broadcast("object:updated"),a.finish()},c=function(){return r.notify("error"),a.finish()},i.save(function(t){return t.severity=s,t}).then(l,c))},o.on("click",".severity-data",function(t){if(t.preventDefault(),t.stopPropagation(),l())return o.find(".pop-severity").popover().open()}),o.on("click",".severity",function(t){var e;if(t.preventDefault(),t.stopPropagation(),l())return e=angular.element(t.currentTarget).data("severity-id"),h(e)}),e.$watch(function(){var t;return null!=(t=u.$modelValue)?t.severity:void 0},function(){var t;if(t=u.$modelValue)return d(t)}),e.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},l.directive("tgIssueSeverityButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),r=function(t,e,r,n,i,o,s){var a;return a=o.get("issue/issue-priority-button.html",!0),{link:function(e,o,c,u){var l,p,d,h;return p=e.$eval(c.notAutoSave),l=function(){return-1!==e.project.my_permissions.indexOf("modify_issue")},d=function(t){var r,n;return n=e.priorityById[t.priority],r=a({priority:n,priorityes:e.priorityList,editable:l()}),r=s(r)(e),o.html(r)},h=function(s){var a,c,l;return $.fn.popover().closeAll(),p?(u.$modelValue.priority=s,void e.$apply()):(a=n().target(o.find(".level-name")).start(),l=function(){return t.$broadcast("object:updated"),a.finish()},c=function(){return r.notify("error"),a.finish()},i.save(function(t){return t.priority=s,t}).then(l,c))},o.on("click",".priority-data",function(t){if(t.preventDefault(),t.stopPropagation(),l())return o.find(".pop-priority").popover().open()}),o.on("click",".priority",function(t){var e;if(t.preventDefault(),t.stopPropagation(),l())return e=angular.element(t.currentTarget).data("priority-id"),h(e)}),e.$watch(function(){var t;return null!=(t=u.$modelValue)?t.priority:void 0},function(){var t;if(t=u.$modelValue)return d(t)}),e.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},l.directive("tgIssuePriorityButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",r]),t=function(t,e,r,n,i,o,s,a){return{link:function(r,c,u,l){var d,h,f;return d=[],f=null,r.$watch(u.ngModel,function(t){if(t)return t.milestone?(c.find(".assign-issue-button.button-unset").removeClass("is-active"),c.find(".assign-issue-button.button-set").addClass("is-active")):(c.find(".assign-issue-button.button-set").removeClass("is-active"),c.find(".assign-issue-button.button-unset").addClass("is-active"))}),c.on("click",".assign-issue-button.button-unset",function(t){return t.preventDefault(),t.stopPropagation(),i.instant("ISSUES.ACTION_ATTACH_SPRINT"),f=l.$modelValue,e.sprints.list(r.projectId,null).then(function(t){return r.milestones=t.milestones,r.selectedSprint=f.milestone,d=angular.copy(r.milestones),o.open(c.find(".lightbox-assign-sprint-to-issue"))})}),c.on("click",".assign-issue-button.button-set",function(n){return n.preventDefault(),n.stopPropagation(),f=l.$modelValue,e.sprints.list(r.projectId,null).then(function(e){var r,n,u;return r=_.find(e.milestones,{id:f.milestone}),u=i.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.TITLE"),n=i.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.MESSAGE",{sprintName:r.name}),a.ask(u,null,n).then(function(e){var r,n;return n=function(){return t.$broadcast("assign-sprint-to-issue:success",null),e.finish(),o.close(c)},r=function(){return e.finish(!1),a.notify("error")},s.save(function(t){return t.setAttr("milestone",null),t}).then(n,r)})})}),r.$on("$destroy",function(){return c.off()}),h=function(t,e){return e=p(e.toUpperCase()),t=p(t.toUpperCase()),_.includes(e,t)},r.filterMilestones=function(t){return r.milestones=d.filter(function(e){return h(t,e.name)})},r.saveIssueToSprint=function(e,r){var i;return i=n().target($(r.currentTarget)).start(),f.setAttr("milestone",e.id),s.save(function(t){return f.setAttr("milestone",e.id),t}).then(function(){return i.finish(),o.close(c.find(".lightbox-assign-sprint-to-issue")),t.$broadcast("assign-sprint-to-issue:success",e.id)})}},restrict:"EA",require:"ngModel",templateUrl:"issue/assign-sprint-to-issue-button.html"}},l.directive("tgAssignSprintToIssueButton",["$rootScope","$tgResources","$tgRepo","$tgLoading","$translate","lightboxService","$tgQueueModelTransformation","$tgConfirm",t])}.call(this),function(){var t,e;this.taiga,this.taiga.bindOnce,e=this.taiga.debounce,this.taiga.trim,t=function(t,r,n,i,o,s,a){return{link:function(t,c,u){var l,p,d;return l=null,t.$on("issueform:bulk",function(e,r,n,i){return l&&l.reset(),s.open(c),t.new={projectId:r,milestoneId:n,bulk:""}}),p=e(2e3,function(e){var u,p,h,f,g;if(e.preventDefault(),(l=c.find("form").checksley()).validate())return u=o().target(d).start(),p=t.new.bulk,f=t.new.projectId,h=t.new.milestoneId,(g=r.issues.bulkCreate(f,h,p)).then(function(t){return t=_.map(t.data,function(t){return a.make_model("issues",t)}),u.finish(),i.$broadcast("issueform:new:success",t),s.close(c),n.notify("success")}),g.then(null,function(){return u.finish(),n.notify("error")})}),d=c.find(".submit-button"),c.on("submit","form",p),t.$on("$destroy",function(){return c.off()})}}},angular.module("taigaIssues").directive("tgLbCreateBulkIssues",["$tgRepo","$tgResources","$tgConfirm","$rootScope","$tgLoading","lightboxService","$tgModel",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d=function(t,e){return function(){return t.apply(e,arguments)}},h={}.hasOwnProperty;l=this.taiga,a=this.taiga.mixOf,p=this.taiga.trim,this.taiga.toString,this.taiga.joinStr,s=this.taiga.groupBy,this.taiga.bindOnce,o=this.taiga.debounceLeading,u=this.taiga.startswith,i=this.taiga.bindMethods,o=this.taiga.debounceLeading,c=angular.module("taigaIssues"),r=function(t){function e(t,e,r,n,o,s,a,c,u,l,p,h,f,g,m,v,y,_){var b,S;(this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=o,this.urls=s,this.params=a,this.q=c,this.location=u,this.appMetaService=l,this.navUrls=p,this.events=h,this.analytics=f,this.translate=g,this.errorHandlingService=m,this.storage=v,this.filterRemoteStorageService=y,this.projectService=_,this.loadIssues=d(this.loadIssues,this),i(this),this.scope.sectionName=this.translate.instant("PROJECT.SECTION.ISSUES"),this.voting=!1,this.applyStoredFilters(this.params.pslug,this.filtersHashSuffix))||((b=this.loadInitialData()).then((S=this,function(){var t,e;return e=S.translate.instant("ISSUES.PAGE_TITLE",{projectName:S.scope.project.name}),t=S.translate.instant("ISSUES.PAGE_DESCRIPTION",{projectName:S.scope.project.name,projectDescription:S.scope.project.description}),S.appMetaService.setAll(e,t)})),b.then(null,this.onInitialDataError.bind(this)),this.scope.$on("issueform:new:success",function(t){return function(){return t.analytics.trackEvent("issue","create","create issue on issues list",1),t.loadIssues()}}(this)),this.scope.$on("assigned-to:changed",function(t){return function(){if(t.generateFilters(),t.isFilterDataTypeSelected("assigned_to")||t.isFilterDataTypeSelected("role")||t.isOrderedBy("assigned_to")||t.isOrderedBy("modified"))return t.loadIssues()}}(this)),this.scope.$on("status:changed",function(t){return function(){if(t.generateFilters(),t.isFilterDataTypeSelected("status")||t.isOrderedBy("status")||t.isOrderedBy("modified"))return t.loadIssues()}}(this)))}return function(t,e){for(var r in e)h.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,a(l.Controller,l.PageMixin,l.FiltersMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$tgUrls","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","tgErrorHandlingService","$tgStorage","tgFilterRemoteStorageService","tgProjectService","tgUserActivityService"],e.prototype.filtersHashSuffix="issues-filters",e.prototype.myFiltersHashSuffix="issues-my-filters",e.prototype.excludePrefix="exclude_",e.prototype.filterCategories=["tags","status","type","severity","priority","assigned_to","owner","role"],e.prototype.isOrderedBy=function(t){return new RegExp("-*"+t).test(this.location.search().order_by)},e.prototype.changeQ=function(t){return this.unselectFilter("page"),this.replaceFilter("q",t),this.loadIssues(),this.generateFilters()},e.prototype.removeFilter=function(t){return this.unselectFilter("page"),this.unselectFilter(t.dataType,t.id,!1,t.mode),this.loadIssues(),this.generateFilters()},e.prototype.addFilter=function(t){return this.unselectFilter("page"),this.selectFilter(t.category.dataType,t.filter.id,!1,t.mode),this.loadIssues(),this.generateFilters()},e.prototype.selectCustomFilter=function(t){var e;return(e=this.location.search().order_by)&&(t.filter.order_by=e),this.unselectFilter("page"),this.replaceAllFilters(t.filter),this.loadIssues(),this.generateFilters()},e.prototype.removeCustomFilter=function(t){return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.myFiltersHashSuffix).then((e=this,function(r){return delete r[t.id],e.filterRemoteStorageService.storeFilters(e.scope.projectId,r,e.myFiltersHashSuffix).then(e.generateFilters)}));var e},e.prototype.isFilterDataTypeSelected=function(t){var e,r,n;for(e=0,r=(n=this.selectedFilters).length;e<r;e++)if(n[e].dataType===t)return!0;return!1},e.prototype.saveCustomFilter=function(t){var e,r,n,i,o,s,a,c;for(r={},a=this.location.search(),n=0,o=(s=this.filterCategories).length;n<o;n++)i=s[n],e=this.excludePrefix.concat(i),r[i]=a[i],r[e]=a[e];return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.myFiltersHashSuffix).then((c=this,function(e){return e[t]=r,c.filterRemoteStorageService.storeFilters(c.scope.projectId,e,c.myFiltersHashSuffix).then(c.generateFilters)}))},e.prototype.generateFilters=function(){var t,e,r,n,i,o,s,a;for(this.storeFilters(this.params.pslug,this.location.search(),this.filtersHashSuffix),s=this.location.search(),(i={}).project=this.scope.projectId,i.q=s.q,e=0,n=(o=this.filterCategories).length;e<n;e++)r=o[e],t=this.excludePrefix.concat(r),i[r]=s[r],i[t]=s[t];return this.q.all([this.rs.issues.filtersData(i),this.filterRemoteStorageService.getFilters(this.scope.projectId,this.myFiltersHashSuffix)]).then((a=this,function(e){var n,o,s,c,u,l,p,d;for(o=e[0],n=e[1],(s={}).status=_.map(o.statuses,function(t){return t.id=t.id.toString(),t}),s.type=_.map(o.types,function(t){return t.id=t.id.toString(),t}),s.severity=_.map(o.severities,function(t){return t.id=t.id.toString(),t}),s.priority=_.map(o.priorities,function(t){return t.id=t.id.toString(),t}),s.tags=_.map(o.tags,function(t){return t.id=t.name,t}),d=_.filter(s.tags,function(t){return t.count>0}),s.assigned_to=_.map(o.assigned_to,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),s.owner=_.map(o.owners,function(t){return t.id=t.id.toString(),t.name=t.full_name,t}),s.role=_.map(o.roles,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.name||"Unassigned",t}),a.selectedFilters=[],c=0,u=(l=a.filterCategories).length;c<u;c++)r=l[c],t=a.excludePrefix.concat(r),i[r]&&(p=a.formatSelectedFilters(r,s[r],i[r]),a.selectedFilters=a.selectedFilters.concat(p)),i[t]&&(p=a.formatSelectedFilters(r,s[r],i[t],"exclude"),a.selectedFilters=a.selectedFilters.concat(p));return a.filterQ=i.q,a.filters=[{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.TYPE"),dataType:"type",content:s.type},{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.SEVERITY"),dataType:"severity",content:s.severity},{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.PRIORITIES"),dataType:"priority",content:s.priority},{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.STATUS"),dataType:"status",content:s.status},{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.TAGS"),dataType:"tags",content:s.tags,hideEmpty:!0,totalTaggedElements:d.length},{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.ASSIGNED_TO"),dataType:"assigned_to",content:s.assigned_to},{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.ROLE"),dataType:"role",content:s.role},{title:a.translate.instant("COMMON.FILTERS.CATEGORIES.CREATED_BY"),dataType:"owner",content:s.owner}],a.customFilters=[],_.forOwn(n,function(t,e){return a.customFilters.push({id:e,name:e,filter:t})})}))},e.prototype.initializeSubscription=function(){var t,e;return t="changes.project."+this.scope.projectId+".issues",this.events.subscribe(this.scope,t,o(500,(e=this,function(t){return e.loadIssues()})))},e.prototype.loadProject=function(){var t;return(t=this.projectService.project.toJS()).is_issues_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.issueStatusById=s(t.issue_statuses,function(t){return t.id}),this.scope.issueStatusList=_.sortBy(t.issue_statuses,"order"),this.scope.severityById=s(t.severities,function(t){return t.id}),this.scope.severityList=_.sortBy(t.severities,"order"),this.scope.priorityById=s(t.priorities,function(t){return t.id}),this.scope.priorityList=_.sortBy(t.priorities,"order"),this.scope.issueTypes=_.sortBy(t.issue_types,"order"),this.scope.issueTypeById=s(t.issue_types,function(t){return t.id}),t},e.prototype.loadIssuesRequests=0,e.prototype.loadIssues=function(){var t,e,r;return t=this.location.search(),e=this.rs.issues.list(this.scope.projectId,t),this.loadIssuesRequests+=1,e.index=this.loadIssuesRequests,e.then((r=this,function(t){return e.index===r.loadIssuesRequests&&(r.scope.issues=t.models,r.scope.page=t.current,r.scope.count=t.count,r.scope.paginatedBy=t.paginatedBy),t})),e},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),this.fillUsersAndRoles(t.members,t.roles),this.initializeSubscription(),this.generateFilters(),this.loadIssues()},e.prototype.addNewIssue=function(){var t;return t=this.projectService.project.toJS(),this.rootscope.$broadcast("genericform:new",{objType:"issue",project:t})},e.prototype.addIssuesInBulk=function(){return this.rootscope.$broadcast("issueform:bulk",this.scope.projectId)},e.prototype.upVoteIssue=function(t){var e,r,n;return this.voting=t,n=this,r=function(){return n.loadIssues(),n.voting=null},e=function(t){return function(){return t.confirm.notify("error"),t.voting=null}}(this),this.rs.issues.upvote(t).then(r,e)},e.prototype.downVoteIssue=function(t){var e,r,n;return this.voting=t,n=this,r=function(){return n.loadIssues(),n.voting=null},e=function(t){return function(){return t.confirm.notify("error"),t.voting=null}}(this),this.rs.issues.downvote(t).then(r,e)},e.prototype.getOrderBy=function(){return _.isString(this.location.search().order_by)?this.location.search().order_by:"created_date"},e}(),c.controller("IssuesController",r),n=function(t,e,r,n){var i,o,s;return s=r.get("issue/issue-paginator.html",!0),o=function(t,e,r,i){var o,a,c;return 2,4,2,2,o=e.find(".issues-paginator"),a=function(){var e;return e=t.count/t.paginatedBy,e=parseInt(e,10)<e?parseInt(e,10)+1:parseInt(e,10)},c=function(){var e,r,i,c,u,l,p,d;if(!((u=a())<=1)){for(o.show(),(l={}).pages=p=[],l.showPrevious=t.page>1,l.showNext=!(t.page===u),e=t.page,i=c=1,d=u;1<=d?c<=d:c>=d;i=1<=d?++c:--c)i===e+2&&u>e+2+2?p.push({classes:"dots",type:"dots"}):i===e-4&&e>6?p.push({classes:"dots",type:"dots"}):i>e+2&&i<=u-2||i<e-4&&i>2||(i===e?p.push({classes:"active",num:i,type:"page-active"}):p.push({classes:"page",num:i,type:"page"}));return r=s(l),r=n(r)(t),o.html(r)}o.hide()},t.$watch("issues",function(t){if(t)return c()}),e.on("click",".issues-paginator a.next",function(e){return e.preventDefault(),t.$apply(function(){return i.selectFilter("page",t.page+1),i.loadIssues()})}),e.on("click",".issues-paginator a.previous",function(e){return e.preventDefault(),t.$apply(function(){return i.selectFilter("page",t.page-1),i.loadIssues()})}),e.on("click",".issues-paginator li.page > a",function(e){var r,n;return e.preventDefault(),n=angular.element(e.currentTarget),r=n.data("pagenum"),t.$apply(function(){return i.selectFilter("page",r),i.loadIssues()})})},i=function(t,r,i,o){var s,a,c,l;return(a=o.getOrderBy())&&(c=u(a,"-")?"icon-arrow-up":"icon-arrow-down",s=r.find(".row.title > div[data-fieldname='"+p(a,"-")+"']"),l=$("<tg-svg>").attr("svg-icon",c),s.append(l),n(s.contents())(t)),r.on("click",".row.title > div",function(i){var s,p,d;return d=angular.element(i.currentTarget),a=o.getOrderBy(),"total_voters"===(p=d.data("fieldname"))&&"-total_voters"!==a&&(a="total_voters"),s=a===p?"-"+p:p,t.$apply(function(){return o.replaceFilter("order_by",s),o.storeFilters(o.params.pslug,e.search(),o.filtersHashSuffix),o.loadIssues().then(function(){return r.find(".row.title > div > tg-svg").remove(),c=u(s,"-")?"icon-arrow-up":"icon-arrow-down",l=$("<tg-svg>").attr("svg-icon",c),d.append(l),n(d.contents())(t)})})})},{link:function(t,e,r){var n;return n=e.controller(),i(t,e,0,n),o(t,e,0,n),t.$on("$destroy",function(){return e.off()})}}},c.directive("tgIssues",["$log","$tgLocation","$tgTemplate","$compile",n]),e=function(t,e,r){var n,i;return n=e.get("issue/issue-status-inline-edition-selection.html",!0),i=function(t,e,r){var n,i,o;if(i=t.find(".issue-status"),n=t.find(".issue-status .issue-status-bind"),o=r[e.status])return n.text(o.name),n.prop("title",o.name),i.css("color",o.color)},{link:function(e,o,s){var a;return o.controller(),a=e.$eval(s.tgIssueStatusInlineEdition),o.on("click",".issue-status",function(t){return t.preventDefault(),t.stopPropagation(),o.find(".pop-status").popover().open()}),o.on("click",".status",function(n){var s;return n.preventDefault(),n.stopPropagation(),s=angular.element(n.currentTarget),a.status=s.data("status-id"),o.find(".pop-status").popover().close(),i(o,a,e.issueStatusById),e.$apply(function(){return t.save(a).then(function(t){return r.$broadcast("status:changed",t)})})}),l.bindOnce(e,"project",function(t){if(o.append(n({statuses:t.issue_statuses})),i(o,a,e.issueStatusById),-1===t.my_permissions.indexOf("modify_issue"))return o.unbind("click"),o.find("a").addClass("not-clickable")}),e.$watch(s.tgIssueStatusInlineEdition,function(t){return i(o,t,e.issueStatusById)}),e.$on("$destroy",function(){return o.off()})}}},c.directive("tgIssueStatusInlineEdition",["$tgRepo","$tgTemplate","$rootScope",e]),t=function(t,e,r,n){var i;return i=_.template('<img style="background-color: <%- bg %>" src="<%- imgurl %>" alt="<%- name %>"/>\n<figcaption><%- name %></figcaption>'),{link:function(o,s,a){var c,u;return u=function(t){var e,a,c;return a={name:r.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png"},c=o.usersById[t.assigned_to],e=n.getAvatar(c),a.imgurl=e.url,a.bg=null,c&&(a.name=c.full_name_display,a.bg=e.bg),s.find(".avatar").html(i(a)),s.find(".issue-assignedto").attr("title",a.name)},s.controller(),c=o.$eval(a.tgIssueAssignedToInlineEdition),u(c),s.on("click",".issue-assignedto",function(t){return e.$broadcast("assigned-to:add",c)}),l.bindOnce(o,"project",function(t){if(-1===t.my_permissions.indexOf("modify_issue"))return s.unbind("click"),s.find("a").addClass("not-clickable")}),o.$on("assigned-to:added",function(r,n,i){if(i.id===c.id)return i.assigned_to=n,t.save(c).then(function(){return u(i),e.$broadcast("assigned-to:changed",i)})}),o.$watch(a.tgIssueAssignedToInlineEdition,function(t){return u(t)}),o.$on("$destroy",function(){return s.off()})}}},c.directive("tgIssueAssignedToInlineEdition",["$tgRepo","$rootScope","$translate","tgAvatarService",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l={}.hasOwnProperty;u=this.taiga,a=this.taiga.mixOf,s=this.taiga.groupBy,this.taiga.bindOnce,o=this.taiga.bindMethods,c=angular.module("taigaUserStories"),i=function(t){function e(t,e,r,n,i,s,a,c,u,l,p,d,h,f,g,m,v,y){var _,b;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=s,this.q=a,this.location=c,this.log=u,this.appMetaService=l,this.navUrls=p,this.analytics=d,this.translate=h,this.modelTransform=f,this.errorHandlingService=g,this.configService=m,this.projectService=v,this.wysiwigService=y,o(this),this.scope.usRef=this.params.usref,this.scope.sectionName=this.translate.instant("US.SECTION_NAME"),this.scope.tribeEnabled=this.configService.config.tribeHost,this.initializeEventHandlers(),(_=this.loadInitialData()).then((b=this,function(){return b._setMeta(),b.initializeOnDeleteGoToUrl()})),_.then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)l.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,a(u.Controller,u.PageMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate","$tgQueueModelTransformation","tgErrorHandlingService","$tgConfig","tgProjectService","tgWysiwygService"],e.prototype._setMeta=function(){var t,e,r,n,i,o,s;return o=this.scope.tasks.length,t=_.filter(this.scope.tasks,(s=this,function(t){return s.scope.taskStatusById[t.status].is_closed})).length,r=o>0?Math.round(100*t/o):0,i=this.translate.instant("US.PAGE_TITLE",{userStoryRef:"#"+this.scope.us.ref,userStorySubject:this.scope.us.subject,projectName:this.scope.project.name}),e=this.translate.instant("US.PAGE_DESCRIPTION",{userStoryStatus:(null!=(n=this.scope.statusById[this.scope.us.status])?n.name:void 0)||"--",userStoryPoints:this.scope.us.total_points,userStoryDescription:angular.element(this.wysiwigService.getHTML(this.scope.us.description)||"").text(),userStoryClosedTasks:t,userStoryTotalTasks:o,userStoryProgressPercentage:r}),this.appMetaService.setAll(i,e)},e.prototype.initializeEventHandlers=function(){var t;return this.scope.$on("related-tasks:update",(t=this,function(){var e;if(t.loadTasks(),t.scope.tasks=_.clone(t.scope.tasks,!1),e=_.every(t.scope.tasks,function(t){return t.is_closed}),t.scope.us.is_closed!==e)return t.loadUs()})),this.scope.$on("attachment:create",function(t){return function(){return t.analytics.trackEvent("attachment","create","create attachment on userstory",1)}}(this)),this.scope.$on("task:reorder",function(t){return function(e,r,n){return t.reorderTask(r,n)}}(this)),this.scope.$on("comment:new",function(t){return function(){return t.loadUs()}}(this))},e.prototype.initializeOnDeleteGoToUrl=function(){var t;return t={project:this.scope.project.slug},this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t),this.scope.project.is_backlog_activated?this.scope.us.milestone?(t.sprint=this.scope.sprint.slug,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-taskboard",t)):this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-backlog",t):this.scope.project.is_kanban_activated?this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-kanban",t):void 0},e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.statusList=t.us_statuses,this.scope.statusById=s(t.us_statuses,function(t){return t.id}),this.scope.taskStatusById=s(t.task_statuses,function(t){return t.id}),this.scope.pointsList=_.sortBy(t.points,"order"),this.scope.pointsById=s(this.scope.pointsList,function(t){return t.id}),t},e.prototype.loadUs=function(){var t,e,r,n;return(r=(t=_.pick(this.location.search(),"milestone","no-milestone","kanban-status")).milestone)&&this.rs.userstories.storeQueryParams(this.scope.projectId,{milestone:r,order_by:"sprint_order"}),t["no-milestone"]&&this.rs.userstories.storeQueryParams(this.scope.projectId,{milestone:"null",order_by:"backlog_order"}),(e=t["kanban-status"])&&this.rs.userstories.storeQueryParams(this.scope.projectId,{status:e,order_by:"kanban_order"}),this.rs.userstories.getByRef(this.scope.projectId,this.params.usref).then((n=this,function(t){return n.scope.us=t,n.scope.usId=t.id,n.scope.commentModel=t,n.modelTransform.setObject(n.scope,"us"),t}))},e.prototype.loadSprint=function(){if(this.scope.us.milestone)return this.rs.sprints.get(this.scope.us.project,this.scope.us.milestone).then((t=this,function(e){return t.scope.sprint=e,e}));var t},e.prototype.loadTasks=function(){return this.rs.tasks.list(this.scope.projectId,null,this.scope.usId).then((t=this,function(e){return t.scope.tasks=e,e}));var t},e.prototype.loadInitialData=function(){var t,e;return t=this.loadProject(),this.fillUsersAndRoles(t.members,t.roles),this.loadUs().then((e=this,function(){return e.q.all([e.loadSprint(),e.loadTasks()])}))},e.prototype.onUpvote=function(){var t,e,r;return r=this,e=function(){return r.loadUs(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.userstories.upvote(this.scope.usId).then(e,t)},e.prototype.onDownvote=function(){var t,e,r;return r=this,e=function(){return r.loadUs(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.userstories.downvote(this.scope.usId).then(e,t)},e.prototype.onWatch=function(){var t,e,r;return r=this,e=function(){return r.loadUs(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.userstories.watch(this.scope.usId).then(e,t)},e.prototype.onUnwatch=function(){var t,e,r;return r=this,e=function(){return r.loadUs(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.userstories.unwatch(this.scope.usId).then(e,t)},e.prototype.onTribeInfo=function(){var t,e,r,n;return r=this.translate.instant("US.TRIBE.PUBLISH_MORE_INFO_TITLE"),t=$("<img />").attr({src:"/"+window._version+"/images/monster-fight.png",alt:this.translate.instant("US.TRIBE.PUBLISH_MORE_INFO_TITLE")}),n=this.translate.instant("US.TRIBE.PUBLISH_MORE_INFO_TEXT"),e=$("<div></div>").append(t).append(n),this.confirm.success(r,e)},e.prototype.reorderTask=function(t,e){var r,n,i,o,s,a,c,u,l,p;return s={},this.scope.tasks.forEach(function(t){return s[t.id]=t.us_order}),n=(l=this.scope.tasks.filter(function(e){return e.id!==t.id})).slice(0,e),r=l.slice(e),o=(a=n[n.length-1])?a.us_order+1:0,s[t.id]=o,c=n.filter(function(t){return t.us_order===a.us_order}),u=_.fromPairs(c.map(function(t){return[t.id,t.us_order]})),r.forEach(function(t){return s[t.id]=t.us_order+1}),this.scope.tasks=_.map(this.scope.tasks,function(t){return t.us_order=s[t.id],t}),this.scope.tasks=_.sortBy(this.scope.tasks,"us_order"),i={us_order:o,version:t.version},this.rs.tasks.reorder(t.id,i,u).then((p=this,function(t){return p.scope.tasks=_.map(p.scope.tasks,function(e){return e.id===t.id?t:e}),p.rootscope.$broadcast("related-tasks:reordered")}))},e}(),c.controller("UserStoryDetailController",i),r=function(t,e){var r;return r=t.get("common/components/status-display.html",!0),{link:function(t,n,i){var o;return o=function(i){var o,s;return s=t.statusById[i.status],o=r({is_closed:i.is_closed,status:s}),o=e(o)(t),n.html(o)},t.$watch(i.ngModel,function(t){if(null!=t)return o(t)}),t.$on("$destroy",function(){return n.off()})},restrict:"EA",require:"ngModel"}},c.directive("tgUsStatusDisplay",["$tgTemplate","$compile",r]),e=function(t,e,r,n,i,o,s){var a;return a=o.get("common/components/status-button.html",!0),{link:function(e,o,c,u){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_us")},p=function(t){var r,n;return n=e.statusById[t.status],r=a({status:n,statuses:e.statusList,editable:l()}),o.html(r),s(o.contents())(e)},d=function(e){var s,a,c;return o.find(".pop-status").popover().close(),s=n().target(o.find(".js-edit-status")).start(),c=function(){return t.$broadcast("object:updated"),s.finish()},a=function(){return r.notify("error"),s.finish()},i.save(function(t){return t.status=e,t}).then(c,a)},o.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),l())return o.find(".pop-status").popover().open()}),o.on("click",".status",function(t){var e;if(t.preventDefault(),t.stopPropagation(),l())return e=angular.element(t.currentTarget).data("status-id"),d(e)}),e.$watch(function(){var t;return null!=(t=u.$modelValue)?t.status:void 0},function(){var t;if(t=u.$modelValue)return p(t)}),e.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},c.directive("tgUsStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",e]),n=function(t,e,r,n,i,o,s){var a;return a=o.get("us/us-team-requirement-button.html",!0),{link:function(e,o,c,u){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_us")},p=function(t){var r,n;return r={canEdit:l(),isRequired:t.team_requirement},n=a(r),n=s(n)(e),o.html(n)},d=function(e){var s,a;return s=n().target(o.find("label")).start(),(a=i.save(function(t){return t.team_requirement=e,t})).then(function(){return s.finish(),t.$broadcast("object:updated")}),a.then(null,function(){return s.finish(),r.notify("error")})},o.on("click",".team-requirement",function(t){var e;if(l())return e=!u.$modelValue.team_requirement,d(e)}),e.$watch(function(){var t;return null!=(t=u.$modelValue)?t.team_requirement:void 0},function(){var t;if(t=u.$modelValue)return p(t)}),e.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},c.directive("tgUsTeamRequirementButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),t=function(t,e,r,n,i,o,s){var a;return a=o.get("us/us-client-requirement-button.html",!0),{link:function(e,o,c,u){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_us")},p=function(t){var r,n;return r={canEdit:l(),isRequired:t.client_requirement},n=s(a(r))(e),o.html(n)},d=function(e){var s,a;return s=n().target(o.find("label")).start(),(a=i.save(function(t){return t.client_requirement=e,t})).then(function(){return s.finish(),t.$broadcast("object:updated")}),a.then(null,function(){return r.notify("error")})},o.on("click",".client-requirement",function(t){var e;if(l())return e=!u.$modelValue.client_requirement,d(e)}),e.$watch(function(){var t;return null!=(t=u.$modelValue)?t.client_requirement:void 0},function(){var t;if(t=u.$modelValue)return p(t)}),e.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},c.directive("tgUsClientRequirementButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u={}.hasOwnProperty;c=this.taiga,s=this.taiga.mixOf,o=this.taiga.groupBy,i=this.taiga.bindMethods,a=angular.module("taigaTasks"),t=function(t){function e(t,e,r,n,o,s,a,c,u,l,p,d,h,f,g,m){var v,y;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=o,this.params=s,this.q=a,this.location=c,this.log=u,this.appMetaService=l,this.navUrls=p,this.analytics=d,this.translate=h,this.modelTransform=f,this.errorHandlingService=g,this.projectService=m,i(this),this.scope.taskRef=this.params.taskref,this.scope.sectionName=this.translate.instant("TASK.SECTION_NAME"),this.initializeEventHandlers(),(v=this.loadInitialData()).then((y=this,function(){return y._setMeta(),y.initializeOnDeleteGoToUrl()})),v.then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)u.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,s(c.Controller,c.PageMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate","$tgQueueModelTransformation","tgErrorHandlingService","tgProjectService"],e.prototype._setMeta=function(){var t,e,r;return r=this.translate.instant("TASK.PAGE_TITLE",{taskRef:"#"+this.scope.task.ref,taskSubject:this.scope.task.subject,projectName:this.scope.project.name}),t=this.translate.instant("TASK.PAGE_DESCRIPTION",{taskStatus:(null!=(e=this.scope.statusById[this.scope.task.status])?e.name:void 0)||"--",taskDescription:angular.element(this.scope.task.description_html||"").text()}),this.appMetaService.setAll(r,t)},e.prototype.initializeEventHandlers=function(){var t;return this.scope.$on("promote-task-to-us:success",(t=this,function(){return t.analytics.trackEvent("task","promoteToUserstory","promote task to userstory",1),t.rootscope.$broadcast("object:updated"),t.loadTask()})),this.scope.$on("attachment:create",function(t){return function(){return t.analytics.trackEvent("attachment","create","create attachment on task",1)}}(this)),this.scope.$on("custom-attributes-values:edit",function(t){return function(){return t.rootscope.$broadcast("object:updated")}}(this)),this.scope.$on("comment:new",function(t){return function(){return t.loadTask()}}(this))},e.prototype.initializeOnDeleteGoToUrl=function(){var t;if(t={project:this.scope.project.slug},this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t),this.scope.project.is_backlog_activated){if(this.scope.task.milestone)return t.sprint=this.scope.sprint.slug,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-taskboard",t);if(this.scope.task.us)return t.ref=this.scope.us.ref,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-userstories-detail",t)}else if(this.scope.project.is_kanban_activated&&this.scope.us)return t.ref=this.scope.us.ref,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-userstories-detail",t)},e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.statusList=t.task_statuses,this.scope.statusById=o(t.task_statuses,function(t){return t.id}),t},e.prototype.loadTask=function(){return this.rs.tasks.getByRef(this.scope.projectId,this.params.taskref).then((t=this,function(e){var r,n,i;return t.scope.task=e,t.scope.taskId=e.id,t.scope.commentModel=e,t.modelTransform.setObject(t.scope,"task"),null!=(null!=(n=t.scope.task.neighbors.previous)?n.ref:void 0)&&(r={project:t.scope.project.slug,ref:t.scope.task.neighbors.previous.ref},t.scope.previousUrl=t.navUrls.resolve("project-tasks-detail",r)),null!=(null!=(i=t.scope.task.neighbors.next)?i.ref:void 0)&&(r={project:t.scope.project.slug,ref:t.scope.task.neighbors.next.ref},t.scope.nextUrl=t.navUrls.resolve("project-tasks-detail",r)),e}));var t},e.prototype.loadSprint=function(){if(this.scope.task.milestone)return this.rs.sprints.get(this.scope.task.project,this.scope.task.milestone).then((t=this,function(e){return t.scope.sprint=e,e}));var t},e.prototype.loadUserStory=function(){if(this.scope.task.user_story)return this.rs.userstories.get(this.scope.task.project,this.scope.task.user_story).then((t=this,function(e){return t.scope.us=e,e}));var t},e.prototype.loadInitialData=function(){var t,e;return t=this.loadProject(),this.fillUsersAndRoles(t.members,t.roles),this.loadTask().then((e=this,function(){return e.q.all([e.loadSprint(),e.loadUserStory()])}))},e.prototype.onUpvote=function(){var t,e,r;return r=this,e=function(){return r.loadTask(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.tasks.upvote(this.scope.taskId).then(e,t)},e.prototype.onDownvote=function(){var t,e,r;return r=this,e=function(){return r.loadTask(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.tasks.downvote(this.scope.taskId).then(e,t)},e.prototype.onWatch=function(){var t,e,r;return r=this,e=function(){return r.loadTask(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.tasks.watch(this.scope.taskId).then(e,t)},e.prototype.onUnwatch=function(){var t,e,r;return r=this,e=function(){return r.loadTask(),r.rootscope.$broadcast("object:updated")},t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.tasks.unwatch(this.scope.taskId).then(e,t)},e}(),a.controller("TaskDetailController",t),n=function(t,e){var r;return r=t.get("common/components/status-display.html",!0),{link:function(t,n,i){var o;return o=function(i){var o,s;return s=t.statusById[i.status],o=r({is_closed:s.is_closed,status:s}),o=e(o)(t),n.html(o)},t.$watch(i.ngModel,function(t){if(null!=t)return o(t)}),t.$on("$destroy",function(){return n.off()})},restrict:"EA",require:"ngModel"}},a.directive("tgTaskStatusDisplay",["$tgTemplate","$compile",n]),r=function(t,e,r,n,i,o,s,a){var c;return c=a.get("common/components/status-button.html",!0),{link:function(e,s,a,u){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_task")},p=function(t){var r,n;return n=e.statusById[t.status],r=o(c({status:n,statuses:e.statusList,editable:l()}))(e),s.html(r)},d=function(e){var o,a,c;return o=n().target(s).start(),c=function(){return t.$broadcast("object:updated"),o.finish()},a=function(){return r.notify("error"),o.finish()},i.save(function(t){return t.status=e,t}).then(c,a)},s.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),l())return s.find(".pop-status").popover().open()}),s.on("click",".status",function(t){var e;if(t.preventDefault(),t.stopPropagation(),l())return e=angular.element(t.currentTarget),$.fn.popover().closeAll(),d(e.data("status-id"))}),e.$watch(function(){var t;return null!=(t=u.$modelValue)?t.status:void 0},function(){var t;if(t=u.$modelValue)return p(t)}),e.$on("$destroy",function(){return s.off()})},restrict:"EA",require:"ngModel"}},a.directive("tgTaskStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$compile","$translate","$tgTemplate",r]),e=function(t,e,r,n,i,o,s){var a;return a=s.get("issue/iocaine-button.html",!0),{link:function(e,s,c,u){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_task")},p=function(t){var r,n;if(l()||t.is_iocaine)return r={isIocaine:t.is_iocaine,isEditable:l()},n=o(a(r))(e),s.html(n);s.html("")},d=function(e){var o,a;return o=n().target(s.find("label")).start(),(a=i.save(function(t){return t.is_iocaine=e,t})).then(function(){return t.$broadcast("object:updated")}),a.then(null,function(){return r.notify("error")}),a.finally(function(){return o.finish()})},s.on("click",".is-iocaine",function(t){var e;if(l())return e=!u.$modelValue.is_iocaine,d(e)}),e.$watch(function(){var t;return null!=(t=u.$modelValue)?t.is_iocaine:void 0},function(){var t;if(t=u.$modelValue)return p(t)}),e.$on("$destroy",function(){return s.off()})},restrict:"EA",require:"ngModel"}},a.directive("tgTaskIsIocaineButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$compile","$tgTemplate",e])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l={}.hasOwnProperty;u=this.taiga,a=this.taiga.mixOf,c=angular.module("taigaTeam"),e=function(t){function e(t,e,r,n,i,o,s,a,c,u,l,p,d){var h,f;this.scope=t,this.rootscope=e,this.repo=r,this.rs=n,this.params=i,this.q=o,this.location=s,this.navUrls=a,this.appMetaService=c,this.auth=u,this.translate=l,this.projectService=p,this.errorHandlingService=d,this.scope.sectionName="TEAM.SECTION_NAME",(h=this.loadInitialData()).then((f=this,function(){var t,e;return e=f.translate.instant("TEAM.PAGE_TITLE",{projectName:f.scope.project.name}),t=f.translate.instant("TEAM.PAGE_DESCRIPTION",{projectName:f.scope.project.name,projectDescription:f.scope.project.description}),f.appMetaService.setAll(e,t)})),h.then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)l.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,a(u.Controller,u.PageMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$routeParams","$q","$location","$tgNavUrls","tgAppMetaService","$tgAuth","$translate","tgProjectService","tgErrorHandlingService"],e.prototype.setRole=function(t){return this.scope.filtersRole=t||null},e.prototype.loadMembers=function(){var t,e,r,n,i;for(i=this.auth.getUser(),this.scope.totals={},t=0,e=(n=this.scope.activeUsers).length;t<e;t++)r=n[t],this.scope.totals[r.id]=0;return this.scope.currentUser=_.find(this.scope.activeUsers,{id:null!=i?i.id:void 0}),this.scope.memberships=_.reject(this.scope.activeUsers,{id:null!=i?i.id:void 0})},e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.issuesEnabled=t.is_issues_activated,this.scope.tasksEnabled=t.is_kanban_activated||t.is_backlog_activated,this.scope.wikiEnabled=t.is_wiki_activated,this.scope.owner=t.owner.id,t},e.prototype.loadMemberStats=function(){return this.rs.projects.memberStats(this.scope.projectId).then((t=this,function(e){return _.forEach(t.scope.totals,function(r,n){var i;return i=_.map(e,function(t,e){return t[n]}),r=_.reduce(i,function(t,e){return t+e}),t.scope.totals[n]=r}),t.scope.stats=t._processStats(e),t.scope.stats.totals=t.scope.totals}));var t},e.prototype._processStat=function(t){var e,r,n,i,o;for(e in r=_.max(_.toArray(t)),n=_.min(_.toArray(t)),i=Object(),t)l.call(t,e)&&(o=t[e],i[e]=o===n?.1:o===r?1:.5*o/r);return i},e.prototype._processStats=function(t){var e,r;for(e in t)r=t[e],t[e]=this._processStat(r);return t},e.prototype.loadInitialData=function(){var t,e;return t=this.loadProject(),this.fillUsersAndRoles(t.members,t.roles),this.loadMembers(),e=_.map(this.scope.users,function(t){return t.role}),this.scope.roles=_.filter(this.scope.roles,function(t){return-1!==e.indexOf(t.id)}),this.loadMemberStats()},e}(),c.controller("TeamController",e),r=function(){return{templateUrl:"team/team-filter.html"}},c.directive("tgTeamFilters",[r]),i=function(){return{templateUrl:"team/team-member-stats.html",scope:{stats:"=",userId:"=user",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled"}}},c.directive("tgTeamMemberStats",i),n=function(){return{templateUrl:"team/team-member-current-user.html",scope:{project:"=project",currentUser:"=currentuser",stats:"=",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled",owner:"=owner"}}},c.directive("tgTeamCurrentUser",n),o=function(){return"team/team-members.html",{templateUrl:"team/team-members.html",scope:{memberships:"=",filtersQ:"=filtersq",filtersRole:"=filtersrole",stats:"=",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled",owner:"=owner"}}},c.directive("tgTeamMembers",o),t=function(t,e,r,n,i,o,s,a){return{scope:{user:"=",project:"="},templateUrl:"team/leave-project.html",link:function(t,c,u){var l;return l=function(){var s,c;return c=o.instant("TEAM.ACTION_LEAVE_PROJECT"),s=o.instant("TEAM.CONFIRM_LEAVE_PROJECT"),e.ask(c,s).then(function(o){var s;return(s=n.projects.leave(t.project.id)).then(function(){return a.loadProjects().then(function(){return o.finish(),e.notify("success"),r.path(i.resolve("home"))})}),s.then(null,function(t){return t.finish(),e.notify("error",t.data._error_message)})})},t.leave=function(){return t.project.owner.id===t.user.id?s.create("tg-lightbox-leave-project-warning",{class:"lightbox lightbox-leave-project-warning"},{isCurrentUser:!0,project:t.project}):l()}}}},c.directive("tgLeaveProject",["$tgRepo","$tgConfirm","$tgLocation","$tgResources","$tgNavUrls","$translate","tgLightboxFactory","tgCurrentUserService",t]),s=function(){return function(t,e,r){return _.filter(t,function(t){return(!r||t.role===r.id)&&(!e||t.full_name.search(new RegExp(e,"i"))>=0)})}},c.filter("membersFilter",s)}.call(this),function(){var t,e,r,n,i,o,s=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty;o=this.taiga,n=this.taiga.mixOf,this.taiga.groupBy,this.taiga.bindOnce,this.taiga.debounce,i=angular.module("taigaWiki"),t=function(t){function e(t,e,r,n,i,o,a,c,u,l,p,d,h,f,g,m,v){var y,_;this.scope=t,this.rootscope=e,this.repo=r,this.model=n,this.confirm=i,this.rs=o,this.params=a,this.q=c,this.location=u,this.filter=l,this.log=p,this.appMetaService=d,this.navUrls=h,this.analytics=f,this.translate=g,this.errorHandlingService=m,this.projectService=v,this.moveLink=s(this.moveLink,this),this.loadWiki=s(this.loadWiki,this),this.scope.$on("wiki:links:move",this.moveLink),this.scope.$on("wikipage:add",this.loadWiki),this.scope.projectSlug=this.params.pslug,this.scope.wikiSlug=this.params.slug,this.scope.sectionName="Wiki",this.scope.linksVisible=!1,(y=this.loadInitialData()).then((_=this,function(){return _._setMeta()})),y.then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)a.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,n(o.Controller,o.PageMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgModel","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$filter","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate","tgErrorHandlingService","tgProjectService"],e.prototype._setMeta=function(){var t,e,r,n,i;return i=this.translate.instant("WIKI.PAGE_TITLE",{wikiPageName:this.scope.wikiSlug,projectName:this.scope.project.name}),t=this.translate.instant("WIKI.PAGE_DESCRIPTION",{wikiPageContent:angular.element((null!=(e=this.scope.wiki)?e.html:void 0)||"").text(),totalEditions:(null!=(r=this.scope.wiki)?r.editions:void 0)||0,lastModifiedDate:moment(null!=(n=this.scope.wiki)?n.modified_date:void 0).format(this.translate.instant("WIKI.DATETIME"))}),this.appMetaService.setAll(i,t)},e.prototype.loadProject=function(){var t;return(t=this.projectService.project.toJS()).is_wiki_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},e.prototype.loadWiki=function(){var t,e;return(t=this.rs.wiki.getBySlug(this.scope.projectId,this.params.slug)).then((e=this,function(t){return e.scope.wiki=t,e.scope.wikiId=t.id,e.scope.wiki})),t.then(null,function(t){return function(e){var r;return t.scope.wikiId=null,-1===t.scope.project.my_permissions.indexOf("add_wiki_page")?null:(r={project:t.scope.projectId,slug:t.scope.wikiSlug,content:""},t.scope.wiki=t.model.make_model("wiki",r),t.scope.wiki)}}(this))},e.prototype.loadWikiLinks=function(){return this.rs.wiki.listLinks(this.scope.projectId).then((t=this,function(e){var r,n,i,o;for(t.scope.wikiLinks=e,r=0,n=(o=t.scope.wikiLinks).length;r<n;r++)(i=o[r]).url=t.navUrls.resolve("project-wiki-page",{project:t.scope.projectSlug,slug:i.href});return _.find(e,{href:t.scope.wikiSlug})}));var t},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),this.fillUsersAndRoles(t.members,t.roles),this.q.all([this.loadWikiLinks(),this.loadWiki()]).then(this.checkLinksPerms.bind(this))},e.prototype.checkLinksPerms=function(){if(-1!==this.scope.project.my_permissions.indexOf("add_wiki_link")||-1!==this.scope.project.my_permissions.indexOf("view_wiki_links")&&this.scope.wikiLinks.length)return this.scope.linksVisible=!0},e.prototype.delete=function(){var t,e,r;return e=this.translate.instant("WIKI.DELETE_LIGHTBOX_TITLE"),t=this.scope.wikiSlug,this.confirm.askOnDelete(e,t).then((r=this,function(t){var e,n;return n=function(){var e;return t.finish(),e={project:r.scope.projectSlug},r.location.path(r.navUrls.resolve("project-wiki",e)),r.confirm.notify("success"),r.loadWiki()},e=function(){return t.finish(!1),r.confirm.notify("error")},r.repo.remove(r.scope.wiki).then(n,e)}))},e.prototype.moveLink=function(t,e,r){var n,i;return n=(i=this.scope.wikiLinks).indexOf(e),i.splice(n,1),i.splice(r,0,e),_.each(i,function(t,e){return t.order=e}),this.repo.saveAll(i)},e}(),i.controller("WikiDetailController",t),e=function(t,e,r,n,i){var o;return o=e.get("wiki/wiki-summary.html",!0),{link:function(e,s,a,c){var u;return u=function(a){var c,u,l,p;return null==e.usersById?t.error("WikiSummaryDirective requires userById set in scope."):p=e.usersById[a.last_modifier],c=i.getAvatar(p),p=void 0===p?{name:"unknown",avatar:c}:{name:p.full_name_display,avatar:c},u={totalEditions:a.editions,lastModifiedDate:moment(a.modified_date).format(n.instant("WIKI.DATETIME")),user:p},l=o(u),l=r(l)(e),s.html(l)},e.$watch(a.ngModel,function(t){if(t)return u(t)}),e.$on("$destroy",function(){return s.off()})},restrict:"EA",require:"ngModel"}},i.directive("tgWikiSummary",["$log","$tgTemplate","$compile","$translate","tgAvatarService",e]),r=function(t,e,r,n,i,o,s,a){return{scope:!0,link:function(t,e,c){var u;return t.editableDescription=!1,t.saveDescription=i.bindAdd(function(e,n){var i,c;return c=function(e){return null==t.item.id&&(s.trackEvent("wikipage","create","create wiki page",1),t.$emit("wikipage:add")),a.fetchEntries(!0),r.notify("success")},i=function(){return r.notify("error")},t.item.content=e,(null!=t.item.id?o.save(t.item).then(c,i):o.create("wiki",t.item).then(c,i)).finally(n)}),u=function(e,r){return n.addAttachment(t.project.id,t.item.id,"wiki_page",e).then(function(t){return r(t.getIn(["file","name"]),t.getIn(["file","url"]))})},t.uploadFiles=function(t,e){var r,n,i,o;for(o=[],n=0,i=t.length;n<i;n++)r=t[n],o.push(u(r,e));return o},t.$watch(c.model,function(e){if(e)return t.item=e,t.version=e.version,t.storageKey=t.project.id+"-"+e.id+"-wiki"}),t.$watch("project",function(e){if(e)return t.editableDescription=-1!==e.my_permissions.indexOf("modify_wiki_page")})},template:"<div>\n    <tg-wysiwyg\n        ng-if=\"editableDescription\"\n        version='version'\n        storage-key='storageKey'\n        content='item.content'\n        on-save='saveDescription(text, cb)'\n        on-upload-file='uploadFiles(files, cb)'>\n    </tg-wysiwyg>\n\n    <div\n        class=\"wysiwyg\"\n        ng-if=\"!editableDescription && item.content.length\"\n        ng-bind-html=\"item.content | markdownToHTML\"></div>\n\n    <div\n        class=\"wysiwyg\"\n        ng-if=\"!editableDescription && !item.content.length\">\n        {{'COMMON.DESCRIPTION.NO_DESCRIPTION' | translate}}\n    </div>\n</div>"}},i.directive("tgWikiWysiwyg",["$tgQueueModelTransformation","$rootScope","$tgConfirm","tgAttachmentsFullService","$tgQqueue","$tgRepo","$tgAnalytics","tgActivityService",r])}.call(this),function(){var t,e;this.taiga,this.taiga.mixOf,this.taiga.groupBy,e=this.taiga.bindOnce,t=function(t,r,n,i,o,s,a,c,u){var l,p;return p=a.get("wiki/wiki-nav.html",!0),l=function(n,a,l){var d,h,f,g;return d=a.controller(),null==l.ngModel?r.error("WikiNavDirective: no ng-model attr is defined"):(h=n.project.my_permissions.indexOf("add_wiki_link")>-1,f=null,g=function(e){var r,l,m,v;return h=n.project.my_permissions.indexOf("add_wiki_link")>-1,r=n.project.my_permissions.indexOf("delete_wiki_link")>-1,l=p({wikiLinks:e,projectSlug:n.projectSlug,addWikiLinkPermission:h,deleteWikiLinkPermission:r}),l=c(l)(n),a.off(),h&&f&&f.destroy(),a.html(l),h&&(m=null,v=a.find(".sortable"),(f=dragula([v[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:v[0],moves:function(t){return $(t).is("li")}})).on("dragend",function(t){var e;return t=(m=$(t)).scope().link,e=m.index(),n.$emit("wiki:links:move",t,e)}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&f.dragging}})),a.on("click",".add-button",function(t){return t.preventDefault(),a.find(".new").removeClass("hidden"),a.find(".new input").focus(),a.find(".add-button").hide()}),a.on("click",".js-delete-link",function(e){var r,o,s,a;return e.preventDefault(),e.stopPropagation(),s=angular.element(e.currentTarget),r=s.parents(".wiki-link").data("id"),a=u.instant("WIKI.DELETE_LINK_TITLE"),o=n.wikiLinks[r].title,i.askOnDelete(a,o).then(function(e){var o;return(o=t.remove(n.wikiLinks[r])).then(function(){return(o=d.loadWikiLinks()).then(function(){return e.finish(),g(n.wikiLinks)}),o.then(null,function(){return e.finish()})}),o.then(null,function(){return e.finish(!1),i.notify("error")})})}),a.on("keyup",".new input",function(e){var r,c,u,l;return e.preventDefault(),13===e.keyCode?(l=angular.element(e.currentTarget),c=l.val(),r=s().target(a.find(".new")).start(),(u=t.create("wiki-links",{project:n.projectId,title:c})).then(function(){var t;return o.trackEvent("wikilink","create","create wiki link",1),(t=d.loadWikiLinks()).then(function(){return r.finish(),a.find(".new").addClass("hidden"),a.find(".new input").val(""),a.find(".add-button").show(),g(n.wikiLinks)}),t.then(null,function(){return r.finish(),a.find(".new").addClass("hidden"),a.find(".new input").val(""),a.find(".add-button").show(),i.notify("error","Error loading wiki links")})}),u.then(null,function(t){var e;return r.finish(),a.find(".new input").val(c),a.find(".new input").focus().select(),null!=(null!=t&&null!=(e=t.__all__)?e[0]:void 0)?i.notify("error","The link already exists"):i.notify("error")})):27===e.keyCode?(l=angular.element(e.currentTarget),a.find(".new").addClass("hidden"),a.find(".new input").val(""),a.find(".add-button").show()):void 0})},e(n,l.ngModel,g))},{link:function(t,e,r){return l(t,e,r),t.$on("$destroy",function(){return e.off()})}}},angular.module("taigaWiki").directive("tgWikiNav",["$tgRepo","$log","$tgLocation","$tgConfirm","$tgAnalytics","$tgLoading","$tgTemplate","$compile","$translate",t])}.call(this),function(){var t,e,r,n,i={}.hasOwnProperty;n=this.taiga,e=this.taiga.mixOf,r=angular.module("taigaWiki"),t=function(t){function r(t,e,r,n,i,o,s,a,c,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.model=n,this.confirm=i,this.rs=o,this.params=s,this.q=a,this.navUrls=c,this.errorHandlingService=u,this.projectService=l,this.scope.projectSlug=this.params.pslug,this.scope.wikiSlug=this.params.slug,this.scope.sectionName="Wiki",this.scope.linksVisible=!1,this.loadInitialData().then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,e(n.Controller,n.PageMixin)),r.$inject=["$scope","$rootScope","$tgRepo","$tgModel","$tgConfirm","$tgResources","$routeParams","$q","$tgNavUrls","tgErrorHandlingService","tgProjectService"],r.prototype.loadProject=function(){var t;return(t=this.projectService.project.toJS()).is_wiki_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},r.prototype.loadWikiPages=function(){var t;return this.rs.wiki.list(this.scope.projectId).then((t=this,function(e){return t.scope.wikipages=e}))},r.prototype.loadWikiLinks=function(){return this.rs.wiki.listLinks(this.scope.projectId).then((t=this,function(e){var r,n,i,o;for(t.scope.wikiLinks=e,r=0,n=(o=t.scope.wikiLinks).length;r<n;r++)(i=o[r]).url=t.navUrls.resolve("project-wiki-page",{project:t.scope.projectSlug,slug:i.href});return _.find(e,{href:t.scope.wikiSlug})}));var t},r.prototype.loadInitialData=function(){var t;return t=this.loadProject(),this.fillUsersAndRoles(t.members,t.roles),this.q.all([this.loadWikiLinks(),this.loadWikiPages()]).then(this.checkLinksPerms.bind(this))},r.prototype.checkLinksPerms=function(){if(-1!==this.scope.project.my_permissions.indexOf("add_wiki_link")||-1!==this.scope.project.my_permissions.indexOf("view_wiki_links")&&this.scope.wikiLinks.length)return this.scope.linksVisible=!0},r}(),r.controller("WikiPagesListController",t)}.call(this),function(){var t,e,r,n,i,o;this.taiga,this.taiga.debounce,n=function(){return{templateUrl:"admin/memberships-warning-message.html",scope:{project:"="}}},(o=angular.module("taigaKanban")).directive("tgLightboxAddMembersWarningMessage",[n]),r=function(t,e,r,n){return{link:function(i,o){return t.open(o),i.request=function(){return i.loading=!0,e.projects.transferRequest(i.projectId).then(function(){return i.loading=!1,t.close(o),r.notify("success",n.instant("ADMIN.PROJECT_PROFILE.REQUEST_OWNERSHIP_SUCCESS"))})}},templateUrl:"common/lightbox/lightbox-request-ownership.html"}},o.directive("tgLbRequestOwnership",["lightboxService","tgResources","$tgConfirm","$translate",r]),(t=function(){function t(t,e,r,n){this.rs=t,this.lightboxService=e,this.confirm=r,this.translate=n,this.users=[],this.q="",this.commentOpen=!1}return t.prototype.limit=3,t.prototype.normalizeString=function(t){return t=(t=(t=(t=(t=t.replace("Á","A").replace("Ä","A").replace("À","A")).replace("É","E").replace("Ë","E").replace("È","E")).replace("Í","I").replace("Ï","I").replace("Ì","I")).replace("Ó","O").replace("Ö","O").replace("Ò","O")).replace("Ú","U").replace("Ü","U").replace("Ù","U")},t.prototype.filterUsers=function(t){var e,r;return r=t.full_name_display.toUpperCase(),r=this.normalizeString(r),e=this.q.toUpperCase(),e=this.normalizeString(e),_.includes(r,e)},t.prototype.getUsers=function(){var t;return t=(t=this.users.length||this.q.length?this.users:this.activeUsers).slice(0,this.limit),t=_.reject(t,{selected:!0}),_.reject(t,{id:this.currentOwnerId})},t.prototype.userSearch=function(){if(this.users=this.activeUsers,this.selected=_.find(this.users,{selected:!0}),this.q)return this.users=_.filter(this.users,this.filterUsers.bind(this))},t.prototype.selectUser=function(t){return this.activeUsers=_.map(this.activeUsers,function(t){return t.selected=!1,t}),t.selected=!0,this.userSearch()},t.prototype.submit=function(){return this.loading=!0,this.rs.projects.transferStart(this.projectId,this.selected.id,this.comment).then((t=this,function(){var e,r;return t.loading=!1,t.lightboxService.closeAll(),r=t.translate.instant("ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_TITLE"),e=t.translate.instant("ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_DESC"),t.confirm.success(r,e,{type:"svg",name:"icon-speak-up"})}));var t},t}()).$inject=["tgResources","lightboxService","$tgConfirm","$translate"],o.controller("ChangeOwnerLightbox",t),e=function(t,e,r,n){return{scope:!0,controller:"ChangeOwnerLightbox",controllerAs:"vm",bindToController:{currentOwnerId:"=",projectId:"=",activeUsers:"="},templateUrl:"common/lightbox/lightbox-change-owner.html",link:function(e,r){return t.open(r)}}},o.directive("tgLbChangeOwner",["lightboxService","lightboxKeyboardNavigationService","$tgTemplate","$compile",e]),i=function(t){return{templateUrl:"common/lightbox/lightbox-transfer-project-start-success.html",link:function(e,r){return e.close=function(){return t.close(r)},t.open(r)}}},o.directive("tgLbTransferProjectStartSuccess",["lightboxService",i])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p={}.hasOwnProperty;l=this.taiga,c=this.taiga.mixOf,a=this.taiga.bindMethods,u=angular.module("taigaAdmin"),t=function(t){function e(t,e,r,n,i,o,s,c,u,l,p,d,h,f,g,m){var v,y;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=c,this.navUrls=u,this.analytics=l,this.appMetaService=p,this.translate=d,this.auth=h,this.lightboxFactory=f,this.errorHandlingService=g,this.projectService=m,a(this),this.scope.project={},this.scope.filters={},(v=this.loadInitialData()).then((y=this,function(){var t,e;return e=y.translate.instant("ADMIN.MEMBERSHIPS.PAGE_TITLE",{projectName:y.scope.project.name}),t=y.scope.project.description,y.appMetaService.setAll(e,t)})),v.then(null,this.onInitialDataError.bind(this)),this.scope.$on("membersform:new:success",function(t){return function(){return t.loadInitialData(),t.analytics.trackEvent("membership","create","create memberships on admin",1)}}(this))}return function(t,e){for(var r in e)p.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,c(l.Controller,l.PageMixin,l.FiltersMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAnalytics","tgAppMetaService","$translate","$tgAuth","tgLightboxFactory","tgErrorHandlingService","tgProjectService"],e.prototype.loadProject=function(){var t;return(t=this.projectService.project.toJS()).i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.canAddUsers=null===t.max_memberships||t.max_memberships>t.total_memberships,this.scope.$emit("project:loaded",t),t},e.prototype.loadMembers=function(){var t,e;return t=this.getUrlFilters(),this.rs.memberships.list(this.scope.projectId,t).then((e=this,function(t){return e.scope.memberships=_.filter(t.models,function(t){return null===t.user||t.is_user_active}),_.map(e.scope.memberships,function(t){if(t.is_owner)return e.scope.projectOwnerEmail=t.user_email}),e.scope.page=t.current,e.scope.count=t.count,e.scope.paginatedBy=t.paginatedBy,t}))},e.prototype.loadInitialData=function(){return this.loadProject(),this.q.all([this.loadMembers(),this.auth.refresh()])},e.prototype.getUrlFilters=function(){var t;return(t=_.pick(this.location.search(),"page")).page||(t.page=1),t},e.prototype.addNewMembers=function(){return this.lightboxFactory.create("tg-lb-add-members",{class:"lightbox lightbox-add-member",project:"project"},{project:this.scope.project})},e.prototype.showLimitUsersWarningMessage=function(){var t,e,r;return r=this.translate.instant("ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING"),e=this.translate.instant("ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING_MESSAGE",{members:this.scope.project.max_memberships}),t="/"+window._version+"/svg/icons/team-question.svg",this.confirm.success(r,e,{name:t,type:"img"})},e}(),u.controller("MembershipsController",t),e=function(t,e){var r,n;return n=t.get("admin/admin-membership-paginator.html",!0),r=function(t,r,i,o){var s,a,c;return 2,4,2,2,s=r.find(".memberships-paginator"),a=function(){var e;return e=t.count/t.paginatedBy,e=parseInt(e,10)<e?parseInt(e,10)+1:parseInt(e,10)},c=function(){var r,i,o,c,u,l,p,d;if(!((u=a())<=1)){for((l={}).pages=p=[],l.showPrevious=t.page>1,l.showNext=!(t.page===u),r=t.page,o=c=1,d=u;1<=d?c<=d:c>=d;o=1<=d?++c:--c)o===r+2&&u>r+2+2?p.push({classes:"dots",type:"dots"}):o===r-4&&r>6?p.push({classes:"dots",type:"dots"}):o>r+2&&o<=u-2||o<r-4&&o>2||(o===r?p.push({classes:"active",num:o,type:"page-active"}):p.push({classes:"page",num:o,type:"page"}));return i=n(l),i=e(i)(t),s.html(i),s.show()}s.hide()},t.$watch("memberships",function(t){if(t)return c()}),r.on("click",".memberships-paginator a.next",function(e){return e.preventDefault(),t.$apply(function(){return o.selectFilter("page",t.page+1),o.loadMembers()})}),r.on("click",".memberships-paginator a.previous",function(e){return e.preventDefault(),t.$apply(function(){return o.selectFilter("page",t.page-1),o.loadMembers()})}),r.on("click",".memberships-paginator li.page > a",function(e){var r,n;return e.preventDefault(),n=angular.element(e.currentTarget),r=n.data("pagenum"),t.$apply(function(){return o.selectFilter("page",r),o.loadMembers()})})},{link:function(t,e,n){var i;return i=e.controller(),r(t,e,0,i),t.$on("$destroy",function(){return e.off()})}}},u.directive("tgMemberships",["$tgTemplate","$compile",e]),i=function(t,e,r,n,i){var o;return o=e.get("admin/memberships-row-avatar.html",!0),{link:function(e,s,a){var c,u;return c=r.instant("ADMIN.MEMBERSHIP.STATUS_PENDING"),u=function(t){var r,a,u;return r=i.getAvatar(t),a={full_name:t.full_name?t.full_name:"",email:t.user_email?t.user_email:t.email,imgurl:r.url,bg:r.bg,pending:t.is_user_active?"":c,isOwner:t.is_owner},u=o(a),u=n(u)(e),s.html(u)},null==a.tgMembershipsRowAvatar?t.error("MembershipsRowAvatarDirective: the directive need a member"):(u(e.$eval(a.tgMembershipsRowAvatar)),e.$on("$destroy",function(){return s.off()}))}}},u.directive("tgMembershipsRowAvatar",["$log","$tgTemplate","$translate","$compile","tgAvatarService",i]),n=function(t,e,r,n,i){var o;return o=n.get("admin/admin-memberships-row-checkbox.html",!0),{link:function(n,s,a){var c,u;return n.$on("$destroy",function(){return s.off()}),null==a.tgMembershipsRowAdminCheckbox?t.error("MembershipsRowAdminCheckboxDirective: the directive need a member"):(c=n.$eval(a.tgMembershipsRowAdminCheckbox)).is_owner?void s.find(".js-check").remove():(u=function(t){var e,r;return e={inputId:"is-admin-"+t.id},r=o(e),r=i(r)(n),s.html(r)},s.on("click",":checkbox",function(t){var n,i,o;return i=function(){return r.notify("success")},n=function(t){return c.revert(),s.find(":checkbox").prop("checked",c.is_admin),r.notify("error",t.is_admin[0])},o=angular.element(t.currentTarget),c.is_admin=o.prop("checked"),e.save(c).then(i,n)}),u(c),c.is_admin?s.find(":checkbox").prop("checked",!0):void 0)}}},u.directive("tgMembershipsRowAdminCheckbox",["$log","$tgRepo","$tgConfirm","$tgTemplate","$compile",n]),o=function(t,e,r){var n;return n=_.template('<select>\n    <% _.each(roleList, function(role) { %>\n    <option value="<%- role.id %>" <% if(selectedRole === role.id){ %>selected="selected"<% } %>>\n        <%- role.name %>\n    </option>\n    <% }); %>\n</select>'),{link:function(i,o,s){var a,c;return c=function(t){var e,r;return e={roleList:i.project.roles,selectedRole:t.role},r=n(e),o.html(r)},null==s.tgMembershipsRowRoleSelector?t.error("MembershipsRowRoleSelectorDirective: the directive need a member"):(o.controller(),c(a=i.$eval(s.tgMembershipsRowRoleSelector)),o.on("change","select",function(t){var n,i,o,s;if(o=function(){return r.notify("success")},i=function(){return r.notify("error")},s=angular.element(t.currentTarget),n=parseInt(s.val(),10),a.role!==n)return a.role=n,e.save(a).then(o,i)}),i.$on("$destroy",function(){return o.off()}))}}},u.directive("tgMembershipsRowRoleSelector",["$log","$tgRepo","$tgConfirm",o]),r=function(t,e,r,n,i,o,s,a,c,u){var l,p;return l='<div class="active"\n     translate="ADMIN.MEMBERSHIP.STATUS_ACTIVE">\n</div>\n<a class="delete" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.DELETE_MEMBER\' | translate }}">\n    <tg-svg svg-icon="icon-trash"></tg-svg>\n</a>',p='<a class="resend js-resend" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.RESEND\' | translate }}"\n   translate="ADMIN.MEMBERSHIP.RESEND">\n</a>\n<a class="delete" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.DELETE_MEMBER\' | translate }}">\n    <tg-svg svg-icon="icon-trash"></tg-svg>\n</a>',{link:function(d,h,f){var g,m,v,y;return y=function(t){var e;return e=t.user?i(l)(d):i(p)(d),h.html(e)},null==f.tgMembershipsRowActions?t.error("MembershipsRowActionsDirective: the directive need a member"):(g=h.controller(),y(v=d.$eval(f.tgMembershipsRowActions)),h.on("click",".js-resend",function(t){var e,i;return t.preventDefault(),i=function(){var t;return t=o.instant("ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION",{email:d.member.email}),n.notify("success",t)},e=function(){var t;return t=o.instant("ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION"),n.notify("error",t)},r.memberships.resendInvitation(d.member.id).then(i,e)}),m=function(){var t,r,i;return i=o.instant("ADMIN.MEMBERSHIP.DELETE_MEMBER"),t=o.instant("ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE",{email:v.email}),r=v.user?v.full_name:t,n.askOnDelete(i,r).then(function(t){var i,c;return c=function(){var e;return t.finish(),v.user!==d.user.id?(d.page>1&&d.count-1<=d.paginatedBy&&g.selectFilter("page",d.page-1),u.fetchProject().then(function(){return g.loadInitialData()})):s.path(a.resolve("home")),e=o.instant("ADMIN.MEMBERSHIP.SUCCESS_DELETE",{message:r}),n.notify("success",e,null,5e3)},i=function(){var e;return t.finish(!1),e=o.instant("ADMIN.MEMBERSHIP.ERROR_DELETE",{message:r}),n.notify("error",e)},e.remove(v).then(c,i)})},h.on("click",".delete",function(t){var e;return t.preventDefault(),d.project.owner.id===v.user?(e=d.user.id===v.user,c.create("tg-lightbox-leave-project-warning",{class:"lightbox lightbox-leave-project-warning"},{isCurrentUser:e,project:d.project})):m()}),d.$on("$destroy",function(){return h.off()}))}}},u.directive("tgMembershipsRowActions",["$log","$tgRepo","$tgResources","$tgConfirm","$compile","$translate","$tgLocation","$tgNavUrls","tgLightboxFactory","tgProjectService",r]),s=function(){return{templateUrl:"admin/no-more-memberships-explanation.html",scope:{project:"=",ownerEmail:"="}}},u.directive("tgNoMoreMembershipsExplanation",[s])}.call(this),function(){var t;t=function(){return{link:function(t,e,r){var n;return n=r.tgAdminNavigation,e.find(".active").removeClass("active"),e.find("#adminmenu-"+n+" a").addClass("active"),t.$on("$destroy",function(){return e.off()})}}},angular.module("taigaAdmin").directive("tgAdminNavigation",t)}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,b,S,j,k,$,I=function(t,e){for(var r in e)E.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},E={}.hasOwnProperty,C=function(t,e){return function(){return t.apply(e,arguments)}};$=this.taiga,S=this.taiga.mixOf,k=this.taiga.scopeDefer,this.taiga.trim,this.taiga.toString,this.taiga.joinStr,this.taiga.groupBy,this.taiga.bindOnce,b=this.taiga.debounce,j=angular.module("taigaAdmin"),v=function(t){function e(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g){var m,v;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.appMetaService=u,this.translate=l,this.tgAuth=p,this.currentUserService=d,this.errorHandlingService=h,this.projectService=f,this.model=g,this.scope.project={},this.scope.projectTags=[],(m=this.loadInitialData()).then((v=this,function(){var t,e,r;return e=v.translate.instant(v.scope.sectionName),r=v.translate.instant("ADMIN.PROJECT_PROFILE.PAGE_TITLE",{sectionName:e,projectName:v.scope.project.name}),t=v.scope.project.description,v.appMetaService.setAll(r,t),v.fillUsersAndRoles(v.scope.project.members,v.scope.project.roles)})),m.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:loaded",function(t){return function(){var e,r,n;return r=t.translate.instant(t.scope.sectionName),n=t.translate.instant("ADMIN.PROJECT_PROFILE.PAGE_TITLE",{sectionName:r,projectName:t.scope.project.name}),e=t.scope.project.description,t.appMetaService.setAll(n,e)}}(this))}return I(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","$tgAuth","tgCurrentUserService","tgErrorHandlingService","tgProjectService","$tgModel"],e.prototype.loadProject=function(){var t,e;return t=this.projectService.project.toJS(),(t=this.model.make_model("projects",t)).i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.epicStatusList=_.sortBy(t.epic_statuses,"order"),this.scope.usStatusList=_.sortBy(t.us_statuses,"order"),this.scope.pointsList=_.sortBy(t.points,"order"),this.scope.taskStatusList=_.sortBy(t.task_statuses,"order"),this.scope.issueTypesList=_.sortBy(t.issue_types,"order"),this.scope.issueStatusList=_.sortBy(t.issue_statuses,"order"),this.scope.prioritiesList=_.sortBy(t.priorities,"order"),this.scope.severitiesList=_.sortBy(t.severities,"order"),k(this.scope,(e=this,function(){return e.scope.$emit("project:loaded",t)})),this.scope.projectTags=_.map(this.scope.project.tags,function(t){return function(e){return[e,t.scope.project.tags_colors[e]]}}(this)),t},e.prototype.loadInitialData=function(){return this.loadProject(),this.tgAuth.refresh()},e.prototype.openDeleteLightbox=function(){return this.rootscope.$broadcast("deletelightbox:new",this.scope.project)},e.prototype.addTag=function(t,e){var r;return(r=_.clone(this.scope.project.tags)).push(t),this.scope.projectTags.push([t,null]),this.scope.project.tags=r},e.prototype.deleteTag=function(t){var e;return e=_.clone(this.scope.project.tags),_.pull(e,t[0]),_.remove(this.scope.projectTags,function(e){return e[0]===t[0]}),this.scope.project.tags=e},e}(S($.Controller,$.PageMixin)),j.controller("ProjectProfileController",v),y=function(t,e,r,n,i,o,s,a){return{link:function(c,u,l){var p,d,h,f;return p=u.controller(),d=u.find("form").checksley({onlyOneErrorElement:!0}),h=b(2e3,function(u){var l,h,g;if(u.preventDefault(),d.validate())return l=r().target(f).start(),h=c.project.isAttributeModified("is_private"),(g=t.save(c.project)).then(function(){var t;return l.finish(),h&&c.project.is_private?a.trackEvent("project-privacy-changed","from-public-to-private","Change project privacy from public to private",1):h&&!c.project.is_private&&a.trackEvent("project-privacy-changed","from-private-to-public","Change project privacy from private to public",1),e.notify("success"),t=n.resolve("project-admin-project-profile-details",{project:c.project.slug}),i.path(t),o.fetchProject().then(function(){return p.loadInitialData()}),s.loadProjects()}),g.then(null,function(t){if(l.finish(),d.setErrors(t),t._error_message)return e.notify("error",t._error_message)})}),f=u.find(".submit-button"),u.on("submit","form",h)}}},j.directive("tgProjectProfile",["$tgRepo","$tgConfirm","$tgLoading","$tgNavUrls","$tgLocation","tgProjectService","tgCurrentUserService","$tgAnalytics",y]),d=function(t,e,r,n){return{link:function(i,o,s){var a,c,u;return a=o.find("form").checksley({onlyOneErrorElement:!0}),c=b(2e3,function(o){var s,c;if(o.preventDefault(),a.validate())return s=n().target(u).start(),(c=e.save(i.project)).then(function(){return s.finish(),r.notify("success"),t.$broadcast("admin:project-default-values:updated")}),c.then(null,function(t){if(s.finish(),a.setErrors(t),t._error_message)return r.notify("error",t._error_message)})}),u=o.find(".submit-button"),o.on("submit","form",c),i.$on("$destroy",function(){return o.off()})}}},j.directive("tgProjectDefaultValues",["$rootScope","$tgRepo","$tgConfirm","$tgLoading",d]),m=function(t,e,r,n){return{link:function(n,i,o){var s;return s=function(){var o,s;if((o=i.find("form").checksley()).initializeFields(),o.reset(),o.validate())return(s=e.save(n.project)).then(function(){return n.$emit("project:loaded",n.project),t.$broadcast("admin:project-modules:updated"),r.notify("success")}),s.then(null,function(t){if(o.setErrors(t),t._error_message)return r.notify("error",t._error_message)})},i.on("change",".module-activation.module-direct-active input",function(t){return t.preventDefault(),n.$applyAsync(s)}),i.on("submit","form",function(t){return t.preventDefault(),s()}),i.on("click",".save",function(t){return t.preventDefault(),s()}),i.on("keydown",".videoconference-attributes input",function(t){return 32!==t.which}),n.$watch("project.videoconferences",function(t,e){if(null!=t&&null!=e&&t!==e)return n.project.videoconferences_extra_data=""}),n.$watch("isVideoconferenceActivated",function(t,e){if(!1===t&&(n.project.videoconferences=null,n.project.videoconferences_extra_data="",!0===e))return s()}),n.$watch("project",function(t){return null!=t.videoconferences?n.isVideoconferenceActivated=!0:n.isVideoconferenceActivated=!1})}}},j.directive("tgProjectModules",["$rootScope","$tgRepo","$tgConfirm","$tgLoading",m]),h=function(t,e,r,n,i){return{link:function(o,s,a){var c,u,l,p,d,h,f,g,m,v,y,_,S,j,k,$,I,E,C,T,A,P,w,O,R,M;return u=s.find(".admin-project-export-buttons"),E=function(){return u.removeClass("hidden")},p=function(){return u.addClass("hidden")},m=s.find(".admin-project-export-result"),w=function(){return m.removeClass("hidden")},d=function(){return m.addClass("hidden")},R=s.find(".spin"),O=function(){return R.removeClass("hidden")},h=function(){return R.addClass("hidden")},y=s.find(".result-title"),g=n.instant("ADMIN.PROJECT_EXPORT.LOADING_TITLE"),f=n.instant("ADMIN.PROJECT_EXPORT.LOADING_MESSAGE"),l=function(){return y.html(n.instant("ADMIN.PROJECT_EXPORT.DUMP_READY"))},c=function(){return y.html(n.instant("ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE"))},M=function(t){return y.html(n.instant("ADMIN.PROJECT_EXPORT.SYNC_MESSAGE",{url:t}))},k=function(){return y.html(g)},S=function(){return y.html(f)},I=function(){return y.html(l)},v=s.find(".result-message "),j=function(){return v.html(f)},_=function(){return v.html(c)},$=function(t){return v.html(M(t))},P=function(){return O(),k(),j(),p(),w()},T=function(){return h(),S(),_()},A=function(t){return h(),I(),$(t)},C=function(){return h(),d(),E()},s.on("click","a.button-export",b(2e3,function(s){var a,c;return s.preventDefault(),c=function(e){var r;return i.trackEvent("exporter","export-project","Exported project",1),202===e.status?T():(r=e.data.url,A(r),t.open(r,"_blank"))},a=function(t){var e,i;return C(),e=n.instant("ADMIN.PROJECT_EXPORT.ERROR"),429===t.status?e=n.instant("ADMIN.PROJECT_EXPORT.ERROR_BUSY"):(null!=(i=t.data)?i._error_message:void 0)&&(e=n.instant("ADMIN.PROJECT_EXPORT.ERROR_BUSY",{message:t.data._error_message})),r.notify("error",e)},P(),e.projects.export(o.projectId).then(c,a)}))}}},j.directive("tgProjectExport",["$window","$tgResources","$tgConfirm","$translate","$tgAnalytics",h]),i=function(t){function e(t,e,r,n,i,o){var s;this.scope=t,this.rootscope=e,this.urls=r,this.confirm=n,this.rs=i,this.translate=o,this._deleteUuid=C(this._deleteUuid,this),this._generateUuid=C(this._generateUuid,this),this.setCsvUuid=C(this.setCsvUuid,this),this.rootscope.$on("project:loaded",this.setCsvUuid),this.scope.$watch("csvUuid",(s=this,function(t){return s.scope.csvUrl=t?s.urls.resolveAbsolute(s.type+"-csv",t):""}))}return I(e,t),e.$inject=["$scope","$rootScope","$tgUrls","$tgConfirm","$tgResources","$translate"],e.prototype.setCsvUuid=function(){return this.scope.csvUuid=this.scope.project[this.type+"_csv_uuid"]},e.prototype._generateUuid=function(t){var e,r;return null==t&&(t=null),(e=this.rs.projects["regenerate_"+this.type+"_csv_uuid"](this.scope.projectId)).then((r=this,function(t){var e;return r.scope.csvUuid=null!=(e=t.data)?e.uuid:void 0})),e.then(null,function(t){return function(){return t.confirm.notify("error")}}(this)),e.finally(function(){if(t)return t.finish()}),e},e.prototype._deleteUuid=function(t){var e,r;return null==t&&(t=null),(e=this.rs.projects["delete_"+this.type+"_csv_uuid"](this.scope.projectId)).then((r=this,function(t){var e;return r.scope.csvUuid=null!=(e=t.data)?e.uuid:void 0})),e.then(null,function(t){return function(){return t.confirm.notify("error")}}(this)),e.finally(function(){if(t)return t.finish()}),e},e.prototype.regenerateUuid=function(){var t,e;return this.scope.csvUuid?(e=this.translate.instant("ADMIN.REPORTS.REGENERATE_TITLE"),t=this.translate.instant("ADMIN.REPORTS.REGENERATE_SUBTITLE"),this.confirm.ask(e,t).then(this._generateUuid)):this._generateUuid()},e.prototype.deleteUuid=function(){var t,e;return this.scope.csvUuid?(e=this.translate.instant("ADMIN.REPORTS.DELETE_TITLE"),t=this.translate.instant("ADMIN.REPORTS.DELETE_SUBTITLE"),this.confirm.ask(e,t).then(this._deleteUuid)):this._deleteUuid()},e}($.Controller),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return I(e,i),e.prototype.type="epics",e}(),c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return I(e,i),e.prototype.type="userstories",e}(),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return I(e,i),e.prototype.type="tasks",e}(),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return I(e,i),e.prototype.type="issues",e}(),j.controller("CsvExporterEpicsController",o),j.controller("CsvExporterUserstoriesController",c),j.controller("CsvExporterTasksController",a),j.controller("CsvExporterIssuesController",s),n=function(t){return{controller:"CsvExporterEpicsController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_EPIC"},scope:!0}},j.directive("tgCsvEpic",["$translate",n]),p=function(t){return{controller:"CsvExporterUserstoriesController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_US"},scope:!0}},j.directive("tgCsvUs",["$translate",p]),l=function(t){return{controller:"CsvExporterTasksController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_TASK"},scope:!0}},j.directive("tgCsvTask",["$translate",l]),u=function(t){return{controller:"CsvExporterIssuesController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_ISSUE"},scope:!0}},j.directive("tgCsvIssue",["$translate",u]),f=function(t,e,r,n){return{link:function(t,i,o){var s,a,c;return c=function(){return i.find(".size-info").addClass("active")},a=function(r){var o;return o=e.make_model("projects",r.data),t.project=o,i.find(".loading-overlay").removeClass("active"),n.notify("success")},s=function(t){return 413===t.status&&c(),i.find(".loading-overlay").removeClass("active"),n.notify("error",t.data._error_message)},i.on("click",".js-change-logo",function(){return i.find("#logo-field").click()}),i.on("change","#logo-field",function(e){if(t.logoAttachment)return i.find(".loading-overlay").addClass("active"),r.projects.changeLogo(t.project.id,t.logoAttachment).then(a,s)}),i.on("click","a.js-use-default-logo",function(e){return i.find(".loading-overlay").addClass("active"),r.projects.removeLogo(t.project.id).then(a,s)}),t.$on("$destroy",function(){return i.off()})}}},j.directive("tgProjectLogo",["$tgAuth","$tgModel","$tgResources","$tgConfirm",f]),g=function(t){return{link:function(e,r,n){var i,o;return i=t(n.tgProjectLogoModel),o=i.assign,r.bind("change",function(){return e.$apply(function(){return o(e,r[0].files[0])})})}}},j.directive("tgProjectLogoModel",["$parse",g]),r=function(){return{scope:{project:"="},templateUrl:"admin/admin-project-restrictions.html"}},j.directive("tgAdminProjectRestrictions",[r]),e=function(t){return{link:function(e){return e.requestOwnership=function(){return t.create("tg-lb-request-ownership",{class:"lightbox lightbox-request-ownership"},{projectId:e.projectId})}},scope:{projectId:"=",owner:"="},templateUrl:"admin/admin-project-request-ownership.html"}},j.directive("tgAdminProjectRequestOwnership",["tgLightboxFactory",e]),t=function(t){return{link:function(e){return e.changeOwner=function(){return t.create("tg-lb-change-owner",{class:"lightbox lightbox-select-user","project-id":"projectId","active-users":"activeUsers","current-owner-id":"currentOwnerId"},{projectId:e.projectId,activeUsers:e.activeUsers,currentOwnerId:e.owner.id,members:e.members})}},scope:{activeUsers:"=",projectId:"=",owner:"=",members:"="},templateUrl:"admin/admin-project-change-owner.html"}},j.directive("tgAdminProjectChangeOwner",["tgLightboxFactory",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m=function(t,e){for(var r in e)v.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},v={}.hasOwnProperty,y=function(t,e){return function(){return t.apply(e,arguments)}};g=this.taiga,h=this.taiga.mixOf,this.taiga.trim,this.taiga.toString,this.taiga.joinStr,this.taiga.groupBy,this.taiga.bindOnce,p=this.taiga.debounce,d=this.taiga.getDefaulColorList,f=angular.module("taigaAdmin"),u=function(t){function e(t,e,r,n,i,o,s,a,c,u,l,p,d){var h,f,g;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.appMetaService=u,this.translate=l,this.errorHandlingService=p,this.projectService=d,this.scope.project={},this.loadInitialData(),f=this.translate.instant(this.scope.sectionName),g=this.translate.instant("ADMIN.PROJECT_VALUES.PAGE_TITLE",{sectionName:f,projectName:this.scope.project.name}),h=this.scope.project.description,this.appMetaService.setAll(g,h)}return m(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","tgErrorHandlingService","tgProjectService"],e.prototype.loadProject=function(){var t;return(t=this.projectService.project.toJS()).i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},e.prototype.loadInitialData=function(){return this.loadProject()},e}(h(g.Controller,g.PageMixin)),f.controller("ProjectValuesSectionController",u),a=function(t){function e(t,e,r,n,i){var o,s;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.moveValue=y(this.moveValue,this),this.loadValues=y(this.loadValues,this),this.scope.$on("admin:project-values:move",this.moveValue),o=this.scope.$watch("resource",(s=this,function(t){if(t)return s.loadValues(),o()}))}return m(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources"],e.prototype.loadValues=function(){return this.rs[this.scope.resource].listValues(this.scope.projectId,this.scope.type).then((t=this,function(e){return e.length&&(t.scope.values=e,t.scope.maxValueOrder=_.maxBy(e,"order").order),e}));var t},e.prototype.moveValue=function(t,e,r){var n,i,o;return n=(i=this.scope.values).indexOf(e),i.splice(n,1),i.splice(r,0,e),_.each(i,function(t,e){return t.order=e}),this.repo.saveAll(i).then((o=this,function(){return o.rootscope.$broadcast("admin:project-values:updated")}))},e}(g.Controller),f.controller("ProjectValuesController",a),i=function(t){function e(){return this.displayValues=y(this.displayValues,this),this.createDefaultValues=y(this.createDefaultValues,this),this.loadValues=y(this.loadValues,this),e.__super__.constructor.apply(this,arguments)}return m(e,a),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources"],e.prototype.loadValues=function(){return this.rs[this.scope.resource].listValues(this.scope.projectId,this.scope.type).then((t=this,function(e){return e.length?(t.scope.maxValueOrder=_.maxBy(e,"order").order,t.displayValues(e)):t.createDefaultValues(),e}));var t},e.prototype.createDefaultValues=function(){var t;if(null!=this.rs[this.scope.resource].createDefaultValues)return this.rs[this.scope.resource].createDefaultValues(this.scope.projectId,this.scope.type).then((t=this,function(e){var r;return t.rootscope.$broadcast("admin:project-values:updated"),(r=e.data).length&&(t.scope.maxValueOrder=_.maxBy(r,"order").order,t.displayValues(r)),r}))},e.prototype.displayValues=function(t){return _.each(t,function(t,e){return t.days_to_due_abs=null!==t.days_to_due?Math.abs(t.days_to_due):null,t.sign=t.days_to_due>=0?1:-1}),this.scope.values=t},e}(),f.controller("ProjectDueDatesValuesController",i),c=function(t,e,r,n,i,o,s,a){var c,u;return c=function(t,e,r){var n,i,o;return null,null,i=null,o=e.find(".sortable"),(n=dragula([o[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:o[0],moves:function(t){return $(t).is("div[tg-bind-scope]")}})).on("dragend",function(e){var r,n;return n=(i=$(e)).scope().value,r=i.index(),t.$broadcast("admin:project-values:move",n,r)}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&n.dragging}}),t.$on("$destroy",function(){return e.off(),n.destroy()})},u=function(t,n,i){var c,u,l,d,h,f,g,m,v;return c=n.controller(),v=i.type,f=i.objname,h=function(){return t.addNewElementText=o.instant("ADMIN.PROJECT_VALUES_"+f.toUpperCase()+".ACTION_ADD")},(d=function(){return t.newValue={name:"",is_closed:!1,is_archived:!1}})(),h(),s.$on("$translateChangeEnd",function(){return t.$evalAsync(h)}),l=function(t){var e;if(null==t&&(t=!1),e=n.find(".table-main"),$(document.body).scrollTop(e.offset().top+e.height()),t)return n.find(".new-value input:visible").first().focus()},m=function(t){var r,n,i,o;if(n=t.parents("form"),(r=n.checksley()).validate())return o=n.scope().value,(i=e.save(o)).then(function(){var e;return(e=t.parents(".row.table-main")).addClass("hidden"),e.siblings(".visualization").removeClass("hidden"),s.$broadcast("admin:project-values:updated"),a.fetchProject()}),i.then(null,function(t){return r.setErrors(t)})},g=function(r){var n,i,o;if(i=r.parents("form"),(n=i.checksley()).validate())return t.newValue.project=t.project.id,t.newValue.order=t.maxValueOrder?t.maxValueOrder+1:1,(o=e.create(v,t.newValue)).then(function(e){return r.addClass("hidden"),t.values.push(e),t.maxValueOrder=e.order,d(),s.$broadcast("admin:project-values:updated")}),o.then(null,function(t){return n.setErrors(t)})},u=function(e){var r,n,i;return n=e.parents(".row.table-main"),r=e.parents("form"),i=r.scope().value,t.$apply(function(){return n.addClass("hidden"),i.revert(),n.siblings(".visualization").removeClass("hidden")})},n.on("click",".show-add-new",function(t){return t.preventDefault(),n.find(".new-value").removeClass("hidden"),l(!0)}),n.on("click",".add-new",p(2e3,function(t){var e;return t.preventDefault(),e=n.find(".new-value"),g(e)})),n.on("click",".delete-new",function(t){return t.preventDefault(),n.find(".new-value").addClass("hidden"),d()}),n.on("click",".edit-value",function(t){var e,r;return t.preventDefault(),(r=angular.element(t.currentTarget).parents(".row.table-main")).addClass("hidden"),(e=r.siblings(".edition")).removeClass("hidden"),e.find("input:visible").first().focus().select()}),n.on("keyup",".new-value input",function(t){var e;return 13===t.keyCode?(e=n.find(".new-value"),g(e)):27===t.keyCode?(n.find(".new-value").addClass("hidden"),d()):void 0}),n.on("click",".save",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),m(e)}),n.on("click",".cancel",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),u(e)}),n.on("click",".delete-value",function(n){var i,a,u,l,p,d;return n.preventDefault(),a=angular.element(n.currentTarget).parents("form"),d=a.scope().value,i={},_.each(t.values,function(t){if(d.id!==t.id)return i[t.id]=t.name}),u=d.name,0===_.keys(i).length?r.error(o.instant("ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL")):(p=o.instant("ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE"),l=o.instant("ADMIN.PROJECT_VALUES.REPLACEMENT"),r.askChoice(p,u,i,l).then(function(t){var n,i;return i=function(){return c.loadValues().finally(function(){return s.$broadcast("admin:project-values:updated"),t.finish()})},n=function(){return r.notify("error")},e.remove(d,{moveTo:t.selected}).then(i,n)}))})},{link:function(t,e,r){return c(t,e),u(t,e,r),t.$on("$destroy",function(){return e.off()})}}},f.directive("tgProjectValues",["$log","$tgRepo","$tgConfirm","$tgLocation","animationFrame","$translate","$rootScope","tgProjectService",c]),n=function(t,e,r,n,i,o,s,a){var u,l;return l=c(0,e,r,0,0,o,s,a),u=function(t,n,i,a){var c,u,l,d,h;return a=n.controller(),h=i.type,(l=function(){return t.newValue={name:"",days_to_due:0,sign:1}})(),c=function(t){return t.days_to_due=t.days_to_due_abs*t.sign},u=function(t){var e,r;return(r=angular.element(t.currentTarget)).parents(".row.table-main"),(e=r.parents("form")).scope().value?e.scope().value:e.scope().newValue},d=function(r){var n,i,o;if(i=r.parents("form"),(n=i.checksley()).validate())return t.newValue.project=t.project.id,t.newValue.order=t.maxValueOrder?t.maxValueOrder+1:1,(o=e.create(h,t.newValue)).then(function(e){return r.addClass("hidden"),e.sign=t.newValue.sign,e.days_to_due_abs=t.newValue.days_to_due_abs,t.values.push(e),s.$broadcast("admin:project-values:updated"),l()}),o.then(null,function(t){return n.setErrors(t)})},n.on("input",".days-to-due-abs",function(e){var r;return e.preventDefault(),r=u(e),t.$apply(function(){return c(r)})}),n.on("click",".days-to-due-sign",function(e){var r;return e.preventDefault(),r=u(e),t.$apply(function(){return r.sign=-1*r.sign,c(r)})}),n.on("click",".add-new-due-date",p(2e3,function(t){var e;return t.preventDefault(),e=n.find(".new-value"),d(e)})),n.on("click",".delete-due-date",function(t){var n,i,c,u;return t.preventDefault(),n=angular.element(t.currentTarget).parents("form"),u=n.scope().value,c=o.instant("LIGHTBOX.ADMIN_DUE_DATES.TITLE_ACTION_DELETE_DUE_DATE"),i=o.instant("LIGHTBOX.ADMIN_DUE_DATES.SUBTITLE_ACTION_DELETE_DUE_DATE",{due_date_status_name:u.name}),r.ask(c,i).then(function(t){var n,i;return i=function(){return a.loadValues().finally(function(){return s.$broadcast("admin:project-values:updated"),t.finish()})},n=function(){return r.notify("error")},e.remove(u).then(i,n)})})},{link:function(t,e,r){return l.link(t,e,r),u(t,e,r)}}},f.directive("tgProjectDueDatesValues",["$log","$tgRepo","$tgConfirm","$tgLocation","animationFrame","$translate","$rootScope","tgProjectService",n]),t=function(){return{link:function(t,e,r,n){return t.colorList=d(),t.allowEmpty=!1,r.tgAllowEmpty&&(t.allowEmpty=!0),e.controller(),t.$watch(r.ngModel,function(e){return t.color=e.color}),e.on("click",".current-color",function(t){var r,n;return t.preventDefault(),t.stopPropagation(),n=angular.element(t.currentTarget),$(".select-color").hide(),n.siblings(".select-color").show(),(r=angular.element("body")).on("click",function(t){if(0===angular.element(t.target).parent(".select-color").length)return e.find(".select-color").hide(),r.unbind("click")})}),e.on("click",".select-color .color",function(r){var i;return r.preventDefault(),i=angular.element(r.currentTarget),t.$apply(function(){return n.$modelValue.color=i.data("color")}),e.find(".select-color").hide()}),e.on("click",".select-color .selected-color",function(r){return r.preventDefault(),t.$apply(function(){return n.$modelValue.color=t.color}),e.find(".select-color").hide()}),e.on("keyup","input",function(r){return r.stopPropagation(),13===r.keyCode?(t.$apply(function(){return n.$modelValue.color=t.color}),e.find(".select-color").hide()):27===r.keyCode?e.find(".select-color").hide():void 0}),t.$on("$destroy",function(){return e.off()})},require:"ngModel"}},f.directive("tgColorSelection",t),l=[{key:"text",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT"},{key:"multiline",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI"},{key:"richtext",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_RICHTEXT"},{key:"date",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE"},{key:"url",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL"},{key:"dropdown",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DROPDOWN"},{key:"checkbox",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_CHECKBOX"},{key:"number",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_NUMBER"}],e=function(t){function e(t,e,r,n,i,o,s,a,c,u,p){var d,h,f,g;this.scope=t,this.rootscope=e,this.repo=r,this.rs=n,this.params=i,this.q=o,this.location=s,this.navUrls=a,this.appMetaService=c,this.translate=u,this.projectService=p,this.moveCustomAttributes=y(this.moveCustomAttributes,this),this.deleteCustomAttribute=y(this.deleteCustomAttribute,this),this.saveCustomAttribute=y(this.saveCustomAttribute,this),this.createCustomAttribute=y(this.createCustomAttribute,this),this.loadCustomAttributes=y(this.loadCustomAttributes,this),this._onCustomAttributesModified=y(this._onCustomAttributesModified,this),this.scope.TYPE_CHOICES=l,this.scope.project=this.projectService.project.toJS(),this.scope.projectId=this.scope.project.id,h=this.translate.instant(this.scope.sectionName),f=this.translate.instant("ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE",{sectionName:h,projectName:this.scope.project.name}),d=this.scope.project.description,this.appMetaService.setAll(f,d),this.scope.init=(g=this,function(t){return g.scope.type=t,g.loadCustomAttributes()})}return m(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","tgProjectService"],e.prototype._parseAttributesExtra=function(){return this.scope.customAttributes=_.map(this.scope.customAttributes,(t=this,function(e){return t._parseAttributeExtra(e)}));var t},e.prototype._parseAttributeExtra=function(t){return"dropdown"!==t.type||t.extra||(t.extra=[""]),t},e.prototype._onCustomAttributesModified=function(){return this.rootscope.$broadcast("admin:project-custom-attributes:updated")},e.prototype.loadCustomAttributes=function(){return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then((t=this,function(e){var r;return t.scope.customAttributes=e,t.scope.maxOrder=null!=(r=_.maxBy(e,"order"))?r.order:void 0,t._parseAttributesExtra(),e}));var t},e.prototype.createCustomAttribute=function(t){return this.repo.create("custom-attributes/"+this.scope.type,t).then((e=this,function(){return e._onCustomAttributesModified()}));var e},e.prototype.saveCustomAttribute=function(t){return this.repo.save(t).then((e=this,function(){return e._onCustomAttributesModified()}));var e},e.prototype.deleteCustomAttribute=function(t){return this.repo.remove(t).then((e=this,function(){return e._onCustomAttributesModified()}));var e},e.prototype.moveCustomAttributes=function(t,e){var r,n,i;return n=(r=this.scope.customAttributes).indexOf(t),r.splice(n,1),r.splice(e,0,t),_.each(r,function(t,e){return t.order=e}),this.repo.saveAll(r).then((i=this,function(){return i._onCustomAttributesModified()}))},e}(h(g.Controller,g.PageMixin)),f.controller("ProjectCustomAttributesController",e),r=function(t,e,r,n){return{link:function(t,r,i){var o,s,a,c,u,l,d,h,f,g,m,v,y,_,b,S,j,k,I,E,C,T,A,P;return o=r.controller(),t.$on("$destroy",function(){return r.off()}),t.isExtraVisible={},a=function(t,e){return t.preventDefault(),e(angular.element(t.currentTarget).closest("form"))},b=function(){var t,n,i,s,a,c,u;for(u=r.find(".js-sortable"),(t=dragula([u[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:u[0],moves:function(t,e,r){return!$(r).closest(".js-child-sortable")[0]&&$(t).is("div[tg-bind-scope]")}})).on("dragend",function(t){var e,r,n;return e=(r=$(t)).scope().attr,n=r.index(),o.moveCustomAttributes(e,n)}),a=[],i=0,s=(c=r.find(".js-child-sortable")).length;i<s;i++)t[n=c[i]]=dragula([n],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:n,moves:function(t){return $(t).is("div[tg-bind-scope]")}}),a.push(t[n].on("dragend",function(t){var r,n,i,s,a;return r=(n=$(t)).scope().attr.extra,i=n.scope().$index,s=n.index(),a=r[i],r.splice(i,1),r.splice(s,0,a),n.scope().attr.setAttr("extra",r),o.saveCustomAttribute(n.scope().attr).then(function(){return e.notify("success")})}));return a},C=function(){return r.find(".js-new-custom-field").removeClass("hidden"),r.find(".js-new-custom-field input:visible").first().focus()},m=function(){return r.find(".js-new-custom-field").addClass("hidden")},I=function(){return r.find(".js-add-custom-field-button").removeClass("hidden")},f=function(){return r.find(".js-add-custom-field-button").addClass("hidden")},E=function(){return r.find(".js-cancel-new-custom-field-button").removeClass("hidden")},g=function(){return r.find(".js-cancel-new-custom-field-button").addClass("hidden")},j=function(){return t.newAttr={}},d=function(r){var n,i,s,a;if((i=r.checksley()).validate())return a=function(){return o.loadCustomAttributes(),m(),j(),e.notify("success")},s=function(t){return i.setErrors(t)},(n=t.newAttr).project=t.projectId,n.order=t.maxOrder?t.maxOrder+1:1,o.createCustomAttribute(n).then(a,s)},u=function(){return m(),j()},_=function(t){var e,r;if("dropdown"===(e=t.scope().newAttr?t.scope().newAttr:t.scope().attr).type&&(null==(r=e.extra)||!r.length))return e.extra=[""],e.id?T(t):(A(-1),t.scope().$apply())},t.$watch("customAttributes",function(t){if(t)return 0===t.length?(g(),f(),C()):(m(),I(),E(),b())}),r.on("change",".custom-field-type select",function(t){return a(t,_)}),r.on("click",".js-add-custom-field-button",function(t){return a(t,C)}),r.on("click",".js-create-custom-field-button",p(2e3,function(t){return a(t,d)})),r.on("click",".js-cancel-new-custom-field-button",function(t){return t.preventDefault(),u()}),r.on("keyup",".js-new-custom-field input",function(t){return 13===t.keyCode?a(t,d):27===t.keyCode?u():void 0}),T=function(e){return e.find(".js-view-custom-field").addClass("hidden"),e.find(".js-edit-custom-field").removeClass("hidden"),e.find(".js-edit-custom-field input:visible").first().focus().select(),e.find(".js-view-custom-field-extra").addClass("hidden"),e.find(".js-edit-custom-field-extra").removeClass("hidden"),e.find(".custom-extra-actions").removeClass("hidden"),A(e.scope().attr.id),t.$apply()},P=function(t){var r,n,i,s;if((n=t.checksley()).validate())return s=function(){return o.loadCustomAttributes(),v(t),e.notify("success")},i=function(t){return n.setErrors(t)},(r=t.scope().attr).setAttr("extra",r.extra),o.saveCustomAttribute(r).then(s,i)},l=function(t){return v(t),k(t)},v=function(t){return t.find(".js-edit-custom-field").addClass("hidden"),t.find(".js-view-custom-field").removeClass("hidden"),t.find(".js-edit-custom-field-extra").addClass("hidden"),t.find(".js-view-custom-field-extra").removeClass("hidden"),t.find(".custom-extra-actions").addClass("hidden")},k=function(e){return t.$apply(function(){return e.scope().attr.revert()})},r.on("click",".js-edit-custom-field-button",function(t){return a(t,T)}),r.on("click",".js-update-custom-field-button",p(1e3,function(t){return a(t,P)})),r.on("click",".js-cancel-edit-custom-field-button",function(t){return a(t,l)}),r.on("keyup",".js-edit-custom-field input",function(t){return 13===t.keyCode?a(t,P):27===t.keyCode?a(t,l):void 0}),h=function(t){var r,i,s,a;return r=t.scope().attr,i=r.name,a=n.instant("COMMON.CUSTOM_ATTRIBUTES.DELETE"),s=n.instant("COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE"),e.ask(a,s,i).then(function(t){var n,s;return s=function(){return o.loadCustomAttributes().finally(function(){return t.finish()})},n=function(){return e.notify("error",null,"We have not been able to delete '"+i+"'.")},o.deleteCustomAttribute(r).then(s,n)})},r.on("click",".js-delete-custom-field-button",p(2e3,function(t){return a(t,h)})),t.toggleExtraVisible=function(e){return t.isExtraVisible[e]?y(e):A(e)},A=function(e){return t.isExtraVisible[e]=!0},y=function(e){return t.isExtraVisible[e]=!1},s=function(t,e){return t.preventDefault(),e(angular.element(t.currentTarget).closest("form"),angular.element(t.currentTarget).closest(".js-form"))},c=function(t,e){var r,n;return((null!=(n=(r=t.scope()).newAttr)?n.extra:void 0)?r.newAttr.extra:r.attr.extra).push(""),r.$apply(),t.find(".js-edit-custom-field-extra").last().removeClass("hidden"),t.find(".js-view-custom-field-extra").last().addClass("hidden"),t.find(".js-edit-custom-field-extra input").last().focus()},S=function(t,e){return t.scope().attr.extra.splice(e.scope().$index,1),e.scope().$apply()},r.on("keyup",".js-edit-custom-field-extra input",function(t){return 13===t.keyCode?a(t,P):27===t.keyCode?a(t,l):void 0}),r.on("keyup",".js-new-custom-field-extra input",function(t){return 13===t.keyCode?a(t,d):27===t.keyCode?u():void 0}),r.on("click",".js-add-option-custom-field-extra-button",p(500,function(t){return s(t,c)})),r.on("click",".js-delete-custom-field-extra-button",p(500,function(t){return s(t,S)}))}}},f.directive("tgProjectCustomAttributes",["$log","$tgConfirm","animationFrame","$translate",r]),o=function(t){function e(t,e,r,n,i,o,s){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.model=o,this.projectService=s,this.mixingClass=y(this.mixingClass,this),this.cancelMixingTags=y(this.cancelMixingTags,this),this.confirmMixingTags=y(this.confirmMixingTags,this),this.toggleMixingFromTags=y(this.toggleMixingFromTags,this),this.startMixingTags=y(this.startMixingTags,this),this.deleteTag=y(this.deleteTag,this),this.editTag=y(this.editTag,this),this.createTag=y(this.createTag,this),this.filterAndSortTags=y(this.filterAndSortTags,this),this.loadTags=y(this.loadTags,this),this.loading=!0,this.loadTags()}return m(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$tgModel","tgProjectService"],e.prototype.loadTags=function(){var t,e;return t=this.projectService.project.toJS(),this.rs.projects.tagsColors(t.id).then((e=this,function(t){return e.scope.projectTagsAll=_.map(t.getAttrs(),function(t,r){return e.model.make_model("tag",{name:r,color:t})}),e.filterAndSortTags(),e.loading=!1}))},e.prototype.filterAndSortTags=function(){return this.scope.projectTags=_.sortBy(this.scope.projectTagsAll,function(t){return t.name.toLowerCase()}),this.scope.projectTags=_.filter(this.scope.projectTags,(t=this,function(e){return-1!==e.name.indexOf(t.scope.tagsFilter.name)}));var t},e.prototype.createTag=function(t,e){return this.rs.projects.createTag(this.scope.projectId,t,e)},e.prototype.editTag=function(t,e,r){return t===e&&(e=null),this.rs.projects.editTag(this.scope.projectId,t,e,r)},e.prototype.deleteTag=function(t){return this.scope.loadingDelete=!0,this.rs.projects.deleteTag(this.scope.projectId,t).finally((e=this,function(){return e.scope.loadingDelete=!1}));var e},e.prototype.startMixingTags=function(t){return this.scope.mixingTags.toTag=t.name},e.prototype.toggleMixingFromTags=function(t){var e;if(t.name!==this.scope.mixingTags.toTag)return-1===(e=this.scope.mixingTags.fromTags.indexOf(t.name))?this.scope.mixingTags.fromTags.push(t.name):this.scope.mixingTags.fromTags.splice(e,1)},e.prototype.confirmMixingTags=function(){var t,e,r;return e=this.scope.mixingTags.toTag,t=this.scope.mixingTags.fromTags,this.scope.loadingMixing=!0,this.rs.projects.mixTags(this.scope.projectId,e,t).then((r=this,function(){return r.cancelMixingTags(),r.loadTags()})).finally(function(t){return function(){return t.scope.loadingMixing=!1}}(this))},e.prototype.cancelMixingTags=function(){return this.scope.mixingTags.toTag=null,this.scope.mixingTags.fromTags=[]},e.prototype.mixingClass=function(t){if(null!==this.scope.mixingTags.toTag){if(t.name===this.scope.mixingTags.toTag)return"mixing-tags-to";if(-1!==this.scope.mixingTags.fromTags.indexOf(t.name))return"mixing-tags-from"}},e}(g.Controller),f.controller("ProjectTagsController",o),s=function(t,e,r,n,i,o,s){return{link:function(t,e,n){var i,a,c,u,l,d,h,f,g;return a=$(window),i=e.controller(),n.type,n.objname,d=function(){return t.tagsFilter={name:""}},u=function(){return t.mixingTags={toTag:null,fromTags:[]}},h=function(){return t.addNewElementText=o.instant("ADMIN.PROJECT_VALUES_TAGS.ACTION_ADD")},(l=function(){return t.newValue={tag:"",color:""}})(),d(),u(),h(),s.$on("$translateChangeEnd",function(){return t.$evalAsync(h)}),function(t){var r;if(null==t&&(t=!1),r=e.find(".table-main"),$(document.body).scrollTop(r.offset().top+r.height()),t)return e.find(".new-value input:visible").first().focus()},g=function(e){var r,n,o,a,c;if(n=e.parents("form"),(r=n.checksley()).validate())return(o=(c=n.scope().tag).clone()).revert(),t.loadingEdit=!0,(a=i.editTag(o.name,c.name,c.color)).then(function(){return i.loadTags().then(function(){var r;return(r=e.parents(".row.table-main")).addClass("hidden"),t.loadingEdit=!1,s.$broadcast("tags:updated"),r.siblings(".visualization").removeClass("hidden")})}),a.then(null,function(e){return t.loadingEdit=!1,r.setErrors(e.data)})},f=function(e){var r,n;if(e.parents("form"),(r=e.checksley()).validate())return t.loadingCreate=!0,(n=i.createTag(t.newValue.tag,t.newValue.color)).then(function(r){return i.loadTags().then(function(){return t.loadingCreate=!1,e.addClass("hidden"),s.$broadcast("tags:updated"),l()})}),n.then(null,function(e){return t.loadingCreate=!1,r.setErrors(e.data)})},c=function(e){var r,n,i;return n=e.parents(".row.table-main"),r=e.parents("form"),i=r.scope().tag,t.$apply(function(){return n.addClass("hidden"),i.revert(),n.siblings(".visualization").removeClass("hidden")})},t.$watch("tagsFilter.name",function(t){return i.filterAndSortTags()}),a.on("keyup",function(e){if(27===e.keyCode)return t.$apply(function(){return u()})}),e.on("click",".show-add-new",function(t){return t.preventDefault(),e.find(".new-value").removeClass("hidden")}),e.on("click",".add-new",p(2e3,function(t){var r;return t.preventDefault(),r=e.find(".new-value"),f(r)})),e.on("click",".delete-new",function(t){return t.preventDefault(),e.find(".new-value").addClass("hidden"),l()}),e.on("click",".mix-tags",function(e){var r;return e.preventDefault(),r=angular.element(e.currentTarget),t.$apply(function(){return i.startMixingTags(r.parents("form").scope().tag)})}),e.on("click",".mixing-row",function(e){var r;return e.preventDefault(),r=angular.element(e.currentTarget),t.$apply(function(){return i.toggleMixingFromTags(r.parents("form").scope().tag)})}),e.on("click",".mixing-confirm",function(e){return e.preventDefault(),e.stopPropagation(),t.$apply(function(){return i.confirmMixingTags()})}),e.on("click",".mixing-cancel",function(e){return e.preventDefault(),e.stopPropagation(),t.$apply(function(){return i.cancelMixingTags()})}),e.on("click",".edit-value",function(t){var e,r;return t.preventDefault(),(r=angular.element(t.currentTarget).parents(".row.table-main")).addClass("hidden"),(e=r.siblings(".edition")).removeClass("hidden"),e.find("input:visible").first().focus().select()}),e.on("keyup",".new-value input",function(t){var r;return 13===t.keyCode?(r=e.find(".new-value"),f(r)):27===t.keyCode?(e.find(".new-value").addClass("hidden"),l()):void 0}),e.on("keyup",".status-name input",function(t){var e;return e=angular.element(t.currentTarget),13===t.keyCode?g(e):27===t.keyCode?c(e):void 0}),e.on("click",".save",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),g(e)}),e.on("click",".cancel",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),c(e)}),e.on("click",".delete-tag",function(t){var e,n,a;return t.preventDefault(),e=angular.element(t.currentTarget).parents("form"),n=e.scope().tag,a=o.instant("ADMIN.COMMON.TITLE_ACTION_DELETE_TAG"),r.askOnDelete(a,n.name).then(function(t){var e,o;return o=function(){return i.loadTags().finally(function(){return s.$broadcast("tags:updated"),t.finish()})},e=function(){return r.notify("error")},i.deleteTag(n.name).then(o,e)})}),t.$on("$destroy",function(){return e.off(),a.off()})}}},f.directive("tgProjectTags",["$log","$tgRepo","$tgConfirm","$tgLocation","animationFrame","$translate","$rootScope",s])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p=function(t,e){return function(){return t.apply(e,arguments)}},d={}.hasOwnProperty,h=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};l=this.taiga,c=this.taiga.mixOf,s=this.taiga.bindOnce,a=this.taiga.debounce,o=this.taiga.bindMethods,u=angular.module("taigaAdmin"),n=function(t){function e(t,e,r,n,i,s,a,c,u,l,d,h,f,g){var m,v;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=s,this.q=a,this.location=c,this.navUrls=u,this.model=l,this.appMetaService=d,this.translate=h,this.errorHandlingService=f,this.projectService=g,this._disableComputable=p(this._disableComputable,this),this._enableComputable=p(this._enableComputable,this),o(this),this.scope.sectionName="ADMIN.MENU.PERMISSIONS",this.scope.project={},this.scope.anyComputableRole=!0,(m=this.loadInitialData()).then((v=this,function(){var t,e;return e=v.translate.instant("ADMIN.ROLES.PAGE_TITLE",{projectName:v.scope.project.name}),t=v.scope.project.description,v.appMetaService.setAll(e,t)})),m.then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)d.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,c(l.Controller,l.PageMixin,l.FiltersMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgModel","tgAppMetaService","$translate","tgErrorHandlingService","tgProjectService"],e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),(t=this.model.make_model("projects",t)).i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.anyComputableRole=_.some(_.map(t.roles,function(t){return t.computable})),t},e.prototype.loadRoles=function(){return this.rs.roles.list(this.scope.projectId).then((t=this,function(e){var r;return e=e.map(function(t){return t.external_user=!1,t}),r={name:t.translate.instant("ADMIN.ROLES.EXTERNAL_USER"),permissions:t.scope.project.public_permissions,external_user:!0},e.push(r),t.scope.roles=e,t.scope.role=t.scope.roles[0],e}));var t},e.prototype.loadInitialData=function(){return this.loadProject(),this.loadRoles()},e.prototype.forceLoadProject=function(){return this.rootscope.$broadcast("admin:project-roles:updated")},e.prototype.setRole=function(t){return this.scope.role=t,this.scope.$broadcast("role:changed",this.scope.role)},e.prototype.delete=function(){var t,e,r,n,i,o,s,a,c,u;for(t={},e=0,r=(n=this.scope.roles).length;e<r;e++)(o=n[e]).id!==this.scope.role.id&&(t[o.id]=o.name);return 0===_.keys(t).length?this.confirm.error(this.translate.instant("ADMIN.ROLES.ERROR_DELETE_ALL")):(a=this.translate.instant("ADMIN.ROLES.TITLE_DELETE_ROLE"),s=this.scope.role.name,i=this.translate.instant("ADMIN.ROLES.REPLACEMENT_ROLE"),c=this.translate.instant("ADMIN.ROLES.WARNING_DELETE_ROLE"),this.confirm.askChoice(a,s,t,i,c).then((u=this,function(t){var e,r;return r=function(){return u.forceLoadProject(),u.loadRoles().finally(function(){return t.finish()})},e=function(){return u.confirm.notify("error")},u.repo.remove(u.scope.role,{moveTo:t.selected}).then(r,e)})))},e.prototype._enableComputable=function(){var t,e,r;return r=this,e=function(){return r.confirm.notify("success"),r.forceLoadProject()},t=function(t){return function(){return t.confirm.notify("error"),t.scope.role.revert()}}(this),this.repo.save(this.scope.role).then(e,t)},e.prototype._disableComputable=function(){var t,e,r,n,i;return i=this,e=function(t){var e,r;return r=function(){return t.finish(),i.confirm.notify("success"),i.forceLoadProject()},e=function(){return t.finish(),i.confirm.notify("error"),i.scope.role.revert()},i.repo.save(i.scope.role).then(r,e)},t=function(t){return function(e){return t.scope.role.revert()}}(this),n=this.translate.instant("ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE"),r=this.translate.instant("ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE",{roleName:this.scope.role.name}),this.confirm.ask(n,r,"").then(e,t)},e.prototype.toggleComputable=a(2e3,function(){return this.scope.role.computable?this._enableComputable():this._disableComputable()}),e}(),u.controller("RolesController",n),t=function(t,e){return{link:function(r,n,i){var o,s;return s=function(){return n.find(".total").toggle(),n.find(".edit-role").toggle()},o=function(){var i;return r.role.name=n.find("input").val(),(i=t.save(r.role)).then(function(){return e.notify("success")}),i.then(null,function(t){return e.notify("error")}),s()},n.on("click",".edit-value",function(){return s(),n.find("input").focus(),n.find("input").val(r.role.name)}),n.on("click","a.save",o),n.on("keyup","input",function(t){return 13===t.keyCode?o():27===t.keyCode?s():void 0}),r.$on("role:changed",function(){if(n.find(".edit-role").is(":visible"))return s()}),r.$on("$destroy",function(){return n.off()})}}},u.directive("tgEditRole",["$tgRepo","$tgConfirm",t]),i=function(){return{link:function(t,e,r){return e.controller(),t.$on("$destroy",function(){return e.off()})}}},u.directive("tgRoles",i),e=function(t,e){var r;return r=["view_project","view_milestones","view_us","view_tasks","view_issues"],{link:function(n,i,o){var s;return s=i.controller(),n.$on("$destroy",function(){return i.off()}),i.on("click","a.add-button",function(t){return t.preventDefault(),i.find(".new").removeClass("hidden"),i.find(".new").focus(),i.find(".add-button").hide()}),i.on("keyup",".new",function(o){var a,c,u,l;return o.preventDefault(),13===o.keyCode?(l=angular.element(o.currentTarget),a={project:n.projectId,name:l.val(),permissions:r,order:_.maxBy(n.roles,function(t){return t.order}).order+1,computable:!1},i.find(".new").addClass("hidden"),i.find(".new").val(""),u=function(t){var e;return e=n.roles.length-1,n.roles.splice(e,0,t),s.setRole(t),i.find(".add-button").show(),s.forceLoadProject()},c=function(){return e.notify("error")},t.create("roles",a).then(u,c)):27===o.keyCode?(l=angular.element(o.currentTarget),i.find(".new").addClass("hidden"),i.find(".new").val(""),i.find(".add-button").show()):void 0})}}},u.directive("tgNewRole",["$tgRepo","$tgConfirm",e]),r=function(t,e,r,n){var i,o,a;return a=_.template('<div class="resume-title" translate="<%- category.name %>"></div>\n<div class="summary-role">\n    <div class="count"><%- category.activePermissions %>/<%- category.permissions.length %></div>\n    <% _.each(category.permissions, function(permission) { %>\n        <div class="role-summary-single <% if(permission.active) { %>active<% } %>"\n             title="{{ \'<%- permission.name %>\' | translate }}"></div>\n    <% }) %>\n</div>\n<tg-svg svg-icon="icon-arrow-right"></tg-svg>'),o=_.template('<div class="category-config" data-id="<%- index %>">\n    <div class="resume">\n    </div>\n    <div class="category-items">\n        <div class="items-container">\n        <% _.each(category.permissions, function(permission) { %>\n            <div class="category-item" data-id="<%- permission.key %>">\n                <span translate="<%- permission.name %>"></span>\n                <div class="check">\n                    <input type="checkbox"\n                           <% if(!permission.editable) { %> disabled="disabled" <% } %>\n                           <% if(permission.active) { %> checked="checked" <% } %>/>\n                    <div></div>\n                    <span class="check-text check-yes" translate="COMMON.YES"></span>\n                    <span class="check-text check-no" translate="COMMON.NO"></span>\n                </div>\n            </div>\n        <% }) %>\n        </div>\n    </div>\n</div>'),i=_.template('<div class="category-config-list"></div>'),{link:function(c,u,l){var p,d,f,g,m;return p=u.controller(),d=function(t){var e,r,n,i,o,s,a,u,l;return r=function(t,e,r){return!(e.external_user&&!r.is_private&&0===t.key.indexOf("view_"))},s=function(e){return _.map(e,function(e){return e.permissions=e.permissions.map(function(e){return e.editable=r(e,t,c.project),e}),_.extend({},e,{activePermissions:_.filter(e.permissions,"active").length})})},(e=[]).push({name:"COMMON.PERMISIONS_CATEGORIES.EPICS.NAME",permissions:(o=function(e){return _.map(e,function(e){var r;return _.extend({},e,{active:(r=e.key,h.call(t.permissions,r)>=0)})})})([{key:"view_epics",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.VIEW_EPICS"},{key:"add_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.ADD_EPICS"},{key:"modify_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.MODIFY_EPICS"},{key:"comment_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.COMMENT_EPICS"},{key:"delete_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.DELETE_EPICS"}])}),i=[{key:"view_milestones",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS"},{key:"add_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS"},{key:"modify_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS"},{key:"delete_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS"}],e.push({name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME",permissions:o(i)}),u=[{key:"view_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES"},{key:"add_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES"},{key:"modify_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES"},{key:"comment_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.COMMENT_USER_STORIES"},{key:"delete_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES"}],e.push({name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME",permissions:o(u)}),a=[{key:"view_tasks",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS"},{key:"add_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS"},{key:"modify_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS"},{key:"comment_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.COMMENT_TASKS"},{key:"delete_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS"}],e.push({name:"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME",permissions:o(a)}),n=[{key:"view_issues",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES"},{key:"add_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES"},{key:"modify_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES"},{key:"comment_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.COMMENT_ISSUES"},{key:"delete_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES"}],e.push({name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME",permissions:o(n)}),l=[{key:"view_wiki_pages",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES"},{key:"add_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES"},{key:"modify_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES"},{key:"delete_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES"},{key:"view_wiki_links",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS"},{key:"add_wiki_link",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS"},{key:"delete_wiki_link",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS"}],e.push({name:"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME",permissions:o(l)}),s(e)},m=function(t,e){return t.find(".resume").html(n(a({category:e}))(c))},f=function(t,e){var r;return r=o({category:t,index:e}),r=angular.element(r),m(r,t),n(r)(c)},g=function(){var n;return u.off(),n=i(),_.each(d(c.role),function(t,e){return n=angular.element(n).append(f(t,e))}),u.html(n),u.on("click",".resume",function(t){var e;return t.preventDefault(),(e=angular.element(t.currentTarget)).toggleClass("open-drawer"),e.next().toggleClass("open")}),u.on("change",".category-item input",function(n){var i,o,s,a;return i=function(){var t;return t=_.filter(u.find(".category-item input"),function(t){return angular.element(t).is(":checked")}),(t=_.sortBy(_.map(t,function(t){return angular.element(t).parents(".category-item").data("id")}))).length&&t.push("view_project"),t},a=angular.element(n.currentTarget),c.role.permissions=i(),s=function(){var e,n;return e=d(c.role),n=a.parents(".category-config").data("id"),m(a.parents(".category-config"),e[n]),t.$broadcast("projects:reload"),r.notify("success"),p.forceLoadProject()},o=function(){return r.notify("error"),a.prop("checked",!a.prop("checked")),c.role.permissions=i()},c.role.external_user?(c.project.public_permissions=c.role.permissions,c.project.anon_permissions=c.role.permissions.filter(function(t){return 0===t.indexOf("view_")}),e.save(c.project).then(s,o)):e.save(c.role).then(s,o)})},c.$on("$destroy",function(){return u.off()}),c.$on("role:changed",function(){return g()}),s(c,l.ngModel,g)}}},u.directive("tgRolePermissions",["$rootScope","$tgRepo","$tgConfirm","$compile",r])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,b=function(t,e){for(var r in e)S.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},S={}.hasOwnProperty;v=this.taiga,g=this.taiga.mixOf,h=this.taiga.bindMethods,f=this.taiga.debounce,y=this.taiga.timeout,m=angular.module("taigaAdmin"),d=function(t){function e(t,e,r,n,i,o,s,a,c,u){var l,p;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.location=i,this.navUrls=o,this.appMetaService=s,this.translate=a,this.errorHandlingService=c,this.projectService=u,h(this),this.scope.sectionName="ADMIN.WEBHOOKS.SECTION_NAME",this.scope.project={},(l=this.loadInitialData()).then((p=this,function(){var t,e;return e=p.translate.instant("ADMIN.WEBHOOKS.PAGE_TITLE",{projectName:p.scope.project.name}),t=p.scope.project.description,p.appMetaService.setAll(e,t)})),l.then(null,this.onInitialDataError.bind(this)),this.scope.$on("webhooks:reload",this.loadWebhooks)}return b(e,t),e.$inject=["$scope","$tgRepo","$tgResources","$routeParams","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","tgErrorHandlingService","tgProjectService"],e.prototype.loadWebhooks=function(){return this.rs.webhooks.list(this.scope.projectId).then((t=this,function(e){return t.scope.webhooks=e}));var t},e.prototype.loadProject=function(){var t;return(t=this.projectService.project.toJS()).i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},e.prototype.loadInitialData=function(){return this.loadProject(),this.loadWebhooks()},e}(g(v.Controller,v.PageMixin,v.FiltersMixin)),m.controller("WebhooksController",d),p=function(t,e,r,n,i){return{link:function(n,o,s){var a,c,u,l,p,d,h,g;return g=n.$eval(s.tgWebhook),d=function(){var e;return e=i.instant("ADMIN.WEBHOOKS.DATE"),t.webhooklogs.list(g.id).then(function(t){var r,n,i,o;for(r=0,n=t.length;r<n;r++)(i=t[r]).validStatus=200<=(o=i.status)&&o<300,i.prettySentHeaders=_.map(_.toPairs(i.request_headers),function(t){return t[0]+": "+t[1]}).join("\n"),i.prettySentData=JSON.stringify(i.request_data),i.prettyDate=moment(i.created).format(e);return g.logs_counter=t.length,g.logs=t,h()})},h=function(){var t,e,r;return(e=o.find(".toggle-history")).parents(".single-webhook-wrapper").find(".webhooks-history").hasClass("open")?(t=i.instant("ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY"),r=i.instant("ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE")):(t=i.instant("ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY"),r=i.instant("ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE")),e.text(t),e.prop("title",r)},p=function(){return o.find(".edition-mode").addClass("hidden"),o.find(".visualization-mode").removeClass("hidden")},l=function(){return o.find(".visualization-mode").addClass("hidden"),o.find(".edition-mode").removeClass("hidden")},c=function(){return o.find(".webhooks-history").addClass("open")},a=function(){return p(),n.$apply(function(){return g.revert()})},u=f(2e3,function(t){var n,i;if((n=t.parents("form").checksley()).validate())return(i=e.save(g)).then(function(){return p()}),i.then(null,function(t){return r.notify("error"),n.setErrors(t)})}),o.on("click",".test-webhook",function(){return c(),t.webhooks.test(g.id).then(function(){return d()})}),o.on("click",".edit-webhook",function(){return l()}),o.on("click",".cancel-existing",function(){return a()}),o.on("click",".edit-existing",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),u(e)}),o.on("keyup",".edition-mode input",function(t){var e;return 13===t.keyCode?(e=angular.element(t.currentTarget),u(e)):27===t.keyCode?(e=angular.element(t.currentTarget),a()):void 0}),o.on("click",".delete-webhook",function(){var t,o;return o=i.instant("ADMIN.WEBHOOKS.DELETE"),t=i.instant("ADMIN.WEBHOOKS.WEBHOOK_NAME",{name:g.name}),r.askOnDelete(o,t).then(function(t){var i,o;return o=function(){return t.finish(),n.$emit("webhooks:reload")},i=function(){return t.finish(!1),r.notify("error")},e.remove(g).then(o,i)})}),o.on("click",".toggle-history",function(t){return angular.element(t.currentTarget),null==g.logs||0===g.logs.length?d().then(function(){return y(0,function(){return o.find(".webhooks-history").toggleClass("open").slideToggle(),h()})}):(o.find(".webhooks-history").toggleClass("open").slideToggle(),n.$apply(function(){return h()}))}),o.on("click",".history-single",function(t){var e;return(e=angular.element(t.currentTarget)).toggleClass("history-single-open"),e.siblings(".history-single-response").toggleClass("open")}),o.on("click",".resend-request",function(e){var r;return r=angular.element(e.currentTarget).data("log"),t.webhooklogs.resend(r).then(function(){return d()})})}}},m.directive("tgWebhook",["$tgResources","$tgRepo","$tgConfirm","$tgLoading","$translate",p]),c=function(t,e,r,n,i){return{link:function(t,n,o){var s,a,c,u;return t.$eval(o.tgWebhook),a=n.find(".new-webhook-form"),s=n.find(".add-webhook"),(c=function(){return t.newValue={name:"",url:"",key:""}})(),t.$watch("webhooks",function(t){if(null!=t)return 0===t.length?(a.removeClass("hidden"),s.addClass("hidden"),a.find("input")[0].focus()):(a.addClass("hidden"),s.removeClass("hidden"))}),u=f(2e3,function(){var n,o;if((n=a.checksley()).validate())return t.newValue.project=t.project.id,(o=e.create("webhooks",t.newValue)).then(function(){return i.trackEvent("webhooks","create","Create new webhook",1),t.$emit("webhooks:reload"),c()}),o.then(null,function(t){return r.notify("error"),n.setErrors(t)})}),a.on("click",".add-new",function(t){return t.preventDefault(),u()}),a.on("keyup","input",function(t){if(13===t.keyCode)return u()}),a.on("click",".cancel-new",function(e){return t.$apply(function(){if(c(),t.webhooks.length>=1)return a.addClass("hidden")})}),s.on("click",function(t){return a.removeClass("hidden"),a.find("input")[0].focus()})}}},m.directive("tgNewWebhook",["$tgResources","$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",c]),r=function(t){function e(t,e,r,n,i,o,s){var a,c;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,h(this),this.scope.sectionName=this.translate.instant("ADMIN.GITHUB.SECTION_NAME"),this.scope.project={},(a=this.loadInitialData()).then((c=this,function(){var t,e;return e=c.translate.instant("ADMIN.GITHUB.PAGE_TITLE",{projectName:c.scope.project.name}),t=c.scope.project.description,c.appMetaService.setAll(e,t)})),a.then(null,this.onInitialDataError.bind(this))}return b(e,t),e.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],e.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"github").then((t=this,function(e){return t.scope.github=e}));var t},e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},e.prototype.loadInitialData=function(){return this.loadProject(),this.loadModules()},e}(g(v.Controller,v.PageMixin,v.FiltersMixin)),m.controller("GithubController",r),i=function(t){function e(t,e,r,n,i,o,s){var a,c;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,h(this),this.scope.sectionName=this.translate.instant("ADMIN.GITLAB.SECTION_NAME"),this.scope.project={},(a=this.loadInitialData()).then((c=this,function(){var t,e;return e=c.translate.instant("ADMIN.GITLAB.PAGE_TITLE",{projectName:c.scope.project.name}),t=c.scope.project.description,c.appMetaService.setAll(e,t)})),a.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:modules:reload",function(t){return function(){return t.loadModules()}}(this))}return b(e,t),e.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],e.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"gitlab").then((t=this,function(e){return t.scope.gitlab=e}));var t},e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},e.prototype.loadInitialData=function(){return this.loadProject(),this.loadModules()},e}(g(v.Controller,v.PageMixin,v.FiltersMixin)),m.controller("GitlabController",i),t=function(t){function e(t,e,r,n,i,o,s){var a,c;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,h(this),this.scope.sectionName=this.translate.instant("ADMIN.BITBUCKET.SECTION_NAME"),this.scope.project={},(a=this.loadInitialData()).then((c=this,function(){var t,e;return e=c.translate.instant("ADMIN.BITBUCKET.PAGE_TITLE",{projectName:c.scope.project.name}),t=c.scope.project.description,c.appMetaService.setAll(e,t)})),a.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:modules:reload",function(t){return function(){return t.loadModules()}}(this))}return b(e,t),e.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],e.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"bitbucket").then((t=this,function(e){return t.scope.bitbucket=e}));var t},e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},e.prototype.loadInitialData=function(){return this.loadProject(),this.loadModules()},e}(g(v.Controller,v.PageMixin,v.FiltersMixin)),m.controller("BitbucketController",t),u=function(t,e){return{link:function(r,n,i){return n.on("click",".select-input-content",function(){var r;if((r=n.find("input")).val())return r.select(),document.execCommand("copy"),e.notify("success",t.instant("COMMON.COPIED_TO_CLIPBOARD"))})}}},m.directive("tgSelectInputText",["$translate","$tgConfirm",u]),n=function(t,e,r,n){return{link:function(i,o,s){var a,c,u;return a=o.find("form").checksley({onlyOneErrorElement:!0}),c=f(2e3,function(o){var s,c;if(o.preventDefault(),a.validate())return s=r().target(u).start(),(c=t.saveAttribute(i.github,"github")).then(function(){return n.trackEvent("github-webhook","created-or-changed","Create or changed github webhook",1),s.finish(),e.notify("success")}),c.then(null,function(t){if(s.finish(),a.setErrors(t),t._error_message)return e.notify("error",t._error_message)})}),u=o.find(".submit-button"),o.on("submit","form",c)}}},m.directive("tgGithubWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",n]),o=function(t,e,r,n){return{link:function(i,o,s){var a,c,u;return a=o.find("form").checksley({onlyOneErrorElement:!0}),c=f(2e3,function(o){var s,c;if(o.preventDefault(),a.validate())return s=r().target(u).start(),(c=t.saveAttribute(i.gitlab,"gitlab")).then(function(){return n.trackEvent("gitlab-webhook","created-or-changed","Create or changed gitlab webhook",1),s.finish(),e.notify("success"),i.$emit("project:modules:reload")}),c.then(null,function(t){if(s.finish(),a.setErrors(t),t._error_message)return e.notify("error",t._error_message)})}),u=o.find(".submit-button"),o.on("submit","form",c)}}},m.directive("tgGitlabWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",o]),e=function(t,e,r,n){return{link:function(i,o,s){var a,c,u;return a=o.find("form").checksley({onlyOneErrorElement:!0}),c=f(2e3,function(o){var s,c;if(o.preventDefault(),a.validate())return s=r().target(u).start(),(c=t.saveAttribute(i.bitbucket,"bitbucket")).then(function(){return n.trackEvent("bitbucket-webhook","created-or-changed","Create or changed bitbucket webhook",1),s.finish(),e.notify("success"),i.$emit("project:modules:reload")}),c.then(null,function(t){if(s.finish(),a.setErrors(t),t._error_message)return e.notify("error",t._error_message)})}),u=o.find(".submit-button"),o.on("submit","form",c)}}},m.directive("tgBitbucketWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",e]),l=function(){return{link:function(t,e,r,n){return n.$parsers.push(function(t){return""===(t=$.trim(t))?[]:t.split(",")})},restrict:"EA",require:"ngModel"}},m.directive("tgValidOriginIps",l),s=function(t){function e(t,e,r,n,i,o,s){var a,c;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,h(this),this.scope.sectionName=this.translate.instant("ADMIN.GOGS.SECTION_NAME"),this.scope.project={},(a=this.loadInitialData()).then((c=this,function(){var t,e;return e=c.translate.instant("ADMIN.GOGS.PAGE_TITLE",{projectName:c.scope.project.name}),t=c.scope.project.description,c.appMetaService.setAll(e,t)})),a.then(null,this.onInitialDataError.bind(this))}return b(e,t),e.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],e.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"gogs").then((t=this,function(e){return t.scope.gogs=e}));var t},e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},e.prototype.loadInitialData=function(){return this.loadProject(),this.loadModules()},e}(g(v.Controller,v.PageMixin,v.FiltersMixin)),a=function(t,e,r,n){return{link:function(i,o,s){var a,c,u;return a=o.find("form").checksley({onlyOneErrorElement:!0}),c=f(2e3,function(o){var s,c;if(o.preventDefault(),a.validate())return s=r().target(u).start(),(c=t.saveAttribute(i.gogs,"gogs")).then(function(){return n.trackEvent("gogs-webhook","create-or-change","Create or change gogs webhook",1),s.finish(),e.notify("success"),i.$emit("project:modules:reload")}),c.then(null,function(t){if(s.finish(),a.setErrors(t),t._error_message)return e.notify("error",t._error_message)})}),u=o.find(".submit-button"),o.on("submit","form",c),o.on("click",".submit-button",c)}}},m.controller("GogsController",s),m.directive("tgGogsWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",a])}.call(this),function(){var t;this.taiga,this.taiga.bindOnce,this.taiga.timeout,this.taiga.debounce,t=function(t,e,r,n,i,o,s,a,c,u){return{link:function(r,l,p){var d,h;return d=null,r.$on("deletelightbox:new",function(t,e){return s.open(l),d=e}),r.$on("$destroy",function(){return l.off()}),h=function(){var r;return a.start(),s.close(l),(r=t.remove(d)).then(function(t){return u.trackEvent("projects","delete","Delete project",1),a.pageLoaded(),e.$broadcast("projects:reload"),n.path(i.resolve("home")),o.notify("success"),c.loadProjects()}),r.then(null,function(){return o.notify("error"),s.close(l)})},l.on("click",".button-red",function(t){return t.preventDefault(),s.close(l)}),l.on("click",".button-green",function(t){return t.preventDefault(),h()})}}},angular.module("taigaProject").directive("tgLbDeleteProject",["$tgRepo","$rootScope","$tgAuth","$tgLocation","$tgNavUrls","$tgConfirm","lightboxService","tgLoader","tgCurrentUserService","$tgAnalytics",t])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u,l;u=this.taiga.bindOnce,r=function(){return{link:function(t,e,r){return u(t,r.tgBoBind,function(t){return e.text(t)})}}},i=function(){return{link:function(t,e,r){return u(t,r.tgBoHtml,function(t){return e.html(t)})}}},o=function(){return{link:function(t,e,r){return u(t,r.tgBoRef,function(t){return e.html("#"+t+" ")})}}},s=function(){return{link:function(t,e,r){return u(t,r.tgBoSrc,function(t){return e.attr("src",t)})}}},n=function(){return{link:function(t,e,r){return u(t,r.tgBoHref,function(t){return e.attr("href",t)})}}},e=function(){return{link:function(t,e,r){return u(t,r.tgBoAlt,function(t){return e.attr("alt",t)})}}},a=function(){return{link:function(t,e,r){return u(t,r.tgBoTitle,function(t){return e.attr("title",t)})}}},c=function(){return{link:function(t,e,r){return t.$watch(r.tgTitleHtml,function(t){if(null!=t)return e.attr("title",t)})}}},t=function(){return{link:function(t,e,r){return t.$watch(r.tgBindHtml,function(t){if(null!=t)return e.html(t)})}}},(l=angular.module("taigaBase")).directive("tgBoBind",r),l.directive("tgBoHtml",i),l.directive("tgBoRef",o),l.directive("tgBoSrc",s),l.directive("tgBoHref",n),l.directive("tgBoAlt",e),l.directive("tgBoTitle",a),l.directive("tgBindTitle",c),l.directive("tgBindHtml",t)}.call(this),function(){var t;t=function(){function t(){this.config=window.taigaConfig}return t.prototype.get=function(t,e){return null==e&&(e=null),_.has(this.config,t)?this.config[t]:e},t}(),angular.module("taigaBase").service("$tgConfig",t)}.call(this),function(){var t,e,r,n=function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;r=angular.module("taigaBase"),t=function(t){function e(t,e,r,n,i,o,s){this.rootScope=t,this.scope=e,this.params=r,this.repo=n,this.rs=i,this.confirm=o,this.projectService=s,this.scope.currentPlugin=_.head(_.filter(this.rootScope.adminPlugins,{slug:this.params.plugin})),this.scope.projectSlug=this.params.pslug,this.loadInitialData()}return n(e,t),e.$inject=["$rootScope","$scope","$routeParams","$tgRepo","$tgResources","$tgConfirm","tgProjectService"],e.prototype.loadProject=function(){var t;return t=this.projectService.project.toJS(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.$broadcast("project:loaded",t),t},e.prototype.loadInitialData=function(){return this.loadProject()},e}(taiga.Controller),r.controller("ContribController",t),e=function(t){function e(t,e,r){this.rootScope=t,this.scope=e,this.params=r,this.scope.currentPlugin=_.head(_.filter(this.rootScope.userSettingsPlugins,{slug:this.params.plugin}))}return n(e,t),e.$inject=["$rootScope","$scope","$routeParams"],e}(taiga.Controller),r.controller("ContribUserSettingsController",e)}.call(this),function(){var t,e={}.hasOwnProperty;t=this.taiga,function(r){function n(t,e){this.storage=t,this.params=e}(function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype})(n,t.Service),n.$inject=["$tgStorage","$routeParams"],n.prototype.generateHash=function(t){return null==t&&(t=[]),t=_.map(t,function(t){return JSON.stringify(t)}),hex_sha1(t.join(":"))}}()}.call(this),function(){var t,e,r={}.hasOwnProperty;e=this.taiga,t=function(t){function n(t,e,r,i,o,s){this.http=t,this.q=e,this.storage=r,this.rootScope=i,this.cacheFactory=o,this.translate=s,n.__super__.constructor.call(this),this.cache=this.cacheFactory("httpget")}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(n,e.Service),n.$inject=["$http","$q","$tgStorage","$rootScope","$cacheFactory","$translate"],n.prototype.headers=function(){var t,e,r;return t={},(r=this.storage.get("token"))&&(t.Authorization="Bearer "+r),(e=this.translate.preferredLanguage())&&(t["Accept-Language"]=e),t},n.prototype.request=function(t){return t.headers=_.assign({},t.headers||{},this.headers()),this.http(t)},n.prototype.get=function(t,e,r){return r=_.assign({method:"GET",url:t},r),e&&(r.params=e),r.cache=this.cache,this.request(r).finally((n=this,function(t){return n.cache.removeAll()}));var n},n.prototype.post=function(t,e,r,n){return n=_.assign({method:"POST",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},n.prototype.put=function(t,e,r,n){return n=_.assign({method:"PUT",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},n.prototype.patch=function(t,e,r,n){return n=_.assign({method:"PATCH",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},n.prototype.delete=function(t,e,r,n){return n=_.assign({method:"DELETE",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},n}(),angular.module("taigaBase").service("$tgHttp",t)}.call(this),function(){var t;t=function(t,e,r){return t.noreload=function(r){var n,i;return n=e.current,i=r.$on("$locationChangeSuccess",function(){return e.current=n,i()}),t},t.isInCurrentRouteParams=function(e,r){return(t.search()||{})[e]===r},t},angular.module("taigaBase").factory("$tgLocation",["$location","$route","$rootScope",t])}.call(this),function(){var t,e,r,n=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},i={}.hasOwnProperty;t=function(){function t(t,e,r){this._attrs=e,this._name=t,this._dataTypes=r,this.setAttrs(e),this.initialize()}return t.prototype.realClone=function(){var e,r;return e=_.cloneDeep(this._attrs),(r=new t(this._name,e,this._dataTypes))._modifiedAttrs=_.cloneDeep(this._modifiedAttrs),r._isModified=_.cloneDeep(this._isModified),r},t.prototype.clone=function(){var e;return(e=new t(this._name,this._attrs,this._dataTypes))._modifiedAttrs=this._modifiedAttrs,e._isModified=this._isModified,e},t.prototype.applyCasts=function(){var t,e,r,n,i;for(t in i=[],n=this._dataTypes)r=n[t],(e=service.casts[r])&&i.push(this._attrs[t]=e(this._attrs[t]));return i},t.prototype.getIdAttrName=function(){return"id"},t.prototype.getName=function(){return this._name},t.prototype.getAttrs=function(t){return null==t&&(t=!1),null!=this._attrs.version&&(this._modifiedAttrs.version=this._attrs.version),t?_.extend({},this._modifiedAttrs):_.extend({},this._attrs,this._modifiedAttrs)},t.prototype.setAttrs=function(t){return this._attrs=t,this._modifiedAttrs={},this.applyCasts(),this._isModified=!1},t.prototype.setAttr=function(t,e){return this._modifiedAttrs[t]=e,this._isModified=!0},t.prototype.initialize=function(){var t,e,r;return e=this,t=function(t){return function(){return"string"==typeof t&&"__"===t.substr(0,2)?e[t]:n.call(_.keys(e._modifiedAttrs),t)<0?e._attrs[t]:e._modifiedAttrs[t]}},r=function(t){return function(r){"string"!=typeof t||"__"!==t.substr(0,2)?e._attrs[t]!==r?(e._modifiedAttrs[t]=r,e._isModified=!0):delete e._modifiedAttrs[t]:e[t]=r}},_.each(this._attrs,function(n,i){var o;return o={get:t(i),set:r(i),enumerable:!0,configurable:!0},Object.defineProperty(e,i,o)})},t.prototype.serialize=function(){var t;return t={data:_.clone(this._attrs),name:this._name},JSON.stringify(t)},t.prototype.isModified=function(){return this._isModified},t.prototype.isAttributeModified=function(t){return null!=this._modifiedAttrs[t]},t.prototype.markSaved=function(){return this._isModified=!1,this._attrs=this.getAttrs(),this._modifiedAttrs={}},t.prototype.revert=function(){return this._modifiedAttrs={},this._isModified=!1},t.desSerialize=function(e){var r;return new t((r=JSON.parse(e)).url,r.data)},t}(),r=this.taiga,function(t){function e(t,r,n,i){this.q=t,this.urls=r,this.storage=n,this.http=i,e.__super__.constructor.call(this)}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,r.Service),e.$inject=["$q","$tgUrls","$tgStorage","$tgHttp"]}(),e=function(e,r,n,i){var o;return(o={}).make_model=function(e,r,n,i){return null==n&&(n=t),null==i&&(i={}),new n(e,r,i)},o.cls=t,o.casts={int:function(t){return parseInt(t,10)},float:function(t){return parseFloat(t,10)}},o},angular.module("taigaBase").factory("$tgModel",["$q","$http","$tgUrls","$tgStorage",e])}.call(this),function(){var t,e,r,n,i,o,s={}.hasOwnProperty;i=this.taiga,o=this.taiga.trim,r=this.taiga.bindOnce,n=angular.module("taigaBase"),e=function(t){function e(){this.urls={}}return function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,i.Service),e.prototype.update=function(t){return this.urls=_.merge({},this.urls,t||{})},e.prototype.formatUrl=function(t,e){var r;return null==e&&(e={}),r=function(t){return t=o(t,":"),e[t]||"undefined"},t.replace(/(:\w+)/g,r)},e.prototype.resolve=function(t,e){var r;return(r=this.urls[t])?e?this.formatUrl(r,e):r:""},e}(),n.service("$tgNavUrls",e),t=function(t,e,n,i,s,a){var c,u;return c=function(t,e){var i;return i=n.defer(),r(t,e,function(t){return i.resolve(t)}),i.promise},u=function(t,e){var r,i,s,a,u,l,p,d;if(l=_.map(t.split(":"),o),i=l[0],a=l[1])for(p=a.split(/(\w+)=/),p=_.filter(p,function(t){return t.length}),p=_.map(p,function(t){return o(t.replace(/,$/g,""))}),a=[],r=0;r<p.length;)(s={})[p[r]]=p[r+1],a.push(s),r+=2;else a=[];return d=_.map(a,function(t){return _.values(t)[0]}),u=_.map(d,function(t){return c(e,t)}),n.all(u).then(function(){var t,r,n,o,s,c;for(o={},t=0,n=a.length;t<n;t++)c=(s=a[t])[r=Object.keys(s)[0]],o[r]=e.$eval(c);return[i,o]})},{link:function(r,n,o){return n.is("a")&&n.attr("href","#"),n.on("mouseenter",function(c){var l;if(!(l=$(c.currentTarget)).data("fullUrl")||o.tgNavGetParams!==l.data("params"))return u(o.tgNav,r).then(function(c){var u,p,d,h,f,g,m;return h=c[0],f=c[1],(m=e.getUser())&&(f.user=m.username),"project"===h&&(h=h+"-"+a.getPath(f.project,f.section)),g=t.resolve(h),u=t.formatUrl(g,f),o.tgNavGetParams&&(p=JSON.parse(o.tgNavGetParams),d=$.param(p),u=u+"?"+d,l.data("params",o.tgNavGetParams)),l.data("fullUrl",u),l.is("a")&&l.attr("href",u),n.on("click",function(t){if(!t.metaKey&&!t.ctrlKey&&(t.preventDefault(),!(l=$(t.currentTarget)).hasClass("noclick"))){switch(u=l.data("fullUrl"),t.which){case 1:i.url(u),r.$apply();break;case 2:window.open(u)}return s.closeAll()}})})}),r.$on("$destroy",function(){return n.off()})}}},n.directive("tgNav",["$tgNavUrls","$tgAuth","$q","$tgLocation","lightboxService","$tgSections",t])}.call(this),function(){var t,e,r={}.hasOwnProperty;e=this.taiga,t=function(t){function n(t,e,r,i,o){this.q=t,this.model=e,this.storage=r,this.http=i,this.urls=o,n.__super__.constructor.call(this)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(n,e.Service),n.$inject=["$q","$tgModel","$tgStorage","$tgHttp","$tgUrls"],n.prototype.resolveUrlForModel=function(t){var e;return e=t.getIdAttrName(),this.urls.resolve(t.getName())+"/"+t[e]},n.prototype.resolveUrlForAttributeModel=function(t){return this.urls.resolve(t.getName(),t.parent)},n.prototype.create=function(t,e,r,n){var i,o,s,a;return null==r&&(r={}),null==n&&(n={}),i=this.q.defer(),s=this.urls.resolve(t),(o=this.http.post(s,JSON.stringify(e),n)).success((a=this,function(e,n){return i.resolve(a.model.make_model(t,e,null,r))})),o.error(function(t,e){return i.reject(t)}),i.promise},n.prototype.remove=function(t,e){var r,n,i;return null==e&&(e={}),r=this.q.defer(),i=this.resolveUrlForModel(t),(n=this.http.delete(i,{},e)).success(function(e,n){return r.resolve(t)}),n.error(function(e,n){return r.reject(t)}),r.promise},n.prototype.saveAll=function(t,e){var r,n;return null==e&&(e=!0),r=_.map(t,(n=this,function(t){return n.save(t,!0)})),this.q.all(r)},n.prototype.save=function(t,e,r,n,i){var o,s,a,c;return null==e&&(e=!0),null==r&&(r={}),null==i&&(i=!1),s=this.q.defer(),!t.isModified()&&e?(s.resolve(t),s.promise):(c=this.resolveUrlForModel(t),o=JSON.stringify(t.getAttrs(e)),(a=e?this.http.patch(c,o,r,n):this.http.put(c,o,r,n)).success(function(e,r,n,o){return t._isModified=!1,t._attrs=_.extend(t.getAttrs(),e),t._modifiedAttrs={},t.applyCasts(),i?s.resolve([t,n()]):s.resolve(t)}),a.error(function(t,e){return s.reject(t)}),s.promise)},n.prototype.saveAttribute=function(t,e,r){var n,i,o,s;return null==r&&(r=!0),i=this.q.defer(),!t.isModified()&&r?(i.resolve(t),i.promise):(s=this.resolveUrlForAttributeModel(t),(n={})[e]=t.getAttrs(),(o=r?this.http.patch(s,n):this.http.put(s,n)).success(function(e,r){return t._isModified=!1,t._attrs=_.extend(t.getAttrs(),e),t._modifiedAttrs={},t.applyCasts(),i.resolve(t)}),o.error(function(t,e){return i.reject(t)}),i.promise)},n.prototype.refresh=function(t){var e,r,n;return e=this.q.defer(),n=this.resolveUrlForModel(t),(r=this.http.get(n)).success(function(r,n){return t._modifiedAttrs={},t._attrs=r,t._isModified=!1,t.applyCasts(),e.resolve(t)}),r.error(function(t,r){return e.reject(t)}),e.promise},n.prototype.queryMany=function(t,e,r,n){var i,o,s;return null==r&&(r={}),null==n&&(n=!1),o=this.urls.resolve(t),i={headers:{}},r.enablePagination||(i.headers["x-disable-pagination"]="1"),this.http.get(o,e,i).then((s=this,function(e){var r;return r=_.map(e.data,function(e){return s.model.make_model(t,e)}),n?[r,e.headers]:r}))},n.prototype.queryOneAttribute=function(t,e,r,n,i){var o,s,a;return null==i&&(i={}),s=this.urls.resolve(t,e),o={headers:{}},i.enablePagination||(o.headers["x-disable-pagination"]="1"),this.http.get(s,n,o).then((a=this,function(n){var i;return(i=a.model.make_model(t,n.data[r])).parent=e,i}))},n.prototype.queryOne=function(t,e,r,n){var i,o,s;return null==n&&(n={}),o=this.urls.resolve(t),e&&(o=o+"/"+e),i={headers:{}},n.enablePagination||(i.headers["x-disable-pagination"]="1"),this.http.get(o,r,i).then((s=this,function(e){return s.model.make_model(t,e.data)}))},n.prototype.queryOneRaw=function(t,e,r,n){var i,o;return null==n&&(n={}),o=this.urls.resolve(t),e&&(o=o+"/"+e),i=_.merge({headers:{}},n),n.enablePagination||(i.headers["x-disable-pagination"]="1"),this.http.get(o,r,i).then(function(t){return t.data})},n.prototype.queryPaginated=function(t,e,r){var n,i,o;return null==r&&(r={}),i=this.urls.resolve(t),n=_.merge({headers:{}},r),this.http.get(i,e,n).then((o=this,function(e){var r,n;return r=e.headers(),(n={}).models=_.map(e.data,function(e){return o.model.make_model(t,e)}),n.count=parseInt(r["x-pagination-count"],10),n.current=parseInt(r["x-pagination-current"]||1,10),n.paginatedBy=parseInt(r["x-paginated-by"],10),n}))},n.prototype.queryOnePaginatedRaw=function(t,e,r,n){var i,o;return null==n&&(n={}),o=this.urls.resolve(t),e&&(o=o+"/"+e),i=_.merge({headers:{}},n),this.http.get(o,r,i).then(function(t){var e,r;return e=t.headers(),(r={}).data=t.data,r.count=parseInt(e["x-pagination-count"],10),r.current=parseInt(e["x-pagination-current"]||1,10),r.paginatedBy=parseInt(e["x-paginated-by"],10),r})},n.prototype.resolve=function(t){var e,r;return r={},null!=t.pslug&&(r.project=t.pslug),null!=t.usref&&(r.us=t.usref),null!=t.taskref&&(r.task=t.taskref),null!=t.issueref&&(r.issue=t.issueref),null!=t.sslug&&(r.milestone=t.sslug),null!=t.wikipage&&(r.wikipage=t.wikipage),null!=t.ref&&(r.ref=t.ref),e=!(t.wikipage||t.sslug),this.queryOneRaw("resolver",null,r,{cache:e})},n}(),angular.module("taigaBase").service("$tgRepo",t)}.call(this),function(){var t,e,r={}.hasOwnProperty;e=this.taiga,t=function(t){function n(t){n.__super__.constructor.call(this)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(n,e.Service),n.$inject=["$rootScope"],n.prototype.get=function(t,e){var r;return null===(r=localStorage.getItem(t))?e||null:JSON.parse(r)},n.prototype.set=function(t,e){return _.isObject(t)?_.each(t,(r=this,function(t,e){return r.set(e,t)})):localStorage.setItem(t,JSON.stringify(e));var r},n.prototype.contains=function(t){return null!==this.get(t)},n.prototype.remove=function(t){return localStorage.removeItem(t)},n.prototype.clear=function(){return localStorage.clear()},n}(),angular.module("taigaBase").service("$tgStorage",t)}.call(this),function(){var t,e,r,n={}.hasOwnProperty;e=function(t,e){return e=_.clone(e),t.replace(/%s/g,function(t){return String(e.shift())})},r=this.taiga,t=function(t){function i(t){this.config=t,this.urls={},this.mainUrl=this.config.get("api")}return function(t,e){for(var r in e)n.call(e,r)&&(t[r]=e[r]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(i,r.Service),i.$inject=["$tgConfig"],i.prototype.update=function(t){return this.urls=_.merge(this.urls,t)},i.prototype.resolve=function(){var t,r,n;if(0===(t=_.toArray(arguments)).length)throw Error("wrong arguments to setUrls");return r=t.slice(0,1)[0],n=e(this.urls[r],t.slice(1)),e("%s/%s",[_.trimEnd(this.mainUrl,"/"),_.trimStart(n,"/")])},i.prototype.resolveAbsolute=function(){var t;return t=this.resolve.apply(this,arguments),/^https?:\/\//i.test(t)?t:/^\//.test(t)?window.location.protocol+"//"+window.location.host+t:window.location.protocol+"//"+window.location.host+"/"+t},i}(),angular.module("taigaBase").service("$tgUrls",t)}.call(this),function(){var t;this.taiga,t=function(t){var e,r;return e=function(e,r){return t.queryOne(r,e)},r={epic:{get:function(t){return e(t,"custom-attributes-values/epic")}},userstory:{get:function(t){return e(t,"custom-attributes-values/userstory")}},task:{get:function(t){return e(t,"custom-attributes-values/task")}},issue:{get:function(t){return e(t,"custom-attributes-values/issue")}}},function(t){return t.customAttributesValues=r}},angular.module("taigaResources").factory("$tgCustomAttributesValuesResourcesProvider",["$tgRepo",t])}.call(this),function(){var t;this.taiga,this.taiga.sizeFormat,t=function(t){var e,r;return e=function(e,r){return t.queryMany(r,{project:e})},r={epic:{list:function(t){return e(t,"custom-attributes/epic")}},userstory:{list:function(t){return e(t,"custom-attributes/userstory")}},task:{list:function(t){return e(t,"custom-attributes/task")}},issue:{list:function(t){return e(t,"custom-attributes/issue")}}},function(t){return t.customAttributes=r}},angular.module("taigaResources").factory("$tgCustomAttributesResourcesProvider",["$tgRepo",t])}.call(this),function(){var t,e,r;r=this.taiga,t=r.generateHash,e=function(e,r,n,i){var o;return"epics-queryparams",(o={}).getByRef=function(t,r){var n;return(n=o.getQueryParams(t)).project=t,n.ref=r,e.queryOne("epics","by_ref",n)},o.listValues=function(t,r){var n;return n={project:t},o.storeQueryParams(t,n),e.queryMany(r,n)},o.storeQueryParams=function(e,r){var n;return n=t([e,e+":epics-queryparams"]),i.set(n,r)},o.getQueryParams=function(e){var r;return r=t([e,e+":epics-queryparams"]),i.get(r)||{}},o.upvote=function(t){var e;return e=n.resolve("epic-upvote",t),r.post(e)},o.downvote=function(t){var e;return e=n.resolve("epic-downvote",t),r.post(e)},o.watch=function(t){var e;return e=n.resolve("epic-watch",t),r.post(e)},o.unwatch=function(t){var e;return e=n.resolve("epic-unwatch",t),r.post(e)},function(t){return t.epics=o}},angular.module("taigaResources").factory("$tgEpicsResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage",e])}.call(this),function(){var t;this.taiga,t=function(t,e,r){var n;return(n={}).get=function(e,r,n){return t.queryOneRaw("history/"+e,r,{type:n})},n.editComment=function(t,n,i,o){var s,a,c;return c=(c=r.resolve("history/"+t))+"/"+n+"/edit_comment",a={id:i},s={comment:o},e.post(c,s,a).then(function(t){return t.data})},n.getCommentHistory=function(t,n,i){var o,s;return s=(s=r.resolve("history/"+t))+"/"+n+"/comment_versions",o={id:i},e.get(s,o).then(function(t){return t.data})},n.deleteComment=function(t,n,i){var o,s;return s=(s=r.resolve("history/"+t))+"/"+n+"/delete_comment",o={id:i},e.post(s,null,o).then(function(t){return t.data})},n.undeleteComment=function(t,n,i){var o,s;return s=(s=r.resolve("history/"+t))+"/"+n+"/undelete_comment",o={id:i},e.post(s,null,o).then(function(t){return t.data})},function(t){return t.history=n}},angular.module("taigaResources").factory("$tgHistoryResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){var t;this.taiga,t=function(t){var e;return(e={}).get=function(e){return t.queryOne("invitations",e)},function(t){return t.invitations=e}},angular.module("taigaResources").factory("$tgInvitationsResourcesProvider",["$tgRepo",t])}.call(this),function(){var t,e,r;r=this.taiga,t=r.generateHash,e=function(e,r,n,i,o){var s;return"issues-queryparams",(s={}).get=function(t,r){var n;return(n=s.getQueryParams(t)).project=t,e.queryOne("issues",r,n)},s.getByRef=function(t,r){var n;return(n=s.getQueryParams(t)).project=t,n.ref=r,e.queryOne("issues","by_ref",n)},s.listInAllProjects=function(t){return e.queryMany("issues",t)},s.list=function(t,r,n){var i;return i={project:t},i=_.extend({},i,r||{}),s.storeQueryParams(t,i),e.queryPaginated("issues",i,n)},s.listInProject=function(t,r,n){return null==r&&(r=null),n=_.merge(n,{project:t}),r&&(n.milestone=r),s.storeQueryParams(t,n),e.queryMany("issues",n)},s.bulkCreate=function(t,e,i){var o,s;return s=n.resolve("bulk-create-issues"),o={project_id:t,milestone_id:e,bulk_issues:i},r.post(s,o)},s.upvote=function(t){var e;return e=n.resolve("issue-upvote",t),r.post(e)},s.downvote=function(t){var e;return e=n.resolve("issue-downvote",t),r.post(e)},s.watch=function(t){var e;return e=n.resolve("issue-watch",t),r.post(e)},s.unwatch=function(t){var e;return e=n.resolve("issue-unwatch",t),r.post(e)},s.stats=function(t){return e.queryOneRaw("projects",t+"/issues_stats")},s.filtersData=function(t){return e.queryOneRaw("issues-filters",null,t)},s.listValues=function(t,r){var n;return n={project:t},s.storeQueryParams(t,n),e.queryMany(r,n)},s.createDefaultValues=function(t,e){var i,o;return i={project_id:t},o=n.resolve(e+"-create-default"),r.post(o,i)},s.storeQueryParams=function(e,r){var n;return n=t([e,e+":issues-queryparams"]),i.set(n,r)},s.getQueryParams=function(e){var r;return r=t([e,e+":issues-queryparams"]),i.get(r)||{}},s.bulkUpdateMilestone=function(t,e,i){var o,s;return s=n.resolve("bulk-update-issue-milestone"),o={project_id:t,milestone_id:e,bulk_issues:i},r.post(s,o)},function(t){return t.issues=s}},angular.module("taigaResources").factory("$tgIssuesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage","$q",e])}.call(this),function(){var t,e,r;r=this.taiga,t=r.generateHash,e=function(e){var r;return"kanban-statusviewmodels","kanban-statuscolumnmodels",(r={}).storeStatusColumnModes=function(r,n){var i;return i=t([r,r+":kanban-statuscolumnmodels"]),e.set(i,n)},r.getStatusColumnModes=function(r){var n;return n=t([r,r+":kanban-statuscolumnmodels"]),e.get(n)||{}},function(t){return t.kanban=r}},angular.module("taigaResources").factory("$tgKanbanResourcesProvider",["$tgStorage",e])}.call(this),function(){var t;this.taiga,this.taiga.sizeFormat,t=function(t){var e;return e={list:function(){return t.queryMany("locales")}},function(t){return t.locales=e}},angular.module("taigaResources").factory("$tgLocalesResourcesProvider",["$tgRepo",t])}.call(this),function(){var t;this.taiga,t=function(t,e,r){var n;return(n={}).render=function(t,n){var i,o;return null!=n&&""!==n||(n=" "),i={project_id:t,content:n},o=e.resolve("wiki"),r.post(o+"/render",i).then(function(t){return t.data})},function(t){return t.mdrender=n}},angular.module("taigaResources").factory("$tgMdRenderResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",t])}.call(this),function(){var t;this.taiga,t=function(t,e,r){var n;return(n={}).get=function(e){return t.queryOne("memberships",e)},n.list=function(e,r,n){var i;return null==n&&(n=!0),i={project:e},i=_.extend({},i,r||{}),n?t.queryPaginated("memberships",i):t.queryMany("memberships",i,{enablePagination:n})},n.listByUser=function(e,r){var n;return n={user:e},n=_.extend({},n,r||{}),t.queryPaginated("memberships",n)},n.resendInvitation=function(t){var n;return n=r.resolve("memberships"),e.post(n+"/"+t+"/resend_invitation",{})},n.bulkCreateMemberships=function(t,n,i){var o,s;return s=r.resolve("bulk-create-memberships"),o={project_id:t,bulk_memberships:n,invitation_extra_text:i},e.post(s,o)},function(t){return t.memberships=n}},angular.module("taigaResources").factory("$tgMembershipsResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){var t;t=function(t){var e;return(e={}).list=function(e,r){return t.queryOneAttribute("project-modules",e,r)},function(t){return t.modules=e}},angular.module("taigaResources").factory("$tgModulesResourcesProvider",["$tgRepo",t])}.call(this),function(){var t;this.taiga,t=function(t,e,r){var n;return(n={}).get=function(e){return t.queryOne("notify-policies",e)},n.list=function(e){var r;return r=_.extend({},r,e||{}),t.queryMany("notify-policies",r)},function(t){return t.notifyPolicies=n}},angular.module("taigaResources").factory("$tgNotifyPoliciesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){var t,e;this.taiga,e=this.taiga.sizeFormat,t=function(t,r,n,i,o,s,a){var c;return(c={}).get=function(t){return r.queryOne("projects",t)},c.getBySlug=function(t){return r.queryOne("projects","by_slug?slug="+t)},c.list=function(t){var e;return e={order_by:"user_order"},e=_.extend({},e,t||{}),r.queryMany("projects",e)},c.listByMember=function(t){var e;return e={member:t,order_by:"user_order"},r.queryMany("projects",e)},c.templates=function(){return r.queryMany("project-templates")},c.usersList=function(t){var e;return e={project:t},r.queryMany("users",e)},c.rolesList=function(t){var e;return e={project:t},r.queryMany("roles",e)},c.stats=function(t){return r.queryOneRaw("projects",t+"/stats")},c.bulkUpdateOrder=function(t){var e;return e=i.resolve("bulk-update-projects-order"),n.post(e,t)},c.regenerate_epics_csv_uuid=function(t){var e;return e=i.resolve("projects")+"/"+t+"/regenerate_epics_csv_uuid",n.post(e)},c.regenerate_userstories_csv_uuid=function(t){var e;return e=i.resolve("projects")+"/"+t+"/regenerate_userstories_csv_uuid",n.post(e)},c.regenerate_tasks_csv_uuid=function(t){var e;return e=i.resolve("projects")+"/"+t+"/regenerate_tasks_csv_uuid",n.post(e)},c.regenerate_issues_csv_uuid=function(t){var e;return e=i.resolve("projects")+"/"+t+"/regenerate_issues_csv_uuid",n.post(e)},c.delete_epics_csv_uuid=function(t){var e;return e=i.resolve("projects")+"/"+t+"/delete_epics_csv_uuid",n.post(e)},c.delete_userstories_csv_uuid=function(t){var e;return e=i.resolve("projects")+"/"+t+"/delete_userstories_csv_uuid",n.post(e)},c.delete_tasks_csv_uuid=function(t){var e;return e=i.resolve("projects")+"/"+t+"/delete_tasks_csv_uuid",n.post(e)},c.delete_issues_csv_uuid=function(t){var e;return e=i.resolve("projects")+"/"+t+"/delete_issues_csv_uuid",n.post(e)},c.leave=function(t){var e;return e=i.resolve("projects")+"/"+t+"/leave",n.post(e)},c.memberStats=function(t){return r.queryOneRaw("projects",t+"/member_stats")},c.tagsColors=function(t){return r.queryOne("projects",t+"/tags_colors")},c.deleteTag=function(t,e){var r;return r=i.resolve("projects")+"/"+t+"/delete_tag",n.post(r,{tag:e})},c.createTag=function(t,e,r){var o,s;return s=i.resolve("projects")+"/"+t+"/create_tag",(o={}).tag=e,o.color=null,r&&(o.color=r),n.post(s,o)},c.editTag=function(t,e,r,o){var s,a;return a=i.resolve("projects")+"/"+t+"/edit_tag",(s={}).from_tag=e,r&&(s.to_tag=r),s.color=null,o&&(s.color=o),n.post(a,s)},c.mixTags=function(t,e,r){var o;return o=i.resolve("projects")+"/"+t+"/mix_tags",n.post(o,{to_tag:e,from_tags:r})},c.export=function(t){var e;return e=i.resolve("exporter")+"/"+t,n.get(e)},c.import=function(r,n){var c,u,l,p,d,h,f,g,m,v,y;return l=s.defer(),(h=t.get("maxUploadFileSize",null))&&r.size>h?(p=a.instant("PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED",{fileName:r.name,fileSize:e(r.size),maxFileSize:e(h)}),f={status:413,data:{_error_message:p}},l.reject(f),l.promise):(v=function(t){var r,i;return i=Math.round(t.loaded/t.total*100),r=a.instant("PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE",{uploadedSize:e(t.loaded),totalSize:e(t.total)}),n("in-progress",null,r,i)},g=function(t){return n("done",a.instant("PROJECT.IMPORT.TITLE"),a.instant("PROJECT.IMPORT.DESCRIPTION"))},m=function(t){return n("error")},c=function(t){var e;f={};try{f.data=JSON.parse(t.target.responseText)}catch(t){f.data={}}return f.status=t.target.status,t.target.getResponseHeader("Taiga-Info-Project-Is-Private")&&(f.headers={isPrivate:"True"===t.target.getResponseHeader("Taiga-Info-Project-Is-Private"),memberships:parseInt(t.target.getResponseHeader("Taiga-Info-Project-Memberships"))}),201!==(e=f.status)&&202!==e||l.resolve(f),l.reject(f)},d=function(t){return l.reject("fail")},(u=new FormData).append("dump",r),(y=new XMLHttpRequest).upload.addEventListener("progress",v,!1),y.upload.addEventListener("load",g,!1),y.upload.addEventListener("error",m,!1),y.upload.addEventListener("abort",m,!1),y.addEventListener("load",c,!1),y.addEventListener("error",d,!1),y.open("POST",i.resolve("importer")),y.setRequestHeader("Authorization","Bearer "+o.getToken()),y.setRequestHeader("Accept","application/json"),y.send(u),l.promise)},c.changeLogo=function(r,o){var a,c,u,l,p,d;return(u=t.get("maxUploadFileSize",null))&&o.size>u?(p={status:413,data:{_error_message:"'"+o.name+"' ("+e(o.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+e(u)+")"}},(c=s.defer()).reject(p),c.promise):((a=new FormData).append("logo",o),l={transformRequest:angular.identity,headers:{"Content-Type":void 0}},d=i.resolve("projects")+"/"+r+"/change_logo",n.post(d,a,{},l))},c.removeLogo=function(t){var e;return e=i.resolve("projects")+"/"+t+"/remove_logo",n.post(e)},function(t){return t.projects=c}},angular.module("taigaResources").factory("$tgProjectsResourcesProvider",["$tgConfig","$tgRepo","$tgHttp","$tgUrls","$tgAuth","$q","$translate",t])}.call(this),function(){var t;this.taiga,t=function(t,e,r){var n;return(n={}).get=function(e){return t.queryOne("roles",e)},n.list=function(e){return t.queryMany("roles",{project:e})},function(t){return t.roles=n}},angular.module("taigaResources").factory("$tgRolesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){var t;this.taiga,t=function(t,e,r,n){var i;return(i={}).do=function(t,i){var o,s,a;return o=n.defer(),s={url:e.resolve("search"),method:"GET",timeout:o.promise,cancelable:!0,params:{project:t,text:i,get_all:!1}},(a=r.request(s).then(function(t){return t.data})).abort=function(){return o.resolve()},a.finally=function(){return a.abort=angular.noop,o=a=null},a},function(t){return t.search=i}},angular.module("taigaResources").factory("$tgSearchResourcesProvider",["$tgRepo","$tgUrls","$tgHttp","$q",t])}.call(this),function(){var t;this.taiga.generateHash,t=function(t,e,r,n,i){var o;return(o={}).get=function(r,n){return t.queryOne("milestones",n).then(function(t){var r;return r=t.user_stories,r=_.map(r,function(t){return e.make_model("userstories",t)}),t._attrs.user_stories=r,t})},o.stats=function(e,r){return t.queryOneRaw("milestones",r+"/stats")},o.list=function(r,n){var i;return i={project:r},i=_.extend({},i,n||{}),t.queryMany("milestones",i,{},!0).then(function(t){var r,n,i,o,s,a;for(s=t[0],r=t[1],n=0,i=s.length;n<i;n++)a=(o=s[n]).user_stories,a=_.map(a,function(t){return e.make_model("userstories",t)}),o._attrs.user_stories=a;return{milestones:s,closed:parseInt(r("Taiga-Info-Total-Closed-Milestones"),10),open:parseInt(r("Taiga-Info-Total-Opened-Milestones"),10)}})},o.moveUserStoriesMilestone=function(t,e,r,o){var s,a;return a=i.resolve("move-userstories-to-milestone",t),s={project_id:e,milestone_id:r,bulk_stories:o},n.post(a,s)},o.moveTasksMilestone=function(t,e,r,o){var s,a;return a=i.resolve("move-tasks-to-milestone",t),s={project_id:e,milestone_id:r,bulk_tasks:o},n.post(a,s)},o.moveIssuesMilestone=function(t,e,r,o){var s,a;return a=i.resolve("move-issues-to-milestone",t),s={project_id:e,milestone_id:r,bulk_issues:o},n.post(a,s)},function(t){return t.sprints=o}},angular.module("taigaResources").factory("$tgSprintsResourcesProvider",["$tgRepo","$tgModel","$tgStorage","$tgHttp","$tgUrls",t])}.call(this),function(){var t,e,r;r=this.taiga,t=r.generateHash,e=function(e,r,n,i){var o;return"tasks-queryparams","tasks-statuscolumnmodels","tasks-usrowmodels",(o={}).get=function(t,r,n){var i;return(i=o.getQueryParams(t)).project=t,i=_.extend({},i,n),e.queryOne("tasks",r,i)},o.getByRef=function(t,r,n){var i;return(i=o.getQueryParams(t)).project=t,i.ref=r,i=_.extend({},i,n),e.queryOne("tasks","by_ref",i)},o.listInAllProjects=function(t){return e.queryMany("tasks",t)},o.filtersData=function(t){return e.queryOneRaw("task-filters",null,t)},o.list=function(t,r,n,i){return null==r&&(r=null),null==n&&(n=null),i=_.merge(i,{project:t,order_by:"us_order"}),r&&(i.milestone=r),n&&(i.user_story=n),o.storeQueryParams(t,i),e.queryMany("tasks",i)},o.bulkCreate=function(t,e,i,o){var s,a;return a=n.resolve("bulk-create-tasks"),s={project_id:t,milestone_id:e,us_id:i,bulk_tasks:o},r.post(a,s).then(function(t){return t.data})},o.upvote=function(t){var e;return e=n.resolve("task-upvote",t),r.post(e)},o.downvote=function(t){var e;return e=n.resolve("task-downvote",t),r.post(e)},o.watch=function(t){var e;return e=n.resolve("task-watch",t),r.post(e)},o.unwatch=function(t){var e;return e=n.resolve("task-unwatch",t),r.post(e)},o.bulkUpdateTaskTaskboardOrder=function(t,e){var i,o;return o=n.resolve("bulk-update-task-taskboard-order"),i={project_id:t,bulk_tasks:e},r.post(o,i)},o.bulkUpdateMilestone=function(t,e,i){var o,s;return s=n.resolve("bulk-update-task-milestone"),o={project_id:t,milestone_id:e,bulk_tasks:i},r.post(s,o)},o.reorder=function(t,e,i){var o,s;return s=n.resolve("tasks")+"/"+t,o={headers:{"set-orders":JSON.stringify(i)}},r.patch(s,e,null,o).then(function(t){return t.data})},o.listValues=function(t,r){var n;return n={project:t},e.queryMany(r,n)},o.createDefaultValues=function(t,e){var i,o;return i={project_id:t},o=n.resolve(e+"-create-default"),r.post(o,i)},o.storeQueryParams=function(e,r){var n;return n=t([e,e+":tasks-queryparams"]),i.set(n,r)},o.getQueryParams=function(e){var r;return r=t([e,e+":tasks-queryparams"]),i.get(r)||{}},o.storeStatusColumnModes=function(e,r){var n;return n=t([e,e+":tasks-statuscolumnmodels"]),i.set(n,r)},o.getStatusColumnModes=function(e){var r;return r=t([e,e+":tasks-statuscolumnmodels"]),i.get(r)||{}},o.storeUsRowModes=function(e,r,n){var o;return o=t([e,r,e+":tasks-usrowmodels"]),i.set(o,n)},o.getUsRowModes=function(e,r){var n;return n=t([e,r,e+":tasks-usrowmodels"]),i.get(n)||{}},function(t){return t.tasks=o}},angular.module("taigaResources").factory("$tgTasksResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage",e])}.call(this),function(){var t;this.taiga,t=function(t,e,r){var n;return(n={}).get=function(e){return t.queryOne("user-project-settings",e)},n.list=function(e){var r;return r=_.extend({},r,e||{}),t.queryMany("user-project-settings",r)},function(t){return t.userProjectSettings=n}},angular.module("taigaResources").factory("$tgUserProjectSettingsResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){var t,e;this.taiga,e=this.taiga.sizeFormat,t=function(t,r,n,i,o){var s;return(s={}).changeAvatar=function(r){var s,a,c,u,l,p;return(c=t.get("maxUploadFileSize",null))&&r.size>c?(l={status:413,data:{_error_message:"'"+r.name+"' ("+e(r.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+e(c)+")"}},(a=o.defer()).reject(l),a.promise):((s=new FormData).append("avatar",r),u={transformRequest:angular.identity,headers:{"Content-Type":void 0}},p=i.resolve("users")+"/change_avatar",n.post(p,s,{},u))},s.removeAvatar=function(){var t;return t=i.resolve("users")+"/remove_avatar",n.post(t)},s.changePassword=function(t,e){var r,o;return o=i.resolve("users")+"/change_password",r={current_password:t,password:e},n.post(o,r)},function(t){return t.userSettings=s}},angular.module("taigaResources").factory("$tgUserSettingsResourcesProvider",["$tgConfig","$tgRepo","$tgHttp","$tgUrls","$q",t])}.call(this),function(){var t;this.taiga,this.taiga.sizeFormat,t=function(t,e){var r;return(r={}).contacts=function(r,n){var i,o;return null==n&&(n={}),o=e.resolve("user-contacts",r),i={headers:{}},n.enablePagination||(i.headers["x-disable-pagination"]="1"),t.get(o,{},i).then(function(t){return t.data})},function(t){return t.users=r}},angular.module("taigaResources").factory("$tgUsersResourcesProvider",["$tgHttp","$tgUrls","$q",t])}.call(this),function(){var t,e,r;r=this.taiga,t=r.generateHash,e=function(e,r,n,i,o){var s,a;return s="userstories-queryparams",(a={}).get=function(t,r,n){var i;return(i=a.getQueryParams(t)).project=t,i=_.extend({},i,n),e.queryOne("userstories",r,i)},a.getByRef=function(t,r,n){var i;return null==n&&(n={}),(i=a.getQueryParams(t)).project=t,i.ref=r,i=_.extend({},i,n),e.queryOne("userstories","by_ref",i)},a.listInAllProjects=function(t){return e.queryMany("userstories",t)},a.filtersData=function(t){return e.queryOneRaw("userstories-filters",null,t)},a.listUnassigned=function(t,r,n){var i;return i={project:t,milestone:"null"},i=_.extend({},i,r||{}),a.storeQueryParams(t,i),e.queryMany("userstories",_.extend(i,{page_size:n}),{enablePagination:!0},!0)},a.listAll=function(t,r){var n;return n={project:t},n=_.extend({},n,r||{}),a.storeQueryParams(t,n),e.queryMany("userstories",n)},a.bulkCreate=function(t,e,i){var o,s;return o={project_id:t,status_id:e,bulk_stories:i},s=n.resolve("bulk-create-us"),r.post(s,o)},a.upvote=function(t){var e;return e=n.resolve("userstory-upvote",t),r.post(e)},a.downvote=function(t){var e;return e=n.resolve("userstory-downvote",t),r.post(e)},a.watch=function(t){var e;return e=n.resolve("userstory-watch",t),r.post(e)},a.unwatch=function(t){var e;return e=n.resolve("userstory-unwatch",t),r.post(e)},a.bulkUpdateBacklogOrder=function(t,e){var i,o;return o=n.resolve("bulk-update-us-backlog-order"),i={project_id:t,bulk_stories:e},r.post(o,i)},a.bulkUpdateMilestone=function(t,e,i){var o,s;return s=n.resolve("bulk-update-us-milestone"),o={project_id:t,milestone_id:e,bulk_stories:i},r.post(s,o)},a.bulkUpdateKanbanOrder=function(t,e,i){var o,s;return s=n.resolve("bulk-update-us-kanban-order"),o={project_id:t,status_id:e,bulk_stories:i},r.post(s,o)},a.listValues=function(t,r){var n;return n={project:t},a.storeQueryParams(t,n),e.queryMany(r,n)},a.createDefaultValues=function(t,e){var i,o;return i={project_id:t},o=n.resolve(e+"-create-default"),r.post(o,i)},a.storeQueryParams=function(e,r){var n;return n=t([e,e+":"+s]),i.set(n,r)},a.getQueryParams=function(e){var r;return r=t([e,e+":"+s]),i.get(r)||{}},a.storeShowTags=function(e,r){var n;return n=t([e,"showTags"]),i.set(n,r)},a.getShowTags=function(e){var r;return r=t([e,"showTags"]),i.get(r)||null},function(t){return t.userstories=a}},angular.module("taigaResources").factory("$tgUserstoriesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage","$q",e])}.call(this),function(){var t;t=function(t,e,r){var n;return(n={}).list=function(e){var r;return r={webhook:e},t.queryMany("webhooklogs",r)},n.resend=function(t){var n;return n=e.resolve("webhooklogs-resend",t),r.post(n)},function(t){return t.webhooklogs=n}},angular.module("taigaResources").factory("$tgWebhookLogsResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",t])}.call(this),function(){var t;t=function(t,e,r){var n;return(n={}).list=function(e){var r;return r={project:e},t.queryMany("webhooks",r)},n.test=function(t){var n;return n=e.resolve("webhooks-test",t),r.post(n)},function(t){return t.webhooks=n}},angular.module("taigaResources").factory("$tgWebhooksResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",t])}.call(this),function(){var t;this.taiga,t=function(t,e,r){var n;return(n={}).get=function(e){return t.queryOne("wiki",e)},n.getBySlug=function(e,r){return t.queryOne("wiki","by_slug?project="+e+"&slug="+r)},n.list=function(e){return t.queryMany("wiki",{project:e})},n.listLinks=function(e){return t.queryMany("wiki-links",{project:e})},function(t){return t.wiki=n}},angular.module("taigaResources").factory("$tgWikiResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){var t,e,r,n,i,o,s={}.hasOwnProperty;o=this.taiga,n=this.taiga.mixOf,r=this.taiga.debounce,i=angular.module("taigaUserSettings"),t=function(t){function e(t,e,r,n,i,o,s,a,c,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.auth=u,this.translate=l,this.scope.sectionName=this.translate.instant("CHANGE_PASSWORD.SECTION_NAME"),this.scope.user=this.auth.getUser()}return function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,n(o.Controller,o.PageMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","$translate"],e}(),i.controller("UserChangePasswordController",t),e=function(t,e,n,i){return{link:function(o,s,a,c){var u,l,p;return u=new checksley.Form(s.find("form")),l=r(2e3,function(r){var s,a;if(r.preventDefault(),u.validate()){if(o.newPassword1===o.newPassword2)return s=n().target(p).start(),(a=t.userSettings.changePassword(o.currentPassword,o.newPassword1)).then(function(){return s.finish(),e.notify("success")}),a.then(null,function(t){return s.finish(),e.notify("error",t.data._error_message)});e.notify("error",i.instant("CHANGE_PASSWORD.ERROR_PASSWORD_MATCH"))}}),p=s.find(".submit-button"),s.on("submit","form",l),o.$on("$destroy",function(){return s.off()})}}},i.directive("tgUserChangePassword",["$tgResources","$tgConfirm","$tgLoading","$translate",e])}.call(this),function(){var t,e;this.taiga,this.taiga.bindOnce,e=this.taiga.debounce,t=function(t,r,n,i,o,s,a){return{link:function(r,c,u){var l,p;return r.$on("deletelightbox:new",function(t,e){return s.open(c)}),r.$on("$destroy",function(){return c.off()}),l=function(){var e,u;return e=a().target(p).start(),(u=t.remove(r.user)).then(function(t){return e.finish(),s.close(c),n.logout(),i.path(o.resolve("login"))}),u.then(null,function(){return e.finish(),console.log("FAIL")})},c.on("click",".button-green",function(t){return t.preventDefault(),s.close(c)}),c.on("click",".button-red",e(2e3,function(t){return t.preventDefault(),l()})),p=c.find(".button-red")},templateUrl:"user/lightbox/lightbox-delete-account.html"}},angular.module("taigaUserSettings").directive("tgLbDeleteUser",["$tgRepo","$rootScope","$tgAuth","$tgLocation","$tgNavUrls","lightboxService","$tgLoading",t])}.call(this),function(){var t,e,r,n,i,o,s,a={}.hasOwnProperty;s=this.taiga,i=this.taiga.mixOf,n=this.taiga.bindOnce,o=angular.module("taigaUserSettings"),t=function(t){function e(t,e,r,n,i,o,s,a,c,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.auth=u,this.errorHandlingService=l,this.scope.sectionName="USER_SETTINGS.NOTIFICATIONS.LIVE_SECTION_NAME",this.scope.user=this.auth.getUser(),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)a.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,i(s.Controller,s.PageMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","tgErrorHandlingService"],e.prototype.loadInitialData=function(){return this.rs.notifyPolicies.list().then((t=this,function(e){return t.scope.notifyPolicies=e,e}));var t},e}(),o.controller("UserLiveNotificationsController",t),e=function(){return{link:function(t,e,r){return t.$on("$destroy",function(){return e.off()})}}},o.directive("tgUserLiveNotifications",e),r=function(t,e,r){var i;return i=_.template('<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\n<div class="policy-table-row" data-index="<%- index %>">\n  <div class="policy-table-project"><span><%- notifyPolicy.project_name %></span></div>\n  <div class="policy-table-all">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-all-<%- notifyPolicy.id %>"\n             value="2" <% if (notifyPolicy.live_notify_level == 2) { %>checked="checked"<% } %>/>\n      <label for="policy-all-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_ALL"></label>\n    </fieldset>\n  </div>\n  <div class="policy-table-involved">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-involved-<%- notifyPolicy.id %>"\n             value="1" <% if (notifyPolicy.live_notify_level == 1) { %>checked="checked"<% } %> />\n      <label for="policy-involved-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED"></label>\n    </fieldset>\n  </div>\n  <div class="policy-table-none">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-none-<%- notifyPolicy.id %>"\n             value="3" <% if (notifyPolicy.live_notify_level == 3) { %>checked="checked"<% } %> />\n      <label for="policy-none-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_NONE"></label>\n    </fieldset>\n  </div>\n</div>\n<% }) %>'),{link:function(o,s,a){var c;return c=function(){var n,a;return s.off(),n={notifyPolicies:o.notifyPolicies},a=i(n),s.html(r(a)(o)),s.on("change","input[type=radio]",function(r){var n,i,s,a,c,u;return a=(u=angular.element(r.currentTarget)).parents(".policy-table-row").data("index"),s=o.notifyPolicies[a],c=s.live_notify_level,s.live_notify_level=parseInt(u.val(),10),i=function(){return e.notify("success")},n=function(){return e.notify("error"),u.parents(".policy-table-row").find("input[value="+c+"]").prop("checked",!0)},t.save(s).then(i,n)})},o.$on("$destroy",function(){return s.off()}),n(o,a.ngModel,c)}}},o.directive("tgUserLiveNotificationsList",["$tgRepo","$tgConfirm","$compile",r])}.call(this),function(){var t,e,r,n,i,o,s,a,c,u={}.hasOwnProperty;c=this.taiga,o=this.taiga.mixOf,a=this.taiga.sizeFormat,s=angular.module("taigaUserSettings"),i=this.taiga.debounce,n=function(t){function e(t,e,r,n,i,o,s,c,u,l,p,d,h,f){var g,m;this.scope=t,this.rootscope=e,this.config=r,this.repo=n,this.confirm=i,this.rs=o,this.params=s,this.q=c,this.location=u,this.navUrls=l,this.auth=p,this.translate=d,this.errorHandlingService=h,this.window=f,this.scope.sectionName="USER_SETTINGS.MENU.SECTION_TITLE",this.scope.project={},this.scope.user=this.auth.getUser(),this.scope.user||this.errorHandlingService.permissionDenied(),this.scope.lang=this.getLan(),this.scope.theme=this.getTheme(),(g=this.config.get("maxUploadFileSize",null))&&(m=this.translate.instant("USER_SETTINGS.AVATAR_MAX_SIZE",{maxFileSize:a(g)}),this.scope.maxFileSizeMsg=m),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)u.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,o(c.Controller,c.PageMixin)),e.$inject=["$scope","$rootScope","$tgConfig","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","$translate","tgErrorHandlingService","$window"],e.prototype.loadInitialData=function(){return this.scope.availableThemes=this.config.get("themes",[]),this.rs.locales.list().then((t=this,function(e){return t.scope.locales=e,e}));var t},e.prototype.openDeleteLightbox=function(){return this.rootscope.$broadcast("deletelightbox:new",this.scope.user)},e.prototype.getLan=function(){return this.scope.user.lang||this.translate.preferredLanguage()},e.prototype.getTheme=function(){return this.scope.user.theme||this.config.get("defaultTheme")||"taiga"},e.prototype.exportProfile=function(){var t,e,r;return e=function(t){var e;return e=t.data.url,this.window.open(e,"_blank")},r=this,t=function(t){var e;if(null!=(e=t.data)?e._error_message:void 0)return r.confirm.notify("error",t.data._error_message)},this.auth.exportProfile().then(e,t)},e}(),s.controller("UserSettingsController",n),r=function(t,e,r,n){return{link:function(o,s,a){var c;return c=i(2e3,function(i){var a,c,u,l;if(i.preventDefault(),(c=s.find("form").checksley()).validate())return a=o.user.isAttributeModified("email"),o.user.lang=o.lang,o.user.theme=o.theme,l=function(r){var i;return e.setUser(r),a?(i=n.instant("USER_PROFILE.CHANGE_EMAIL_SUCCESS"),t.success(i)):t.notify("success")},u=function(e){return c.setErrors(e),t.notify("error",e._error_message)},r.save(o.user).then(l,u)}),s.on("submit","form",c),o.$on("$destroy",function(){return s.off()})}}},s.directive("tgUserProfile",["$tgConfirm","$tgAuth","$tgRepo","$translate",r]),e=function(t,e,r,n){return{link:function(i,o,s){var a,c,u;return u=function(){return o.find(".size-info").removeClass("hidden")},c=function(r){var s;return s=e.make_model("users",r.data),t.setUser(s),i.user=s,o.find(".loading-overlay").removeClass("active"),n.notify("success")},a=function(t){return 413===t.status&&u(),o.find(".loading-overlay").removeClass("active"),n.notify("error",t.data._error_message)},o.on("click",".js-change-avatar",function(){return o.find("#avatar-field").click()}),o.on("change","#avatar-field",function(t){if(i.avatarAttachment)return o.find(".loading-overlay").addClass("active"),r.userSettings.changeAvatar(i.avatarAttachment).then(c,a)}),o.on("click","a.js-use-gravatar",function(t){return o.find(".loading-overlay").addClass("active"),r.userSettings.removeAvatar().then(c,a)}),i.$on("$destroy",function(){return o.off()})}}},s.directive("tgUserAvatar",["$tgAuth","$tgModel","$tgResources","$tgConfirm",e]),t=function(t){return{link:function(e,r,n){var i,o;return i=t(n.tgAvatarModel),o=i.assign,r.bind("change",function(){return e.$apply(function(){return o(e,r[0].files[0])})})}}},s.directive("tgAvatarModel",["$parse",t])}.call(this),function(){var t;t=function(){return{link:function(t,e,r){var n;return n=r.tgUserSettingsNavigation,e.find(".active").removeClass("active"),e.find("#usersettingsmenu-"+n+" a").addClass("active"),t.$on("$destroy",function(){return e.off()})}}},angular.module("taigaUserSettings").directive("tgUserSettingsNavigation",t)}.call(this),function(){var t,e,r,n,i,o,s,a={}.hasOwnProperty;s=this.taiga,i=this.taiga.mixOf,n=this.taiga.bindOnce,o=angular.module("taigaUserSettings"),t=function(t){function e(t,e,r,n,i,o,s,a,c,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.auth=u,this.errorHandlingService=l,this.scope.sectionName="USER_SETTINGS.NOTIFICATIONS.SECTION_NAME",this.scope.user=this.auth.getUser(),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)a.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,i(s.Controller,s.PageMixin)),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","tgErrorHandlingService"],e.prototype.loadInitialData=function(){return this.rs.notifyPolicies.list().then((t=this,function(e){return t.scope.notifyPolicies=e,e}));var t},e}(),o.controller("UserNotificationsController",t),e=function(){return{link:function(t,e,r){return t.$on("$destroy",function(){return e.off()})}}},o.directive("tgUserNotifications",e),r=function(t,e,r){var i;return i=_.template('<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\n<div class="policy-table-row" data-index="<%- index %>">\n  <div class="policy-table-project"><span><%- notifyPolicy.project_name %></span></div>\n  <div class="policy-table-all">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-all-<%- notifyPolicy.id %>"\n             value="2" <% if (notifyPolicy.notify_level == 2) { %>checked="checked"<% } %>/>\n      <label for="policy-all-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_ALL"></label>\n    </fieldset>\n  </div>\n  <div class="policy-table-involved">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-involved-<%- notifyPolicy.id %>"\n             value="1" <% if (notifyPolicy.notify_level == 1) { %>checked="checked"<% } %> />\n      <label for="policy-involved-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED"></label>\n    </fieldset>\n  </div>\n  <div class="policy-table-none">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-none-<%- notifyPolicy.id %>"\n             value="3" <% if (notifyPolicy.notify_level == 3) { %>checked="checked"<% } %> />\n      <label for="policy-none-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_NONE"></label>\n    </fieldset>\n  </div>\n</div>\n<% }) %>'),{link:function(o,s,a){var c;return c=function(){var n,a;return s.off(),n={notifyPolicies:o.notifyPolicies},a=i(n),s.html(r(a)(o)),s.on("change","input[type=radio]",function(r){var n,i,s,a,c,u;return a=(u=angular.element(r.currentTarget)).parents(".policy-table-row").data("index"),s=o.notifyPolicies[a],c=s.notify_level,s.notify_level=parseInt(u.val(),10),i=function(){return e.notify("success")},n=function(){return e.notify("error"),u.parents(".policy-table-row").find("input[value="+c+"]").prop("checked",!0)},t.save(s).then(i,n)})},o.$on("$destroy",function(){return s.off()}),n(o,a.ngModel,c)}}},o.directive("tgUserNotificationsList",["$tgRepo","$tgConfirm","$compile",r])}.call(this),function(){var t,e,r,n,i={}.hasOwnProperty,o=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};n=this.taiga,e=this.taiga.mixOf,this.taiga.bindOnce,r=angular.module("taigaUserSettings"),t=function(t){function r(t,e,r,n,i,o,s){this.rootScope=t,this.scope=e,this.tgSections=r,this.rs=n,this.repo=i,this.confirm=o,this.currentUserService=s,this.scope.sections=this.tgSections.list(),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,e(n.Controller,n.PageMixin)),r.$inject=["$rootScope","$scope","$tgSections","$tgResources","$tgRepo","$tgConfirm","tgCurrentUserService"],r.prototype.loadInitialData=function(){return this.rs.userProjectSettings.list().then((t=this,function(e){return t.scope.userProjectSettings=e}));var t},r.prototype.updateCustomHomePage=function(t){var e,r,n;return n=this,r=function(){return n.currentUserService.loadProjects(),n.rootScope.$broadcast("dropdown-project-list:updated"),n.confirm.notify("success")},e=function(t){return function(){return t.confirm.notify("error")}}(this),this.repo.save(t).then(r,e)},r.prototype.filteredSections=function(t){return _.filter(this.scope.sections,function(e){var r;return r=e.id,o.call(t.allowed_sections,r)>=0})},r}(),r.controller("UserProjectSettingsController",t)}.call(this),function(){var t,e,r,n,i,o,s,a={}.hasOwnProperty;s=this.taiga,i=this.taiga.mixOf,n=this.taiga.bindOnce,o=angular.module("taigaUserSettings"),t=function(t){function e(t,e,r){this.scope=t,this.rs=e,this.auth=r,this.scope.sectionName="USER_SETTINGS.EVENTS.SECTION_NAME",this.scope.user=this.auth.getUser(),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}return function(t,e){for(var r in e)a.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,i(s.Controller,s.PageMixin)),e.$inject=["$scope","$tgResources","$tgAuth"],e.prototype.loadInitialData=function(){return this.rs.notifyPolicies.list().then((t=this,function(e){return t.scope.notifyPolicies=e,e}));var t},e}(),o.controller("UserWebNotificationsController",t),e=function(){return{link:function(t,e,r){return t.$on("$destroy",function(){return e.off()})}}},o.directive("tgUserWebNotifications",e),r=function(t,e,r){var i;return i=_.template('<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\n<div class="policy-table-row">\n  <div class="policy-table-project"><span><%- notifyPolicy.project_name %></span></div>\n  <div class="policy-table-all">\n    <div class="check" data-index="<%- index %>">\n      <input type="checkbox"\n        <% if(notifyPolicy.web_notify_level) { %> checked="checked" <% } %>\n        name="policy-<%- notifyPolicy.id %>" id="policy-<%- notifyPolicy.id %>"/>\n      <div></div>\n      <span class="check-text check-yes" translate="COMMON.YES"></span>\n      <span class="check-text check-no"" translate="COMMON.NO"></span>\n    </div>\n  </div>\n</div>\n<% }) %>'),{link:function(o,s,a){var c;return c=function(){var n,a;return s.off(),n={notifyPolicies:o.notifyPolicies},a=i(n),s.html(r(a)(o)),s.on("click",".check",function(r){var n,i,s,a,c;return a=(c=angular.element(r.currentTarget)).data("index"),(s=o.notifyPolicies[a]).web_notify_level=!s.web_notify_level,i=function(){return e.notify("success"),c.find("input").prop("checked",s.web_notify_level)},n=function(){return e.notify("error")},t.save(s).then(i,n)})},o.$on("$destroy",function(){return s.off()}),n(o,a.ngModel,c)}}},o.directive("tgUserWebNotificationsList",["$tgRepo","$tgConfirm","$compile",r])}.call(this),function(){angular.module("taigaComponents",[])}.call(this),function(){angular.module("taigaDiscover",[])}.call(this),function(){angular.module("taigaExternalApps",[])}.call(this),function(){angular.module("taigaHistory",[])}.call(this),function(){angular.module("taigaHome",[])}.call(this),function(){angular.module("taigaNavigationBar",[])}.call(this),function(){angular.module("taigaNotifications",[])}.call(this),function(){angular.module("taigaProfile",[])}.call(this),function(){angular.module("taigaProjects",[])}.call(this),function(){angular.module("taigaResources2",[])}.call(this),function(){angular.module("taigaUserTimeline",[])}.call(this),function(){angular.module("taigaUtils",[])}.call(this),function(){angular.module("taigaWikiHistory",[])}.call(this),function(){var t;(t=function(){return{templateUrl:"components/assigned-to/assigned-item/assigned-item.html",scope:{member:"="},link:function(t,e,r){}}}).$inject=[],angular.module("taigaComponents").directive("tgAssignedItem",t)}.call(this),function(){var t;t=function(){function t(){this.assigned&&this._getAssignedMember(),this._filterAssignedMember()}return t.$inject=[],t.prototype._getAssignedMember=function(){return this.assignedMember=_.filter(this.project.members,(t=this,function(e){return e.id===t.assigned.get("id")}));var t},t.prototype._filterAssignedMember=function(){return this.assigned?this.nonAssignedMembers=_.filter(this.project.members,(t=this,function(e){return e.id!==t.assigned.get("id")})):this.nonAssignedMembers=this.project.members;var t},t}(),angular.module("taigaComponents").controller("AssignedToSelectorCtrl",t)}.call(this),function(){var t;(t=function(){return{controller:"AssignedToSelectorCtrl",controllerAs:"vm",bindToController:!0,templateUrl:"components/assigned-to/assigned-to-selector/assigned-to-selector.html",scope:{assigned:"=",project:"=",onRemoveAssigned:"&",onAssignTo:"&"}}}).$inject=[],angular.module("taigaComponents").directive("tgAssignedToSelector",t)}.call(this),function(){var t;t=function(){function t(t,e){this.lightboxFactory=t,this.lightboxService=e,this.has_permissions=_.includes(this.project.my_permissions,"modify_epic")}return t.$inject=["tgLightboxFactory","lightboxService"],t.prototype._closeAndRemoveAssigned=function(){return this.lightboxService.closeAll(),this.onRemoveAssigned()},t.prototype._closeAndAssign=function(t){return this.lightboxService.closeAll(),this.onAssignTo({member:t})},t.prototype.onSelectAssignedTo=function(t,e){return this.lightboxFactory.create("tg-assigned-to-selector",{class:"lightbox lightbox-assigned-to-selector open",assigned:"assigned",project:"project","on-remove-assigned":"onRemoveAssigned()","on-assign-to":"assignTo(member)"},{assigned:this.assignedTo,project:this.project,onRemoveAssigned:this._closeAndRemoveAssigned.bind(this),assignTo:this._closeAndAssign.bind(this)})},t}(),angular.module("taigaComponents").controller("AssignedToCtrl",t)}.call(this),function(){var t;(t=function(){return{controller:"AssignedToCtrl",controllerAs:"vm",bindToController:!0,templateUrl:"components/assigned-to/assigned-to.html",scope:{assignedTo:"=",project:"=",onRemoveAssigned:"&",onAssignTo:"&"}}}).$inject=[],angular.module("taigaComponents").directive("tgAssignedToComponent",t)}.call(this),function(){var t;t=function(t,e,r,n,i,o,s,a,c,u,l){return{link:function(t,e,r,n){var i,o,a;return i=function(){var e,n;return-1!==(null!=(e=t.project)&&null!=(n=e.my_permissions)?n.indexOf(r.requiredPerm):void 0)},a=function(e){var r,i,o;return r=n.$modelValue.assigned_to,i=l.searchUsers(e),r&&(i=_.reject(i,{id:r})),o=_.slice(i,0,5),o=_.map(o,function(t){return t.avatar=u.getAvatar(t)}),t.users=_.slice(i,0,5),t.showMore=i.length>5},o=function(e){var r;return(null!=e?e.assigned_to:void 0)?(t.selected=e.assigned_to,r=t.usersById[t.selected],t.fullName=null!=r?r.full_name_display:void 0,t.isUnassigned=!1,t.avatar=u.getAvatar(r),t.bg=t.avatar.bg,t.isIocaine=null!=e?e.is_iocaine:void 0):(t.fullName=s.instant("COMMON.ASSIGNED_TO.ASSIGN"),t.isUnassigned=!0,t.avatar=u.getAvatar(null),t.bg=null,t.isIocaine=!1),t.fullNameVisible=!(t.isUnassigned&&!c.isAuthenticated()),t.isEditable=i()},e.on("click",".users-search",function(t){return t.stopPropagation()}),e.on("click",".users-dropdown",function(r){return r.preventDefault(),r.stopPropagation(),t.usersSearch="",a(),t.$apply(),e.find(".pop-users").popover().open()}),t.selfAssign=function(){return n.$modelValue.assigned_to=c.getUser().get("id"),o(n.$modelValue)},t.unassign=function(){return n.$modelValue.assigned_to=null,o()},t.$watch("usersSearch",function(t){if(null!=t)return a(t),e.find("input").focus()}),e.on("click",".user-list-single",function(e){var r;return e.preventDefault(),r=angular.element(e.currentTarget),n.$modelValue.assigned_to=r.data("user-id"),o(n.$modelValue),t.$apply()}),t.$watch(r.ngModel,function(t){return o(t)}),t.$on("isiocaine:changed",function(t,e){return o(e)}),t.$on("$destroy",function(){return e.off()})},templateUrl:"common/components/assigned-to-inline.html",require:"ngModel"}},angular.module("taigaComponents").directive("tgAssignedToInline",["$rootScope","$tgConfirm","$tgRepo","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$translate","$compile","tgCurrentUserService","tgAvatarService","tgUserListService",t])}.call(this),function(){var t;t=function(t,e,r,n,i,o,s,a,c,u){var l;return l=o.get("common/components/assigned-to.html",!0),{link:function(r,p,d,h){var f,g,m;return f=function(){var t,e;return-1!==(null!=(t=r.project)&&null!=(e=t.my_permissions)?e.indexOf(d.requiredPerm):void 0)},m=function(r){var o,s;return h.$modelValue.clone().assigned_to=r,o=n().target(p).start(),(s=i.save(function(t){return t.assigned_to=r,t})).then(function(e){return o.finish(),t.$broadcast("object:updated")}),s.then(null,function(){return e.notify("error"),o.finish()}),s},g=function(){var t,e;return l=o.get("common/components/assigned-to.html"),e=r.$new(),t=a(l)(e),p.html(t)},r.assign=function(){return t.$broadcast("assigned-to:add",h.$modelValue)},r.unassign=function(){var t;return t=s.instant("COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED"),e.ask(t).then(function(t){return t.finish(),m(null)})},r.selfAssign=function(){var t;return t=c.getUser().get("id"),m(t)},r.$on("assigned-to:added",function(t,e,r){if(r.id===h.$modelValue.id)return m(e)}),r.$watch(d.ngModel,function(t){var e;return(null!=t?t.assigned_to:void 0)?(r.selected=t.assigned_to,e=r.usersById[r.selected],r.fullName=null!=e?e.full_name_display:void 0,r.isUnassigned=!1,r.avatar=u.getAvatar(e),r.bg=r.avatar.bg,r.isIocaine=null!=t?t.is_iocaine:void 0):(r.fullName=s.instant("COMMON.ASSIGNED_TO.ASSIGN"),r.isUnassigned=!0,r.avatar=u.getAvatar(null),r.bg=null,r.isIocaine=!1),r.fullNameVisible=!(r.isUnassigned&&!c.isAuthenticated()),r.isEditable=f(),g()}),r.$on("$destroy",function(){return p.off()})},require:"ngModel"}},angular.module("taigaComponents").directive("tgAssignedTo",["$rootScope","$tgConfirm","$tgRepo","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$translate","$compile","tgCurrentUserService","tgAvatarService",t])}.call(this),function(){var t,e=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};t=function(t,r,n,i,o,s,a,c,u,l,p){return{scope:!0,link:function(t,r,n,i){var o,s,a,c,d,h;return s=[],a=null,c=function(){return s.length>0},h=function(r){var n,i,o;return i=p.searchUsers(r),n=[],_.map(i,function(t){var r;if(r=t.id,e.call(s,r)>=0)return t.avatar=l.getAvatar(t),n.push(t)}),o=[],_.map(i,function(t){var r;if(r=t.id,e.call(s,r)<0)return t.avatar=l.getAvatar(t),o.push(t)}),t.selected=_.slice(n,0,5),t.selected.length<5?t.users=_.slice(o,0,5-t.selected.length):t.users=[],t.showMore=i.length>5},d=function(){var e;return e=_.map(s,function(e){return t.usersById[e]}),e=_.filter(e,function(t){return!!t}),t.hiddenUsers=s.length>3?s.length-3:0,t.assignedUsers=_.slice(e,0,3),t.isAssigned=c()},o=function(){return _.map(s,function(e){if(!t.usersById[e])return s.splice(s.indexOf(e),1)}),0===s.length?a=null:-1!==s.indexOf(a)&&a||(a=s[0]),i.$modelValue.setAttr("assigned_users",s),i.$modelValue.assigned_to=a},r.on("click",".users-dropdown",function(e){return e.preventDefault(),e.stopPropagation(),t.usersSearch=null,h(),t.$apply(),r.find(".pop-users").popover().open()}),t.assign=function(t){return s.push(t.id),d(),o()},t.selfAssign=function(){return s.push(u.getUser().get("id")),d(),o()},t.unassign=function(t){var e;return e=s.indexOf(t.id),s.splice(e,1),d(),o()},r.on("click",".users-search",function(t){return t.stopPropagation()}),t.$watch("usersSearch",function(t){if(null!=t)return h(t),r.find("input").focus()}),t.$watch(n.ngModel,function(t){if(null!=t)return s=[],null,null!=t.assigned_users&&(s=t.assigned_users),t.assigned_to,d()}),t.$on("$destroy",function(){return r.off()})},templateUrl:"common/components/assigned-users-inline.html",require:"ngModel"}},angular.module("taigaComponents").directive("tgAssignedUsersInline",["$rootScope","$tgConfirm","$tgRepo","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$translate","$compile","tgCurrentUserService","tgAvatarService","tgUserListService",t])}.call(this),function(){var t,e=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};t=function(t,r,n,i,o,s,a,c){return{scope:!0,templateUrl:"common/components/assigned-users.html",link:function(n,o,s,u){var l,p,d,h,f,g;return d=function(){var t,e;return-1!==(null!=(t=n.project)&&null!=(e=t.my_permissions)?e.indexOf(s.requiredPerm):void 0)},p=function(){return n.assignedUsers.length>0},g=function(e,o){var s;return(s=i.save(function(t){return t.assigned_users=e,t.assigned_to||(t.assigned_to=o),t})).then(function(){return e=_.map(e,function(t){return n.usersById[t]}),f(e),t.$broadcast("object:updated")}),s.then(null,function(){return r.notify("error")})},h=function(){var e;return e=_.clone(u.$modelValue,!1),t.$broadcast("assigned-user:add",e)},n.selfAssign=function(){var t,e;if(d())return e=c.getUser().get("id"),(t=_.clone(u.$modelValue.assigned_users,!1)).push(e),t=_.uniq(t),g(t,e)},n.unassign=function(t){var e,i,o;if(d())return e=t.id,o=a.instant("COMMON.ASSIGNED_USERS.TITLE_LIGHTBOX_DELETE_ASSIGNED"),i=n.usersById[e].full_name_display,r.askOnDelete(o,i).then(function(t){var r;return t.finish(),r=_.clone(u.$modelValue.assigned_users,!1),r=_.pull(r,e),l(r)})},l=function(o){var s;return(s=i.save(function(t){var r;return t.assigned_users=o,r=t.assigned_to,e.call(o,r)<0&&o.length>0&&(t.assigned_to=o[0]),0===o.length&&(t.assigned_to=null),t})).then(function(){var e,r;return r=i.getObj(),e=_.map(r.assignedUsers,function(t){return n.usersById[t]}),f(e),t.$broadcast("object:updated")}),s.then(null,function(){return item.revert(),r.notify("error")})},f=function(t){return n.assignedUsers=t,n.isEditable=d(),n.isAssigned=p(),n.openAssignedUsers=h},n.$on("assigned-user:deleted",function(t,e){var r;return r=_.clone(u.$modelValue.assigned_users,!1),r=_.pull(r,e),r=_.uniq(r),l(r)}),n.$on("assigned-user:added",function(t,e){var r;return(r=_.clone(u.$modelValue.assigned_users,!1)).push(e),r=_.uniq(r),g(r,e)}),n.$watch(s.ngModel,function(t){var e;if(null!=t)return e=_.map(t.assigned_users,function(t){return n.usersById[t]}),e=_.filter(e,function(t){return!!t}),f(e)}),n.$on("$destroy",function(){return o.off()})},require:"ngModel"}},angular.module("taigaComponents").directive("tgAssignedUsers",["$rootScope","$tgConfirm","$tgRepo","$tgQueueModelTransformation","$tgTemplate","$compile","$translate","tgCurrentUserService",t])}.call(this),function(){var t;(t=function(t,e,r){return{link:function(n,i,o){var s;return s=t(o.tgAttachmentLink)(n),i.on("click",function(t){return taiga.isImage(s.getIn(["file","name"]))?(t.preventDefault(),n.$apply(function(){return r.open($("tg-attachments-preview")),e.fileId=s.getIn(["file","id"])})):taiga.isPdf(s.getIn(["file","name"]))?(t.preventDefault(),window.open(s.getIn(["file","url"]))):void 0}),n.$on("$destroy",function(){return i.off()})}}}).$inject=["$parse","tgAttachmentsPreviewService","lightboxService"],angular.module("taigaComponents").directive("tgAttachmentLink",t)}.call(this),function(){var t;(t=function(){return{scope:{},bindToController:{attachment:"=",onDelete:"&",onUpdate:"&",type:"="},controller:"Attachment",controllerAs:"vm",templateUrl:"components/attachment/attachment-gallery.html",link:function(t,e,r,n){}}}).$inject=[],angular.module("taigaComponents").directive("tgAttachmentGallery",t)}.call(this),function(){var t;t=function(){function t(t,e){this.attachmentsService=t,this.translate=e,this.form={},this.form.description=this.attachment.getIn(["file","description"]),this.form.is_deprecated=this.attachment.get(["file","is_deprecated"]),this.title=this.translate.instant("ATTACHMENT.TITLE",{fileName:this.attachment.get("name"),date:moment(this.attachment.get("created_date")).format(this.translate.instant("ATTACHMENT.DATE"))})}return t.$inject=["tgAttachmentsService","$translate"],t.prototype.editMode=function(t){var e;return e=this.attachment.set("editable",t),this.onUpdate({attachment:e})},t.prototype.delete=function(){return this.onDelete({attachment:this.attachment})},t.prototype.save=function(){var t;return t=this.attachment.set("loading",!0),this.onUpdate({attachment:t}),t=(t=this.attachment.merge({editable:!1,loading:!1})).mergeIn(["file"],{description:this.form.description,is_deprecated:!!this.form.is_deprecated}),this.onUpdate({attachment:t})},t}(),angular.module("taigaComponents").controller("Attachment",t)}.call(this),function(){var t;(t=function(){return{scope:{},bindToController:{attachment:"=",onDelete:"&",onUpdate:"&",type:"="},controller:"Attachment",controllerAs:"vm",templateUrl:"components/attachment/attachment.html",link:function(t,e,r,n){}}}).$inject=[],angular.module("taigaComponents").directive("tgAttachment",t)}.call(this),function(){var t;(t=function(t){return{link:function(e,r,n){var i;return i=t(n.tgAttachmentsDrop),r.on("dragover",function(t){return t.preventDefault(),!1}),r.on("drop",function(t){var r;return t.stopPropagation(),t.preventDefault(),r=t.dataTransfer||t.originalEvent&&t.originalEvent.dataTransfer,e.$apply(function(){return i(e,{files:r.files})})}),e.$on("$destroy",function(){return r.off()})}}}).$inject=["$parse"],angular.module("taigaComponents").directive("tgAttachmentsDrop",t)}.call(this),function(){var t,e;e=this.taiga.sizeFormat,t=function(){function t(t,r,n,i,o,s,a){var c;this.translate=t,this.confirm=r,this.config=n,this.storage=i,this.attachmentsFullService=o,this.projectService=s,this.attachmentsPreviewService=a,this.mode=this.storage.get("attachment-mode","list"),this.maxFileSize=this.config.get("maxUploadFileSize",null),this.maxFileSize&&(this.maxFileSize=e(this.maxFileSize)),this.maxFileSizeMsg=this.maxFileSize?this.translate.instant("ATTACHMENT.MAX_UPLOAD_SIZE",{maxFileSize:this.maxFileSize}):"",taiga.defineImmutableProperty(this,"attachments",(c=this,function(){return c.attachmentsFullService.attachments})),taiga.defineImmutableProperty(this,"deprecatedsCount",function(t){return function(){return t.attachmentsFullService.deprecatedsCount}}(this)),taiga.defineImmutableProperty(this,"attachmentsVisible",function(t){return function(){return t.attachmentsFullService.attachmentsVisible}}(this)),taiga.defineImmutableProperty(this,"deprecatedsVisible",function(t){return function(){return t.attachmentsFullService.deprecatedsVisible}}(this))}return t.$inject=["$translate","$tgConfirm","$tgConfig","$tgStorage","tgAttachmentsFullService","tgProjectService","tgAttachmentsPreviewService"],t.prototype.uploadingAttachments=function(){return this.attachmentsFullService.uploadingAttachments},t.prototype.addAttachment=function(t){var e;return e="list"===this.mode,this.attachmentsFullService.addAttachment(this.projectId,this.objId,this.type,t,e)},t.prototype.setMode=function(t){return this.mode=t,this.storage.set("attachment-mode",t)},t.prototype.toggleDeprecatedsVisible=function(){return this.attachmentsFullService.toggleDeprecatedsVisible()},t.prototype.addAttachments=function(t){return _.forEach(t,(e=this,function(t){return e.addAttachment(t)}));var e},t.prototype.loadAttachments=function(){return this.attachmentsFullService.loadAttachments(this.type,this.objId,this.projectId)},t.prototype.deleteAttachment=function(t){var e,r,n;return this.attachmentsPreviewService.fileId=null,r=this.translate.instant("ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT"),e=this.translate.instant("ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT",{fileName:t.getIn(["file","name"])}),this.confirm.askOnDelete(r,e).then((n=this,function(r){var i,o;return i=function(){return e=n.translate.instant("ATTACHMENT.ERROR_DELETE_ATTACHMENT",{errorMessage:e}),n.confirm.notify("error",null,e),r.finish(!1)},o=function(){return r.finish()},n.attachmentsFullService.deleteAttachment(t,n.type).then(o,i)}))},t.prototype.reorderAttachment=function(t,e){return this.attachmentsFullService.reorderAttachment(this.type,t,e)},t.prototype.updateAttachment=function(t){return this.attachmentsFullService.updateAttachment(t,this.type)},t.prototype._isEditable=function(){return!!this.projectService.project&&this.projectService.hasPermission(this.editPermission)},t.prototype.showAttachments=function(){return this._isEditable()||this.attachmentsFullService.attachments.size},t}(),angular.module("taigaComponents").controller("AttachmentsFull",t)}.call(this),function(){var t,e;e=this.taiga.bindOnce,(t=function(){return{scope:{},bindToController:{type:"@",objId:"=",projectId:"=",editPermission:"@"},controller:"AttachmentsFull",controllerAs:"vm",templateUrl:"components/attachments-full/attachments-full.html",link:function(t,r,n,i){return e(t,"vm.objId",function(t){return i.loadAttachments()})}}}).$inject=[],angular.module("taigaComponents").directive("tgAttachmentsFull",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(t,e){var r;this.attachmentsService=t,this.rootScope=e,this._attachments=Immutable.List(),this._deprecatedsCount=0,this._attachmentsVisible=Immutable.List(),this._deprecatedsVisible=!1,this.uploadingAttachments=[],taiga.defineImmutableProperty(this,"attachments",(r=this,function(){return r._attachments})),taiga.defineImmutableProperty(this,"deprecatedsCount",function(t){return function(){return t._deprecatedsCount}}(this)),taiga.defineImmutableProperty(this,"attachmentsVisible",function(t){return function(){return t._attachmentsVisible}}(this)),taiga.defineImmutableProperty(this,"deprecatedsVisible",function(t){return function(){return t._deprecatedsVisible}}(this))}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=["tgAttachmentsService","$rootScope"],r.prototype.toggleDeprecatedsVisible=function(){return this._deprecatedsVisible=!this._deprecatedsVisible,this.regenerate()},r.prototype.regenerate=function(){return this._deprecatedsCount=this._attachments.count(function(t){return t.getIn(["file","is_deprecated"])}),this._deprecatedsVisible?this._attachmentsVisible=this._attachments:this._attachmentsVisible=this._attachments.filter(function(t){return!t.getIn(["file","is_deprecated"])})},r.prototype.addAttachment=function(t,e,r,n,i,o){return null==i&&(i=!0),null==o&&(o=!1),new Promise((s=this,function(a,c){return s.attachmentsService.validate(n)?(s.uploadingAttachments.push(n),s.attachmentsService.upload(n,e,t,r,o).then(function(t){var e;return s.uploadingAttachments=s.uploadingAttachments.filter(function(e){return e.name!==t.get("name")}),e=(e=Immutable.Map()).merge({file:t,editable:i,loading:!1,from_comment:o}),s._attachments=s._attachments.push(e),s.regenerate(),s.rootScope.$broadcast("attachment:create"),a(e)})):c(new Error(n))}));var s},r.prototype.loadAttachments=function(t,e,r){return this.attachmentsService.list(t,e,r).then((n=this,function(t){return n._attachments=t.map(function(t){return Immutable.Map().merge({loading:!1,editable:!1,file:t})}),n.regenerate()}));var n},r.prototype.deleteAttachment=function(t,e){var r,n;return n=this,r=function(){return n._attachments=n._attachments.filter(function(e){return e!==t}),n.regenerate()},this.attachmentsService.delete(e,t.getIn(["file","id"])).then(r)},r.prototype.reorderAttachment=function(t,e,r){var n,i,o,s;if((i=this.attachments.findIndex(function(t){return t===e}))!==r)return n=(n=(n=this.attachments.remove(i)).splice(r,0,e)).map(function(t,e){return t.setIn(["file","order"],e+1)}),o=[],n.forEach((s=this,function(e){var r;return r={order:e.getIn(["file","order"])},o.push(s.attachmentsService.patch(e.getIn(["file","id"]),t,r))})),Promise.all(o).then(function(t){return function(){return t._attachments=n,t.regenerate()}}(this))},r.prototype.updateAttachment=function(t,e){var r,n,i,o;return r=this._attachments.findIndex(function(e){return e.getIn(["file","id"])===t.getIn(["file","id"])}),n=this._attachments.get(r),i=taiga.patch(n.get("file"),t.get("file")),t.get("loading")?(this._attachments=this._attachments.set(r,t),this.regenerate()):this.attachmentsService.patch(t.getIn(["file","id"]),e,i).then((o=this,function(){return o._attachments=o._attachments.set(r,t),o.regenerate()}))},r}(),angular.module("taigaComponents").service("tgAttachmentsFullService",t)}.call(this),function(){var t;t=function(){function t(t){var e;this.attachmentsPreviewService=t,taiga.defineImmutableProperty(this,"current",(e=this,function(){return e.attachmentsPreviewService.fileId?e.getCurrent():null}))}return t.$inject=["tgAttachmentsPreviewService"],t.prototype.hasPagination=function(){return this.attachments.filter(function(t){return taiga.isImage(t.getIn(["file","name"]))}).size>1},t.prototype.getCurrent=function(){var t;return this.attachments.find((t=this,function(e){return t.attachmentsPreviewService.fileId===e.getIn(["file","id"])})).get("file")},t.prototype.getIndex=function(){return this.attachments.findIndex((t=this,function(e){return t.attachmentsPreviewService.fileId===e.getIn(["file","id"])}));var t},t.prototype.next=function(){var t,e;return t=this.getIndex(),(e=this.attachments.slice(t+1).find(function(t){return taiga.isImage(t.getIn(["file","name"]))}))||(e=this.attachments.find(function(t){return taiga.isImage(t.getIn(["file","name"]))})),this.attachmentsPreviewService.fileId=e.getIn(["file","id"])},t.prototype.previous=function(){var t,e;return t=this.getIndex(),(e=this.attachments.slice(0,t).findLast(function(t){return taiga.isImage(t.getIn(["file","name"]))}))||(e=this.attachments.findLast(function(t){return taiga.isImage(t.getIn(["file","name"]))})),this.attachmentsPreviewService.fileId=e.getIn(["file","id"])},t}(),angular.module("taigaComponents").controller("AttachmentsPreview",t)}.call(this),function(){var t;t=function(t,e){return{scope:{},controller:"AttachmentsPreview",templateUrl:"components/attachments-preview/attachments-preview.html",link:function(t,r,n,i){return $(document.body).on("keydown.image-preview",function(r){return e.fileId&&(39===r.keyCode?i.next():37===r.keyCode&&i.previous()),t.$digest()}),t.$on("$destroy",function(){return $(document.body).off(".image-preview")})},controllerAs:"vm",bindToController:{attachments:"="}}},angular.module("taigaComponents").directive("tgAttachmentsPreview",["lightboxService","tgAttachmentsPreviewService",t])}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(){}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=[],r}(),angular.module("taigaComponents").service("tgAttachmentsPreviewService",t)}.call(this),function(){var t;t=function(){function t(t){this.attachmentsService=t}return t.$inject=["tgAttachmentsService"],t.prototype.addAttachment=function(t){var e;if(e=Immutable.fromJS({file:t,name:t.name,size:t.size}),this.attachmentsService.validate(t)&&(this.attachments=this.attachments.push(e),this.onAdd))return this.onAdd({attachment:e})},t.prototype.addAttachments=function(t){return _.forEach(t,this.addAttachment.bind(this))},t.prototype.deleteAttachment=function(t){if(this.attachments=this.attachments.filter(function(e){return e!==t}),this.onDelete)return this.onDelete({attachment:t})},t}(),angular.module("taigaComponents").controller("AttachmentsSimple",t)}.call(this),function(){var t;(t=function(){return{scope:{},bindToController:{attachments:"=",onAdd:"&",onDelete:"&"},controller:"AttachmentsSimple",controllerAs:"vm",templateUrl:"components/attachments-simple/attachments-simple.html",link:function(t,e,r,n){}}}).$inject=[],angular.module("taigaComponents").directive("tgAttachmentsSimple",t)}.call(this),function(){var t;(t=function(t){return{link:function(e,r,n){var i,o;return i=t(n.tgAttachmentsSortable),(o=dragula([r[0]],{copySortSource:!1,copy:!1,mirrorContainer:r[0],moves:function(t){return $(t).is("div[tg-bind-scope]")}})).on("dragend",function(t){var r,n;return t=$(t),r=t.scope().attachment,n=t.index(),e.$apply(function(){return i(e,{attachment:r,index:n})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&o.dragging}}),e.$on("$destroy",function(){return r.off(),o.destroy()})}}}).$inject=["$parse"],angular.module("taigaComponents").directive("tgAttachmentsSortable",t)}.call(this),function(){var t;(t=function(t){return{link:function(e,r){return t(function(){return r[0].select()})}}}).$inject=["$timeout"],angular.module("taigaComponents").directive("tgAutoSelect",t)}.call(this),function(){var t;(t=function(t){return{link:function(e,r,n){var i;return i=n.tgAvatarBig?"avatarBig":"avatar",e.$watch(i,function(e){var n;return n=t.getAvatar(e,i),r.attr("src",n.url),r.attr("title",""+n.username),r.attr("alt",""+n.username),r.css("background",n.bg||"")})},scope:{avatar:"=tgAvatar",avatarBig:"=tgAvatarBig"}}}).$inject=["tgAvatarService"],angular.module("taigaComponents").directive("tgAvatar",t),angular.module("taigaComponents").directive("tgAvatarBig",t)}.call(this),function(){var t;t=function(t,e,r,n,i){return{link:function(i,o,s){var a;return i.$watch("epics",function(t){return a(t)}),i.$on("related-epics:changed",function(t,e){return r.userstories.getByRef(e.project,e.ref,{}).then(function(t){return i.item.epics=t.epics,a(t.epics)})}),i.removeEpicRelationship=function(r){var o,s;return s=t.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.TITLE"),o=t.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.MESSAGE",{epicSubject:r.get("subject")}),e.ask(s,null,o).then(function(t){var o,s,a,c;return a=function(){return t.finish(),i.$broadcast("related-epics:changed",i.item)},s=function(){return t.finish(!1),e.notify("error")},o=r.get("id"),c=i.item.id,n.epics.deleteRelatedUserstory(o,c).then(a,s)})},a=function(t){if(i.epicsLength=0,i.immutable_epics=[],t&&!t.isIterable)return i.epicsLength=t.length,i.immutable_epics=Immutable.fromJS(t)}},scope:{epics:"=",item:"="},templateUrl:function(t,e){return e.format?"components/belong-to-epics/belong-to-epics-"+e.format+".html":"components/belong-to-epics/belong-to-epics-pill.html"}}},angular.module("taigaEpics").directive("tgBelongToEpics",["$translate","$tgConfirm","$tgResources","tgResources","lightboxService",t])}.call(this),function(){var t;t=function(t,e,r,n,i){return{restrict:"A",compile:function(o,s){var a,c;return a=e(s.tgBindCode),c=e(s.tgBindCode,function(t){return(t||"").toString()}),r.$$addBindingClass(o),function(e,o,s){return r.$$addBindingInfo(o,s.tgBindCode),e.$watch(c,function(){var r;return r=n.getHTML(a(e)),o.html(t.getTrustedHtml(r)||""),i.addHightlighter(o)})}}}},angular.module("taigaComponents").directive("tgBindCode",["$sce","$parse","$compile","tgWysiwygService","tgWysiwygCodeHightlighterService",t])}.call(this),function(){var t;t=function(){return{scope:{levels:"=",value:"="},templateUrl:"components/board-zoom/board-zoom.html"}},angular.module("taigaComponents").directive("tgBoardZoom",[t])}.call(this),function(){var t;t=function(){function t(){this.index=0}return t.$inject=[],t.prototype.next=function(){if(this.index++,this.index>=this.images.size)return this.index=0},t.prototype.previous=function(){if(this.index--,this.index<0)return this.index=this.images.size-1},t}(),angular.module("taigaComponents").controller("CardSlideshow",t)}.call(this),function(){var t;t=function(){return{controller:"CardSlideshow",templateUrl:"components/card-slideshow/card-slideshow.html",bindToController:!0,controllerAs:"vm",scope:{images:"="}}},angular.module("taigaComponents").directive("tgCardSlideshow",t)}.call(this),function(){var t;t=function(){function t(){}return t.$inject=[],t.prototype.visible=function(t){return-1!==this.zoom.indexOf(t)},t.prototype.hasTasks=function(){var t;return(t=this.item.getIn(["model","tasks"]))&&t.size>0},t.prototype.hasMultipleAssignedUsers=function(){var t;return(t=this.item.getIn(["model","assigned_users"]))&&t.size>1},t.prototype.hasVisibleAttachments=function(){return this.item.get("images").size>0},t.prototype.toggleFold=function(){return this.onToggleFold({id:this.item.get("id")})},t.prototype.getClosedTasks=function(){return this.item.getIn(["model","tasks"]).filter(function(t){return t.get("is_closed")})},t.prototype.closedTasksPercent=function(){return 100*this.getClosedTasks().size/this.item.getIn(["model","tasks"]).size},t.prototype.getModifyPermisionKey=function(){return"task"===this.type?"modify_task":"modify_us"},t.prototype.getDeletePermisionKey=function(){return"task"===this.type?"delete_task":"delete_us"},t.prototype._setVisibility=function(){var t;return t={related:this.visible("related_tasks"),slides:this.visible("attachments")},_.isUndefined(this.item.get("foldStatusChanged"))||(this.visible("related_tasks")&&this.visible("attachments")?(t.related=!this.item.get("foldStatusChanged"),t.slides=!this.item.get("foldStatusChanged")):this.visible("attachments")?(t.related=this.item.get("foldStatusChanged"),t.slides=this.item.get("foldStatusChanged")):this.visible("related_tasks")||this.visible("attachments")||(t.related=this.item.get("foldStatusChanged"),t.slides=this.item.get("foldStatusChanged"))),this.item.getIn(["model","tasks"])&&this.item.getIn(["model","tasks"]).size||(t.related=!1),this.item.get("images")&&this.item.get("images").size||(t.slides=!1),t},t.prototype.isRelatedTasksVisible=function(){return this._setVisibility().related},t.prototype.isSlideshowVisible=function(){return this._setVisibility().slides},t.prototype.getNavKey=function(){return"task"===this.type?"project-tasks-detail":"issue"===this.type?"project-issues-detail":"project-userstories-detail"},t}(),angular.module("taigaComponents").controller("Card",t)}.call(this),function(){var t;t=function(){return{link:function(t){},controller:"Card",controllerAs:"vm",bindToController:!0,templateUrl:"components/card/card.html",scope:{onToggleFold:"&",onClickAssignedTo:"&",onClickEdit:"&",onClickRemove:"&",onClickDelete:"&",project:"=",item:"=",zoom:"=",zoomLevel:"=",archived:"=",type:"@"}}},angular.module("taigaComponents").directive("tgCard",t)}.call(this),function(){var t;t=function(){return{link:function(t,e){return e.on("click",function(t){var r;if(!$(t.target).is("input"))return t.preventDefault(),(r=e.find('input[type="file"]')).val(""),r.trigger("click")}),t.$on("$destroy",function(){return e.off()})}}},angular.module("taigaComponents").directive("tgClickInputFile",[t])}.call(this),function(){var t,e,r;r=this.taiga,e=r.getDefaulColorList,t=function(){function t(t){this.projectService=t,this.colorList=e(),this.checkIsColorRequired(),this.displayColorList=!1}return t.$inject=["tgProjectService"],t.prototype.userCanChangeColor=function(){return!this.requiredPerm||this.projectService.hasPermission(this.requiredPerm)},t.prototype.checkIsColorRequired=function(){if(!this.isColorRequired)return this.colorList=_.dropRight(this.colorList)},t.prototype.setColor=function(t){return this.color=t,this.customColor=t},t.prototype.resetColor=function(){if(this.isColorRequired&&!this.color)return this.color=this.initColor},t.prototype.toggleColorList=function(){return this.displayColorList=!this.displayColorList,this.customColor=this.color,this.resetColor()},t.prototype.onSelectDropdownColor=function(t){return this.color=t,this.onSelectColor({color:t}),this.toggleColorList()},t.prototype.onKeyDown=function(t){if(13===t.which)return!this.customColor&&this.isColorRequired||this.onSelectDropdownColor(this.customColor),t.preventDefault()},t}(),angular.module("taigaComponents").controller("ColorSelectorCtrl",t)}.call(this),function(){var t;this.taiga.bindOnce,(t=function(t){return{link:function(e,r,n,i){var o,s,a;return o=null,s=function(){return t.cancel(o),o=null},a=function(){if(!o)return o=t(function(){return i.displayColorList=!1,i.resetColor()},400)},r.find(".color-selector").mouseenter(s).mouseleave(a),r.find(".color-selector-dropdown").mouseenter(s).mouseleave(a),e.$watch("vm.initColor",function(t){return i.setColor(t)})},templateUrl:"components/color-selector/color-selector.html",controller:"ColorSelectorCtrl",controllerAs:"vm",bindToController:{isColorRequired:"=",onSelectColor:"&",initColor:"=",requiredPerm:"@"},scope:{}}}).$inject=["$timeout"],angular.module("taigaComponents").directive("tgColorSelector",t)}.call(this),function(){var t,e;e=angular.module("taigaUserStories"),t=function(){function t(t,e,r,n,i){this.rootScope=t,this.confirm=e,this.modelTransform=r,this.navUrls=n,this.window=i,this.editMode=!1,this.loadingSubject=!1,this.originalSubject=this.item.subject,this.objType={tasks:"task",issues:"issue",userstories:"us"}[this.item._name]}return t.$inject=["$rootScope","$tgConfirm","$tgQueueModelTransformation","$tgNavUrls","$window"],t.prototype._checkNav=function(){var t,e,r;if(null!=(null!=(e=this.item.neighbors.previous)?e.ref:void 0)&&(t={project:this.project.slug,ref:this.item.neighbors.previous.ref},this.previousUrl=this.navUrls.resolve("project-"+this.item._name+"-detail",t)),null!=(null!=(r=this.item.neighbors.next)?r.ref:void 0))return t={project:this.project.slug,ref:this.item.neighbors.next.ref},this.nextUrl=this.navUrls.resolve("project-"+this.item._name+"-detail",t)},t.prototype._checkPermissions=function(){return this.permissions={canEdit:_.includes(this.project.my_permissions,this.requiredPerm)}},t.prototype.cancelEdit=function(){return this.editMode=!1,this.item.subject=this.originalSubject},t.prototype.editSubject=function(t){if("Range"!==this.window.getSelection().type&&(t&&(this.editMode=!0),!t))return this.editMode=!1},t.prototype.onKeyDown=function(t){if(13===t.which&&this.saveSubject(),27===t.which)return this.item.subject=this.originalSubject,this.editSubject(!1)},t.prototype.saveSubject=function(){var t,e,r;return r=this,e=function(){return r.loadingSubject=!1,r.rootScope.$broadcast("object:updated"),r.confirm.notify("success"),r.originalSubject=r.item.subject},t=function(t){return function(){return t.loadingSubject=!1,t.confirm.notify("error")}}(this),this.editMode=!1,this.loadingSubject=!0,this.item,this.modelTransform.save(function(t){return t}).then(e,t)},t.prototype.relateToEpic=function(t){return this.rootScope.$broadcast("relate-to-epic:add",t)},t}(),e.controller("StoryHeaderCtrl",t)}.call(this),function(){var t;t=function(){return this.$inject=[],{link:function(t,e,r,n){return n._checkPermissions(),n._checkNav()},controller:"StoryHeaderCtrl",bindToController:!0,scope:{item:"=",project:"=",requiredPerm:"@"},controllerAs:"vm",templateUrl:"components/detail/header/detail-header.html"}},angular.module("taigaUserStories").directive("tgDetailHeader",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n){this.translate=t,this.tgLightboxFactory=e,this.projectService=r,this.rootscope=n,this.defaultConfig=[{color:"#9dce0a",name:"normal due",days_to_due:null,by_default:!0},{color:"#ff9900",name:"due soon",days_to_due:14,by_default:!1},{color:"#ff8a84",name:"past due",days_to_due:0,by_default:!1}]}return t.$inject=["$translate","tgLightboxFactory","tgProjectService","$rootScope"],t.prototype.visible=function(){return"button"===this.format||null!=this.dueDate},t.prototype.disabled=function(){return this.isClosed},t.prototype.color=function(){var t;return(null!=(t=this.getStatus())?t.color:void 0)||null},t.prototype.title=function(){return this.dueDate?this._formatTitle():"button"===this.format?this.translate.instant("COMMON.DUE_DATE.TITLE_ACTION_SET_DUE_DATE"):""},t.prototype.getStatus=function(t){return this.dueDate?((t=this.projectService.project.toJS()[this.objType+"_duedates"])||(t=this.defaultConfig),this._getAppearance(t)):null},t.prototype._getDefaultAppearance=function(t){var e;return e=null,_.map(t,function(t){if(!0===t.by_default)return e=t}),e},t.prototype._getAppearance=function(t){var e,r,n;return e=this._getDefaultAppearance(t),t=_.sortBy(t,function(t){return-t.days_to_due}),r=moment(this.dueDate),n=moment(),_.map(t,function(t){var i;if(null!==t.days_to_due)return i=moment(r-moment.duration(t.days_to_due,"days")),n>=i?e=t:void 0}),e},t.prototype._formatTitle=function(){var t,e,r;return e=this.translate.instant("COMMON.PICKERDATE.FORMAT"),t=moment(this.dueDate).format(e),(null!=(r=this.getStatus())?r.name:void 0)?t+" ("+r.name+")":t},t.prototype.setDueDate=function(){if(!this.disabled())return this.tgLightboxFactory.create("tg-lb-set-due-date",{class:"lightbox lightbox-set-due-date"},{object:this.item,notAutoSave:this.notAutoSave})},t}(),angular.module("taigaComponents").controller("DueDateCtrl",t)}.call(this),function(){var t;t=function(t,e){return{link:function(t,r,n,i){var o;return t.open=!1,o=e.get(),_.merge(o,{field:r.find(".due-date-button")[0],container:r.find(".date-picker-container")[0],bound:!0,onClose:function(){return t.open=!1,t.$apply()},onSelect:function(){return i.dueDate=this.getMoment().format("YYYY-MM-DD")}}),r.picker=new Pikaday(o),r.on("click",".due-date-button",function(e){if(!t.open)return!r.picker.getDate()&&i.dueDate&&r.picker.setDate(moment(i.dueDate).format("YYYY-MM-DD")),r.picker.show(),t.open=!0,t.$apply();r.picker.hide()}),r.on("click",".date-picker-clean",function(e){return e.preventDefault(),e.stopPropagation(),i.dueDate=null,r.picker.setDate(i.dueDate),t.open=!1,r.picker.hide(),t.$apply()}),t.$on("status:changed",function(t,e){return i.isClosed=i.item.is_closed})},controller:"DueDateCtrl",controllerAs:"vm",bindToController:!0,templateUrl:"components/due-date/due-date-popover.html",scope:{dueDate:"=",isClosed:"=",item:"=",objType:"@",format:"@",notAutoSave:"="}}},angular.module("taigaComponents").directive("tgDueDatePopover",["$translate","tgDatePickerConfigService",t])}.call(this),function(){var t;t=function(t,e){return{link:function(r,n,i,o){var s;if(s=function(){var i,s;return s=t.instant("COMMON.PICKERDATE.FORMAT"),o.dueDate&&(o.dueDate=moment(o.dueDate,s)),n.on("click",".date-picker-popover-trigger",function(t){if(!o.disabled())return t.preventDefault(),t.stopPropagation(),n.find(".date-picker-popover").popover().open()}),n.on("click",".date-picker-clean",function(t){return t.preventDefault(),t.stopPropagation(),o.dueDate=null,r.$apply(),n.find(".date-picker-popover").popover().close()}),i=e.get(),_.merge(i,{field:n.find("input.due-date")[0],container:n.find(".date-picker-container")[0],bound:!1,onSelect:function(){return o.dueDate=this.getMoment().format("YYYY-MM-DD"),n.find(".date-picker-popover").popover().close(),r.$apply()}}),n.picker=new Pikaday(i)},"button-popover"===i.format)return s()},controller:"DueDateCtrl",controllerAs:"vm",bindToController:!0,templateUrl:function(t,e){return e.format?"components/due-date/due-date-"+e.format+".html":"components/due-date/due-date-icon.html"},scope:{dueDate:"=",isClosed:"=",item:"=",objType:"@",format:"@",notAutoSave:"="}}},angular.module("taigaComponents").directive("tgDueDate",["$translate","tgDatePickerConfigService",t])}.call(this),function(){var t;(t=function(t){return{restrict:"A",link:function(e,r,n,i){var o;return o=t(n.tgFileChange),r.on("change",function(t){return e.$apply(function(){return o(e,{files:t.currentTarget.files})})}),e.$on("$destroy",function(){return r.off()})}}}).$inject=["$parse"],angular.module("taigaComponents").directive("tgFileChange",t)}.call(this),function(){var t,e,r={}.hasOwnProperty;e=taiga.generateHash,t=function(t){function n(t,e,r){this.q=t,this.urls=e,this.http=r}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(n,taiga.Service),n.$inject=["$q","$tgUrls","$tgHttp"],n.prototype.storeFilters=function(t,r,n){var i,o,s,a,c;return i=this.q.defer(),a=this.urls.resolve("user-storage"),o=e([t,t+":"+n]),_.isEmpty(r)?((s=this.http.delete(a+"/"+o,{key:o,value:r})).then(function(){return i.resolve()}),s.then(null,function(){return i.reject()})):((s=this.http.put(a+"/"+o,{key:o,value:r})).then(function(t){return i.resolve()}),s.then(null,(c=this,function(t){var e;return(e=c.http.post(""+a,{key:o,value:r})).then(function(){return i.resolve()}),e.then(null,function(){return i.reject()})}))),i.promise},n.prototype.getFilters=function(t,r){var n,i,o,s;return n=this.q.defer(),s=this.urls.resolve("user-storage"),i=e([t,t+":"+r]),(o=this.http.get(s+"/"+i)).then(function(t){return n.resolve(t.data.value)}),o.then(null,function(t){return n.resolve({})}),n.promise},n}(),angular.module("taigaComponents").service("tgFilterRemoteStorageService",t)}.call(this),function(){var t;t=function(){return{priority:900,link:function(t,e,r,n){var i;return i=$("tg-filter"),t.$watch(r.ngIf,function(t){var r;if(t)return i.find(".filter-list").hide(),i.height(),r=0,i.children().each(function(){return r+=$(this).outerHeight(!0)}),console.log(e),$(e).next().css({display:"block"})})}}},angular.module("taigaComponents").directive("tgFilterSlideDown",[t])}.call(this),function(){var t;t=function(){function t(t){this.translate=t,this.opened=null,this.filterModeOptions=["include","exclude"],this.filterModeLabels={include:this.translate.instant("COMMON.FILTERS.ADVANCED_FILTERS.INCLUDE"),exclude:this.translate.instant("COMMON.FILTERS.ADVANCED_FILTERS.EXCLUDE")},this.filterMode="include",this.showAdvancedFilter=!1,this.customFilterForm=!1,this.customFilterName=""}return t.$inject=["$translate"],t.prototype.toggleAdvancedFilter=function(){return this.showAdvancedFilter=!this.showAdvancedFilter},t.prototype.toggleFilterCategory=function(t){return this.opened===t?this.opened=null:this.opened=t},t.prototype.isOpen=function(t){return this.opened===t},t.prototype.saveCustomFilter=function(){return this.onSaveCustomFilter({name:this.customFilterName}),this.customFilterForm=!1,this.opened="custom-filter",this.customFilterName=""},t.prototype.changeQ=function(){return this.onChangeQ({q:this.q})},t.prototype.unselectFilter=function(t){return this.onRemoveFilter({filter:t})},t.prototype.unselectFilter=function(t){return this.onRemoveFilter({filter:t})},t.prototype.selectFilter=function(t,e){return e={category:t,filter:e,mode:this.filterMode},this.onAddFilter({filter:e})},t.prototype.removeCustomFilter=function(t){return this.onRemoveCustomFilter({filter:t})},t.prototype.selectCustomFilter=function(t){return this.onSelectCustomFilter({filter:t})},t.prototype.isFilterSelected=function(t,e){return!!_.find(this.selectedFilters,function(r){return e.id===r.id&&t.dataType===r.dataType})},t}(),angular.module("taigaComponents").controller("Filter",t)}.call(this),function(){var t;t=function(){return{scope:{onChangeQ:"&",onAddFilter:"&",onSelectCustomFilter:"&",onRemoveFilter:"&",onRemoveCustomFilter:"&",onSaveCustomFilter:"&",customFilters:"<",defaultQ:"=q",filters:"<",customFilters:"<",selectedFilters:"<"},bindToController:!0,controller:"Filter",controllerAs:"vm",templateUrl:"components/filter/filter.html",link:function(t,e,r,n){var i;return i=t.$watch("vm.defaultQ",function(e){return e&&!t.vm.filtersForm.$dirty?(t.vm.q=e,i()):t.vm.filtersForm.$dirty?i():void 0}),r.$observe("open",function(r){return(r=t.$eval(r))?e.addClass("open"):e.removeClass("open")})}}},angular.module("taigaComponents").directive("tgFilter",[t])}.call(this),function(){var t;this.taiga,(t=function(t,e,r,n,i){return{scope:{},link:function(n,o,s,a){var c,u,l;return l=null,(u=introJs()).oncomplete(function(){return $("html,body").scrollTop(0)}),u.onexit(function(){return e.disableJoyRide()}),c=function(t,e){if(e[t.joyride])return u.setOptions({exitOnEsc:!1,exitOnOverlayClick:!1,showStepNumbers:!1,nextLabel:i.instant("JOYRIDE.NAV.NEXT")+" &rarr;",prevLabel:"&larr; "+i.instant("JOYRIDE.NAV.BACK"),skipLabel:i.instant("JOYRIDE.NAV.SKIP"),doneLabel:i.instant("JOYRIDE.NAV.DONE"),disableInteraction:!0}),u.setOption("steps",r.get(t.joyride)),u.start()},t.$on("$routeChangeSuccess",function(r,n){return n.joyride&&e.isAuthenticated()?(u.oncomplete(function(){return e.disableJoyRide(n.joyride)}),n.loader?l=t.$on("loader:end",function(){return e.loadJoyRideConfig().then(function(t){return c(n,t)}),l()}):e.loadJoyRideConfig().then(function(t){return c(n,t)})):(u.exit(),void(l&&l()))})}}}).$inject=["$rootScope","tgCurrentUserService","tgJoyRideService","$location","$translate"],angular.module("taigaComponents").directive("tgJoyRide",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(t,e){this.translate=t,this.checkPermissionsService=e}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=["$translate","tgCheckPermissionsService"],r.prototype.getConfig=function(){return{dashboard:(t=this,function(){var e;return e=[{element:".project-list > section:not(.ng-hide)",position:"left",joyride:{title:t.translate.instant("JOYRIDE.DASHBOARD.STEP1.TITLE"),text:t.translate.instant("JOYRIDE.DASHBOARD.STEP1.TEXT")}},{element:".working-on-container",position:"right",joyride:{title:t.translate.instant("JOYRIDE.DASHBOARD.STEP2.TITLE"),text:t.translate.instant("JOYRIDE.DASHBOARD.STEP2.TEXT")}},{element:".watching-container",position:"right",joyride:{title:t.translate.instant("JOYRIDE.DASHBOARD.STEP3.TITLE"),text:[t.translate.instant("JOYRIDE.DASHBOARD.STEP3.TEXT1"),t.translate.instant("JOYRIDE.DASHBOARD.STEP3.TEXT2")]}}],$(".project-list .create-project-button").is(":hidden")||e.push({element:".project-list .create-project-button",position:"bottom",joyride:{title:t.translate.instant("JOYRIDE.DASHBOARD.STEP4.TITLE"),text:[t.translate.instant("JOYRIDE.DASHBOARD.STEP4.TEXT1"),t.translate.instant("JOYRIDE.DASHBOARD.STEP4.TEXT2")]}}),e}),backlog:function(t){return function(){var e;return e=[{element:".summary",position:"bottom",joyride:{title:t.translate.instant("JOYRIDE.BACKLOG.STEP1.TITLE"),text:[t.translate.instant("JOYRIDE.BACKLOG.STEP1.TEXT1"),t.translate.instant("JOYRIDE.BACKLOG.STEP1.TEXT2")]}},{element:".backlog-table-empty",position:"bottom",joyride:{title:t.translate.instant("JOYRIDE.BACKLOG.STEP2.TITLE"),text:t.translate.instant("JOYRIDE.BACKLOG.STEP2.TEXT")}},{element:".sprints",position:"left",joyride:{title:t.translate.instant("JOYRIDE.BACKLOG.STEP3.TITLE"),text:t.translate.instant("JOYRIDE.BACKLOG.STEP3.TEXT")}}],t.checkPermissionsService.check("add_us")&&e.push({element:".new-us",position:"rigth",joyride:{title:t.translate.instant("JOYRIDE.BACKLOG.STEP4.TITLE"),text:t.translate.instant("JOYRIDE.BACKLOG.STEP4.TEXT")}}),e}}(this),kanban:function(t){return function(){var e;return e=[{element:".kanban-table-inner",position:"bottom",joyride:{title:t.translate.instant("JOYRIDE.KANBAN.STEP1.TITLE"),text:t.translate.instant("JOYRIDE.KANBAN.STEP1.TEXT")}},{element:".card-placeholder",position:"right",joyride:{title:t.translate.instant("JOYRIDE.KANBAN.STEP2.TITLE"),text:t.translate.instant("JOYRIDE.KANBAN.STEP2.TEXT")}}],t.checkPermissionsService.check("add_us")&&e.push({element:".add-action",position:"bottom",joyride:{title:t.translate.instant("JOYRIDE.KANBAN.STEP3.TITLE"),text:[t.translate.instant("JOYRIDE.KANBAN.STEP3.TEXT1"),t.translate.instant("JOYRIDE.KANBAN.STEP3.TEXT2")]}}),e}}(this)};var t},r.prototype.get=function(t){var e;return e=this.getConfig()[t].call(this),_.map(e,function(t){var e;return e="",t.joyride.title&&(e+="<h3>"+t.joyride.title+"</h3>"),_.isArray(t.joyride.text)?_.forEach(t.joyride.text,function(t){return e+="<p>"+t+"</p>"}):e+="<p>"+t.joyride.text+"</p>",t.intro=e,t})},r}(),angular.module("taigaComponents").service("tgJoyRideService",t)}.call(this),function(){var t;t=function(t,e){return{scope:{onZoomChange:"&"},template:'<tg-board-zoom\n    class="board-zoom"\n    value="zoomIndex"\n    levels="levels"\n></tg-board-zoom>',link:function(r,n,i,o){var s,a,c;return r.zoomIndex=t.get("kanban_zoom")||2,r.levels=5,c=[["ref"],["subject"],["owner","tags","extra_info"],["unfold"],["attachments","related_tasks","empty_extra_info"]],s=function(e){return null==e&&(e=0),t.get("kanban_zoom")!==e&&t.set("kanban_zoom",e),_.reduce(c,function(t,r,n){return n<=e&&(t=t.concat(r)),t})},r.$watch("zoomIndex",function(t){var e;return e=s(t),r.onZoomChange({zoomLevel:t,zoom:e})}),a=r.$watch(function(){return e.project},function(t){if(t)return-1===t.get("my_permissions").indexOf("view_tasks")&&(r.levels=4),a()})}}},angular.module("taigaComponents").directive("tgKanbanBoardZoom",["$tgStorage","tgProjectService",t])}.call(this),function(){var t;(t=function(t){return{restrict:"AE",scope:{},controllerAs:"vm",controller:function(){return this.close=function(){return t.open=!1},Object.defineProperties(this,{open:{get:function(){return t.open}},title:{get:function(){return t.title}},desc:{get:function(){return t.desc}}})},link:function(t,e,r){},templateUrl:"components/live-announcement/live-announcement.html"}}).$inject=["tgLiveAnnouncementService"],angular.module("taigaComponents").directive("tgLiveAnnouncement",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(){this.open=!1,this.title="",this.desc=""}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.prototype.show=function(t,e){return this.open=!0,this.title=t,this.desc=e},r}(),angular.module("taigaComponents").service("tgLiveAnnouncementService",t)}.call(this),function(){var t,e;e=angular.module("taigaComponents"),t=function(){function t(t,e,r,n,i,o,s){var a;this.rootScope=t,this.scope=e,this.rs=r,this.projectService=n,this.translate=i,this.lightboxService=o,this.confirm=s,this.projectId=this.projectService.project.get("id"),this.loading=!1,this.someSelected=!1,this.selectedSprintId=null,this.typesSelected={uss:!1,tasks:!1,issues:!1},this.itemsToMove={},this._loadSprints(),this.scope.$watch("vm.openItems",(a=this,function(t){if(t)return a._init(t)}))}return t.$inject=["$rootScope","$scope","$tgResources","tgProjectService","$translate","lightboxService","$tgConfirm"],t.prototype._init=function(t){var e,r,n;return this.hasManyItemTypes=_.size(this.openItems)>1,this.ussCount=parseInt(null!=(e=t.uss)?e.length:void 0),this.updateSelected("uss",this.ussCount>0),this.tasksCount=parseInt(null!=(r=t.tasks)?r.length:void 0),this.updateSelected("tasks",this.tasksCount>0),this.issuesCount=parseInt(null!=(n=t.issues)?n.length:void 0),this.updateSelected("issues",this.issuesCount>0)},t.prototype._loadSprints=function(){return this.rs.sprints.list(this.projectId,{closed:!1}).then((t=this,function(e){return t.sprints=_.filter(e.milestones,function(e){return e.id!==t.sprint.id})}));var t},t.prototype.updateSelected=function(t,e){return this.typesSelected[t]=e,this.someSelected=_.some(this.typesSelected),!0===e?this.itemsToMove[t]=this.openItems[t]:this.itemsToMove[t]?delete this.itemsToMove[t]:void 0},t.prototype.submit=function(){var t,e;return t={},_.map(this.openItems,(e=this,function(r,n){if(!e.itemsToMove[n])return t[n]=!0})),this.loading=!0,this.moveItems().then(function(e){return function(){if(e.rootScope.$broadcast("taskboard:items:move",e.typesSelected),e.lightboxService.closeAll(),e.loading=!1,_.size(t)>0)return e.displayWarning(t)}}(this))},t.prototype.moveItems=function(){var t;return t=[],this.itemsToMove.uss&&t.push(this.rs.sprints.moveUserStoriesMilestone(this.sprint.id,this.projectId,this.selectedSprintId,this.itemsToMove.uss)),this.itemsToMove.tasks&&t.push(this.rs.sprints.moveTasksMilestone(this.sprint.id,this.projectId,this.selectedSprintId,this.itemsToMove.tasks)),this.itemsToMove.issues&&t.push(this.rs.sprints.moveIssuesMilestone(this.sprint.id,this.projectId,this.selectedSprintId,this.itemsToMove.issues)),Promise.all(t)},t.prototype.displayWarning=function(t){var e,r,n,i,o;return e=this.translate.instant("COMMON.I_GET_IT"),1===_.size(t)&&!0===t.issues?(i=this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_ISSUES_NOT_MOVED_TITLE"),r=this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_ISSUES_NOT_MOVED")):(o=0,_.map(this.itemsToMove,function(t,e){return o+=t.length}),i=this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_SPRINT_STILL_OPEN_TITLE",{total:o},"messageformat"),r=this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_SPRINT_STILL_OPEN",{sprintName:null!=(n=this.sprint)?n.name:void 0})),this.confirm.success(i,r,null,e)},t}(),e.controller("MoveToSprintLbCtrl",t)}.call(this),function(){var t,e;t=angular.module("taigaComponents"),(e=function(t){return{scope:{},bindToController:{openItems:"=",sprint:"="},templateUrl:"components/move-to-sprint/move-to-sprint-lb/move-to-sprint-lb.html",controller:"MoveToSprintLbCtrl",controllerAs:"vm",link:function(e,r,n,i){return t.open(r)}}}).$inject=["lightboxService"],t.directive("tgLbMoveToSprint",e)}.call(this),function(){var t;this.taiga,t=function(){function t(t,e,r){var n;this.scope=t,this.lightboxFactory=e,this.projectService=r,this.permissions=this.projectService.project.get("my_permissions"),this.hasOpenItems=!1,this.disabled=!1,this.openItems={uss:[],tasks:[],issues:[]},this.scope.$watch("vm.uss",(n=this,function(){return n.getOpenUss()})),this.scope.$watch("vm.unnasignedTasks",function(t){return function(){return t.getOpenStorylessTasks()}}(this)),this.scope.$watch("vm.issues",function(t){return function(){return t.getOpenIssues()}}(this))}return t.$inject=["$scope","tgLightboxFactory","tgProjectService"],t.prototype.checkOpenItems=function(){return _.some(Object.keys(this.openItems),(t=this,function(e){return t.openItems[e].length>0}));var t},t.prototype.openLightbox=function(){var t;if(!1===this.disabled&&this.hasOpenItems)return t={},_.map(this.openItems,function(e,r){if(e.length)return t[r]=e}),this.lightboxFactory.create("tg-lb-move-to-sprint",{class:"lightbox lightbox-move-to-sprint",sprint:"sprint","open-items":"openItems"},{sprint:this.sprint,openItems:t})},t.prototype.getOpenUss=function(){var t;if(this.uss&&-1!==this.permissions.indexOf("modify_us"))return this.openItems.uss=[],this.uss.map((t=this,function(e){if(!1===e.is_closed)return t.openItems.uss.push({us_id:e.id,order:e.sprint_order})})),this.hasOpenItems=this.checkOpenItems()},t.prototype.getOpenStorylessTasks=function(){var t;if(this.unnasignedTasks&&-1!==this.permissions.indexOf("modify_task"))return this.openItems.tasks=[],this.unnasignedTasks.map((t=this,function(e){return e.map(function(e){if(!1===e.get("model").get("is_closed"))return t.openItems.tasks.push({task_id:e.get("model").get("id"),order:e.get("model").get("taskboard_order")})})})),this.hasOpenItems=this.checkOpenItems()},t.prototype.getOpenIssues=function(){var t;if(this.issues&&-1!==this.permissions.indexOf("modify_issue"))return this.openItems.issues=[],this.issues.map((t=this,function(e){if(!1===e.get("status").get("is_closed"))return t.openItems.issues.push({issue_id:e.get("id")})})),this.hasOpenItems=this.checkOpenItems()},t}(),angular.module("taigaComponents").controller("MoveToSprintCtrl",t)}.call(this),function(){var t,e;t=angular.module("taigaComponents"),(e=function(t){return{controller:"MoveToSprintCtrl",controllerAs:"vm",bindToController:!0,templateUrl:"components/move-to-sprint/move-to-sprint.html",scope:{sprint:"=",uss:"=",unnasignedTasks:"=",issues:"=",disabled:"="}}}).$inject=["tgTaskboardTasks"],t.directive("tgMoveToSprint",[e])}.call(this),function(){var t;(t=function(t){return{link:function(e,r,n){return e.$watch("project",function(e){var n,i;if(e=Immutable.fromJS(e))return(i=e.get("logo_big_url"))?(r.attr("src",i),r.css("background","")):(n=t.getDefaultProjectLogo(e.get("slug"),e.get("id")),r.attr("src",n.src),r.css("background",n.color))})},scope:{project:"=tgProjectLogoBigSrc"}}}).$inject=["tgProjectLogoService"],angular.module("taigaComponents").directive("tgProjectLogoBigSrc",t)}.call(this),function(){var t;(t=function(t){return{link:function(e,r,n){return e.$watch("project",function(e){var n,i;if(e=Immutable.fromJS(e))return(i=e.get("logo_small_url"))?(r.attr("src",i),r.css("background","")):(n=t.getDefaultProjectLogo(e.get("slug"),e.get("id")),r.attr("src",n.src),r.css("background",n.color))})},scope:{project:"=tgProjectLogoSmallSrc"}}}).$inject=["tgProjectLogoService"],angular.module("taigaComponents").directive("tgProjectLogoSmallSrc",t)}.call(this),function(){var t;t=function(){function t(t,e){this.projectService=t,this.lightboxFactory=e,this.project=null,this.menu=Immutable.Map()}return t.$inject=["tgProjectService","tgLightboxFactory"],t.prototype.show=function(){var t;return this.project=this.projectService.project,this.sprints=null!=(t=this.project.get("milestones"))?t.toJS():void 0,this.active=this._getActiveSection(),this._setVideoConference(),this._setMenuPermissions()},t.prototype.hide=function(){return this.project=null,this.menu={}},t.prototype.search=function(){return this.lightboxFactory.create("tg-search-box",{class:"lightbox lightbox-search"})},t.prototype._setVideoConference=function(){var t;if(t=this._videoConferenceUrl())return this.project=this.project.set("videoconferenceUrl",t)},t.prototype._setMenuPermissions=function(){if(this.menu=Immutable.Map({epics:!1,backlog:!1,kanban:!1,issues:!1,wiki:!1}),this.project.get("is_epics_activated")&&-1!==this.project.get("my_permissions").indexOf("view_epics")&&(this.menu=this.menu.set("epics",!0)),this.project.get("is_backlog_activated")&&-1!==this.project.get("my_permissions").indexOf("view_us")&&(this.menu=this.menu.set("backlog",!0)),this.project.get("is_kanban_activated")&&-1!==this.project.get("my_permissions").indexOf("view_us")&&(this.menu=this.menu.set("kanban",!0)),this.project.get("is_issues_activated")&&-1!==this.project.get("my_permissions").indexOf("view_issues")&&(this.menu=this.menu.set("issues",!0)),this.project.get("is_wiki_activated")&&-1!==this.project.get("my_permissions").indexOf("view_wiki_pages"))return this.menu=this.menu.set("wiki",!0)},t.prototype._getActiveSection=function(){var t,e,r,n,i;return n=this.projectService.section,t=(i=this.projectService.sectionsBreadcrumb).lastIndexOf("backlog"),e=i.lastIndexOf("kanban"),-1===t&&-1===e||(r=-1===e||t>e?"backlog":"kanban"),"backlog-kanban"===n&&("backlog"===r||"kanban"===r?n=r:this.project.get("is_backlog_activated")&&!this.project.get("is_kanban_activated")?n="backlog":!this.project.get("is_backlog_activated")&&this.project.get("is_kanban_activated")&&(n="kanban")),n},t.prototype._videoConferenceUrl=function(){var t,e;if("appear-in"===this.project.get("videoconferences"))t="https://appear.in/";else if("talky"===this.project.get("videoconferences"))t="https://talky.io/";else{if("jitsi"!==this.project.get("videoconferences"))return"custom"===this.project.get("videoconferences")?this.project.get("videoconferences_extra_data"):"";t="https://meet.jit.si/"}return e=this.project.get("videoconferences_extra_data")?this.project.get("slug")+"-"+taiga.slugify(this.project.get("videoconferences_extra_data")):this.project.get("slug"),"jitsi"===this.project.get("videoconferences")&&(e=e.replace(/-/g,"")),t+e},t}(),angular.module("taigaComponents").controller("ProjectMenu",t)}.call(this),function(){var t;this.taiga,(t=function(t,e){return{scope:{},controller:"ProjectMenu",controllerAs:"vm",templateUrl:"components/project-menu/project-menu.html",link:function(e,r,n,i){var o;return o=function(){return t.project?i.show():i.hide()},e.$watch(function(){return t.project},o),e.vm.fixed=!1,$(window).on("scroll",function(){var t;return(t=$(window).scrollTop())>100&&!1===e.vm.fixed?(e.vm.fixed=!0,e.$digest()):t<100&&!0===e.vm.fixed?(e.vm.fixed=!1,e.$digest()):void 0})}}}).$inject=["tgProjectService","tgLightboxFactory"],angular.module("taigaComponents").directive("tgProjectMenu",t)}.call(this),function(){var t;t=function(t,e,r,n){return{restrict:"AE",require:"ngModel",templateUrl:"components/promote-to-us/promote-to-us.html",link:function(i,o,s,a){var c,u;return c=null,u=function(n,i){var o,s,a,u;return(s={})["generated_from_"+c]=n.id,s.project=n.project,s.subject=n.subject,s.description=n.description,s.tags=n.tags,s.is_blocked=n.is_blocked,s.blocked_note=n.blocked_note,s.due_date=n.due_date,o=s,u=function(){return i.finish(),r.notify("success"),t.$broadcast("promote-"+c+"-to-us:success")},a=function(){return i.finish(),r.notify("error")},e.create("userstories",o).then(u,a)},o.on("click","a",function(t){var e,i,o,s,l;return t.preventDefault(),i=a.$modelValue,e="COMMON.CONFIRM_PROMOTE."+(c=_.get({tasks:"task",issues:"issue"},i._name)).toUpperCase(),l=n.instant(e+".TITLE"),o=n.instant(e+".MESSAGE"),s=i.subject,r.ask(l,s,o).then(function(t){return u(i,t)})}),i.$on("$destroy",function(){return o.off()})}}},angular.module("taigaComponents").directive("tgPromoteToUsButton",["$rootScope","$tgRepo","$tgConfirm","$translate",t])}.call(this),function(){var t,e,r,n;e=angular.module("taigaComponents"),r=this.taiga.normalizeString,t=this.taiga.groupBy,n=function(e){return{link:function(n,i,o,s){var a,c,u,l,p,d;return n.templateUrl="components/search-list/search-list-"+n.itemType+"-choice.html",n.currentSelected=null,!1,a=[],u={},"issue"===n.itemType&&(n.milestonesById=t(n.project.milestones,function(t){return t.id})),n.filterClosed&&(n.showClosed=!1,"sprint"===n.itemType&&(n.textShowClosed=e.instant("BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS"),n.textHideClosed=e.instant("BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS"))),i.on("click",".choice",function(t){var e,r,i;return e=parseInt($(t.currentTarget).data("choice-id")),i=(null!=(r=o.ngModel)?r.id:void 0)!==e?u[e]:null,s.$setViewValue(i),n.currentSelected=i,n.$apply()}),c=function(t,e){return _.includes(l(e),l(t))},l=function(t){return"string"!=typeof t&&(t=t.toString()),r(t.toUpperCase())},d=function(){return n.currentSelected=null,s.$setViewValue(null)},p=function(){return d(),n.searchText="",a=angular.copy(n.items),u=t(a,function(t){return t.id})},n.isVisible=function(t){var e;return!(n.filterClosed&&!n.showClosed)||("sprint"!==n.itemType||!t.closed&&!t.is_closed||((null!=(e=n.currentSelected)?e.id:void 0)===t.id&&d(),!1))},n.toggleShowClosed=function(t){return n.showClosed=!n.showClosed},n.filterItems=function(t){if(n.filtering=!0,n.items=_.filter(a,function(e){var r;return r=e.getAttrs(),Array.isArray(n.filterBy)?_.some(n.filterBy,function(e){return c(t,r[e])}):c(t,r[n.filterBy])}),!_.find(n.items,n.currentSelected))return d()},n.$watch("items",function(t){if(!n.filtering&&t)return p()})},templateUrl:"components/search-list/search-list.html",require:"ngModel",scope:{label:"@",placeholder:"@",project:"=",filterBy:"=",items:"=",itemType:"@",filterClosed:"=",itemDisabled:"="}}},e.directive("tgSearchList",["$translate",n])}.call(this),function(){var t;t=function(){var t,e,r;return e=function(t){var e,r,n;return t.addClass("selected"),(n=t.position().top+t.outerHeight())>(e=t.parent().outerHeight())?(r=n-e,t.parent().scrollTop(t.parent().scrollTop()+r)):t.position().top<0?t.parent().scrollTop(t.parent().scrollTop()+t.position().top):void 0},t=function(t,r,n){var i,o,s;if(i=t.find(".selected"),40===r){if(!i.length)return e(t.find("li:first"));if((o=i.next("li")).length)return i.removeClass("selected"),e(o)}else if(38===r){if(!i.length)return e(t.find("li:last"));if((s=i.prev("li")).length)return i.removeClass("selected"),e(s)}},r=function(){return $(document).off(".tags-keyboard-navigation")},{link:function(e,n){return r(),$(n).parent().on("keydown.tags-keyboard-navigation",function(e){var r;if(40===(r=e.keyCode?e.keyCode:e.which)||38===r)return e.preventDefault(),t(n,r)}),e.$on("$destroy",r)},templateUrl:"components/tags/tag-dropdown/tag-dropdown.html",scope:{onSelectTag:"&",colorArray:"=",tag:"="}}},angular.module("taigaCommon").directive("tgTagsDropdown",t)}.call(this),function(){var t,e;this.taiga.trim,e=angular.module("taigaCommon"),t=function(){function t(t){this.tagLineService=t,this.disableColorSelection=!1,this.newTag={name:"",color:null},this.colorArray=[],this.addTag=!1}return t.$inject=["tgTagLineService"],t.prototype.checkPermissions=function(){return this.tagLineService.checkPermissions(this.project.my_permissions,this.permissions)},t.prototype._createColorsArray=function(t){return this.colorArray=this.tagLineService.createColorsArray(t)},t.prototype.displayTagInput=function(){return this.addTag=!0},t.prototype.addNewTag=function(t,e){if(this.newTag.name="",this.newTag.color=null,t.length)return this.disableColorSelection?t.length?this.onAddTag({name:t,color:e}):void 0:(this.project.tags_colors[t]&&(e=this.project.tags_colors[t]),this.onAddTag({name:t,color:e}))},t.prototype.selectColor=function(t){return this.newTag.color=t},t}(),e.controller("TagLineCommonCtrl",t)}.call(this),function(){var t;t=function(){return{link:function(t,e,r,n){var i;return _.isUndefined(r.disableColorSelection)||(n.disableColorSelection=!0),i=t.$watch("vm.project",function(t){if(t&&Object.keys(t).length)return i(),n.disableColorSelection?void 0:n.colorArray=n._createColorsArray(n.project.tags_colors)}),e.on("keydown",".tag-input",function(r){var i;return 27===r.keyCode?(n.addTag=!1,n.newTag.name="",n.newTag.color="",r.stopPropagation()):13===r.keyCode&&(r.preventDefault(),e.find(".tags-dropdown .selected").length?(i=$(".tags-dropdown .selected .tags-dropdown-name").text(),n.addNewTag(i,null)):n.addNewTag(n.newTag.name,n.newTag.color)),t.$apply()})},scope:{permissions:"@",loadingAddTag:"=",loadingRemoveTag:"=",tags:"=",project:"=",onAddTag:"&",onDeleteTag:"&"},templateUrl:"components/tags/tag-line-common/tag-line-common.html",controller:"TagLineCommonCtrl",controllerAs:"vm",bindToController:!0}},angular.module("taigaCommon").directive("tgTagLineCommon",t)}.call(this),function(){var t,e,r;r=this.taiga.trim,e=angular.module("taigaCommon"),t=function(){function t(t,e,r){this.rootScope=t,this.confirm=e,this.modelTransform=r,this.loadingAddTag=!1}return t.$inject=["$rootScope","$tgConfirm","$tgQueueModelTransformation"],t.prototype.onDeleteTag=function(t){var e,n,i,o;return this.loadingRemoveTag=t[0],o=this,n=function(t){return o.rootScope.$broadcast("object:updated"),o.loadingRemoveTag=!1,t},e=function(t){return function(){return t.confirm.notify("error"),t.loadingRemoveTag=!1}}(this),i=r(t[0].toLowerCase()),this.modelTransform.save(function(t){var e;return e=_.clone(t.tags),_.remove(e,function(t){return t[0]===i}),t.tags=e,t}).then(n,e)},t.prototype.onAddTag=function(t,e){var n,i,o;return this.loadingAddTag=!0,o=this,i=function(t){return o.rootScope.$broadcast("object:updated"),o.rootScope.$broadcast("tags:updated"),o.addTag=!1,o.loadingAddTag=!1,t},n=function(t){return function(){return t.loadingAddTag=!1,t.confirm.notify("error")}}(this),this.modelTransform.save(function(n){var i;return r(t.toLowerCase()),(i=_.clone(n.tags)).push([t,e]),n.tags=i,n}).then(i,n)},t}(),e.controller("TagLineCtrl",t)}.call(this),function(){var t;t=function(){return{scope:{item:"=",permissions:"@",project:"="},templateUrl:"components/tags/tag-line-detail/tag-line-detail.html",controller:"TagLineCtrl",controllerAs:"vm",bindToController:!0}},angular.module("taigaCommon").directive("tgTagLine",t)}.call(this),function(){var t,e,r={}.hasOwnProperty;e=angular.module("taigaCommon"),t=function(t){function e(){}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,taiga.Service),e.$inject=[],e.prototype.checkPermissions=function(t,e){return _.includes(t,e)},e.prototype.createColorsArray=function(t){return _.map(t,function(t,e){return[e,t]})},e}(),e.service("tgTagLineService",t)}.call(this),function(){var t;t=function(){return{templateUrl:"components/tags/tag/tag.html",scope:{tag:"<",loadingRemoveTag:"<",onDeleteTag:"&",hasPermissions:"@"}}},angular.module("taigaCommon").directive("tgTag",t)}.call(this),function(){var t;t=function(t){return{scope:{onZoomChange:"&"},template:'<tg-board-zoom\n    levels="levels"\n    class="board-zoom"\n    value="zoomIndex"\n></tg-board-zoom>',link:function(e,r,n,i){var o,s;return e.zoomIndex=t.get("taskboard_zoom")||2,e.levels=4,s=[["ref"],["subject"],["owner","tags","extra_info","unfold"],["attachments","empty_extra_info"],["related_tasks"]],o=function(e){return null==e&&(e=0),t.get("taskboard_zoom")!==e&&t.set("taskboard_zoom",e),_.reduce(s,function(t,r,n){return n<=e&&(t=t.concat(r)),t})},e.$watch("zoomIndex",function(t){var r;return r=o(t),e.onZoomChange({zoomLevel:t,zoom:r})})}}},angular.module("taigaComponents").directive("tgTaskboardZoom",["$tgStorage",t])}.call(this),function(){var t;(t=function(t,e){return{link:function(r,n,i){var o,s;if(e.hasPermission("modify_task"))return o=t(i.tgTasksSortable),(s=dragula([n[0]],{copySortSource:!1,copy:!1,mirrorContainer:n[0],moves:function(t){return $(t).is("div.single-related-task.js-related-task")}})).on("dragend",function(t){var e,n,i;return e=$(t),i=e.scope().task,n=e.index(),r.$apply(function(){return o(r,{task:i,newIndex:n})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&s.dragging}}),r.$on("$destroy",function(){return n.off(),s.destroy()})}}}).$inject=["$parse","tgProjectService"],angular.module("taigaComponents").directive("tgTasksSortable",t)}.call(this),function(){var t;(t=function(t,e,r,n,i){return{restrict:"AE",scope:{},controllerAs:"vm",controller:function(){return this.close=function(){var n,o,s;return t.open=!1,void 0===(o=r.getUser()).read_new_terms&&((s=o.getAttrs()).read_new_terms=!1,o=i.make_model("users",s)),o.read_new_terms=!0,n=function(t){return r.setUser(t)},e.save(o).then(n)},Object.defineProperties(this,{open:{get:function(){return t.open}}})},link:function(t,e,r){return t.privacyPolicyUrl=n.get("privacyPolicyUrl"),t.termsOfServiceUrl=n.get("termsOfServiceUrl"),t.GDPRUrl=n.get("GDPRUrl")},templateUrl:"components/terms-announcement/terms-announcement.html"}}).$inject=["tgTermsAnnouncementService","$tgRepo","$tgAuth","$tgConfig","$tgModel"],angular.module("taigaComponents").directive("tgTermsAnnouncement",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(){this.open=!1}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.prototype.show=function(){return this.open=!0},r}(),angular.module("taigaComponents").service("tgTermsAnnouncementService",t)}.call(this),function(){var t;t=function(t){return{restrict:"AE",link:function(e,r,n){return e.privacyPolicyUrl=t.get("privacyPolicyUrl"),e.termsOfServiceUrl=t.get("termsOfServiceUrl"),e.target=!1,e.privacyPolicyUrl&&e.termsOfServiceUrl||(e.target=!0),r.on("change","input[name='accepted_terms']",function(t){var r;return r=angular.element(t.currentTarget),e.target=r.is(":checked"),e.$apply()})},scope:{target:"="},templateUrl:"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html"}},angular.module("taigaComponents").directive("tgTermsOfServiceAndPrivacyPolicyNotice",["$tgConfig",t])}.call(this),function(){var t,e;t=this.taiga.timeout,e=function(e,r){var n,i;return i=[{contentType:"icon",icon:"icon-project",message:"PROJECTS_ORDER"},{contentType:"icon",icon:"icon-upvote",message:"VOTING"},{contentType:"icon",icon:"icon-attach",message:"ISSUES_TO_SPRINT"},{contentType:"icon",icon:"icon-clock",message:"DUE_DATE"},{contentType:"icon",icon:"icon-iocaine",message:"IOCAIN"},{contentType:"icon",icon:"icon-blocked-project",message:"BLOCKED"},{contentType:"icon",icon:"icon-promote",message:"PROMOTE"},{contentType:"icon",icon:"icon-bulk",message:"BULK"},{contentType:"range",message:"ZOOM"},{contentType:"icon",icon:"icon-settings",message:"CUSTOM_FIELDS"},{contentType:"arrows",message:"SLIDE_ARROWS"}],n=function(t){return Math.floor(Math.random()*t)+1},{link:function(r,o,s){var a,c;return r.tipLoaded=!1,c=null,e.onStart(function(){return c=t(1e3,function(){return a()})}),e.onEnd(function(){return clearTimeout(c),r.tipLoaded=!1}),a=function(){var t;return r.tipLoaded=!0,t=i[n(i.length-1)],r.tip={contentType:t.contentType,message:"TIPS.TIP_"+t.message,icon:t.icon,color:"tip-color-"+n(5)}}},scope:!0,templateUrl:"components/tips/tip.html"}},angular.module("taigaComponents").directive("tgTips",["tgLoader","$translate",e])}.call(this),function(){var t;(t=function(t,e){return{scope:{usId:"=",projectSlug:"="},controllerAs:"vm",templateUrl:"components/tribe-button/tribe-button.html",link:function(r,n,i){return r.vm={},r.vm.tribeHost=t.config.tribeHost,r.vm.url=e.protocol()+"://"+e.host(),"http"===e.protocol()&&80!==e.port()?r.vm.url=r.vm.url+":"+e.port():"https"===e.protocol()&&443!==e.port()?r.vm.url=r.vm.url+":"+e.port():void 0}}}).$inject=["$tgConfig","$tgLocation"],angular.module("taigaComponents").directive("tgTribeButton",t)}.call(this),function(){var t;(t=function(t){return{templateUrl:"components/tribe-button/tribe-linked.html",scope:{gigTitle:"=",gigId:"="},link:function(e,r,n){return e.vm={},e.vm.tribeHost=t.config.tribeHost,e.vm.show=function(){return e.vm.open=!0},e.vm.hide=function(t){return e.vm.open=!1}}}}).$inject=["$tgConfig"],angular.module("taigaComponents").directive("tgTribeLinked",t)}.call(this),function(){var t;t=function(){function t(t){this.currentUserService=t,this.user=this.currentUserService.getUser(),this.isMouseOver=!1,this.loading=!1}return t.$inject=["tgCurrentUserService"],t.prototype.showTextWhenMouseIsOver=function(){return this.isMouseOver=!0},t.prototype.showTextWhenMouseIsLeave=function(){return this.isMouseOver=!1},t.prototype.toggleVote=function(){var t,e;return this.loading=!0,(t=this.item.is_voter?this._downvote():this._upvote()).finally((e=this,function(){return e.loading=!1})),t},t.prototype._upvote=function(){return this.onUpvote().then((t=this,function(){return t.showTextWhenMouseIsLeave()}));var t},t.prototype._downvote=function(){return this.onDownvote()},t}(),angular.module("taigaComponents").controller("VoteButton",t)}.call(this),function(){var t;t=function(){return{scope:{},controller:"VoteButton",bindToController:{item:"=",onUpvote:"=",onDownvote:"="},controllerAs:"vm",templateUrl:"components/vote-button/vote-button.html"}},angular.module("taigaComponents").directive("tgVoteButton",t)}.call(this),function(){var t;t=function(){function t(t,e){this.currentUserService=t,this.rootScope=e,this.user=this.currentUserService.getUser(),this.isMouseOver=!1,this.loading=!1}return t.$inject=["tgCurrentUserService","$rootScope"],t.prototype.showTextWhenMouseIsOver=function(){return this.isMouseOver=!0},t.prototype.showTextWhenMouseIsLeave=function(){return this.isMouseOver=!1},t.prototype.openWatchers=function(){return this.rootScope.$broadcast("watcher:add",this.item)},t.prototype.getPerms=function(){return this.item?{userstories:"modify_us",issues:"modify_issue",tasks:"modify_task",epics:"modify_epic"}[this.item._name]:""},t.prototype.toggleWatch=function(){var t,e;return this.loading=!0,(t=this.item.is_watcher?this._unwatch():this._watch()).finally((e=this,function(){return e.loading=!1})),t},t.prototype._watch=function(){return this.onWatch().then((t=this,function(){return t.showTextWhenMouseIsLeave()}));var t},t.prototype._unwatch=function(){return this.onUnwatch()},t}(),angular.module("taigaComponents").controller("WatchButton",t)}.call(this),function(){var t;t=function(){return{scope:{},controller:"WatchButton",bindToController:{item:"=",onWatch:"=",onUnwatch:"="},controllerAs:"vm",templateUrl:function(t,e){return"components/watch-button/watch-button-"+e.environment+".html"}}},angular.module("taigaComponents").directive("tgWatchButton",t)}.call(this),function(){var t;t=function(t){return{scope:!0,link:function(e,r,n){var i,o;return i={epics:"epic",userstories:"us",issues:"issue",tasks:"task"},o=function(r,n){return t.addAttachment(e.vm.projectId,e.vm.comment.comment.id,i[e.vm.comment.comment._name],r,!0,!0).then(function(t){return n(t.getIn(["file","name"]),t.getIn(["file","url"]))})},e.uploadFiles=function(t,e){var r,n,i,s;for(s=[],n=0,i=t.length;n<i;n++)r=t[n],s.push(o(r,e));return s}},template:"<div>\n    <tg-wysiwyg\n        editonly\n        required\n        content='vm.comment.comment'\n        on-save=\"vm.saveComment(text, cb)\"\n        on-cancel=\"vm.onEditMode({commentId: vm.comment.id})\"\n        on-upload-file='uploadFiles(files, cb)'>\n    </tg-wysiwyg>\n</div>"}},angular.module("taigaComponents").directive("tgCommentEditWysiwyg",["tgAttachmentsFullService",t])}.call(this),function(){var t;t=function(t,e,r){return{scope:!0,link:function(n,i,o){var s,a;return n.editableDescription=!1,n.saveComment=function(r,i){var o;return n.content="",n.vm.type.comment=r,(o=t.save(function(t){})).then(function(){return n.vm.onAddComment&&n.vm.onAddComment(),e.$broadcast("object:updated")}),o.finally(i)},s={epics:"epic",userstories:"us",issues:"issue",tasks:"task"},a=function(t,e){return r.addAttachment(n.vm.projectId,n.vm.type.id,s[n.vm.type._name],t,!0,!0).then(function(t){return e(t.getIn(["file","name"]),t.getIn(["file","url"]))})},n.onChange=function(t){return n.vm.type.comment=t},n.uploadFiles=function(t,e){var r,n,i,o;for(o=[],n=0,i=t.length;n<i;n++)r=t[n],o.push(a(r,e));return o},n.content="",n.$watch("vm.type",function(t){if(t)return n.storageKey="comment-"+t.project+"-"+t.id+"-"+t._name})},template:"<div>\n    <tg-wysiwyg\n        required\n        not-persist\n        placeholder='{{\"COMMENTS.TYPE_NEW_COMMENT\" | translate}}'\n        storage-key='storageKey'\n        content='content'\n        on-save='saveComment(text, cb)'\n        on-upload-file='uploadFiles(files, cb)'>\n    </tg-wysiwyg>\n</div>"}},angular.module("taigaComponents").directive("tgCommentWysiwyg",["$tgQueueModelTransformation","$rootScope","tgAttachmentsFullService",t])}.call(this),function(){var t;t=function(t){return{scope:!0,link:function(e,r,n){var i,o;return i={userstories:"us",issues:"issue",tasks:"task"},o=function(r,n){return t.addAttachment(e.vm.projectId,e.vm.comment.comment.id,i[e.vm.comment.comment._name],r).then(function(t){return n(t.getIn(["file","name"]),t.getIn(["file","url"]))})},e.uploadFiles=function(t,e){var r,n,i,s;for(s=[],n=0,i=t.length;n<i;n++)r=t[n],s.push(o(r,e));return s}},template:"<div>\n    <tg-wysiwyg\n        editonly\n        content='customAttributeValue.value'\n        on-save=\"saveCustomRichText(text, cb)\"\n        on-cancel=\"cancelCustomRichText()\"\n        on-upload-file='uploadFiles(files, cb)'>\n    </tg-wysiwyg>\n</div>"}},angular.module("taigaComponents").directive("tgCustomFieldEditWysiwyg",["tgAttachmentsFullService",t])}.call(this),function(){var t;t=function(t,e,r,n,i){return{scope:!0,link:function(i,o,s){var a;return i.editableDescription=!1,i.saveDescription=function(n,i){var o;return(o=t.save(function(t){return t.description=n,t})).then(function(){return r.notify("success"),e.$broadcast("object:updated")}),o.then(null,function(){return r.notify("error")}),o.finally(i)},a=function(t,e){return n.addAttachment(i.project.id,i.item.id,s.type,t).then(function(t){return e(t.getIn(["file","name"]),t.getIn(["file","url"]))})},i.uploadFiles=function(t,e){var r,n,i,o;for(o=[],n=0,i=t.length;n<i;n++)r=t[n],o.push(a(r,e));return o},i.$watch(s.model,function(t){if(t)return i.item=t,i.version=t.version,i.storageKey=i.project.id+"-"+t.id+"-"+s.type}),i.$watch("project",function(t){if(t)return i.editableDescription=-1!==t.my_permissions.indexOf(s.requiredPerm)})},template:"<div>\n    <tg-wysiwyg\n        ng-if=\"editableDescription\"\n        placeholder='{{\"COMMON.DESCRIPTION.EMPTY\" | translate}}'\n        version='version'\n        storage-key='storageKey'\n        content='item.description'\n        on-save='saveDescription(text, cb)'\n        on-upload-file='uploadFiles(files, cb)'>\n    </tg-wysiwyg>\n\n    <div\n        class=\"wysiwyg\"\n        ng-if=\"!editableDescription && item.description.length\"\n        ng-bind-html=\"item.description | markdownToHTML\"></div>\n\n    <div\n        class=\"wysiwyg\"\n        ng-if=\"!editableDescription && !item.description.length\">\n        {{'COMMON.DESCRIPTION.NO_DESCRIPTION' | translate}}\n    </div>\n</div>"}},angular.module("taigaComponents").directive("tgItemWysiwyg",["$tgQueueModelTransformation","$rootScope","$tgConfirm","tgAttachmentsFullService","$translate",t])}.call(this),function(){var t;t=function(){function t(){Prism.plugins.customClass.prefix("prism-"),Prism.plugins.customClass.map({})}return t.prototype.getLanguages=function(){return new Promise((t=this,function(e,r){return t.languages?e(t.languages):t.loadPromise?t.loadPromise.then(function(){return e(t.languages)}):t.loadPromise=$.getJSON("/"+window._version+"/prism/prism-languages.json").then(function(r){return t.loadPromise=null,t.languages=_.map(r,function(t){return t.url="/"+window._version+"/prism/"+t.file,t}),e(t.languages)})}));var t},t.prototype.getLanguageInClassList=function(t){var e;return(e=_.find(this.languages,function(e){return!!_.find(t,function(t){return"language-"+e.name===t})}))?e.name:null},t.prototype.loadLanguage=function(t){return new Promise(function(e){return Prism.languages[t]?e():ljs.load("/"+window._version+"/prism/prism-"+t+".min.js",e)})},t.prototype.replaceCodeBrToNl=function(t){return $(t).find("br").replaceWith("\n")},t.prototype.hightlightCode=function(t){var e;if(this.replaceCodeBrToNl(t),e=this.getLanguageInClassList(t.classList))return this.loadLanguage(e).then(function(){return Prism.highlightElement(t)})},t.prototype.addHightlighter=function(t){var e;return $(t).find("code").each((e=this,function(t,r){return e.hightlightCode(r)}))},t}(),angular.module("taigaComponents").service("tgWysiwygCodeHightlighterService",t)}.call(this),function(){var t;t=function(t){return{scope:{languages:"<",codeLanguage:"<",code:"<",visible:"<",onClose:"&",onSave:"&"},link:function(e,r,n,i){return e.$watch("visible",function(n){return n&&!r.hasClass("open")?(e.open=!0,t.open(r,null,e.onClose),e.$applyAsync(function(){var t;if(t=r[0].querySelector("textarea"))return t.select()})):!n&&r.hasClass("open")?(e.open=!1,t.close(r)):void 0})},templateUrl:"components/wysiwyg/wysiwyg-code-lightbox/wysiwyg-code-lightbox.html"}},angular.module("taigaComponents").directive("tgWysiwygCodeLightbox",["lightboxService",t])}.call(this),function(){var t;t=function(){function t(t,e,r,n){this.projectService=t,this.wysiwygService=e,this.navurls=r,this.rs=n,this.cancelablePromise=null,this.projectSlug=this.projectService.project.get("slug")}return t.$inject=["tgProjectService","tgWysiwygService","$tgNavUrls","$tgResources"],t.prototype.search=function(t){return new Promise((e=this,function(r){return-1!=="#".indexOf(t[0])?e.searchItem(t.replace("#","")).then(r):-1!=="@".indexOf(t[0])?e.searchUser(t.replace("@",""),r):-1!==":".indexOf(t[0])?e.searchEmoji(t.replace(":",""),r):void 0}));var e},t.prototype.searchItem=function(t){return new Promise((e=this,function(r,n){var i;return t=taiga.slugify(t),i=function(e){return["subject","ref"].some(function(r){return taiga.slugify(e[r]).indexOf(t)>=0})},e.rs.search.do(e.projectService.project.get("id"),t).then(function(t){var n,o,s,a,c,u,l;if(c=[],t.count&&t.count!==t.wikipages.length){for(l={issues:"project-issues-detail",userstories:"project-userstories-detail",tasks:"project-tasks-detail"},n=0,s=(a=["issues","tasks","userstories"]).length;n<s;n++)t[u=a[n]]&&(o=t[u].filter(i).map(function(t){return t.url=e.navurls.resolve(l[u],{project:e.projectSlug,ref:t.ref}),t}),c=c.concat(o));return r(_.sortBy(c,["ref"]).slice(0,10))}return r(c)})}));var e},t.prototype.searchUser=function(t,e){var r;return e(this.projectService.project.toJS().members.filter(function(e){return["username","full_name","full_name_display"].some(function(r){return taiga.slugify(e[r]).indexOf(t)>=0||e[r].indexOf(t)>=0})}).slice(0,10).map((r=this,function(t){return t.url=r.navurls.resolve("user-profile",{project:r.projectSlug,username:t.username}),t})))},t.prototype.searchEmoji=function(t,e){return e(this.wysiwygService.searchEmojiByName(t).slice(0,10))},t}(),angular.module("taigaComponents").service("tgWysiwygMentionService",t)}.call(this),function(){var t,e;e=this.taiga,this.taiga.bindOnce,t=function(t,r,n,i,o,s,a,c,u,l){var p,d,h,f,g,m,v,y,b,S,j;return j=function(){if(window.getSelection){if(window.getSelection().empty)return window.getSelection().empty()}else{if(window.getSelection().removeAllRanges)return window.getSelection().removeAllRanges();if(document.selection)return document.selection.empty()}},m=function(t){return $(t.endContainer).parentsUntil(".editor","code")},v=function(t){return!!m(t).length},S=function(t,e){var r,n,i;return i=(r=$(t).is("code")?t:$(t).closest("code")[0]).parentNode,(n=document.createElement("p")).innerText=r.innerText,i.parentNode.replaceChild(n,i),e.checkContentChanged(e.elements[0])},f=function(t,e){var r,n,i,o;return i=document.createElement("pre"),r=document.createElement("code"),t.startContainer.parentNode.nextSibling||$("<br/>").insertAfter(t.startContainer.parentNode),o=t.endContainer.parentNode.nextSibling,n=t.extractContents(),r.appendChild(n),i.appendChild(r),o.parentNode.insertBefore(i,o),b(e),e.checkContentChanged(e.elements[0])},b=function(e){var r,n,i,o,s,a,c,u,l,p;if(e){for(r=0,i=(l=e.elements[0].children).length;r<i;r++)(s=l[r])&&"p"===s.tagName.toLowerCase()&&!s.innerHTML.trim().length&&s.parentNode.removeChild(s);for(p=[],n=0,o=(u=e.elements[0].querySelectorAll("pre")).length;n<o;n++)(c=u[n]).setAttribute("contenteditable",!1),c.setAttribute("title",t.instant("COMMON.WYSIWYG.DB_CLICK")),c.addEventListener("mousedown",function(t){return t.preventDefault()}),c.nextElementSibling&&"p"===c.nextElementSibling.nodeName.toLowerCase()&&!c.nextElementSibling.children.length?p.push(c.nextElementSibling.appendChild(document.createElement("br"))):c.nextElementSibling&&-1!==["p","ul","h1","h2","h3"].indexOf(c.nextElementSibling.nodeName.toLowerCase())?p.push(void 0):((a=document.createElement("p")).appendChild(document.createElement("br")),p.push(c.parentNode.insertBefore(a,c.nextSibling)));return p}},p=MediumEditor.extensions.button.extend({name:"rtl",init:function(){var t;return t=_.find(this.base.options.toolbar.buttons,function(t){return"rtl"===t.name}),this.button=this.document.createElement("button"),this.button.classList.add("medium-editor-action"),this.button.innerHTML=t.contentDefault||"<b>RTL</b>",this.button.title="RTL",this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},handleClick:function(t){return"right"===MediumEditor.selection.getSelectionRange(document).commonAncestorContainer.parentNode.style.textAlign?document.execCommand("justifyLeft",!1):document.execCommand("justifyRight",!1)}}),g=function(t){return'<svg class="icon icon-'+t+'">\n    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'+t+'"></use>\n</svg>'},d=MediumEditor.extensions.button.extend({name:"code",init:function(){var t;return t=_.find(this.base.options.toolbar.buttons,function(t){return"code"===t.name}),this.button=this.document.createElement("button"),this.button.classList.add("medium-editor-action"),this.button.innerHTML=t.contentDefault||"<b>Code</b>",this.button.title="Code",this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},tagNames:["code"],handleClick:function(t){var e,r;if(e=MediumEditor.selection.getSelectionRange(self.document),v(e,this.base)?S(e.endContainer,this.base):(f(e,this.base),j()),r=this.base.getExtensionByName("toolbar"))return r.hideToolbar()}}),h=MediumEditor.extensions.paste.extend({doPaste:function(t,e,r){var n;return n=MediumEditor.util.htmlEntities(e),MediumEditor.util.insertHTMLCommand(this.document,n)}}),y=MediumEditor.util.isBlockContainer,MediumEditor.util.isBlockContainer=function(t){return t&&"code"===(t.tagName?t.tagName:t.parentNode.tagName).toLowerCase()||y(t)},{templateUrl:"common/components/wysiwyg-toolbar.html",scope:{placeholder:"@",version:"<",storageKey:"<",content:"<",onCancel:"&",onSave:"&",onUploadFile:"&",onChange:"&"},link:function(o,f,m){var v,y,j,k,I,E,C,T,A,P,w,O,R,M,U,D,N,x,L,F,B;return O=null,E=f.find(".medium"),f.find(".markdown"),j=null,A=!!m.$attr.editonly,R=!!m.$attr.notPersist,o.required=!!m.$attr.required,o.editMode=A||!1,o.mode=n.get("editor-mode","html"),o.markdown="",o.codeEditorVisible=!1,o.codeLans=[],a.getLanguages().then(function(t){return o.codeLans=t}),D=function(t){return o.editMode=t},N=function(t){var e;if(e=i.getHTML(t),E.html(e),a.addHightlighter(O.elements[0]),o.editMode)return b(O)},o.saveSnippet=function(t,e){var r;return o.codeEditorVisible=!1,j.innerText=e,r=j.parentNode,"remove-formating"===t?(j.className="",r.className="",S(j,O)):_.trim(e).length?(t?(j.className="language-"+t,r.className="language-"+t):(j.className="",r.className=""),a.hightlightCode(j),O.checkContentChanged(O.elements[0])):(j.parentNode.parentNode.removeChild(j.parentNode),O.checkContentChanged(O.elements[0])),x(),null},o.setMode=function(t){return n.set("editor-mode",t),"markdown"===t?F():N(o.markdown),o.mode=t,O.trigger("editableBlur",{},E[0])},o.save=function(t){t&&t.preventDefault(),"html"===o.mode&&F(),N(o.markdown),o.required&&!o.markdown.length||(o.saving=!0,o.outdated=!1,o.onSave({text:o.markdown,cb:U}))},o.cancel=function(t){t&&t.preventDefault(),A||D(!1),R?y():"html"===o.mode&&N(o.content||null),o.markdown=o.content,I(),O.trigger("blur",{},E[0]),o.outdated=!1,b(O),o.onCancel()},y=function(){return o.markdown="",E.html("")},U=function(){return o.saving=!1,A||D(!1),R&&y(),I(),O.trigger("blur",{},E[0]),u.trackEvent("develop","save wysiwyg",o.mode,1)},B=function(t,r){return e.isImage(t)?O.pasteHTML("<img src='"+r+"' /><br/>"):(t=$("<div/>").text(t).html(),O.pasteHTML("<a target='_blank' href='"+r+"'>"+t+"</a><br/>"))},P=function(){var t;return!(!(t=n.get(o.storageKey))||!t.version||t.version===o.version)},T=function(){return!!n.get(o.storageKey)},C=function(){var t;return(t=n.get(o.storageKey))?t.text:o.content},I=function(){return n.remove(o.storageKey)},o.cancelWithConfirmation=function(){var e,n;return o.content===o.markdown?(o.cancel(),document.activeElement.blur(),document.body.click(),null):(n=t.instant("COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE"),e=t.instant("COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE"),r.ask(n,null,e).then(function(t){return o.cancel(),t.finish()}))},M=function(){var t;return(t=$("<div></div>").html(E.html())).find("code br").replaceWith("\n"),t.html()},F=function(){var t;return t=M(),o.markdown=i.getMarkdown(t)},w=function(t){var e;if(o.storageKey)return(e={}).version=o.version||0,e.text=t,n.set(o.storageKey,e)},v=function(){return"html"===o.mode&&F(),w(o.markdown),o.onChange({markdown:o.markdown})},x=_.throttle(v,200),k=function(t,e){var r;return null==e&&(e=!1),t.length&&(r=i.getHTML(t),E.html(r)),O=new MediumEditor(E[0],{imageDragging:!1,placeholder:{text:o.placeholder},toolbar:{buttons:[{name:"bold",contentDefault:g("editor-bold")},{name:"italic",contentDefault:g("editor-italic")},{name:"strikethrough",contentDefault:g("editor-cross-out")},{name:"anchor",contentDefault:g("editor-link")},{name:"image",contentDefault:g("editor-image")},{name:"orderedlist",contentDefault:g("editor-list-n")},{name:"unorderedlist",contentDefault:g("editor-list-o")},{name:"h1",contentDefault:g("editor-h1")},{name:"h2",contentDefault:g("editor-h2")},{name:"h3",contentDefault:g("editor-h3")},{name:"quote",contentDefault:g("editor-quote")},{name:"removeFormat",contentDefault:g("editor-no-format")},{name:"rtl",contentDefault:g("editor-rtl")},{name:"code",contentDefault:g("editor-code")}]},extensions:{paste:new h,code:new d,autolist:new AutoList,alignright:new p,mediumMention:new MentionExtension({getItems:function(t,e){return c.search(t).then(e)}})}}),o.changeMarkdown=x,O.subscribe("editableInput",function(t){return o.$applyAsync(x)}),O.subscribe("editableClick",function(t){var e;if(e=new RegExp("^(?:[a-z]+:)?//","i"),t.target.href)return e.test(t.target.getAttribute("href"))||"_blank"===t.target.getAttribute("target")?(t.stopPropagation(),window.open(t.target.href)):l.url(t.target.href)}),O.subscribe("editableDrop",function(t){return o.onUploadFile({files:t.dataTransfer.files,cb:B})}),O.subscribe("editableKeydown",function(t){var e,r;return e=t.keyCode?t.keyCode:t.which,r=$(".medium-mention"),40!==e&&38!==e||!r.length?o.editMode&&27===e?(t.stopPropagation(),o.$applyAsync(o.cancelWithConfirmation)):27===e?E.blur():void 0:(t.stopPropagation(),void t.preventDefault())}),D(e),o.$applyAsync(function(){return a.addHightlighter(O.elements[0]),b(O)})},$(E[0]).on("mousedown",function(t){return t.target.href?(t.preventDefault(),t.stopPropagation()):o.$applyAsync(function(){if(!o.editMode)return D(!0),b(O)})}),$(E[0]).on("dblclick","pre",function(t){return o.$applyAsync(function(){return o.codeEditorVisible=!0,j=t.currentTarget.querySelector("code"),o.currentCodeLanguage=a.getLanguageInClassList(j.classList),o.code=j.innerText})}),L=o.$watch("content",function(t){var e;if(!_.isUndefined(t)){if(o.outdated=P(),!O&&T()&&D(!0),(o.markdown.length||t.length)&&o.markdown===t)return;return t=C(),o.markdown=t,O&&O.destroy(),s.open()?e=s.onEnd(function(){return k(t,o.editMode),e()}):k(t,o.editMode),L()}}),o.$on("$destroy",function(){if(O)return E.length&&$(E[0]).off(),O.destroy()})}}},angular.module("taigaComponents").directive("tgWysiwyg",["$translate","$tgConfirm","$tgStorage","tgWysiwygService","animationFrame","tgLoader","tgWysiwygCodeHightlighterService","tgWysiwygMentionService","$tgAnalytics","$location",t])}.call(this),function(){var t;t=function(){function t(t,e,r,n){this.wysiwygCodeHightlighterService=t,this.projectService=e,this.navurls=r,this.emojis=n}return t.$inject=["tgWysiwygCodeHightlighterService","tgProjectService","$tgNavUrls","$tgEmojis"],t.prototype.searchEmojiByName=function(t){return this.emojis.searchByName(t)},t.prototype.pipeLinks=function(t){return t.replace(/\[\[(.*?)\]\]/g,function(t,e,r,n){var i,o;return i=(o=e.split("|"))[0],"["+(o[1]||o[0])+"]("+i+")"})},t.prototype.replaceUrls=function(t){var e,r,n,i,o;for((e=document.createElement("html")).innerHTML=t,r=0,n=(o=e.querySelectorAll("a")).length;r<n;r++)-1!==(i=o[r]).getAttribute("href").indexOf("/profile/")?i.parentNode.replaceChild(document.createTextNode(i.innerText),i):-1!==i.getAttribute("href").indexOf("/t/")&&i.parentNode.replaceChild(document.createTextNode(i.innerText),i);return e.innerHTML},t.prototype.searchWikiLinks=function(t){var e,r,n,i,o,s;for((e=document.createElement("html")).innerHTML=t,r=0,n=(o=e.querySelectorAll("a")).length;r<n;r++)-1===(i=o[r]).getAttribute("href").indexOf("/")&&(s=this.navurls.resolve("project-wiki-page",{project:this.projectService.project.get("slug"),slug:i.getAttribute("href")}),i.setAttribute("href",s));return e.innerHTML},t.prototype.removeTrailingListBr=function(t){return t.replace(/<li>(.*?)<br><\/li>/g,"<li>$1</li>")},t.prototype.getMarkdown=function(t){var e,r,n;return e={filter:["html","body","span","div"],replacement:function(t){return t}},r={filter:function(t){return"PRE"===t.nodeName&&t.firstChild&&"CODE"===t.firstChild.nodeName},replacement:(n=this,function(t,e){var r;return(r=n.wysiwygCodeHightlighterService.getLanguageInClassList(e.firstChild.classList))||(r=""),"\n\n```"+r+"\n"+_.trim(e.firstChild.textContent)+"\n```\n\n"})},t=t.replace(/&nbsp;(<\/.*>)/g,"$1"),t=this.emojis.replaceImgsByEmojiName(t),t=this.replaceUrls(t),t=this.removeTrailingListBr(t),toMarkdown(t,{gfm:!0,converters:[e,r]})},t.prototype.parseMentionMatches=function(t){var e,r,n,i,o;for("twitter",o=this.tagBuilder,r=[],e=(i=/@[^\s]{1,50}[^.\s]/g).exec(t);null!==e;)n=e.index,t.charAt(n-1),e.index===i.lastIndex&&i.lastIndex++,e.forEach(function(t,e){return r.push(new Autolinker.match.Mention({tagBuilder:o,matchedText:t,offset:n,serviceName:"twitter",mention:t.slice(1)}))}),e=i.exec(t);return r},t.prototype.autoLinkHTML=function(t){var e,r,n,i;return e=/A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC/.source+/\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D4-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F/.source+/0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19/.source,n=new RegExp("@[_"+e+"]{1,50}(?![_"+e+"])","g"),-1===String(n).indexOf(".")&&"@[^s]{1,50}[^.s]",r=new Autolinker({mention:"twitter",hashtag:"twitter",replaceFn:(i=this,function(t){return"mention"===t.getType()?'<a class="autolink" href="'+i.navurls.resolve("user-profile",{project:i.projectService.project.get("slug"),username:t.getMention()})+'">@'+t.getMention()+"</a>":"hashtag"===t.getType()?'<a class="autolink" href="'+i.navurls.resolve("project-detail-ref",{project:i.projectService.project.get("slug"),ref:t.getHashtag()})+'">#'+t.getHashtag()+"</a>":void 0})}),Autolinker.matcher.Mention.prototype.parseMatches=this.parseMentionMatches.bind(r),r.link(t)},t.prototype.getHTML=function(t){var e,r;return t&&t.length?({breaks:!0},t=this.emojis.replaceEmojiNameByImgs(t),t=this.pipeLinks(t),(e=window.markdownit({breaks:!0})).use(window.markdownitLazyHeaders),r=e.render(t),r=this.searchWikiLinks(r),r=this.autoLinkHTML(r)):""},t}(),angular.module("taigaComponents").service("tgWysiwygService",t)}.call(this),function(){var t;t=function(){function t(t){this.translate=t,this.is_open=!1,this.texts={week:this.translate.instant("DISCOVER.FILTERS.WEEK"),month:this.translate.instant("DISCOVER.FILTERS.MONTH"),year:this.translate.instant("DISCOVER.FILTERS.YEAR"),all:this.translate.instant("DISCOVER.FILTERS.ALL_TIME")}}return t.$inject=["$translate"],t.prototype.currentText=function(){return this.texts[this.currentOrderBy]},t.prototype.open=function(){return this.is_open=!0},t.prototype.close=function(){return this.is_open=!1},t.prototype.orderBy=function(t){return this.currentOrderBy=t,this.is_open=!1,this.onChange({orderBy:this.currentOrderBy})},t}(),angular.module("taigaDiscover").controller("DiscoverHomeOrderBy",t)}.call(this),function(){var t;(t=function(){return{controller:"DiscoverHomeOrderBy",controllerAs:"vm",bindToController:!0,templateUrl:"discover/components/discover-home-order-by/discover-home-order-by.html",scope:{currentOrderBy:"=orderBy",onChange:"&"},link:function(t,e,r){}}}).$inject=[],angular.module("taigaDiscover").directive("tgDiscoverHomeOrderBy",t)}.call(this),function(){var t;t=function(){function t(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"projects",(e=this,function(){return e.discoverProjectsService.projectsCount})),this.discoverProjectsService.fetchStats()}return t.$inject=["tgDiscoverProjectsService"],t.prototype.selectFilter=function(t){return this.onChange({filter:t,q:this.q})},t.prototype.submitFilter=function(){return this.onChange({filter:this.filter,q:this.q})},t}(),angular.module("taigaDiscover").controller("DiscoverSearchBar",t)}.call(this),function(){var t;(t=function(){return{controller:"DiscoverSearchBar",controllerAs:"vm",templateUrl:"discover/components/discover-search-bar/discover-search-bar.html",bindToController:!0,scope:{q:"=",filter:"=",onChange:"&"},compile:function(t,e){if(!e.q)return e.q=""},link:function(t,e,r,n){}}}).$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearchBar",t)}.call(this),function(){var t;t=function(){function t(){this.like_is_open=0===this.orderBy.indexOf("-total_fans"),this.activity_is_open=0===this.orderBy.indexOf("-total_activity")}return t.$inject=[],t.prototype.openLike=function(){return this.like_is_open=!0,this.activity_is_open=!1,this.setOrderBy("-total_fans_last_week")},t.prototype.openActivity=function(){return this.activity_is_open=!0,this.like_is_open=!1,this.setOrderBy("-total_activity_last_week")},t.prototype.setOrderBy=function(t){return null==t&&(t=""),t||(this.like_is_open=!1,this.activity_is_open=!1),this.onChange({orderBy:t})},t}(),angular.module("taigaDiscover").controller("DiscoverSearchListHeader",t)}.call(this),function(){var t;(t=function(){return{controller:"DiscoverSearchListHeader",controllerAs:"vm",bindToController:!0,templateUrl:"discover/components/discover-search-list-header/discover-search-list-header.html",scope:{onChange:"&",orderBy:"="},link:function(t,e,r){}}}).$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearchListHeader",t)}.call(this),function(){var t;t=function(){function t(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"featured",(e=this,function(){return e.discoverProjectsService.featured})),this.discoverProjectsService.fetchFeatured()}return t.$inject=["tgDiscoverProjectsService"],t}(),angular.module("taigaDiscover").controller("FeaturedProjects",t)}.call(this),function(){var t;(t=function(){return{controller:"FeaturedProjects",controllerAs:"vm",templateUrl:"discover/components/featured-projects/featured-projects.html",scope:{},link:function(t,e,r){}}}).$inject=[],angular.module("taigaDiscover").directive("tgFeaturedProjects",t)}.call(this),function(){var t;(t=function(){return{templateUrl:"discover/components/highlighted/highlighted.html",scope:{loading:"=",highlighted:"=",orderBy:"="}}}).$inject=[],angular.module("taigaDiscover").directive("tgHighlighted",t)}.call(this),function(){var t;t=function(){function t(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"highlighted",(e=this,function(){return e.discoverProjectsService.mostActive})),this.currentOrderBy="week",this.order_by=this.getOrderBy()}return t.$inject=["tgDiscoverProjectsService"],t.prototype.fetch=function(){return this.loading=!0,this.order_by=this.getOrderBy(),this.discoverProjectsService.fetchMostActive({order_by:this.order_by}).then((t=this,function(){return t.loading=!1}));var t},t.prototype.orderBy=function(t){return this.currentOrderBy=t,this.fetch()},t.prototype.getOrderBy=function(t){return"all"===this.currentOrderBy?"-total_activity":"-total_activity_last_"+this.currentOrderBy},t}(),angular.module("taigaDiscover").controller("MostActive",t)}.call(this),function(){var t;(t=function(){return{controller:"MostActive",controllerAs:"vm",templateUrl:"discover/components/most-active/most-active.html",scope:{},link:function(t,e,r,n){return n.fetch()}}}).$inject=[],angular.module("taigaDiscover").directive("tgMostActive",t)}.call(this),function(){var t;t=function(){function t(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"highlighted",(e=this,function(){return e.discoverProjectsService.mostLiked})),this.currentOrderBy="week",this.order_by=this.getOrderBy()}return t.$inject=["tgDiscoverProjectsService"],t.prototype.fetch=function(){return this.loading=!0,this.order_by=this.getOrderBy(),this.discoverProjectsService.fetchMostLiked({order_by:this.order_by}).then((t=this,function(){return t.loading=!1}));var t},t.prototype.orderBy=function(t){return this.currentOrderBy=t,this.fetch()},t.prototype.getOrderBy=function(){return"all"===this.currentOrderBy?"-total_fans":"-total_fans_last_"+this.currentOrderBy},t}(),angular.module("taigaDiscover").controller("MostLiked",t)}.call(this),function(){var t;(t=function(){return{controller:"MostLiked",controllerAs:"vm",templateUrl:"discover/components/most-liked/most-liked.html",scope:{},link:function(t,e,r,n){return n.fetch()}}}).$inject=[],angular.module("taigaDiscover").directive("tgMostLiked",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n){var i,o;this.location=t,this.navUrls=e,this.appMetaService=r,this.translate=n,o=this.translate.instant("DISCOVER.PAGE_TITLE"),i=this.translate.instant("DISCOVER.PAGE_DESCRIPTION"),this.appMetaService.setAll(o,i)}return t.$inject=["$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],t.prototype.onSubmit=function(t){var e;return e=this.navUrls.resolve("discover-search"),this.location.search("text",t).path(e)},t}(),angular.module("taigaDiscover").controller("DiscoverHome",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n,i,o,s){var a,c,u;this.routeParams=t,this.discoverProjectsService=e,this.route=r,this.location=n,this.analytics=i,this.appMetaService=o,this.translate=s,this.page=1,taiga.defineImmutableProperty(this,"searchResult",(u=this,function(){return u.discoverProjectsService.searchResult})),taiga.defineImmutableProperty(this,"nextSearchPage",function(t){return function(){return t.discoverProjectsService.nextSearchPage}}(this)),this.q=this.routeParams.text,this.filter=this.routeParams.filter||"all",this.orderBy=this.routeParams.order_by||"",this.loadingGlobal=!1,this.loadingList=!1,this.loadingPagination=!1,c=this.translate.instant("DISCOVER.SEARCH.PAGE_TITLE"),a=this.translate.instant("DISCOVER.SEARCH.PAGE_DESCRIPTION"),this.appMetaService.setAll(c,a),this.analytics.trackPage(this.location.url(),"Discover Search")}return t.$inject=["$routeParams","tgDiscoverProjectsService","$route","$tgLocation","$tgAnalytics","tgAppMetaService","$translate"],t.prototype.fetch=function(){return this.page=1,this.discoverProjectsService.resetSearchList(),this.search()},t.prototype.fetchByGlobalSearch=function(){var t;if(!this.loadingGlobal)return this.loadingGlobal=!0,this.fetch().then((t=this,function(){return t.loadingGlobal=!1}))},t.prototype.fetchByOrderBy=function(){var t;if(!this.loadingList)return this.loadingList=!0,this.fetch().then((t=this,function(){return t.loadingList=!1}))},t.prototype.showMore=function(){var t;if(!this.loadingPagination)return this.loadingPagination=!0,this.page++,this.search().then((t=this,function(){return t.loadingPagination=!1}))},t.prototype.search=function(){var t,e;return t=this.getFilter(),e={page:this.page,q:this.q,order_by:this.orderBy},_.assign(e,t),this.discoverProjectsService.fetchSearch(e)},t.prototype.getFilter=function(){return"people"===this.filter?{is_looking_for_people:!0}:"scrum"===this.filter?{is_backlog_activated:!0}:"kanban"===this.filter?{is_kanban_activated:!0}:{}},t.prototype.onChangeFilter=function(t,e){return this.filter=t,this.q=e,this.route.updateParams({filter:this.filter,text:this.q}),this.analytics.trackPage(this.location.url(),"Discover Search"),this.fetchByGlobalSearch()},t.prototype.onChangeOrder=function(t){return this.orderBy=t,this.route.updateParams({order_by:t}),this.analytics.trackPage(this.location.url(),"Discover Search"),this.fetchByOrderBy()},t}(),angular.module("taigaDiscover").controller("DiscoverSearch",t)}.call(this),function(){var t;(t=function(){return{controller:"DiscoverSearch",controllerAs:"vm",link:function(t,e,r,n){return n.fetch()}}}).$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearch",t)}.call(this),function(){var t,e,r={}.hasOwnProperty;e=this.taiga,t=function(t){var n;function i(t,r){var n;this.rs=t,this.projectsService=r,this._mostLiked=Immutable.List(),this._mostActive=Immutable.List(),this._featured=Immutable.List(),this._searchResult=Immutable.List(),this._projectsCount=0,this.decorate=this.projectsService._decorate.bind(this.projectsService),e.defineImmutableProperty(this,"mostLiked",(n=this,function(){return n._mostLiked})),e.defineImmutableProperty(this,"mostActive",function(t){return function(){return t._mostActive}}(this)),e.defineImmutableProperty(this,"featured",function(t){return function(){return t._featured}}(this)),e.defineImmutableProperty(this,"searchResult",function(t){return function(){return t._searchResult}}(this)),e.defineImmutableProperty(this,"nextSearchPage",function(t){return function(){return t._nextSearchPage}}(this)),e.defineImmutableProperty(this,"projectsCount",function(t){return function(){return t._projectsCount}}(this))}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(i,e.Service),i.$inject=["tgResources","tgProjectsService"],n={discover_mode:!0},i.prototype.fetchMostLiked=function(t){var e,r;return e=_.extend({},n,t),this.rs.projects.getProjects(e,!1).then((r=this,function(t){var e,n;return e=t.data.slice(0,5),n=(n=Immutable.fromJS(e)).map(r.decorate),r._mostLiked=n}))},i.prototype.fetchMostActive=function(t){var e,r;return e=_.extend({},n,t),this.rs.projects.getProjects(e,!1).then((r=this,function(t){var e,n;return e=t.data.slice(0,5),n=(n=Immutable.fromJS(e)).map(r.decorate),r._mostActive=n}))},i.prototype.fetchFeatured=function(){var t,e;return(t=_.extend({},n)).is_featured=!0,this.rs.projects.getProjects(t,!1).then((e=this,function(t){var r,n;return r=t.data.slice(0,4),n=(n=Immutable.fromJS(r)).map(e.decorate),e._featured=n}))},i.prototype.resetSearchList=function(){return this._searchResult=Immutable.List()},i.prototype.fetchStats=function(){return this.rs.stats.discover().then((t=this,function(e){return t._projectsCount=e.getIn(["projects","total"])}));var t},i.prototype.fetchSearch=function(t){var e,r;return e=_.extend({},n,t),this.rs.projects.getProjects(e).then((r=this,function(t){var e;return r._nextSearchPage=!!t.headers("X-Pagination-Next"),e=(e=Immutable.fromJS(t.data)).map(r.decorate),r._searchResult=r._searchResult.concat(e)}))},i}(),angular.module("taigaDiscover").service("tgDiscoverProjectsService",t)}.call(this),function(){var t,e,r,n;r=this.taiga,n=r.trim,e=r.getRandomDefaultColor,t=function(){function t(t,r,n,i){this.confirm=t,this.projectService=r,this.epicsService=n,this.analytics=i,this.project=this.projectService.project.toJS(),this.newEpic={color:e(),status:this.project.default_epic_status,tags:[]},this.attachments=Immutable.List(),this.loading=!1}return t.$inject=["$tgConfirm","tgProjectService","tgEpicsService","$tgAnalytics"],t.prototype.createEpic=function(){var t;if(this.validateForm())return this.loading=!0,this.epicsService.createEpic(this.newEpic,this.attachments).then((t=this,function(e){return t.analytics.trackEvent("epic","create","create epic",1),t.onCreateEpic(),t.loading=!1})).catch(function(t){return function(e){if(t.loading=!1,t.setFormErrors(e.data),e.data._error_message)return t.confirm.notify("error",e.data._error_message)}}(this))},t.prototype.selectColor=function(t){return this.newEpic.color=t},t.prototype.addTag=function(t,e){if(t=n(t.toLowerCase()),!_.find(this.newEpic.tags,function(e){return e[0]===t}))return this.newEpic.tags.push([t,e])},t.prototype.deleteTag=function(t){return _.remove(this.newEpic.tags,function(e){return e[0]===t[0]})},t.prototype.addAttachment=function(t){return this.attachments.push(t)},t}(),angular.module("taigaEpics").controller("CreateEpicCtrl",t)}.call(this),function(){var t;t=function(){return{link:function(t,e,r,n){var i;return i=e.find("form").checksley(),n.validateForm=function(){return i.validate()},n.setFormErrors=function(t){return i.setErrors(t)}},templateUrl:"epics/create-epic/create-epic.html",controller:"CreateEpicCtrl",controllerAs:"vm",bindToController:{onCreateEpic:"&"},scope:{}}},angular.module("taigaEpics").directive("tgCreateEpic",t)}.call(this),function(){var t;t=function(){function t(t,e,r){this.confirm=t,this.projectService=e,this.epicsService=r,this.displayUserStories=!1,this.displayAssignedTo=!1,this.displayStatusList=!1,this.loadingStatus=!1,this.project=this.projectService.project.toJS(),this._calculateProgressBar()}return t.$inject=["$tgConfirm","tgProjectService","tgEpicsService"],t.prototype._calculateProgressBar=function(){var t,e;return!0===this.epic.getIn(["status_extra_info","is_closed"])?this.percentage="100%":(t=this.epic.getIn(["user_stories_counts","progress"]),e=this.epic.getIn(["user_stories_counts","total"]),this.percentage=0===e?"0%":100*t/e+"%")},t.prototype.canEditEpics=function(){return this.projectService.hasPermission("modify_epic")},t.prototype.toggleUserStoryList=function(){return this.displayUserStories?this.displayUserStories=!1:this.epicsService.listRelatedUserStories(this.epic).then((t=this,function(e){return t.epicStories=e,t.displayUserStories=!0})).catch(function(t){return function(){return t.confirm.notify("error")}}(this));var t},t.prototype.updateStatus=function(t){return this.displayStatusList=!1,this.loadingStatus=!0,this.epicsService.updateEpicStatus(this.epic,t).catch((e=this,function(){return e.confirm.notify("error")})).finally(function(t){return function(){return t.loadingStatus=!1}}(this));var e},t.prototype.updateAssignedTo=function(t){return this.assignLoader=!0,this.epicsService.updateEpicAssignedTo(this.epic,(null!=t?t.id:void 0)||null).catch((e=this,function(){return e.confirm.notify("error")})).then(function(t){return function(){return t.assignLoader=!1}}(this));var e},t}(),angular.module("taigaEpics").controller("EpicRowCtrl",t)}.call(this),function(){var t;t=function(){return{templateUrl:"epics/dashboard/epic-row/epic-row.html",controller:"EpicRowCtrl",controllerAs:"vm",bindToController:!0,scope:{epic:"=",options:"="}}},angular.module("taigaEpics").directive("tgEpicRow",t)}.call(this),function(){var t,e;e=this.taiga,t=function(){function t(t,r,n,i,o,s,a,c,u){var l;this.params=t,this.errorHandlingService=r,this.lightboxFactory=n,this.lightboxService=i,this.confirm=o,this.projectService=s,this.epicsService=a,this.appMetaService=c,this.translate=u,this.sectionName="EPICS.SECTION_NAME",e.defineImmutableProperty(this,"project",(l=this,function(){return l.projectService.project})),e.defineImmutableProperty(this,"epics",function(t){return function(){return t.epicsService.epics}}(this)),this.appMetaService.setfn(this._setMeta.bind(this))}return t.$inject=["$routeParams","tgErrorHandlingService","tgLightboxFactory","lightboxService","$tgConfirm","tgProjectService","tgEpicsService","tgAppMetaService","$translate"],t.prototype._setMeta=function(){var t;return this.project?(t={projectName:this.project.get("name"),projectDescription:this.project.get("description")},{title:this.translate.instant("EPICS.PAGE_TITLE",t),description:this.translate.instant("EPICS.PAGE_DESCRIPTION",t)}):null},t.prototype.loadInitialData=function(){return this.epicsService.clear(),this.projectService.setProjectBySlug(this.params.pslug).then((t=this,function(){return t.projectService.isEpicsDashboardEnabled()?t.projectService.hasPermission("view_epics")?t.epicsService.fetchEpics():t.errorHandlingService.permissionDenied():t.errorHandlingService.notFound()}));var t},t.prototype.canCreateEpics=function(){return this.projectService.hasPermission("add_epic")},t.prototype.onCreateEpic=function(){var t,e;return e=this,t=function(){e.lightboxService.closeAll(),e.confirm.notify("success")},this.lightboxFactory.create("tg-create-epic",{class:"lightbox lightbox-create-epic open","on-create-epic":"onCreateEpic()"},{onCreateEpic:t.bind(this)})},t}(),angular.module("taigaEpics").controller("EpicsDashboardCtrl",t)}.call(this),function(){var t;(t=function(t,e){return{link:function(r,n,i){var o,s;if(e.hasPermission("modify_epic"))return o=t(i.tgEpicsSortable),(s=dragula([n[0]],{copySortSource:!1,copy:!1,mirrorContainer:n[0],moves:function(t){return $(t).is("div.epics-table-body-row")}})).on("dragend",function(t){var e,n,i;return n=$(t),e=n.scope().epic,i=n.index(),r.$apply(function(){return o(r,{epic:e,newIndex:i})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&s.dragging}}),r.$on("$destroy",function(){return n.off(),s.destroy()})}}}).$inject=["$parse","tgProjectService"],angular.module("taigaComponents").directive("tgEpicsSortable",t)}.call(this),function(){var t,e,r;r=this.taiga,e=this.taiga.generateHash,t=function(){function t(t,n,i,o,s){var a;this.confirm=t,this.epicsService=n,this.timeout=i,this.storage=o,this.projectService=s,this.hash=e([this.projectService.project.get("id"),"epics"]),this.displayOptions=!1,this.displayVotes=!0,this.options=this.storage.get(this.hash,{votes:!0,name:!0,project:!0,sprint:!0,assigned:!0,status:!0,progress:!0,closed:!0,closed_us:!0}),r.defineImmutableProperty(this,"epics",(a=this,function(){return a.epicsService.epics})),r.defineImmutableProperty(this,"disabledEpicsPagination",function(t){return function(){return t.epicsService._disablePagination}}(this)),r.defineImmutableProperty(this,"loadingEpics",function(t){return function(){return t.epicsService._loadingEpics}}(this))}return t.$inject=["$tgConfirm","tgEpicsService","$timeout","$tgStorage","tgProjectService"],t.prototype.toggleEpicTableOptions=function(){return this.displayOptions=!this.displayOptions},t.prototype.reorderEpic=function(t,e){return t.get("epics_order")===e?null:this.epicsService.reorderEpic(t,e).then(null,(r=this,function(){return r.confirm.notify("error")}));var r},t.prototype.nextPage=function(){return this.epicsService.nextPage()},t.prototype.hoverEpicTableOption=function(){if(this.timer)return this.timeout.cancel(this.timer)},t.prototype.hideEpicTableOption=function(){return this.timer=this.timeout((t=this,function(){return t.displayOptions=!1}),400);var t},t.prototype.updateViewOptions=function(){return this.storage.set(this.hash,this.options)},t}(),angular.module("taigaEpics").controller("EpicsTableCtrl",t)}.call(this),function(){var t;t=function(){return{templateUrl:"epics/dashboard/epics-table/epics-table.html",controller:"EpicsTableCtrl",controllerAs:"vm",scope:{}}},angular.module("taigaEpics").directive("tgEpicsTable",t)}.call(this),function(){var t,e;e=angular.module("taigaEpics"),t=function(){function t(){this._calculateProgressBar()}return t.$inject=[],t.prototype._calculateProgressBar=function(){var t,e;return!0===this.story.get("is_closed")?this.percentage="100%":(t=this.story.get("tasks").size,e=this.story.get("tasks").filter(function(t){return t.get("is_closed")}).size,this.percentage=0===t?"0%":100*e/t+"%")},t}(),e.controller("StoryRowCtrl",t)}.call(this),function(){var t;t=function(){return{templateUrl:"epics/dashboard/story-row/story-row.html",controller:"StoryRowCtrl",controllerAs:"vm",bindToController:!0,scope:{story:"=",options:"="}}},angular.module("taigaEpics").directive("tgStoryRow",t)}.call(this),function(){var t,e;e=this.taiga,t=function(){function t(t,r,n,i){var o;this.projectService=t,this.attachmentsService=r,this.resources=n,this.xhrError=i,this.clear(),e.defineImmutableProperty(this,"epics",(o=this,function(){return o._epics}))}return t.$inject=["tgProjectService","tgAttachmentsService","tgResources","tgXhrErrorService"],t.prototype.clear=function(){return this._loadingEpics=!1,this._disablePagination=!1,this._page=1,this._epics=Immutable.List()},t.prototype.fetchEpics=function(t){return null==t&&(t=!1),this._loadingEpics=!0,this._disablePagination=!0,this.resources.epics.list(this.projectService.project.get("id"),this._page).then((e=this,function(r){return t?(e.clear(),e._epics=r.list):e._epics=e._epics.concat(r.list),e._loadingEpics=!1,e._disablePagination=!r.headers("x-pagination-next")})).catch(function(t){return function(e){return t.xhrError.response(e)}}(this));var e},t.prototype.nextPage=function(){return this._page++,this.fetchEpics()},t.prototype.listRelatedUserStories=function(t){return this.resources.userstories.listInEpic(t.get("id"))},t.prototype.createEpic=function(t,e,r){return t.project=r||this.projectService.project.get("id"),this.resources.epics.post(t).then((n=this,function(t){var r;return e?(r=_.map(e.toJS(),function(e){return n.attachmentsService.upload(e.file,t.get("id"),t.get("project"),"epic")}),Promise.all(r).then(n.fetchEpics.bind(n,!0))):t}));var n},t.prototype.reorderEpic=function(t,e){var r,n,i,o,s,a,c,u,l,p;return s={},this._epics.forEach(function(t){return s[t.get("id")]=t.get("epics_order")}),n=(l=this.epics.filter(function(e){return e.get("id")!==t.get("id")})).slice(0,e),r=l.slice(e),o=(a=n.last())?a.get("epics_order")+1:0,s[t.get("id")]=o,c=n.filter(function(t){return t.get("epics_order")===a.get("epics_order")}),u=_.fromPairs(c.map(function(t){return[t.get("id"),t.get("epics_order")]}).toJS()),r.forEach(function(t){return s[t.get("id")]=t.get("epics_order")+1}),this._epics=this._epics.map(function(t){return t.set("epics_order",s[t.get("id")])}),this._epics=this._epics.sortBy(function(t){return t.get("epics_order")}),i={epics_order:o,version:t.get("version")},this.resources.epics.reorder(t.get("id"),i,u).then((p=this,function(t){return p._epics=p._epics.map(function(e){return e.get("id")===t.get("id")?t:e})}))},t.prototype.reorderRelatedUserstory=function(t,e,r,n){var i,o,s,a,c,u,l,p,d;return i=e.filter(function(t){return t.get("id")!==r.get("id")}).slice(0,n),a=(c=i.last())?c.get("epic_order")+1:0,u=i.filter(function(t){return t.get("epic_order")===c.get("epic_order")}),l=_.fromPairs(u.map(function(t){return[t.get("id"),t.get("epic_order")]}).toJS()),o={order:a},s=t.get("id"),p=r.get("id"),this.resources.epics.reorderRelatedUserstory(s,p,o,l).then((d=this,function(){return d.listRelatedUserStories(t)}))},t.prototype.replaceEpic=function(t){return this._epics=this._epics.map(function(e){return e.get("id")===t.get("id")?t:e})},t.prototype.updateEpicStatus=function(t,e){var r;return r={status:e,version:t.get("version")},this.resources.epics.patch(t.get("id"),r).then(this.replaceEpic.bind(this))},t.prototype.updateEpicAssignedTo=function(t,e){var r;return r={assigned_to:e,version:t.get("version")},this.resources.epics.patch(t.get("id"),r).then(this.replaceEpic.bind(this))},t}(),angular.module("taigaEpics").service("tgEpicsService",t)}.call(this),function(){var t,e;e=angular.module("taigaEpics"),t=function(){function t(t,e){this.projectService=t,this.epicsService=e,this.sectionName="Epics",this.showCreateRelatedUserstoriesLightbox=!1}return t.$inject=["tgProjectService","tgEpicsService"],t.prototype.showRelatedUserStoriesSection=function(){var t;return this.projectService.hasPermission("view_epics")||(null!=(t=this.userstories)?t.length:void 0)>0},t.prototype.userCanSort=function(){return this.projectService.hasPermission("modify_epic")},t.prototype.loadRelatedUserstories=function(){return this.epicsService.listRelatedUserStories(this.epic).then((t=this,function(e){return t.userstories=e}));var t},t.prototype.reorderRelatedUserstory=function(t,e){return this.epicsService.reorderRelatedUserstory(this.epic,this.userstories,t,e).then((r=this,function(t){return r.userstories=t}));var r},t}(),e.controller("RelatedUserStoriesCtrl",t)}.call(this),function(){var t,e;e=angular.module("taigaEpics"),t=function(){function t(t,e,r,n){this.currentUserService=t,this.rs=e,this.confirm=r,this.analytics=n,this.projects=null,this.projectUserstories=Immutable.List(),this.loading=!1}return t.$inject=["tgCurrentUserService","tgResources","$tgConfirm","$tgAnalytics"],t.prototype.loadProjects=function(){if(null===this.projects)return this.projects=this.currentUserService.projects.get("unblocked")},t.prototype.filterUss=function(t,e){var r;return this.rs.userstories.listInAllProjects({project:t,q:e},!0).then((r=this,function(t){var e,n;return e=r.epicUserstories.map(function(t){return t.get("id")}),n=t.filter(function(t){return-1===e.indexOf(t.get("id"))}),r.projectUserstories=n}))},t.prototype.saveRelatedUserStory=function(t,e){var r,n,i,o;if(this.validateExistingUserstoryForm())return this.loading=!0,o=this,n=function(t){return o.loading=!1,o.confirm.notify("error"),o.setExistingUserstoryFormErrors(t)},i=function(t){return function(){return t.analytics.trackEvent("epic related user story","create","create related user story on epic",1),t.loading=!1,e&&e(),t.loadRelatedUserstories()}}(this),r=this.epic.get("id"),this.rs.epics.addRelatedUserstory(r,t).then(i,n)},t.prototype.bulkCreateRelatedUserStories=function(t,e,r){var n,i,o,s;if(this.validateNewUserstoryForm())return this.loading=!0,s=this,i=function(t){return s.loading=!1,s.confirm.notify("error"),s.setNewUserstoryFormErrors(t)},o=function(t){return function(){return t.analytics.trackEvent("epic related user story","create","create related user story on epic",1),t.loading=!1,r&&r(),t.loadRelatedUserstories()}}(this),n=this.epic.get("id"),this.rs.epics.bulkCreateRelatedUserStories(n,t,e).then(o,i)},t}(),e.controller("RelatedUserstoriesCreateCtrl",t)}.call(this),function(){var t,e,r;r=angular.module("taigaEpics"),e=this.taiga.debounceLeading,(t=function(t){return this.lightboxService=t,{link:function(t,r,n,i){var o,s;return s=r.find(".new-user-story-form").checksley(),o=r.find(".existing-user-story-form").checksley(),i.validateNewUserstoryForm=function(){return s.validate()},i.setNewUserstoryFormErrors=function(t){return s.setErrors(t)},i.validateExistingUserstoryForm=function(){return o.validate()},i.setExistingUserstoryFormErrors=function(t){return o.setErrors(t)},t.showLightbox=function(e){return i.loadProjects(),t.selectProject(e).then(function(){return lightboxService.open(r.find(".lightbox-create-related-user-stories"))})},t.closeLightbox=function(){return t.selectedUserstory=null,t.searchUserstory="",t.relatedUserstoriesText="",lightboxService.close(r.find(".lightbox-create-related-user-stories"))},t.$watch("vm.project",function(e){if(null!=e)return t.selectedProject=e.get("id")}),t.selectProject=function(e){return t.selectedUserstory=null,t.searchUserstory="",i.filterUss(e,t.searchUserstory)},t.onUpdateSearchUserstory=e(300,function(){return t.selectedUserstory=null,i.filterUss(t.selectedProject,t.searchUserstory)})},templateUrl:"epics/related-userstories/related-userstories-create/related-userstories-create.html",controller:"RelatedUserstoriesCreateCtrl",controllerAs:"vm",bindToController:!0,scope:{showCreateRelatedUserstoriesLightbox:"=",project:"=",epic:"=",epicUserstories:"=",loadRelatedUserstories:"&"}}}).$inject=["lightboxService"],r.directive("tgRelatedUserstoriesCreate",t)}.call(this),function(){var t,e;e=angular.module("taigaEpics"),(t=function(t,e){return{link:function(r,n,i){var o,s;if(e.hasPermission("modify_epic"))return o=t(i.tgRelatedUserstoriesSortable),(s=dragula([n[0]],{copySortSource:!1,copy:!1,mirrorContainer:n[0],moves:function(t){return $(t).is("tg-related-userstory-row")}})).on("dragend",function(t){var e,n,i;return e=$(t),i=e.scope().us,n=e.index(),r.$apply(function(){return o(r,{us:i,newIndex:n})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&s.dragging}}),r.$on("$destroy",function(){return n.off(),s.destroy()})}}}).$inject=["$parse","tgProjectService"],e.directive("tgRelatedUserstoriesSortable",t)}.call(this),function(){var t,e;e=angular.module("taigaEpics"),(t=function(){return{templateUrl:"epics/related-userstories/related-userstories.html",controller:"RelatedUserStoriesCtrl",controllerAs:"vm",bindToController:!0,scope:{userstories:"=",project:"=",epic:"="}}}).$inject=[],e.directive("tgRelatedUserstories",t)}.call(this),function(){var t,e;e=angular.module("taigaEpics"),t=function(){function t(t,e,r,n){this.avatarService=t,this.translate=e,this.confirm=r,this.rs=n}return t.$inject=["tgAvatarService","$translate","$tgConfirm","tgResources"],t.prototype.setAvatarData=function(){var t;return t=this.userstory.get("assigned_to_extra_info"),this.avatar=this.avatarService.getAvatar(t)},t.prototype.getAssignedToFullNameDisplay=function(){return this.userstory.get("assigned_to")?this.userstory.getIn(["assigned_to_extra_info","full_name_display"]):this.translate.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED")},t.prototype.onDeleteRelatedUserstory=function(){var t,e,r;return e=this.translate.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.TITLE"),t=this.translate.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.MESSAGE",{epicSubject:this.epic.get("subject")}),this.confirm.ask(e,null,t).then((r=this,function(e){var n,i,o,s;return i=function(){return t=r.translate.instant("EPIC.ERROR_UNLINK_RELATED_USERSTORY",{errorMessage:t}),r.confirm.notify("error",null,t),e.finish(!1)},o=function(){return r.loadRelatedUserstories(),e.finish()},n=r.epic.get("id"),s=r.userstory.get("id"),r.rs.epics.deleteRelatedUserstory(n,s).then(o,i)}))},t}(),e.controller("RelatedUserstoryRowCtrl",t)}.call(this),function(){var t,e;e=angular.module("taigaEpics"),(t=function(){return{link:function(t,e,r,n){return n.setAvatarData()},templateUrl:"epics/related-userstories/related-userstory-row/related-userstory-row.html",controller:"RelatedUserstoryRowCtrl",controllerAs:"vm",bindToController:!0,scope:{userstory:"=",epic:"=",project:"=",loadRelatedUserstories:"&"}}}).$inject=[],e.directive("tgRelatedUserstoryRow",t)}.call(this),function(){var t,e,r=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty;e=this.taiga,t=function(t){function i(t,n,i,o,s,a,c,u){var l,p,d;this.routeParams=t,this.externalAppsService=n,this.window=i,this.currentUserService=o,this.location=s,this.navUrls=a,this.xhrError=c,this.loader=u,this.createApplicationToken=r(this.createApplicationToken,this),this._getApplicationToken=r(this._getApplicationToken,this),this._redirect=r(this._redirect,this),this.loader.start(!1),this._applicationId=this.routeParams.application,this._state=this.routeParams.state,this._getApplicationToken(),this._user=this.currentUserService.getUser(),this._application=null,p=encodeURIComponent(this.location.url()),l=this.navUrls.resolve("login"),this.loginWithAnotherUserUrl=l+"?next="+p,e.defineImmutableProperty(this,"user",(d=this,function(){return d._user})),e.defineImmutableProperty(this,"application",function(t){return function(){return t._application}}(this))}return function(t,e){for(var r in e)n.call(e,r)&&(t[r]=e[r]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(i,e.Controller),i.$inject=["$routeParams","tgExternalAppsService","$window","tgCurrentUserService","$location","$tgNavUrls","tgXhrErrorService","tgLoader"],i.prototype._redirect=function(t){var e;return e=t.get("next_url"),this.window.open(e,"_self")},i.prototype._getApplicationToken=function(){return this.externalAppsService.getApplicationToken(this._applicationId,this._state).then((t=this,function(e){return t._application=e.get("application"),e.get("auth_code")?t._redirect(e):t.loader.pageLoaded()})).catch(function(t){return function(e){return t.loader.pageLoaded(),t.xhrError.response(e)}}(this));var t},i.prototype.cancel=function(){return this.window.history.back()},i.prototype.createApplicationToken=function(){return this.externalAppsService.authorizeApplicationToken(this._applicationId,this._state).then((t=this,function(e){return t._redirect(e)})).catch(function(t){return function(e){return t.xhrError.response(e)}}(this));var t},i}(),angular.module("taigaExternalApps").controller("ExternalApp",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(t){this.rs=t}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=["tgResources"],r.prototype.getApplicationToken=function(t,e){return this.rs.externalapps.getApplicationToken(t,e)},r.prototype.authorizeApplicationToken=function(t,e){return this.rs.externalapps.authorizeApplicationToken(t,e)},r}(),angular.module("taigaExternalApps").service("tgExternalAppsService",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(t){this.lightboxFactory=t}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=["tgLightboxFactory"],r.prototype.sendFeedback=function(){return this.lightboxFactory.create("tg-lb-feedback",{class:"lightbox lightbox-feedback lightbox-generic-form"})},r}(),angular.module("taigaFeedback").service("tgFeedbackService",t)}.call(this),function(){var t;this.taiga,t=function(){function t(t,e){this.rs=t,this.xhrError=e,this._contentType=null,this._objectId=null,this.clear()}return t.$inject=["tgResources","tgXhrErrorService"],t.prototype.clear=function(){return this.page=1,this.loadingEntries=!1,this.disablePagination=!1,this.entries=Immutable.List(),this.count=null},t.prototype.fetchEntries=function(t){return null==t&&(t=!1),t&&(this.page=1),this.loadingEntries=!0,this.disablePagination=!0,this.rs.history.getHistory("activity",this._contentType,this._objectId,this.page).then((e=this,function(r){return t?(e.clear(),e.entries=r.list):e.entries=e.entries.concat(r.list),e.loadingEntries=!1,e.disablePagination=!r.headers("x-pagination-next"),e.count=r.headers("x-pagination-count"),e.entries})).catch(function(t){return function(e){return t.xhrError.response(t.entries)}}(this));var e},t.prototype.nextPage=function(t){return null==t&&(t="comment"),this.page++,this.fetchEntries()},t.prototype.init=function(t,e){return this._contentType=t,this._objectId=e,this.clear()},t}(),angular.module("taigaHistory").service("tgActivityService",t)}.call(this),function(){var t,e;e=angular.module("taigaHistory"),t=function(){function t(t,e,r){this.currentUserService=t,this.permissionService=e,this.lightboxFactory=r,this.hiddenDeletedComment=!0}return t.$inject=["tgCurrentUserService","tgCheckPermissionsService","tgLightboxFactory"],t.prototype.showDeletedComment=function(){return this.hiddenDeletedComment=!1},t.prototype.hideDeletedComment=function(){return this.hiddenDeletedComment=!0},t.prototype.checkCancelComment=function(t){if(27===t.keyCode)return this.onEditMode({commentId:this.comment.id})},t.prototype.canEditDeleteComment=function(){if(this.currentUserService.getUser())return this.user=this.currentUserService.getUser(),this.user.get("id")===this.comment.user.pk||this.permissionService.check("modify_project")},t.prototype.saveComment=function(t,e){return this.onEditComment({commentId:this.comment.id,commentData:t,callback:e})},t.prototype.displayCommentHistory=function(){return this.lightboxFactory.create("tg-lb-display-historic",{class:"lightbox lightbox-display-historic",comment:"comment",name:"name",object:"object"},{comment:this.comment,name:this.name,object:this.object})},t}(),e.controller("CommentCtrl",t)}.call(this),function(){var t;t=function(){return{scope:{name:"@",object:"@",comment:"<",type:"<",loading:"<",editing:"<",deleting:"<",objectId:"<",editMode:"<",onEditMode:"&",onDeleteComment:"&",onRestoreDeletedComment:"&",onEditComment:"&"},templateUrl:"history/comments/comment.html",bindToController:!0,controller:"CommentCtrl",controllerAs:"vm"}},angular.module("taigaHistory").directive("tgComment",t)}.call(this),function(){var t,e;e=angular.module("taigaHistory"),t=function(){function t(){}return t.$inject=[],t.prototype.initializePermissions=function(){return this.canAddCommentPermission="comment_"+this.name},t}(),e.controller("CommentsCtrl",t)}.call(this),function(){var t;t=function(){return{scope:{type:"<",name:"@",object:"@",comments:"<",onEditMode:"&",onDeleteComment:"&",onRestoreDeletedComment:"&",onAddComment:"&",onEditComment:"&",editMode:"<",loading:"<",deleting:"<",editing:"<",projectId:"="},templateUrl:"history/comments/comments.html",bindToController:!0,controller:"CommentsCtrl",controllerAs:"vm",link:function(t,e,r,n){return n.initializePermissions()}}},angular.module("taigaHistory").directive("tgComments",t)}.call(this),function(){var t,e;e=angular.module("taigaHistory"),t=function(){function t(t){this.rs=t}return t.$inject=["$tgResources"],t.prototype._loadHistoric=function(){var t,e,r,n;return r=this.name,e=this.object,t=this.comment.id,this.rs.history.getCommentHistory(r,e,t).then((n=this,function(t){return n.commentHistoryEntries=t}))},t}(),e.controller("LightboxDisplayHistoricCtrl",t)}.call(this),function(){var t;(t=function(t){return{scope:{},bindToController:{name:"=",object:"=",comment:"="},templateUrl:"history/history-lightbox/comment-history-lightbox.html",controller:"LightboxDisplayHistoricCtrl",controllerAs:"vm",link:function(e,r,n,i){return i._loadHistoric(),t.open(r)}}}).$inject=["lightboxService"],angular.module("taigaHistory").directive("tgLbDisplayHistoric",t)}.call(this),function(){var t;t=function(){return{scope:{entry:"<"},templateUrl:"history/history-lightbox/history-entry.html"}},angular.module("taigaHistory").directive("tgHistoryEntry",t)}.call(this),function(){var t;t=function(){return{templateUrl:"history/history-tabs/history-tabs.html",scope:{showCommentTab:"&",showActivityTab:"&",onActiveComments:"&",onActiveActivities:"&",onOrderComments:"&",activeTab:"<",commentsNum:"<",activitiesNum:"<",onReverse:"<"}}},angular.module("taigaHistory").directive("tgHistoryTabs",t)}.call(this),function(){var t,e;e=angular.module("taigaHistory"),t=function(){function t(t,e,r,n,i){var o;this.rs=t,this.repo=e,this.storage=r,this.projectService=n,this.activityService=i,this.editing=null,this.deleting=null,this.editMode={},this.viewComments=!0,this.reverse=this.storage.get("orderComments"),taiga.defineImmutableProperty(this,"disabledActivityPagination",(o=this,function(){return o.activityService.disablePagination})),taiga.defineImmutableProperty(this,"loadingActivity",function(t){return function(){return t.activityService.loading}}(this))}return t.$inject=["$tgResources","$tgRepo","$tgStorage","tgProjectService","tgActivityService"],t.prototype._loadHistory=function(){return this._loadComments(),this._loadActivity()},t.prototype._loadActivity=function(){return this.activityService.init(this.name,this.id),this.activityService.fetchEntries().then((t=this,function(e){return t.activitiesNum=t.activityService.count,t.activities=e.toJS()}));var t},t.prototype._loadComments=function(){return this.rs.history.get(this.name,this.id,"comment").then((t=this,function(e){return t.comments=_.filter(e,function(t){return""!==t.comment}),t.reverse&&(t.comments,_.reverse(t.comments)),t.commentsNum=t.comments.length}));var t},t.prototype.nextActivityPage=function(){return this.activityService.nextPage().then((t=this,function(e){return t.activities=e.toJS()}));var t},t.prototype.showHistorySection=function(){return this.showCommentTab()||this.showActivityTab()},t.prototype.showCommentTab=function(){return this.commentsNum>0||this.projectService.hasPermission("comment_"+this.name)},t.prototype.showActivityTab=function(){return this.activitiesNum>0},t.prototype.toggleEditMode=function(t){return this.editMode[t]=!this.editMode[t]},t.prototype.onActiveHistoryTab=function(t){return this.viewComments=t},t.prototype.deleteComment=function(t){var e,r,n,i;return n=this.name,r=this.id,e=t,this.deleting=t,this.rs.history.deleteComment(n,r,e).then((i=this,function(){return i._loadComments(),i.deleting=null}))},t.prototype.editComment=function(t,e){var r,n,i,o;return i=this.name,n=this.id,r=t,this.editing=t,this.rs.history.editComment(i,n,r,e).then((o=this,function(){return o._loadComments(),o.toggleEditMode(t),o.editing=null}))},t.prototype.restoreDeletedComment=function(t){var e,r,n,i;return n=this.name,r=this.id,e=t,this.editing=t,this.rs.history.undeleteComment(n,r,e).then((i=this,function(){return i._loadComments(),i.editing=null}))},t.prototype.addComment=function(){return this.editMode={},this.editing=null,this._loadComments()},t.prototype.onOrderComments=function(){return this.reverse=!this.reverse,this.storage.set("orderComments",this.reverse),this._loadComments()},t}(),e.controller("HistorySection",t)}.call(this),function(){var t,e;e=angular.module("taigaHistory"),this.taiga.bindOnce,(t=function(){return{link:function(t,e,r,n){return t.$on("object:updated",function(){return n._loadActivity()}),t.$watch("vm.id",function(t){return n._loadHistory()})},templateUrl:"history/history.html",controller:"HistorySection",controllerAs:"vm",bindToController:!0,scope:{type:"=",name:"@",id:"=",projectId:"="}}}).$inject=[],e.directive("tgHistorySection",t)}.call(this),function(){var t,e;e=angular.module("taigaHistory"),t=function(){function t(){}return t.$inject=[],t.prototype.diffTags=function(){if("tags"===this.type)return this.diffRemoveTags=_.difference(this.diff[0],this.diff[1]).toString(),this.diffAddTags=_.difference(this.diff[1],this.diff[0]).toString()},t}(),e.controller("ActivitiesDiffCtrl",t)}.call(this),function(){var t;t=function(){return{scope:{type:"<",diff:"<"},templateUrl:"history/history/history-diff.html",controller:"ActivitiesDiffCtrl",controllerAs:"vm",bindToController:!0,link:function(t,e,r,n){return n.diffTags()}}},angular.module("taigaHistory").directive("tgHistoryDiff",t)}.call(this),function(){var t;t=function(){return{scope:{activities:"<"},templateUrl:"history/history/history.html",link:function(t,e,r){}}},angular.module("taigaHistory").directive("tgHistory",t)}.call(this),function(){var t;(t=function(t,e){return{templateUrl:"home/duties/duty.html",scope:{duty:"=tgDuty",isHidden:"=",type:"@"},link:function(t,r,n,i){return t.vm={},t.vm.duty=t.duty,t.vm.type=t.type,t.vm.isHidden=t.isHidden,t.vm.getDutyType=function(){if(t.vm.duty){if("epics"===t.vm.duty.get("_name"))return e.instant("COMMON.EPIC");if("userstories"===t.vm.duty.get("_name"))return e.instant("COMMON.USER_STORY");if("tasks"===t.vm.duty.get("_name"))return e.instant("COMMON.TASK");if("issues"===t.vm.duty.get("_name"))return e.instant("COMMON.ISSUE")}},r.on("click",".button-hide",function(e){return e.preventDefault(),r.remove(),t.$emit("duty:toggle-hidden",t.vm.duty,t.vm.type)})}}}).$inject=["$tgNavUrls","$translate"],angular.module("taigaHome").directive("tgDuty",t)}.call(this),function(){var t;t=function(){function t(t,e,r){this.currentUserService=t,this.location=e,this.navUrls=r,this.currentUserService.getUser()||this.location.path(this.navUrls.resolve("discover"))}return t.$inject=["tgCurrentUserService","$location","$tgNavUrls"],t}(),angular.module("taigaHome").controller("Home",t)}.call(this),function(){var t,e,r={}.hasOwnProperty;e=this.taiga.groupBy,t=function(t){function n(t,e,r){this.navurls=t,this.rs=e,this.projectsService=r}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(n,taiga.Service),n.$inject=["$tgNavUrls","tgResources","tgProjectsService"],n.prototype._attachProjectInfoToWorkInProgress=function(t,e){var r,n,i,o,s,a;return a=this,r=function(t,r){var n,i,o;return n={project:(i=e.get(String(t.get("project")))).get("slug"),ref:t.get("ref")},o=a.navurls.resolve("project-"+r+"-detail",n),t=(t=(t=t.set("url",o)).set("project",i)).set("_name",r)},i=function(t,n){return t=(t=t.filter(function(t){return e.get(String(t.get("project")))})).map(function(t){return r(t,n)})},(o=t.get("assignedTo")).get("epics")&&(n=i(o.get("epics"),"epics"),o=o.set("epics",n)),o.get("userStories")&&(n=i(o.get("userStories"),"userstories"),o=o.set("userStories",n)),o.get("tasks")&&(n=i(o.get("tasks"),"tasks"),o=o.set("tasks",n)),o.get("issues")&&(n=i(o.get("issues"),"issues"),o=o.set("issues",n)),(s=t.get("watching")).get("epics")&&(n=i(s.get("epics"),"epics"),s=s.set("epics",n)),s.get("userStories")&&(n=i(s.get("userStories"),"userstories"),s=s.set("userStories",n)),s.get("tasks")&&(n=i(s.get("tasks"),"tasks"),s=s.set("tasks",n)),s.get("issues")&&(n=i(s.get("issues"),"issues"),s=s.set("issues",n)),(t=t.set("assignedTo",o)).set("watching",s)},n.prototype.getWorkInProgress=function(t){var r,n,i,o,s,a,c,u,l,p,d,h,f,g,m,v,y,_;return p=Immutable.Map(),d=this.projectsService.getListProjectsByUserId(t).then(function(t){return p=Immutable.fromJS(e(t.toJS(),function(t){return t.id}))}),o=Immutable.Map(),a={status__is_closed:!1,assigned_to:t},l={is_closed:!1,assigned_users:t,dashboard:!0},u={status__is_closed:!1,assigned_to:t},c={status__is_closed:!1,assigned_to:t},r=this.rs.epics.listInAllProjects(a).then(function(t){return o=o.set("epics",t)}),s=this.rs.userstories.listInAllProjects(l).then(function(t){return o=o.set("userStories",t)}),i=this.rs.tasks.listInAllProjects(u).then(function(t){return o=o.set("tasks",t)}),n=this.rs.issues.listInAllProjects(c).then(function(t){return o=o.set("issues",t)}),a={status__is_closed:!1,watchers:t},l={is_closed:!1,watchers:t,dashboard:!0},u={status__is_closed:!1,watchers:t},c={status__is_closed:!1,watchers:t},h=Immutable.Map(),f=this.rs.epics.listInAllProjects(a).then(function(t){return h=h.set("epics",t)}),v=this.rs.userstories.listInAllProjects(l).then(function(t){return h=h.set("userStories",t)}),m=this.rs.tasks.listInAllProjects(u).then(function(t){return h=h.set("tasks",t)}),g=this.rs.issues.listInAllProjects(c).then(function(t){return h=h.set("issues",t)}),y=Immutable.Map(),Promise.all([d,r,f,s,v,i,m,n,g]).then((_=this,function(){return y=(y=y.set("assignedTo",o)).set("watching",h),y=_._attachProjectInfoToWorkInProgress(y,p)}))},n}(),angular.module("taigaHome").service("tgHomeService",t)}.call(this),function(){var t;(t=function(t){return{templateUrl:"home/projects/home-project-list.html",scope:{},link:function(e,r,n,i){return e.vm={},taiga.defineImmutableProperty(e.vm,"projects",function(){return t.projects.get("recents")})}}}).$inject=["tgCurrentUserService"],angular.module("taigaHome").directive("tgHomeProjectList",t)}.call(this),function(){var t;t=function(){function t(t){this.homeService=t,this.assignedTo=Immutable.Map(),this.hiddenAssignedTo=[],this.showHiddenAssignedTo=!1,this.watching=Immutable.Map(),this.showHiddenWatching=!1}return t.$inject=["tgHomeService"],t.prototype._setAssignedTo=function(t){var e,r,n,i;if(e=t.get("assignedTo").get("epics"),i=t.get("assignedTo").get("userStories"),n=t.get("assignedTo").get("tasks"),r=t.get("assignedTo").get("issues"),this.assignedTo=i.concat(n).concat(r).concat(e),this.assignedTo.size>0)return this.assignedTo=this.assignedTo.sortBy(function(t){return t.get("modified_date")}).reverse()},t.prototype._setWatching=function(t){var e,r,n,i;if(e=t.get("watching").get("epics"),i=t.get("watching").get("userStories"),n=t.get("watching").get("tasks"),r=t.get("watching").get("issues"),this.watching=i.concat(n).concat(r).concat(e),this.watching.size>0)return this.watching=this.watching.sortBy(function(t){return t.get("modified_date")}).reverse()},t.prototype.getWorkInProgress=function(t){return this.homeService.getWorkInProgress(t).then((e=this,function(t){return e._setAssignedTo(t),e._setWatching(t)}));var e},t}(),angular.module("taigaHome").controller("WorkingOn",t)}.call(this),function(){var t,e,r=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};this.taiga,e=this.taiga.generateHash,(t=function(t,n,i){return{controller:"WorkingOn",controllerAs:"vm",templateUrl:"home/working-on/working-on.html",scope:{},link:function(t,o,s,a){var c,u,l,p,d,h,f,g,m,v,y;if(m=function(r){var n;return n=e(["ShowHiddenDashboardDuties",r]),i.set(n,t.showHiddenDuties[r])},u=function(t){var r;return r=e(["ShowHiddenDashboardDuties",t]),i.get(r)||!1},g=function(r){var n;return n=e(["HiddenDashboardDuties",r]),i.set(n,t.hiddenDuties[r])},c=function(t){var r;return r=e(["HiddenDashboardDuties",t]),i.get(r)||[]},f=function(e,n){var i;return i=e.get("id"),r.call(t.hiddenDuties[n],i)>=0?t.hiddenDuties[n].splice(t.hiddenDuties[n].indexOf(e.get("id")),1):t.hiddenDuties[n].push(e.get("id")),g(n),t.$apply()},v=n.getUser()){for(y=v.get("id"),a.getWorkInProgress(y),h=["working-on","watching"],t.hiddenDuties={},t.showHiddenDuties={},t.toggleShowHiddenDuties=function(e){return r.call(h,e)>=0?(t.showHiddenDuties[e]=!t.showHiddenDuties[e],m(e)):console.error("Invalid duties slot `"+e+"`")},l=0,p=h.length;l<p;l++)d=h[l],t.hiddenDuties[d]=c(d),t.showHiddenDuties[d]=u(d);return t.$on("duty:toggle-hidden",function(t,e,n){return r.call(h,n)>=0?f(e,n):console.error("Invalid duties slot `"+n+"`")})}}}}).$inject=["tgHomeService","tgCurrentUserService","$tgStorage"],angular.module("taigaHome").directive("tgWorkingOn",t)}.call(this),function(){var t;this.taiga,t=function(){function t(t,e,r,n,i){this.projectService=t,this.rs=e,this.lightboxService=r,this.confirm=n,this.rootScope=i,this.project=this.projectService.project,this.roles=this.projectService.project.get("roles"),this.rolesValues={},this.loading=!1,this.defaultMaxInvites=4}return t.$inject=["tgProjectService","$tgResources","lightboxService","$tgConfirm","$rootScope"],t.prototype._areRolesValidated=function(){return Object.defineProperty(this,"areRolesValidated",{get:(t=this,function(){return _.filter(Object.values(t.rolesValues),function(t){return t}).length===t.contactsToInvite.size+t.emailsToInvite.size})});var t},t.prototype._checkLimitMemberships=function(){var t;return null===this.project.get("max_memberships")?this.membersLimit=this.defaultMaxInvites:(t=Math.max(this.project.get("max_memberships")-this.project.get("total_memberships"),0),this.membersLimit=Math.min(t,this.defaultMaxInvites)),this.showWarningMessage=this.membersLimit<this.defaultMaxInvites},t.prototype.sendInvites=function(){var t;return this.setInvitedContacts=[],_.forEach(this.rolesValues,(t=this,function(e,r){return t.setInvitedContacts.push({role_id:e,username:r})})),this.loading=!0,this.rs.memberships.bulkCreateMemberships(this.project.get("id"),this.setInvitedContacts,this.inviteContactsMessage).then(function(t){return function(e){return t.projectService.fetchProject().then(function(){return t.loading=!1,t.lightboxService.closeAll(),t.rootScope.$broadcast("membersform:new:success"),t.confirm.notify("success")})}}(this)).catch(function(t){return function(e){if(t.loading=!1,e.data._error_message)return t.confirm.notify("error",e.data._error_message)}}(this))},t}(),angular.module("taigaAdmin").controller("InviteMembersFormCtrl",t)}.call(this),function(){var t;t=function(){return{scope:{},templateUrl:"invite-members/invite-members-form/invite-members-form.html",controller:"InviteMembersFormCtrl",controllerAs:"vm",bindToController:{contactsToInvite:"<",emailsToInvite:"=",onDisplayContactList:"&",onRemoveInvitedContact:"&",onRemoveInvitedEmail:"&",onSendInvites:"&"},link:function(t,e,r,n){return n._areRolesValidated(),n._checkLimitMemberships()}}},angular.module("taigaAdmin").directive("tgInviteMembersForm",t)}.call(this),function(){var t;this.taiga,t=function(){function t(t,e,r){this.userService=t,this.currentUserService=e,this.projectService=r,this.contactsToInvite=Immutable.List(),this.emailsToInvite=Immutable.List(),this.displayContactList=!1}return t.$inject=["tgUserService","tgCurrentUserService","tgProjectService"],t.prototype._getContacts=function(){var t,e,r;return e=this.currentUserService.getUser().get("id"),t=this.projectService.project.get("id"),this.userService.getContacts(e,t).then((r=this,function(t){return r.contacts=t}))},t.prototype._filterContacts=function(t){return this.contacts=this.contacts.filter(function(e){return e.get("id")!==t.get("id")})},t.prototype.inviteSuggested=function(t){return this.contactsToInvite=this.contactsToInvite.push(t),this._filterContacts(t),this.displayContactList=!0},t.prototype.removeContact=function(t){return this.contactsToInvite=this.contactsToInvite.filter(function(e){return e.get("id")!==t.id}),t=Immutable.fromJS(t),this.contacts=this.contacts.push(t),this.testEmptyContacts()},t.prototype.inviteEmail=function(t){var e;return e=Immutable.Map({email:t}),this.emailsToInvite=this.emailsToInvite.push(e),this.displayContactList=!0},t.prototype.removeEmail=function(t){return this.emailsToInvite=this.emailsToInvite.filter(function(e){return e.get("email")!==t.email}),this.testEmptyContacts()},t.prototype.testEmptyContacts=function(){if(this.emailsToInvite.size+this.contactsToInvite.size===0)return this.displayContactList=!1},t}(),angular.module("taigaAdmin").controller("AddMembersCtrl",t)}.call(this),function(){var t;t=function(t){return{scope:{},templateUrl:"invite-members/lightbox-add-members.html",controller:"AddMembersCtrl",controllerAs:"vm",link:function(e,r,n,i){return t.open(r),i._getContacts()}}},angular.module("taigaAdmin").directive("tgLbAddMembers",["lightboxService",t])}.call(this),function(){var t,e;e=this.taiga,t=function(){function t(){this.contactQuery=""}return t.$inject=[],t.prototype.isEmail=function(){return e.isEmail(this.contactQuery)},t.prototype.filterContacts=function(){return this.filteredContacts=this.contacts.filter((t=this,function(e){return e.get("full_name_display").toLowerCase().includes(t.contactQuery.toLowerCase())||e.get("username").toLowerCase().includes(t.contactQuery.toLowerCase())})).slice(0,12);var t},t.prototype.setInvited=function(t){return this.onInviteSuggested({contact:t})},t}(),angular.module("taigaAdmin").controller("SuggestAddMembersCtrl",t)}.call(this),function(){var t;t=function(t){return{scope:{},templateUrl:"invite-members/suggest-add-members/suggest-add-members.html",controller:"SuggestAddMembersCtrl",controllerAs:"vm",bindToController:{contacts:"=",onInviteSuggested:"&",onInviteEmail:"&"},link:function(t,e,r,n){return t.$watch("vm.contacts",function(t){if(t)return n.filterContacts()})}}},angular.module("taigaAdmin").directive("tgSuggestAddMembers",["lightboxService",t])}.call(this),function(){var t,e;e=this.taiga.timeout,t=function(t,r,n){return{templateUrl:"navigation-bar/dropdown-notifications/dropdown-notifications.html",scope:{active:"="},link:function(n,i,o,s){return n.notificationsList=[],n.loading=!1,n.$on("notifications:loaded",function(t,r){return n.loading=!1,void 0!==n.total&&r>n.total?(n.newEvent=!0,e(100,function(){return n.total=r,n.$apply()}),e(2e3,function(){return n.newEvent=!1})):n.total=r}),n.$on("notifications:loading",function(){return n.loading=!0}),n.setAllAsRead=function(){return r.setNotificationsAsRead().then(function(){return t.$emit("notifications:dismiss-all")})}}}},angular.module("taigaNavigationBar").directive("tgDropdownNotifications",["$rootScope","tgNotificationsService","tgCurrentUserService",t])}.call(this),function(){var t;(t=function(t,e,r){return{templateUrl:"navigation-bar/dropdown-project-list/dropdown-project-list.html",scope:{active:"="},link:function(n,i,o,s){var a;return n.vm={},taiga.defineImmutableProperty(n.vm,"projects",function(){return e.projects.get("recents")}),n.vm.newProject=function(){return r.newProject()},a=function(){return i.find(".dropdown-project-list ul li a").data("fullUrl","")},t.$on("dropdown-project-list:updated",a)}}}).$inject=["$rootScope","tgCurrentUserService","tgProjectsService"],angular.module("taigaNavigationBar").directive("tgDropdownProjectList",t)}.call(this),function(){var t;(t=function(t,e,r,n,i,o){return{templateUrl:"navigation-bar/dropdown-user/dropdown-user.html",scope:{},link:function(s,a,c,u){return s.vm={},s.vm.isFeedbackEnabled=e.get("feedbackEnabled"),s.vm.customSupportUrl=e.get("supportUrl"),taiga.defineImmutableProperty(s.vm,"user",function(){return t.userData}),s.vm.logout=function(){return t.logout(),r.url(n.resolve("discover")),r.search({})},s.vm.sendFeedback=function(){return i.sendFeedback()},s.vm.userSettingsPlugins=_.filter(o.userSettingsPlugins,{userMenu:!0})}}}).$inject=["$tgAuth","$tgConfig","$tgLocation","$tgNavUrls","tgFeedbackService","$rootScope"],angular.module("taigaNavigationBar").directive("tgDropdownUser",t)}.call(this),function(){var t;(t=function(t,e,r,n,i){return{templateUrl:"navigation-bar/navigation-bar.html",scope:{},link:function(o,s,a,c){return o.vm={},taiga.defineImmutableProperty(o.vm,"projects",function(){return t.projects.get("recents")}),taiga.defineImmutableProperty(o.vm,"isAuthenticated",function(){return t.isAuthenticated()}),taiga.defineImmutableProperty(o.vm,"isEnabledHeader",function(){return e.isEnabledHeader()}),o.vm.publicRegisterEnabled=i.get("publicRegisterEnabled"),o.vm.customSupportUrl=i.get("supportUrl"),o.vm.login=function(){var t;return t=encodeURIComponent(r.url()),r.url(n.resolve("login")),r.search({next:t})},o.$on("$routeChangeSuccess",function(){switch(o.vm.active=null,r.path()){case"/":return o.vm.active="dashboard";case"/discover":return o.vm.active="discover";case"/notifications":return o.vm.active="notifications";case"/projects/":return o.vm.active="projects"}})}}}).$inject=["tgCurrentUserService","tgNavigationBarService","$tgLocation","$tgNavUrls","$tgConfig"],angular.module("taigaNavigationBar").directive("tgNavigationBar",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(){this.disableHeader()}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.prototype.enableHeader=function(){return this.enabledHeader=!0},r.prototype.disableHeader=function(){return this.enabledHeader=!1},r.prototype.isEnabledHeader=function(){return this.enabledHeader},r}(),angular.module("taigaNavigationBar").service("tgNavigationBarService",t)}.call(this),function(){var t;t=function(){return{templateUrl:"notifications/notifications-list/notifications-list.html",controller:"Notifications",controllerAs:"vm",bindToController:!0,scope:{infiniteScrollContainer:"@",infiniteScrollDistance:"=",onlyUnread:"=onlyUnread"}}},angular.module("taigaNotifications").directive("tgNotificationsList",t)}.call(this),function(){var t,e,r,n={}.hasOwnProperty;r=this.taiga,e=this.taiga.mixOf,this.taiga.debounceLeading,t=function(t){function i(t,e,r,n,i,o,s){var a;this.rootScope=t,this.scope=e,this.notificationsService=r,this.currentUserService=n,this.events=i,this.location=o,this.window=s,this.total=0,this.user=this.currentUserService.getUser(),this.scrollDisabled=!1,this.initList(),this.loadNotifications(),this.rootScope.$on("notifications:dismiss",(a=this,function(t){if(a.onlyUnread)return a.reloadList()})),this.rootScope.$on("notifications:new",function(t){return function(e){return t.reloadList()}}(this)),this.rootScope.$on("notifications:dismiss-all",function(t){return function(e){return t.reloadList()}}(this))}return function(t,e){for(var r in e)n.call(e,r)&&(t[r]=e[r]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(i,e(r.Controller,r.PageMixin,r.FiltersMixin)),i.$inject=["$rootScope","$scope","tgNotificationsService","tgCurrentUserService","$tgEvents","$location","$window"],i.prototype.initList=function(){return this.notificationsList=Immutable.List(),this.list=this.notificationsService.getNotificationsList(this.user.get("id"),null!=this.onlyUnread),this.loading=null==this.list},i.prototype.reloadList=function(){return this.initList(),this.loadNotifications()},i.prototype.loadNotifications=function(){return this.scrollDisabled=!0,this.loading=!0,this.scope.$emit("notifications:loading"),this.list.next().then((t=this,function(e){return t.notificationsList=t.notificationsList.concat(e.get("items")),e.get("next")&&(t.scrollDisabled=!1),t.total=e.get("total"),t.scope.$emit("notifications:loaded",t.total),t.loading=!1,t.notificationsList}));var t},i.prototype.setAsRead=function(t,e){return this.notificationsService.setNotificationAsRead(t.get("id")).then((r=this,function(){return r.location.$$url===e?r.window.location.reload():r.location.path(e),r.rootScope.$broadcast("notifications:dismiss")}));var r},i.prototype.setAllAsRead=function(){return this.notificationsService.setNotificationsAsRead().then((t=this,function(){return t.rootScope.$broadcast("notifications:dismiss-all")}));var t},i}(),angular.module("taigaNotifications").controller("Notifications",t)}.call(this),function(){var t,e,r={}.hasOwnProperty;e=this.taiga,t=function(t){var n,i;function o(t,e,r,n,i){this.rs=t,this.userTimelinePaginationSequenceService=e,this.translate=r,this.navUrls=n,this.tgSections=i}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(o,e.Service),o.$inject=["tgResources","tgUserTimelinePaginationSequenceService","$translate","$tgNavUrls","$tgSections"],n=[{check:function(t){return 1===t.get("event_type")},key:"EVENTS.ASSIGNED_YOU",translate_params:["username","obj_name"]},{check:function(t){return 2===t.get("event_type")},key:"EVENTS.MENTIONED_YOU",translate_params:["username","obj_name"]},{check:function(t){return 3===t.get("event_type")},key:"EVENTS.ADDED_YOU_AS_WATCHER",translate_params:["username","obj_name"]},{check:function(t){return 4===t.get("event_type")},key:"EVENTS.ADDED_YOU_AS_MEMBER",translate_params:["username"]},{check:function(t){return 5===t.get("event_type")},key:"EVENTS.COMMENTED",translate_params:["username","obj_name"]},{check:function(t){return 6===t.get("event_type")},key:"EVENTS.MENTIONED_YOU_IN_COMMENT",translate_params:["username","obj_name"]}],i={username:function(t){var e,r,n;return(n=t.getIn(["data","user"])).get("is_profile_visible")?(e=this.translate.instant("COMMON.SEE_USER_PROFILE",{username:n.get("username")}),r=this.navUrls.resolve("user-profile",{username:t.getIn(["data","user","username"])}),this._getLink(t,r,n.get("name"),"user-link",e)):this._getUsernameSpan(n.get("name"))},project_name:function(t){var e;return e=this.navUrls.resolve("project",{project:t.getIn(["data","project","slug"])}),this._getLink(t,e,t.getIn(["data","project","name"]),"project-link")},obj_name:function(t){var e,r,n;return e=this._getNotificationObject(t),n=this._getDetailObjUrl(t,e.get("content_type")),r="#"+e.get("ref")+" "+e.get("subject"),this._getLink(t,n,r,"object-link")}},o.prototype.getNotificationsList=function(t,e){var r,n;return 0,(r={}).fetch=(n=this,function(r){return n.rs.users.getNotifications(t,r,e).then(function(t){return t})}),r.map=function(t){return function(e){return t._addNotificationAttributes(e)}}(this),this.userTimelinePaginationSequenceService.generate(r)},o.prototype.setNotificationAsRead=function(t){return this.rs.users.setNotificationAsRead(t)},o.prototype.setNotificationsAsRead=function(){return this.rs.users.setNotificationsAsRead()},o.prototype._getNotificationObject=function(t){if(t.get("data").get("obj"))return t.get("data").get("obj")},o.prototype._getType=function(t){return _.find(n,function(e){return e.check(t)})},o.prototype._addNotificationAttributes=function(t){var e,r,n,i,o,s;return e=t.get("event_type"),s=this._getType(t),o=this._getTitle(t,e,s),n=(t=t.set("title_html",o)).getIn(["data","project","slug"]),r=this.tgSections.getPath(n),i=this.navUrls.resolve("project-"+r,{project:n}),t=(t=t.set("projectUrl",i)).set("obj",this._getNotificationObject(t))},o.prototype._translateTitleParams=function(t,e,r){return i[t].call(this,e,r)},o.prototype._getDetailObjUrl=function(t,e){var r;return r={issue:"project-issues-detail",task:"project-tasks-detail",userstory:"project-userstories-detail"},this.navUrls.resolve(r[e],{project:t.getIn(["data","project","slug"]),ref:t.getIn(["data","obj","ref"])})},o.prototype._getLink=function(t,e,r,n,i){var o;return i=i||r,o=$("<span>").attr("ng-non-bindable",!0).text(r),$('<a href="">').attr("title",i).attr("class",n).attr("ng-click",'vm.setAsRead(notification, "'+e+'")').append(o).prop("outerHTML")},o.prototype._getUsernameSpan=function(t){var e;return e=e||t,$("<span>").addClass("username").text(t).prop("outerHTML")},o.prototype._getParams=function(t,e,r){var n,i;return n={},r.translate_params.forEach((i=this,function(r){return n[r]=i._translateTitleParams(r,t,e)})),n},o.prototype._getTitle=function(t,e,r){var n,i,o;return n=this._getParams(t,e,r),i={},Object.keys(n).forEach(function(t){return i[t]="{{"+t+"}}"}),o=this.translate.instant(r.key,i),Object.keys(n).forEach(function(t){var e;return e="{{"+t+"}}",o=o.replace(new RegExp(e,"g"),n[t])}),o},o}(),angular.module("taigaNotifications").service("tgNotificationsService",t)}.call(this),function(){var t;t=function(){function t(t){this.userService=t,this.loadStats()}return t.$inject=["tgUserService"],t.prototype.loadStats=function(){return this.userService.getStats(this.user.get("id")).then((t=this,function(e){return t.stats=e}));var t},t}(),angular.module("taigaProfile").controller("ProfileBar",t)}.call(this),function(){var t;t=function(){return{templateUrl:"profile/profile-bar/profile-bar.html",controller:"ProfileBar",controllerAs:"vm",scope:{user:"=user",isCurrentUser:"=iscurrentuser"},bindToController:!0}},angular.module("taigaProfile").directive("tgProfileBar",t)}.call(this),function(){var t;t=function(){function t(t,e){this.userService=t,this.currentUserService=e,this.currentUser=this.currentUserService.getUser(),this.isCurrentUser=!1,this.currentUser&&this.currentUser.get("id")===this.user.get("id")&&(this.isCurrentUser=!0)}return t.$inject=["tgUserService","tgCurrentUserService"],t.prototype.loadContacts=function(){return this.userService.getContacts(this.user.get("id")).then((t=this,function(e){return t.contacts=e}));var t},t}(),angular.module("taigaProfile").controller("ProfileContacts",t)}.call(this),function(){var t;t=function(){return{templateUrl:"profile/profile-contacts/profile-contacts.html",scope:{user:"="},controllerAs:"vm",controller:"ProfileContacts",link:function(t,e,r,n){return n.loadContacts()},bindToController:!0}},angular.module("taigaProfile").directive("tgProfileContacts",t)}.call(this),function(){var t;t=function(){return{scope:{item:"=tgFavItem"},link:function(t,e,r,n){return t.vm={item:t.item}},templateUrl:function(t,e){return"project"===e.itemType?"profile/profile-favs/items/project.html":"profile/profile-favs/items/ticket.html"}}},angular.module("taigaProfile").directive("tgFavItem",t)}.call(this),function(){var t,e,r,n,i,o=function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;i=this.taiga.debounceLeading,t=function(){function t(){this._init()}return t.prototype._init=function(){return this.enableFilterByAll=!0,this.enableFilterByProjects=!0,this.enableFilterByEpics=!0,this.enableFilterByUserStories=!0,this.enableFilterByTasks=!0,this.enableFilterByIssues=!0,this.enableFilterByTextQuery=!0,this._resetList(),this.q=null,this.type=null},t.prototype._resetList=function(){return this.items=Immutable.List(),this.scrollDisabled=!1,this._page=1},t.prototype._enableLoadingSpinner=function(){return this.isLoading=!0},t.prototype._disableLoadingSpinner=function(){return this.isLoading=!1},t.prototype._enableScroll=function(){return this.scrollDisabled=!1},t.prototype._disableScroll=function(){return this.scrollDisabled=!0},t.prototype._checkIfHasMorePages=function(t){return t?(this._page+=1,this._enableScroll()):this._disableScroll()},t.prototype._checkIfHasNoResults=function(){return this.hasNoResults=0===this.items.size},t.prototype.loadItems=function(){return this._enableLoadingSpinner(),this._disableScroll(),this._getItems(this.user.get("id"),this._page,this.type,this.q).then((t=this,function(e){return t.items=t.items.concat(e.get("data")),t._checkIfHasMorePages(e.get("next")),t._checkIfHasNoResults(),t._disableLoadingSpinner(),t.items})).catch(function(t){return function(){return t._disableLoadingSpinner(),t.items}}(this));var t},t.prototype.filterByTextQuery=i(500,function(){return this._resetList(),this.loadItems()}),t.prototype.showAll=function(){if(null!==this.type)return this.type=null,this._resetList(),this.loadItems()},t.prototype.showProjectsOnly=function(){if("project"!==this.type)return this.type="project",this._resetList(),this.loadItems()},t.prototype.showEpicsOnly=function(){if("epic"!==this.type)return this.type="epic",this._resetList(),this.loadItems()},t.prototype.showUserStoriesOnly=function(){if("userstory"!==this.type)return this.type="userstory",this._resetList(),this.loadItems()},t.prototype.showTasksOnly=function(){if("task"!==this.type)return this.type="task",this._resetList(),this.loadItems()},t.prototype.showIssuesOnly=function(){if("issue"!==this.type)return this.type="issue",this._resetList(),this.loadItems()},t}(),e=function(e){function r(t){this.userService=t,r.__super__.constructor.call(this),this.tabName="likes",this.enableFilterByAll=!1,this.enableFilterByProjects=!1,this.enableFilterByEpics=!1,this.enableFilterByUserStories=!1,this.enableFilterByTasks=!1,this.enableFilterByIssues=!1,this.enableFilterByTextQuery=!0,this._getItems=this.userService.getLiked}return o(r,t),r.$inject=["tgUserService"],r}(),angular.module("taigaProfile").controller("ProfileLiked",e),r=function(e){function r(t){this.userService=t,r.__super__.constructor.call(this),this.tabName="upvotes",this.enableFilterByAll=!0,this.enableFilterByProjects=!1,this.enableFilterByEpics=!0,this.enableFilterByUserStories=!0,this.enableFilterByTasks=!0,this.enableFilterByIssues=!0,this.enableFilterByTextQuery=!0,this._getItems=this.userService.getVoted}return o(r,t),r.$inject=["tgUserService"],r}(),angular.module("taigaProfile").controller("ProfileVoted",r),n=function(e){function r(t){this.userService=t,r.__super__.constructor.call(this),this.tabName="watchers",this._getItems=this.userService.getWatched}return o(r,t),r.$inject=["tgUserService"],r}(),angular.module("taigaProfile").controller("ProfileWatched",n)}.call(this),function(){var t,e,r,n;n={scope:{},bindToController:{user:"=",type:"@",q:"@",scrollDisabled:"@",isLoading:"@",hasNoResults:"@"},controller:null,controllerAs:"vm",templateUrl:"profile/profile-favs/profile-favs.html"},t=function(){return _.extend({},n,{controller:"ProfileLiked"})},angular.module("taigaProfile").directive("tgProfileLiked",t),e=function(){return _.extend({},n,{controller:"ProfileVoted"})},angular.module("taigaProfile").directive("tgProfileVoted",e),r=function(){return _.extend({},n,{controller:"ProfileWatched"})},angular.module("taigaProfile").directive("tgProfileWatched",r)}.call(this),function(){var t;(t=function(){function t(t){var e;this.translate=t,e=Math.floor(Math.random()*this.HINTS.length)+1,this.hint=this.HINTS[e-1],this.hint.linkText=this.hint.linkText||"HINTS.LINK",this.hint.title=this.translate.instant("HINTS.HINT"+e+"_TITLE"),this.hint.text=this.translate.instant("HINTS.HINT"+e+"_TEXT")}return t.prototype.HINTS=[{url:"https://tree.taiga.io/support/admin/import-export-projects/"},{url:"https://tree.taiga.io/support/admin/custom-fields/"},{},{}],t}()).$inject=["$translate"],angular.module("taigaProfile").controller("ProfileHints",t)}.call(this),function(){var t;(t=function(t){return{scope:{},controller:"ProfileHints",controllerAs:"vm",templateUrl:"profile/profile-hints/profile-hints.html"}}).$inject=["$translate"],angular.module("taigaProfile").directive("tgProfileHints",t)}.call(this),function(){var t;t=function(){function t(t,e){this.projectsService=t,this.userService=e}return t.$inject=["tgProjectsService","tgUserService"],t.prototype.loadProjects=function(){return this.projectsService.getProjectsByUserId(this.user.get("id")).then((t=this,function(e){return t.userService.attachUserContactsToProjects(t.user.get("id"),e)})).then(function(t){return function(e){return t.projects=e}}(this));var t},t}(),angular.module("taigaProfile").controller("ProfileProjects",t)}.call(this),function(){var t;t=function(){return{templateUrl:"profile/profile-projects/profile-projects.html",scope:{user:"="},link:function(t,e,r,n){return n.loadProjects()},bindToController:!0,controllerAs:"vm",controller:"ProfileProjects"}},angular.module("taigaProfile").directive("tgProfileProjects",t)}.call(this),function(){var t;t=function(){return{templateUrl:"profile/profile-tab/profile-tab.html",scope:{},require:"^tgProfileTabs",link:function(t,e,r,n,i){if(t.tab={},r.$observe("tgProfileTab",function(e){return t.tab.name=e}),r.$observe("tabTitle",function(e){return t.tab.title=e}),t.tab.icon=r.tabIcon,t.tab.active=!!r.tabActive,!0!==t.$eval(r.tabDisabled))return n.addTab(t.tab)},transclude:!0}},angular.module("taigaProfile").directive("tgProfileTab",t)}.call(this),function(){var t;t=function(){function t(){this.tabs=[]}return t.prototype.addTab=function(t){return this.tabs.push(t)},t.prototype.toggleTab=function(t){return _.map(this.tabs,function(t){return t.active=!1}),t.active=!0},t}(),angular.module("taigaProfile").controller("ProfileTabs",t)}.call(this),function(){var t;t=function(){return{scope:{},controller:"ProfileTabs",controllerAs:"vm",templateUrl:"profile/profile-tabs/profile-tabs.html",transclude:!0}},angular.module("taigaProfile").directive("tgProfileTabs",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n,i,o){var s;this.appMetaService=t,this.currentUserService=e,this.routeParams=r,this.userService=n,this.xhrError=i,this.translate=o,this.isCurrentUser=!1,this.routeParams.slug?this.userService.getUserByUserName(this.routeParams.slug).then((s=this,function(t){return t.get("is_active")?(s.user=t,s.isCurrentUser=!1,s._setMeta(s.user),t):s.xhrError.notFound()})).catch(function(t){return function(e){return t.xhrError.response(e)}}(this)):(this.user=this.currentUserService.getUser(),this.isCurrentUser=!0,this._setMeta(this.user))}return t.$inject=["tgAppMetaService","tgCurrentUserService","$routeParams","tgUserService","tgXhrErrorService","$translate"],t.prototype._setMeta=function(t){var e,r,n;return e={userFullName:t.get("full_name_display"),userUsername:t.get("username")},n=this.translate.instant("USER.PROFILE.PAGE_TITLE",e),r=t.get("bio"),this.appMetaService.setAll(n,r)},t}(),angular.module("taigaProfile").controller("Profile",t)}.call(this),function(){var t;t=function(){return{templateUrl:"projects/project/blocked-project-explanation.html"}},angular.module("taigaProjects").directive("tgBlockedProjectExplanation",t)}.call(this),function(){var t;t=function(){function t(t){this.lightboxFactory=t}return t.$inject=["tgLightboxFactory"],t.prototype.launchContactForm=function(){return this.lightboxFactory.create("tg-lb-contact-project",{class:"lightbox lightbox-contact-project e2e-lightbox-contact-project",project:"project"},{project:this.project})},t}(),angular.module("taigaProjects").controller("ContactProjectButtonCtrl",t)}.call(this),function(){var t;t=function(){return{scope:{},controller:"ContactProjectButtonCtrl",bindToController:{project:"=",layout:"@"},controllerAs:"vm",templateUrl:"projects/components/contact-project-button/contact-project-button.html"}},angular.module("taigaProjects").directive("tgContactProjectButton",t)}.call(this),function(){var t;t=function(){function t(t,e,r){this.lightboxService=t,this.rs=e,this.confirm=r,this.contact={}}return t.$inject=["lightboxService","tgResources","$tgConfirm"],t.prototype.contactProject=function(){var t,e,r,n;return e=this.project.get("id"),t=this.contact.message,r=this.rs.projects.contactProject(e,t),this.sendingFeedback=!0,r.then((n=this,function(){return n.lightboxService.closeAll(),n.sendingFeedback=!1,n.confirm.notify("success")}))},t}(),angular.module("taigaProjects").controller("ContactProjectLbCtrl",t)}.call(this),function(){var t;t=function(t){return this.inject=["lightboxService"],{controller:"ContactProjectLbCtrl",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/lb-contact-project/lb-contact-project.html",link:function(e,r){return t.open(r)}}},angular.module("taigaProjects").directive("tgLbContactProject",["lightboxService",t])}.call(this),function(){var t;t=function(){function t(t,e){this.confirm=t,this.likeButtonService=e,this.isMouseOver=!1,this.loading=!1}return t.$inject=["$tgConfirm","tgLikeProjectButtonService"],t.prototype.showTextWhenMouseIsOver=function(){return this.isMouseOver=!0},t.prototype.showTextWhenMouseIsLeave=function(){return this.isMouseOver=!1},t.prototype.toggleLike=function(){var t,e;return this.loading=!0,(t=this.project.get("is_fan")?this._unlike():this._like()).finally((e=this,function(){return e.loading=!1})),t},t.prototype._like=function(){return this.likeButtonService.like(this.project.get("id")).then((t=this,function(){return t.showTextWhenMouseIsLeave()})).catch(function(t){return function(){return t.confirm.notify("error")}}(this));var t},t.prototype._unlike=function(){return this.likeButtonService.unlike(this.project.get("id")).catch((t=this,function(){return t.confirm.notify("error")}));var t},t}(),angular.module("taigaProjects").controller("LikeProjectButton",t)}.call(this),function(){var t;t=function(){return{scope:{},controller:"LikeProjectButton",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/like-project-button/like-project-button.html"}},angular.module("taigaProjects").directive("tgLikeProjectButton",t)}.call(this),function(){var t,e,r={}.hasOwnProperty;e=this.taiga,t=function(t){function n(t,e,r){this.rs=t,this.currentUserService=e,this.projectService=r}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(n,e.Service),n.$inject=["tgResources","tgCurrentUserService","tgProjectService"],n.prototype._getProjectIndex=function(t){return this.currentUserService.projects.get("all").findIndex(function(e){return e.get("id")===t})},n.prototype._updateProjects=function(t,e){var r,n;if(-1!==(r=this._getProjectIndex(t)))return n=this.currentUserService.projects.get("all").update(r,function(t){var r;return r=t.get("total_fans"),e?r++:r--,t.merge({is_fan:e,total_fans:r})}),this.currentUserService.setProjects(n)},n.prototype._updateCurrentProject=function(t){var e,r;return r=this.projectService.project.get("total_fans"),t?r++:r--,e=this.projectService.project.merge({is_fan:t,total_fans:r}),this.projectService.setProject(e)},n.prototype.like=function(t){return this.rs.projects.likeProject(t).then((e=this,function(){return e._updateProjects(t,!0),e._updateCurrentProject(!0)}));var e},n.prototype.unlike=function(t){return this.rs.projects.unlikeProject(t).then((e=this,function(){return e._updateProjects(t,!1),e._updateCurrentProject(!1)}));var e},n}(),angular.module("taigaProjects").service("tgLikeProjectButtonService",t)}.call(this),function(){var t;t=function(t){return{scope:{projects:"=tgSortProjects"},link:function(e,r,n,i){var o,s;return s=null,(o=dragula([r[0]],{copySortSource:!1,copy:!1,mirrorContainer:r[0],moves:function(t){return $(t).hasClass("list-itemtype-project")}})).on("dragend",function(r){var n,i,o,a,c,u,l;for(a=(s=$(r)).scope().project,i=s.index(),u=_.map(e.projects.toJS(),function(t){return t.id}),(u=_.without(u,a.get("id"))).splice(i,0,a.get("id")),c=[],i=n=0,o=u.length;n<o;i=++n)l=u[i],c.push({project_id:l,order:i});return t.bulkUpdateProjectsOrder(c)}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&o.dragging}}),e.$on("$destroy",function(){return r.off(),o.destroy()})}}},angular.module("taigaProjects").directive("tgSortProjects",["tgCurrentUserService",t])}.call(this),function(){var t;t=function(){function t(t,e){this.confirm=t,this.watchButtonService=e,this.showWatchOptions=!1,this.loading=!1}return t.$inject=["$tgConfirm","tgWatchProjectButtonService"],t.prototype.toggleWatcherOptions=function(){return this.showWatchOptions=!this.showWatchOptions},t.prototype.closeWatcherOptions=function(){return this.showWatchOptions=!1},t.prototype.watch=function(t){var e;if(t!==this.project.get("notify_level"))return this.loading=!0,this.closeWatcherOptions(),this.watchButtonService.watch(this.project.get("id"),t).catch((e=this,function(){return e.confirm.notify("error")})).finally(function(t){return function(){return t.loading=!1}}(this))},t.prototype.unwatch=function(){return this.loading=!0,this.closeWatcherOptions(),this.watchButtonService.unwatch(this.project.get("id")).catch((t=this,function(){return t.confirm.notify("error")})).finally(function(t){return function(){return t.loading=!1}}(this));var t},t}(),angular.module("taigaProjects").controller("WatchProjectButton",t)}.call(this),function(){var t;t=function(){return{scope:{},controller:"WatchProjectButton",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/watch-project-button/watch-project-button.html"}},angular.module("taigaProjects").directive("tgWatchProjectButton",t)}.call(this),function(){var t,e,r={}.hasOwnProperty;e=this.taiga,t=function(t){function n(t,e,r){this.rs=t,this.currentUserService=e,this.projectService=r}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(n,e.Service),n.$inject=["tgResources","tgCurrentUserService","tgProjectService"],n.prototype._getProjectIndex=function(t){return this.currentUserService.projects.get("all").findIndex(function(e){return e.get("id")===t})},n.prototype._updateProjects=function(t,e,r){var n,i,o;if(-1!==(n=this._getProjectIndex(t)))return i=this.currentUserService.projects.get("all").update(n,(o=this,function(t){var n;return n=t.get("total_watchers"),!o.projectService.project.get("is_watcher")&&r?n++:o.projectService.project.get("is_watcher")&&!r&&n--,t.merge({is_watcher:r,total_watchers:n,notify_level:e})})),this.currentUserService.setProjects(i)},n.prototype._updateCurrentProject=function(t,e){var r,n;return n=this.projectService.project.get("total_watchers"),!this.projectService.project.get("is_watcher")&&e?n++:this.projectService.project.get("is_watcher")&&!e&&n--,r=this.projectService.project.merge({is_watcher:e,notify_level:t,total_watchers:n}),this.projectService.setProject(r)},n.prototype.watch=function(t,e){return this.rs.projects.watchProject(t,e).then((r=this,function(){return r._updateProjects(t,e,!0),r._updateCurrentProject(e,!0)}));var r},n.prototype.unwatch=function(t){return this.rs.projects.unwatchProject(t).then((e=this,function(){return e._updateProjects(t,null,!1),e._updateCurrentProject(null,!1)}));var e},n}(),angular.module("taigaProjects").service("tgWatchProjectButtonService",t)}.call(this),function(){var t;t=function(){function t(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.platformName="Asana",this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,this.projectForm.project_type="scrum",!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}return t.$inject=["tgCurrentUserService"],t.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},t.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},t.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid:this.canCreatePublicProjects.valid},t.prototype.isDisabled=function(){return!this.canCreateProject()},t}(),angular.module("taigaProjects").controller("AsanaImportProjectFormCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/asana-import/asana-import-project-form/asana-import-project-form.html",controller:"AsanaImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}}).$inject=[],angular.module("taigaProjects").directive("tgAsanaImportProjectForm",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n){var i;this.asanaImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.step="autorization-asana",this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.asanaImportService.projects})),taiga.defineImmutableProperty(this,"members",function(t){return function(){return t.asanaImportService.projectUsers}}(this))}return t.$inject=["tgAsanaImportService","$tgConfirm","$translate","tgImportProjectService"],t.prototype.startProjectSelector=function(){return this.step="project-select-asana",this.asanaImportService.fetchProjects()},t.prototype.onSelectProject=function(t){return this.step="project-form-asana",this.project=t,this.fetchingUsers=!0,this.asanaImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},t.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-asana"},t.prototype.onCancelMemberSelection=function(){return this.step="project-form-asana"},t.prototype.startImport=function(t){var e,r;return(e=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0)).start(),r=this.asanaImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private"),this.project.get("project_type")),this.importProjectService.importPromise(r).then(function(){return e.stop()})},t.prototype.submitUserSelection=function(t){return this.startImport(t),null},t}(),angular.module("taigaProjects").controller("AsanaImportCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/asana-import/asana-import.html",controller:"AsanaImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}}).$inject=[],angular.module("taigaProjects").directive("tgAsanaImport",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(t,e){this.resources=t,this.location=e,this.projects=Immutable.List(),this.projectUsers=Immutable.List(),this.token=null}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=["tgResources","$location"],r.prototype.setToken=function(t){return this.token=t},r.prototype.fetchProjects=function(){return this.resources.asanaImporter.listProjects(this.token).then((t=this,function(e){return t.projects=e}));var t},r.prototype.fetchUsers=function(t){return this.resources.asanaImporter.listUsers(this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},r.prototype.importProject=function(t,e,r,n,i,o,s){return this.resources.asanaImporter.importProject(this.token,t,e,r,n,i,o,s)},r.prototype.getAuthUrl=function(){return new Promise((t=this,function(e){return t.resources.asanaImporter.getAuthUrl().then(function(r){return t.authUrl=r.data.url,e(t.authUrl)})}));var t},r.prototype.authorize=function(t){return new Promise((e=this,function(r,n){return e.resources.asanaImporter.authorize(t).then(function(t){return e.token=t.data.token,r(e.token)},function(t){return n(new Error(t.status))})}));var e},r}(),angular.module("taigaProjects").service("tgAsanaImportService",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n,i,o){this.currentUserService=t,this.projectsService=e,this.projectUrl=r,this.location=n,this.navUrls=i,this.analytics=o,this.projectForm={is_private:!1},this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0),"scrum"===this.type?this.projectForm.creation_template=1:this.projectForm.creation_template=2}return t.$inject=["tgCurrentUserService","tgProjectsService","$projectUrl","$location","$tgNavUrls","$tgAnalytics"],t.prototype.submit=function(){return this.formSubmitLoading=!0,this.projectsService.create(this.projectForm).then((t=this,function(e){return t.analytics.trackEvent("project","create","project creation",{slug:e.get("slug"),id:e.get("id")}),t.location.url(t.projectUrl.get(e)),t.currentUserService.loadProjects()}));var t},t.prototype.onCancelForm=function(){return this.location.path(this.navUrls.resolve("create-project"))},t.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid:this.canCreatePublicProjects.valid},t.prototype.isDisabled=function(){return this.formSubmitLoading||!this.canCreateProject()},t}(),angular.module("taigaProjects").controller("CreateProjectFormCtrl",t)}.call(this),function(){var t;t=function(){return{templateUrl:"projects/create/create-project-form/create-project-form.html",controller:"CreateProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{type:"@"}}},angular.module("taigaProjects").directive("tgCreateProjectForm",t)}.call(this),function(){var t;t=function(){return{scope:{isPrivate:"=",limitMembersPrivateProject:"=",limitMembersPublicProject:"="},templateUrl:"projects/create/create-project-members-restrictions/create-project-members-restrictions.html"}},angular.module("taigaProject").directive("tgCreateProjectMembersRestrictions",[t])}.call(this),function(){var t;t=function(){return{scope:{isPrivate:"=",canCreatePrivateProjects:"=",canCreatePublicProjects:"="},templateUrl:"projects/create/create-project-restrictions/create-project-restrictions.html"}},angular.module("taigaProject").directive("tgCreateProjectRestrictions",[t])}.call(this),function(){var t;t=function(){function t(t,e,r,n,i){var o;this.appMetaService=t,this.translate=e,this.projectService=r,this.location=n,this.authService=i,taiga.defineImmutableProperty(this,"project",(o=this,function(){return o.projectService.project})),this.appMetaService.setfn(this._setMeta.bind(this)),this.authService.refresh(),this.displayScrumDesc=!1,this.displayKanbanDesc=!1}return t.$inject=["tgAppMetaService","$translate","tgProjectService","$location","$tgAuth"],t.prototype._setMeta=function(){var t;return this.project?(t={projectName:this.project.get("name")},{title:this.translate.instant("PROJECT.PAGE_TITLE",t),description:this.project.get("description")}):null},t.prototype.displayHelp=function(t,e){if(e.stopPropagation(),e.preventDefault(),"scrum"===t&&(this.displayScrumDesc=!this.displayScrumDesc),"kanban"===t)return this.displayKanbanDesc=!this.displayKanbanDesc},t}(),angular.module("taigaProjects").controller("CreateProjectCtrl",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n){var i;this.currentUserService=t,this.projectsService=e,this.location=r,this.navUrls=n,this.user=this.currentUserService.getUser(),this.members=Immutable.List(),this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.currentUserService.projects.get("all")})),this.projectForm={is_private:!1},!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}return t.$inject=["tgCurrentUserService","tgProjectsService","$tgLocation","$tgNavUrls"],t.prototype.refreshReferenceProject=function(t){return this.projectsService.getProjectBySlug(t).then((e=this,function(t){return e.referenceProject=t,e.members=t.get("members").filter(function(t){return t.get("id")!==e.user.get("id")}),e.invitedMembers=e.members.map(function(t){return t.get("id")}),e.checkUsersLimit()}));var e},t.prototype.toggleInvitedMember=function(t){return this.invitedMembers.includes(t)?this.invitedMembers=this.invitedMembers.filter(function(e){return e!==t}):this.invitedMembers=this.invitedMembers.push(t),this.checkUsersLimit()},t.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.invitedMembers.size+1),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.invitedMembers.size+1)},t.prototype.submit=function(){var t,e,r;return e=this.referenceProject.get("id"),(t=this.projectForm).users=this.invitedMembers,this.formSubmitLoading=!0,this.projectsService.duplicate(e,t).then((r=this,function(t){return r.formSubmitLoading=!1,r.location.path(r.navUrls.resolve("project",{project:t.data.slug})),r.currentUserService.loadProjects()}))},t.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid&&this.limitMembersPrivateProject.valid:this.canCreatePublicProjects.valid&&this.limitMembersPublicProject.valid},t.prototype.isDisabled=function(){return this.formSubmitLoading||!this.canCreateProject()},t.prototype.onCancelForm=function(){return this.location.path(this.navUrls.resolve("create-project"))},t}(),angular.module("taigaProjects").controller("DuplicateProjectCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){},templateUrl:"projects/create/duplicate/duplicate-project.html",controller:"DuplicateProjectCtrl",controllerAs:"vm",bindToController:!0,scope:{}}}).$inject=[],angular.module("taigaProjects").directive("tgDuplicateProject",t)}.call(this),function(){var t;t=function(){function t(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.platformName="Github",this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,this.projectForm.project_type="kanban",!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}return t.$inject=["tgCurrentUserService"],t.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},t.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},t.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid:this.canCreatePublicProjects.valid},t.prototype.isDisabled=function(){return!this.canCreateProject()},t}(),angular.module("taigaProjects").controller("GithubImportProjectFormCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/github-import/github-import-project-form/github-import-project-form.html",controller:"GithubImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}}).$inject=[],angular.module("taigaProjects").directive("tgGithubImportProjectForm",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n){var i;this.githubImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.step="autorization-github",this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.githubImportService.projects})),taiga.defineImmutableProperty(this,"members",function(t){return function(){return t.githubImportService.projectUsers}}(this))}return t.$inject=["tgGithubImportService","$tgConfirm","$translate","tgImportProjectService"],t.prototype.startProjectSelector=function(){return this.step="project-select-github",this.githubImportService.fetchProjects()},t.prototype.onSelectProject=function(t){return this.step="project-form-github",this.project=t,this.fetchingUsers=!0,this.githubImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},t.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-github"},t.prototype.onCancelMemberSelection=function(){return this.step="project-form-github"},t.prototype.startImport=function(t){var e,r;return(e=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0)).start(),r=this.githubImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private"),this.project.get("project_type")),this.importProjectService.importPromise(r).then(function(){return e.stop()})},t.prototype.submitUserSelection=function(t){return this.startImport(t),null},t}(),angular.module("taigaProjects").controller("GithubImportCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/github-import/github-import.html",controller:"GithubImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}}).$inject=[],angular.module("taigaProjects").directive("tgGithubImport",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(t,e){this.resources=t,this.location=e,this.projects=Immutable.List(),this.projectUsers=Immutable.List()}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=["tgResources"],r.prototype.setToken=function(t){return this.token=t},r.prototype.fetchProjects=function(){return this.resources.githubImporter.listProjects(this.token).then((t=this,function(e){return t.projects=e}));var t},r.prototype.fetchUsers=function(t){return this.resources.githubImporter.listUsers(this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},r.prototype.importProject=function(t,e,r,n,i,o,s){return this.resources.githubImporter.importProject(this.token,t,e,r,n,i,o,s)},r.prototype.getAuthUrl=function(t){return new Promise((e=this,function(r){return e.resources.githubImporter.getAuthUrl(t).then(function(t){return e.authUrl=t.data.url,r(e.authUrl)})}));var e},r.prototype.authorize=function(t){return new Promise((e=this,function(r,n){return e.resources.githubImporter.authorize(t).then(function(t){return e.token=t.data.token,r(e.token)},function(t){return n(new Error(t.status))})}));var e},r}(),angular.module("taigaProjects").service("tgGithubImportService",t)}.call(this),function(){var t;t=function(){function t(t,e){this.currentUserService=t,this.userService=e,this.selectImportUserLightbox=!1,this.warningImportUsers=!1,this.displayEmailSelector=!0,this.cancelledUsers=Immutable.List(),this.selectedUsers=Immutable.List(),this.selectableUsers=Immutable.List(),this.userContacts=Immutable.List()}return t.$inject=["tgCurrentUserService","tgUserService"],t.prototype.fetchUser=function(){return this.currentUser=this.currentUserService.getUser(),this.userService.getContacts(this.currentUser.get("id")).then((t=this,function(e){return t.userContacts=e,t.refreshSelectableUsers()}));var t},t.prototype.searchUser=function(t){return this.selectImportUserLightbox=!0,this.searchingUser=t},t.prototype.beforeSubmitUsers=function(){return this.selectedUsers.size!==this.members.size?this.warningImportUsers=!0:this.submit()},t.prototype.confirmUser=function(t,e){var r;return this.selectImportUserLightbox=!1,r=(r=(r=Immutable.Map()).set("user",t)).set("taigaUser",e),this.selectedUsers=this.selectedUsers.push(r),this.discardSuggestedUser(t),this.refreshSelectableUsers()},t.prototype.unselectUser=function(t){var e;return e=this.selectedUsers.findIndex(function(e){return e.getIn(["user","id"])===t.get("id")}),this.selectedUsers=this.selectedUsers.delete(e),this.refreshSelectableUsers()},t.prototype.discardSuggestedUser=function(t){return this.cancelledUsers=this.cancelledUsers.push(t.get("id"))},t.prototype.getSelectedMember=function(t){return this.selectedUsers.find(function(e){return e.getIn(["user","id"])===t.get("id")})},t.prototype.isMemberSelected=function(t){return!!this.getSelectedMember(t)},t.prototype.getUser=function(t){var e;return(e=this.getSelectedMember(t))?e.get("taigaUser"):null},t.prototype.submit=function(){var t;return this.warningImportUsers=!1,t=Immutable.Map(),this.selectedUsers.map(function(e){var r;return r="",r=_.isString(e.get("taigaUser"))?e.get("taigaUser"):e.getIn(["taigaUser","id"]),t=t.set(e.getIn(["user","id"]),r)}),this.onSubmit({users:t})},t.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size+1),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size+1)},t.prototype.showSuggestedMatch=function(t){return t.get("user")&&-1===this.cancelledUsers.indexOf(t.get("id"))&&!this.isMemberSelected(t)},t.prototype.getDistinctSelectedTaigaUsers=function(){var t,e;return t=[],this.selectedUsers.filter(function(e){var r;return r=e.getIn(["taigaUser","id"]),-1===t.indexOf(r)&&(t.push(r),!0)}).filter((e=this,function(t){return t.getIn(["taigaUser","id"])!==e.currentUser.get("id")}))},t.prototype.refreshSelectableUsers=function(){var t;return this.importMoreUsersDisabled=this.isImportMoreUsersDisabled(),this.importMoreUsersDisabled?(t=this.getDistinctSelectedTaigaUsers(),this.selectableUsers=t.map(function(t){return t.get("taigaUser")}),this.displayEmailSelector=!1):(this.selectableUsers=this.userContacts,this.displayEmailSelector=!0),this.selectableUsers=this.selectableUsers.push(this.currentUser)},t.prototype.isImportMoreUsersDisabled=function(){var t;return t=this.getDistinctSelectedTaigaUsers().size+2,this.project.get("is_private")?!this.currentUserService.canAddMembersPrivateProject(t).valid:!this.currentUserService.canAddMembersPublicProject(t).valid},t}(),angular.module("taigaProjects").controller("ImportProjectMembersCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){return n.fetchUser(),t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/import-project-members/import-project-members.html",controller:"ImportProjectMembersCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSubmit:"&",platform:"@",logo:"@",onCancel:"&"}}}).$inject=[],angular.module("taigaProjects").directive("tgImportProjectMembers",t)}.call(this),function(){var t;t=function(){function t(){}return t.prototype.selectProject=function(t){return this.onSelectProject({project:Immutable.fromJS(t)})},t}(),angular.module("taigaProjects").controller("ImportProjectSelectorCtrl",t)}.call(this),function(){var t;t=function(){return{templateUrl:"projects/create/import-project-selector/import-project-selector.html",controller:"ImportProjectSelectorCtrl",controllerAs:"vm",bindToController:!0,scope:{projects:"<",onCancel:"&",onSelectProject:"&",logo:"@",noProjectsMsg:"@",search:"@"}}},angular.module("taigaProjects").directive("tgImportProjectSelector",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n,i){this.confirm=t,this.rs=e,this.importProjectService=r,this.translate=n,this.analytics=i}return t.$inject=["$tgConfirm","$tgResources","tgImportProjectService","$translate","$tgAnalytics"],t.prototype.importTaiga=function(t){var e,r,n;this.analytics.trackEvent("import","taiga","Start import from taiga",1),e=t[0],(r=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0)).start(),n=this.rs.projects.import(e,r.update),this.importProjectService.importPromise(n).finally(function(){return r.stop()})},t}(),angular.module("taigaProjects").controller("ImportTaigaCtrl",t)}.call(this),function(){var t;t=function(){return{templateUrl:"projects/create/import-taiga/import-taiga.html",controller:"ImportTaigaCtrl",controllerAs:"vm",bindToController:!0,scope:{}}},angular.module("taigaProjects").directive("tgImportTaiga",t)}.call(this),function(){var t;(t=function(t){return{templateUrl:"projects/create/import/import-project-error-lb.html",link:function(e,r,n){return t.open(r),e.close=function(){t.close(r)}}}}).$inject=["lightboxService"],angular.module("taigaProjects").directive("tgLbImportError",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n,i,o,s,a,c,u,l){this.trelloService=t,this.jiraService=e,this.githubService=r,this.asanaService=n,this.location=i,this.window=o,this.routeParams=s,this.tgNavUrls=a,this.config=c,this.confirm=u,this.analytics=l}return t.$inject=["tgTrelloImportService","tgJiraImportService","tgGithubImportService","tgAsanaImportService","$location","$window","$routeParams","$tgNavUrls","$tgConfig","$tgConfirm","$tgAnalytics"],t.prototype.start=function(){var t,e,r,n,i,o;if(this.token=null,this.from=this.routeParams.platform,n=this.location.search(),this.from&&this.analytics.trackEvent("import",this.from,"Start import from "+this.from,1),"asana"===this.from){if(t=n.code,n.code)return t=n.code,this.asanaService.authorize(t).then((o=this,function(t){return o.location.search({token:encodeURIComponent(JSON.stringify(t))})}),this.cancelCurrentImport.bind(this));this.token=JSON.parse(decodeURIComponent(n.token)),this.asanaService.setToken(this.token)}if("trello"===this.from){if(n.oauth_verifier)return i=n.oauth_verifier,this.trelloService.authorize(i).then(function(t){return function(e){return t.location.search({token:e})}}(this),this.cancelCurrentImport.bind(this));n.token&&(this.token=n.token,this.trelloService.setToken(n.token))}if("github"===this.from){if(n.code)return e=n.code,this.githubService.authorize(e).then(function(t){return function(e){return t.location.search({token:e})}}(this),this.cancelCurrentImport.bind(this));n.token&&(this.token=n.token,this.githubService.setToken(n.token))}if("jira"===this.from)return n.oauth_token?(r=n.oauth_verifier,this.jiraService.authorize(r).then(function(t){return function(e){return t.location.search({token:e.token,url:e.url})}}(this),this.cancelCurrentImport.bind(this))):(this.token=n.token,this.jiraService.setToken(n.token,n.url))},t.prototype.select=function(t){var e,r;return"trello"===t?this.trelloService.getAuthUrl().then((r=this,function(t){return r.window.open(t,"_self")})):"jira"===t?this.jiraService.getAuthUrl(this.jiraUrl).then(function(t){return function(e){return t.window.open(e,"_self")}}(this),function(t){return function(e){return t.confirm.notify("error",e)}}(this)):"github"===t?(e=this.location.absUrl()+"/github",this.githubService.getAuthUrl(e).then(function(t){return function(e){return t.window.open(e,"_self")}}(this))):"asana"===t?this.asanaService.getAuthUrl().then(function(t){return function(e){return t.window.open(e,"_self")}}(this)):this.from=t},t.prototype.unfoldOptions=function(t){return this.unfoldedOptions=t},t.prototype.isActiveImporter=function(t){return-1!==this.config.get("importers").indexOf(t)},t.prototype.cancelCurrentImport=function(){return this.location.url(this.tgNavUrls.resolve("create-project-import"))},t.prototype.backToCreate=function(){return this.location.url(this.tgNavUrls.resolve("create-project"))},t}(),angular.module("taigaProjects").controller("ImportProjectCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){return n.start()},templateUrl:"projects/create/import/import-project.html",controller:"ImportProjectCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancelImport:"&"}}}).$inject=[],angular.module("taigaProjects").directive("tgImportProject",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(t,e,r,n,i,o,s){this.currentUserService=t,this.tgAuth=e,this.lightboxFactory=r,this.translate=n,this.confirm=i,this.location=o,this.tgNavUrls=s}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=["tgCurrentUserService","$tgAuth","tgLightboxFactory","$translate","$tgConfirm","$location","$tgNavUrls"],r.prototype.importPromise=function(t){return t.then(this.importSuccess.bind(this),this.importError.bind(this))},r.prototype.importSuccess=function(t){var e,r;return(e=this.currentUserService.loadProjects()).then((r=this,function(){var e,n,i,o;return 202===t.status?(o=r.translate.instant("PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE"),n=r.translate.instant("PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE"),r.location.path(r.tgNavUrls.resolve("home")),r.confirm.success(o,n)):(e={project:t.data.slug},r.location.path(r.tgNavUrls.resolve("project-admin-project-profile-details",e)),i=r.translate.instant("PROJECT.IMPORT.SYNC_SUCCESS"),r.confirm.notify("success",i))})),e},r.prototype.importError=function(t){var e,r;return(e=this.tgAuth.refresh()).then((r=this,function(){var e,n,i;return(i=r.getRestrictionError(t))?r.lightboxFactory.create("tg-lb-import-error",{class:"lightbox lightbox-import-error"},i):(e=r.translate.instant("PROJECT.IMPORT.ERROR"),429===t.status?e=r.translate.instant("PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST"):(null!=(n=t.data)?n._error_message:void 0)&&(e=r.translate.instant("PROJECT.IMPORT.ERROR_MESSAGE",{error_message:t.data._error_message})),r.confirm.notify("error",e))})),e},r.prototype.getRestrictionError=function(t){var e,r,n,i,o,s;return!!t.headers&&(e="",s=this.currentUserService.getUser(),r=null,t.headers.isPrivate?(i=!this.currentUserService.canCreatePrivateProjects().valid,n=null!==s.get("max_memberships_private_projects")&&t.headers.memberships>=s.get("max_memberships_private_projects"),i&&n?(e="private-space-members",r=s.get("max_memberships_private_projects")):i?e="private-space":n&&(e="private-members",r=s.get("max_memberships_private_projects"))):(o=!this.currentUserService.canCreatePublicProjects().valid,n=null!==s.get("max_memberships_public_projects")&&t.headers.memberships>=s.get("max_memberships_public_projects"),o&&n?(e="public-space-members",r=s.get("max_memberships_public_projects")):o?e="public-space":n&&(e="public-members",r=s.get("max_memberships_public_projects"))),!!e&&{key:e,values:{max_memberships:r,members:t.headers.memberships}})},r}(),angular.module("taigaProjects").service("tgImportProjectService",t)}.call(this),function(){var t;t=function(){function t(){}return t.$inject=[],t.prototype.isDisabled=function(t){return-1===this.invitedMembers.indexOf(t)},t}(),angular.module("taigaProjects").controller("InviteMembersCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){},templateUrl:"projects/create/invite-members/invite-members.html",controller:"InviteMembersCtrl",controllerAs:"vm",bindToController:!0,scope:{invitedMembers:"<",members:"<",onToggleInvitedMember:"&"}}}).$inject=[],angular.module("taigaProjects").directive("tgInviteMembers",t)}.call(this),function(){var t;(t=function(){return{templateUrl:"projects/create/invite-members/single-member/single-member.html",scope:{disabled:"<",avatar:"="}}}).$inject=[],angular.module("taigaProjects").directive("tgSingleMember",t)}.call(this),function(){var t;t=function(){function t(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,"agile"===this.projectForm.importer_type?this.projectForm.project_type=null:this.projectForm.project_type="scrum",this.projectForm.create_subissues=!0,!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}return t.$inject=["tgCurrentUserService"],t.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},t.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},t.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid:this.canCreatePublicProjects.valid},t.prototype.isDisabled=function(){return!this.canCreateProject()},t}(),angular.module("taigaProjects").controller("JiraImportProjectFormCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/jira-import/jira-import-project-form/jira-import-project-form.html",controller:"JiraImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}}).$inject=[],angular.module("taigaProjects").directive("tgJiraImportProjectForm",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n){var i;this.jiraImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.step="autorization-jira",this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.jiraImportService.projects})),taiga.defineImmutableProperty(this,"members",function(t){return function(){return t.jiraImportService.projectUsers}}(this))}return t.$inject=["tgJiraImportService","$tgConfirm","$translate","tgImportProjectService"],t.prototype.startProjectSelector=function(){return this.step="project-select-jira",this.jiraImportService.fetchProjects()},t.prototype.onSelectProject=function(t){return this.step="project-form-jira",this.project=t,this.fetchingUsers=!0,this.jiraImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},t.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-jira"},t.prototype.onCancelMemberSelection=function(){return this.step="project-form-jira"},t.prototype.startImport=function(t){var e,r,n;return(e=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0)).start(),"issues"===(r=this.project.get("project_type"))&&this.project.get("create_subissues")&&(r="issues-with-subissues"),n=this.jiraImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private"),r,this.project.get("importer_type")),this.importProjectService.importPromise(n).then(function(){return e.stop()})},t.prototype.submitUserSelection=function(t){return this.startImport(t),null},t}(),angular.module("taigaProjects").controller("JiraImportCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/jira-import/jira-import.html",controller:"JiraImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}}).$inject=[],angular.module("taigaProjects").directive("tgJiraImport",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(t,e){this.resources=t,this.location=e,this.projects=Immutable.List(),this.projectUsers=Immutable.List()}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=["tgResources","$location"],r.prototype.setToken=function(t,e){return this.token=t,this.url=e},r.prototype.fetchProjects=function(){return this.resources.jiraImporter.listProjects(this.url,this.token).then((t=this,function(e){return t.projects=e}));var t},r.prototype.fetchUsers=function(t){return this.resources.jiraImporter.listUsers(this.url,this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},r.prototype.importProject=function(t,e,r,n,i,o,s,a){return this.resources.jiraImporter.importProject(this.url,this.token,t,e,r,n,i,o,s,a)},r.prototype.getAuthUrl=function(t){return new Promise((e=this,function(r,n){return e.resources.jiraImporter.getAuthUrl(t).then(function(t){return e.authUrl=t.data.url,r(e.authUrl)},function(t){return n(t.data._error_message)})}));var e},r.prototype.authorize=function(t){return new Promise((e=this,function(r,n){return e.resources.jiraImporter.authorize(t).then(function(t){return e.token=t.data.token,e.url=t.data.url,r(t.data)},function(t){return n(new Error(t.status))})}));var e},r}(),angular.module("taigaProjects").service("tgJiraImportService",t)}.call(this),function(){var t;t=function(){function t(){}return t.$inject=[],t.prototype.start=function(){return this.mode="search",this.invalid=!1},t.prototype.assignUser=function(){return this.onSelectUser({user:this.user,taigaUser:this.userEmail})},t.prototype.selectUser=function(t){return this.onSelectUser({user:this.user,taigaUser:Immutable.fromJS(t)})},t}(),angular.module("taigaProjects").controller("SelectImportUserLightboxCtrl",t)}.call(this),function(){var t;(t=function(t,e){return{controller:"SelectImportUserLightboxCtrl",controllerAs:"vm",bindToController:!0,scope:{user:"<",visible:"<",onClose:"&",onSelectUser:"&",selectableUsers:"<",isPrivate:"<",limitMembersPrivateProject:"<",limitMembersPublicProject:"<",displayEmailSelector:"<"},templateUrl:"projects/create/select-import-user-lightbox/select-import-user-lightbox.html",link:function(r,n,i,o){return r.$watch("vm.visible",function(i){return i&&!n.hasClass("open")?(o.start(),t.open(n,null,r.vm.onClose).then(function(){return n.find("input").focus(),e.init(n)})):!i&&n.hasClass("open")?t.close(n).then(function(){return o.userEmail="",o.usersSearch=""}):void 0})}}}).$inject=["lightboxService","lightboxKeyboardNavigationService"],angular.module("taigaProjects").directive("tgSelectImportUserLightbox",t)}.call(this),function(){var t;t=function(){function t(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.platformName="Trello",this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}return t.$inject=["tgCurrentUserService"],t.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},t.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},t.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid:this.canCreatePublicProjects.valid},t.prototype.isDisabled=function(){return!this.canCreateProject()},t}(),angular.module("taigaProjects").controller("TrelloImportProjectFormCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/trello-import/trello-import-project-form/trello-import-project-form.html",controller:"TrelloImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}}).$inject=[],angular.module("taigaProjects").directive("tgTrelloImportProjectForm",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n){var i;this.trelloImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.trelloImportService.projects})),taiga.defineImmutableProperty(this,"members",function(t){return function(){return t.trelloImportService.projectUsers}}(this))}return t.$inject=["tgTrelloImportService","$tgConfirm","$translate","tgImportProjectService"],t.prototype.startProjectSelector=function(){return this.trelloImportService.fetchProjects().then((t=this,function(){return t.step="project-select-trello"}));var t},t.prototype.onSelectProject=function(t){return this.step="project-form-trello",this.project=t,this.fetchingUsers=!0,this.trelloImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},t.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-trello"},t.prototype.onCancelMemberSelection=function(){return this.step="project-form-trello"},t.prototype.startImport=function(t){var e,r;return(e=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0)).start(),r=this.trelloImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private")),this.importProjectService.importPromise(r).then(function(){return e.stop()})},t.prototype.submitUserSelection=function(t){return this.startImport(t),null},t}(),angular.module("taigaProjects").controller("TrelloImportCtrl",t)}.call(this),function(){var t;(t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/trello-import/trello-import.html",controller:"TrelloImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}}).$inject=[],angular.module("taigaProjects").directive("tgTrelloImport",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(t){this.resources=t,this.projects=Immutable.List(),this.projectUsers=Immutable.List(),this.token=null}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=["tgResources"],r.prototype.setToken=function(t){return this.token=t},r.prototype.fetchProjects=function(){return this.resources.trelloImporter.listProjects(this.token).then((t=this,function(e){return t.projects=e}));var t},r.prototype.fetchUsers=function(t){return this.resources.trelloImporter.listUsers(this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},r.prototype.importProject=function(t,e,r,n,i,o){return this.resources.trelloImporter.importProject(this.token,t,e,r,n,i,o)},r.prototype.getAuthUrl=function(){return new Promise((t=this,function(e){return t.resources.trelloImporter.getAuthUrl().then(function(r){return t.authUrl=r.data.url,e(t.authUrl)})}));var t},r.prototype.authorize=function(t){return new Promise((e=this,function(r,n){return e.resources.trelloImporter.authorize(t).then(function(t){return e.token=t.data.token,r(e.token)},function(t){return n(new Error(t.status))})}));var e},r}(),angular.module("taigaProjects").service("tgTrelloImportService",t)}.call(this),function(){var t;(t=function(t,e){return{link:function(r,n,i){return r.$watch("visible",function(i){return i&&!n.hasClass("open")?t.open(n,r.onClose).then(function(){return n.find("input").focus(),e.init(n)}):!i&&n.hasClass("open")?t.close(n):void 0})},templateUrl:"projects/create/warning-user-import-lightbox/warning-user-import-lightbox.html",scope:{visible:"<",onClose:"&",onConfirm:"&"}}}).$inject=["lightboxService","lightboxKeyboardNavigationService"],angular.module("taigaProjects").directive("tgWarningUserImportLightbox",t)}.call(this),function(){var t;t=function(){function t(t){var e;this.currentUserService=t,taiga.defineImmutableProperty(this,"projects",(e=this,function(){return e.currentUserService.projects.get("all")}))}return t.$inject=["tgCurrentUserService"],t}(),angular.module("taigaProjects").controller("ProjectsListing",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n,i){var o;this.routeParams=t,this.location=e,this.projectService=r,this.rs=n,this.tgSections=i,this.getProjectHomepage().then((o=this,function(t){return t?o.location.url("project/"+o.routeParams.pslug+"/"+t):o.gotoDefaultProjectHomepage()})).then(null,function(){return this.gotoDefaultProjectHomepage()})}return t.$inject=["$routeParams","$location","tgProjectService","$tgResources","$tgSections"],t.prototype.gotoDefaultProjectHomepage=function(){return this.location.url("project/"+this.routeParams.pslug+"/timeline")},t.prototype.getProjectHomepage=function(){var t,e;return t=this.projectService.project.toJS(),this.rs.userProjectSettings.list({project:t.id}).then((e=this,function(r){var n;if(n=_.find(r,{project:t.id}))return e.tgSections.getPath(t.slug,n.homepage)}))},t}(),angular.module("taigaProjects").controller("ProjectRouter",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n,i){var o;this.routeParams=t,this.appMetaService=e,this.auth=r,this.translate=n,this.projectService=i,this.user=this.auth.userData,taiga.defineImmutableProperty(this,"project",(o=this,function(){return o.projectService.project})),taiga.defineImmutableProperty(this,"members",function(t){return function(){return t.projectService.activeMembers}}(this)),this.appMetaService.setfn(this._setMeta.bind(this))}return t.$inject=["$routeParams","tgAppMetaService","$tgAuth","$translate","tgProjectService"],t.prototype._setMeta=function(){var t;return this.project?(t={projectName:this.project.get("name")},{title:this.translate.instant("PROJECT.PAGE_TITLE",t),description:this.project.get("description")}):null},t}(),angular.module("taigaProjects").controller("Project",t)}.call(this),function(){var t,e,r={}.hasOwnProperty;e=this.taiga,this.taiga.groupBy,t=function(t){function n(t,e){this.rs=t,this.projectUrl=e}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(n,e.Service),n.$inject=["tgResources","$projectUrl"],n.prototype.create=function(t){return this.rs.projects.create(t)},n.prototype.duplicate=function(t,e){return this.rs.projects.duplicate(t,e)},n.prototype.getProjectBySlug=function(t){return this.rs.projects.getProjectBySlug(t).then((e=this,function(t){return e._decorate(t)}));var e},n.prototype.getProjectStats=function(t){return this.rs.projects.getProjectStats(t)},n.prototype.getProjectsByUserId=function(t,e){return this.rs.projects.getProjectsByUserId(t,e).then((r=this,function(t){return t.map(r._decorate.bind(r))}));var r},n.prototype.getListProjectsByUserId=function(t,e){return this.rs.projects.getListProjectsByUserId(t,e).then((r=this,function(t){return t.map(r._decorate.bind(r))}));var r},n.prototype._decorate=function(t){var e;return e=this.projectUrl.get(t.toJS()),t=t.set("url",e)},n.prototype.bulkUpdateProjectsOrder=function(t){return this.rs.projects.bulkUpdateOrder(t)},n.prototype.transferValidateToken=function(t,e){return this.rs.projects.transferValidateToken(t,e)},n.prototype.transferAccept=function(t,e,r){return this.rs.projects.transferAccept(t,e,r)},n.prototype.transferReject=function(t,e,r){return this.rs.projects.transferReject(t,e,r)},n}(),angular.module("taigaProjects").service("tgProjectsService",t)}.call(this),function(){var t;t=function(){return{templateUrl:"projects/transfer/cant-own-project-explanation.html"}},angular.module("taigaProjects").directive("tgCantOwnProjectExplanation",t)}.call(this),function(){var t,e;e=angular.module("taigaProjects"),t=function(){function t(t,e,r,n,i,o,s,a,c){this.routeParams=t,this.projectService=e,this.location=r,this.authService=n,this.currentUserService=i,this.navUrls=o,this.translate=s,this.confirmService=a,this.errorHandlingService=c}return t.$inject=["$routeParams","tgProjectsService","$location","$tgAuth","tgCurrentUserService","$tgNavUrls","$translate","$tgConfirm","tgErrorHandlingService"],t.prototype.initialize=function(){return this.projectId=this.project.get("id"),this.token=this.routeParams.token,this.showAddComment=!1,this._refreshUserData()},t.prototype._validateToken=function(){return this.projectService.transferValidateToken(this.projectId,this.token).then(null,(t=this,function(e,r){return t.errorHandlingService.notfound()}));var t},t.prototype._refreshUserData=function(){return this.authService.refresh().then((t=this,function(){return t._validateToken(),t._setProjectData(),t._checkOwnerData()}));var t},t.prototype._setProjectData=function(){return this.canBeOwnedByUser=this.currentUserService.canOwnProject(this.project)},t.prototype._checkOwnerData=function(){var t,e;return t=this.currentUserService.getUser(),this.project.get("is_private")?(this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE",this.maxProjects=t.get("max_private_projects"),null===this.maxProjects&&(this.maxProjects=this.translate.instant("ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS")),this.currentProjects=t.get("total_private_projects"),e=t.get("max_memberships_private_projects")):(this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC",this.maxProjects=t.get("max_public_projects"),null===this.maxProjects&&(this.maxProjects=this.translate.instant("ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS")),this.currentProjects=t.get("total_public_projects"),e=t.get("max_memberships_public_projects")),this.validNumberOfMemberships=null===e||this.project.get("total_memberships")<=e},t.prototype.transferAccept=function(t,e){return this.loadingAccept=!0,this.projectService.transferAccept(this.project.get("id"),t,e).then((r=this,function(){var t;t=r.navUrls.resolve("project-admin-project-profile-details",{project:r.project.get("slug")}),r.loadingAccept=!1,r.location.path(t),r.confirmService.notify("success",r.translate.instant("ADMIN.PROJECT_TRANSFER.ACCEPTED_PROJECT_OWNERNSHIP"),"",5e3)}));var r},t.prototype.transferReject=function(t,e){return this.loadingReject=!0,this.projectService.transferReject(this.project.get("id"),t,e).then((r=this,function(){var t;t=r.navUrls.resolve("home",{project:r.project.get("slug")}),r.loadingReject=!1,r.location.path(t),r.confirmService.notify("success",r.translate.instant("ADMIN.PROJECT_TRANSFER.REJECTED_PROJECT_OWNERNSHIP"),"",5e3)}));var r},t.prototype.addComment=function(){return this.showAddComment=!0},t.prototype.hideComment=function(){return this.showAddComment=!1,this.reason=""},t}(),e.controller("TransferProjectController",t)}.call(this),function(){var t;t=function(){return{link:function(t,e,r,n){return n.initialize()},scope:{},bindToController:{project:"="},templateUrl:"projects/transfer/transfer-project.html",controller:"TransferProjectController",controllerAs:"vm"}},angular.module("taigaProjects").directive("tgTransferProject",t)}.call(this),function(){var t,e;this.taiga,e=this.taiga.sizeFormat,(t=function(t,r,n,i,o,s){var a;return(a={}).list=function(e,n,i){var o,s,a,c;return c="attachments/"+e,s={object_id:n,project:i},o={headers:{"x-disable-pagination":"1"}},a=t.resolve(c),r.get(a,s,o).then(function(t){return Immutable.fromJS(t.data)})},a.delete=function(e,n){var i,o;return o="attachments/"+e,i=t.resolve(o)+"/"+n,r.delete(i)},a.patch=function(e,n,i){var o,s;return s="attachments/"+e,o=t.resolve(s)+"/"+n,r.patch(o,i)},a.create=function(r,a,c,u,l){var p,d,h,f,g,m,v,y,_,b,S;return b="attachments/"+r,_=t.resolve(b),d=o.defer(),void 0===u?(d.reject(null),d.promise):(h=n.get("maxUploadFileSize",null))&&u.size>h?(f={status:413,data:{_error_message:"'"+u.name+"' ("+e(u.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+e(h)+")"}},d.reject(f),d.promise):(y=function(t){return i.$apply(function(){return u.status="in-progress",u.size=e(t.total),u.progressMessage="upload "+e(t.loaded)+" of "+e(t.total),u.progressPercent=Math.round(t.loaded/t.total*100)+"%"})},m=function(t){return i.$apply(function(){var e,r,n;u.status="done",n=t.target.status;try{e=JSON.parse(t.target.responseText)}catch(t){e={}}return n>=200&&n<400?(e=Immutable.fromJS(e),d.resolve(e)):(f={status:n,data:{_error_message:null!=(r=p.attached_file)?r[0]:void 0}},d.reject(f))})},v=function(t){return i.$apply(function(){return u.status="error",d.reject("fail")})},(p=new FormData).append("project",a),p.append("object_id",c),p.append("attached_file",u),p.append("from_comment",l),(S=new XMLHttpRequest).upload.addEventListener("progress",y,!1),S.addEventListener("load",m,!1),S.addEventListener("error",v,!1),g=s.get("token"),S.open("POST",_),S.setRequestHeader("Authorization","Bearer "+g),S.setRequestHeader("Accept","application/json"),S.send(p),d.promise)},function(){return{attachments:a}}}).$inject=["$tgUrls","$tgHttp","$tgConfig","$rootScope","$q","$tgStorage"],angular.module("taigaResources2").factory("tgAttachmentsResource",t)}.call(this),function(){var t;(t=function(t,e){var r;return(r={}).listInAllProjects=function(r){var n,i;return i=t.resolve("epics"),n={headers:{"x-disable-pagination":"1"}},e.get(i,r,n).then(function(t){return Immutable.fromJS(t.data)})},r.list=function(r,n){var i,o;return null==n&&(n=0),o=t.resolve("epics"),i={project:r,page:n},e.get(o,i).then(function(t){return{list:Immutable.fromJS(t.data),headers:t.headers}})},r.patch=function(r,n){var i;return i=t.resolve("epics")+"/"+r,e.patch(i,n).then(function(t){return Immutable.fromJS(t.data)})},r.post=function(r){var n;return n=t.resolve("epics"),e.post(n,r).then(function(t){return Immutable.fromJS(t.data)})},r.reorder=function(r,n,i){var o,s;return s=t.resolve("epics")+"/"+r,o={headers:{"set-orders":JSON.stringify(i)}},e.patch(s,n,null,o).then(function(t){return Immutable.fromJS(t.data)})},r.addRelatedUserstory=function(r,n){var i,o;return o=t.resolve("epic-related-userstories",r),i={user_story:n,epic:r},e.post(o,i)},r.reorderRelatedUserstory=function(r,n,i,o){var s,a;return a=t.resolve("epic-related-userstories",r)+"/"+n,s={headers:{"set-orders":JSON.stringify(o)}},e.patch(a,i,null,s)},r.bulkCreateRelatedUserStories=function(r,n,i){var o,s;return s=t.resolve("epic-related-userstories-bulk-create",r),o={bulk_userstories:i,project_id:n},e.post(s,o)},r.deleteRelatedUserstory=function(r,n){var i;return i=t.resolve("epic-related-userstories",r)+"/"+n,e.delete(i)},function(){return{epics:r}}}).$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgEpicsResource",t)}.call(this),function(){var t;(t=function(t,e){var r;return(r={}).getApplicationToken=function(r,n){var i;return i=(i=t.resolve("applications"))+"/"+r+"/token?state="+n,e.get(i).then(function(t){return Immutable.fromJS(t.data)})},r.authorizeApplicationToken=function(r,n){var i,o;return o=t.resolve("application-tokens"),o+="/authorize",i={state:n,application:r},e.post(o,i).then(function(t){return Immutable.fromJS(t.data)})},function(){return{externalapps:r}}}).$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgExternalAppsResource",t)}.call(this),function(){var t;(t=function(t,e){var r;return(r={}).getHistory=function(r,n,i,o){var s;return s=t.resolve("history/"+n),e.get(s+"/"+i,{page:o,type:r}).then(function(t){return{list:Immutable.fromJS(t.data),headers:t.headers}})},function(){return{history:r}}}).$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgHistory",t)}.call(this),function(){var t,e,r,n,i;this.taiga,(n=function(t,e){var r;return(r={}).getAuthUrl=function(r){return r=t.resolve("importers-trello-auth-url"),e.get(r)},r.authorize=function(r){var n;return n=t.resolve("importers-trello-authorize"),e.post(n,{code:r})},r.listProjects=function(r){var n;return n=t.resolve("importers-trello-list-projects"),e.post(n,{token:r}).then(function(t){return Immutable.fromJS(t.data)})},r.listUsers=function(r,n){var i;return i=t.resolve("importers-trello-list-users"),e.post(i,{token:r,project:n}).then(function(t){return Immutable.fromJS(t.data)})},r.importProject=function(r,n,i,o,s,a,c){var u,l;return l=t.resolve("importers-trello-import-project"),u={token:r,name:n,description:i,project:o,users_bindings:s.toJS(),keep_external_reference:a,is_private:c,template:"kanban"},e.post(l,u)},function(){return{trelloImporter:r}}}).$inject=["$tgUrls","$tgHttp"],(r=function(t,e){var r;return(r={}).getAuthUrl=function(r){var n;return n=t.resolve("importers-jira-auth-url")+"?url="+r,e.get(n)},r.authorize=function(r){var n;return n=t.resolve("importers-jira-authorize"),e.post(n,{oauth_verifier:r})},r.listProjects=function(r,n){var i;return i=t.resolve("importers-jira-list-projects"),e.post(i,{url:r,token:n}).then(function(t){return Immutable.fromJS(t.data)})},r.listUsers=function(r,n,i){var o;return o=t.resolve("importers-jira-list-users"),e.post(o,{url:r,token:n,project:i}).then(function(t){return Immutable.fromJS(t.data)})},r.importProject=function(r,n,i,o,s,a,c,u,l,p){var d,h,f;return f=t.resolve("importers-jira-import-project"),h="kanban","kanban"!==l&&(h="scrum"),d={url:r,token:n,name:i,description:o,project:s,users_bindings:a.toJS(),keep_external_reference:c,is_private:u,project_type:l,importer_type:p,template:h},e.post(f,d)},function(){return{jiraImporter:r}}}).$inject=["$tgUrls","$tgHttp"],(e=function(t,e){var r;return(r={}).getAuthUrl=function(r){var n;return n=t.resolve("importers-github-auth-url")+"?uri="+r,e.get(n)},r.authorize=function(r){var n;return n=t.resolve("importers-github-authorize"),e.post(n,{code:r})},r.listProjects=function(r){var n;return n=t.resolve("importers-github-list-projects"),e.post(n,{token:r}).then(function(t){return Immutable.fromJS(t.data)})},r.listUsers=function(r,n){var i;return i=t.resolve("importers-github-list-users"),e.post(i,{token:r,project:n}).then(function(t){return Immutable.fromJS(t.data)})},r.importProject=function(r,n,i,o,s,a,c,u){var l,p;return p=t.resolve("importers-github-import-project"),l={token:r,name:n,description:i,project:o,users_bindings:s.toJS(),keep_external_reference:a,is_private:c,template:u},e.post(p,l)},function(){return{githubImporter:r}}}).$inject=["$tgUrls","$tgHttp"],(t=function(t,e){var r;return(r={}).getAuthUrl=function(){var r;return r=t.resolve("importers-asana-auth-url"),e.get(r)},r.authorize=function(r){var n;return n=t.resolve("importers-asana-authorize"),e.post(n,{code:r})},r.listProjects=function(r){var n;return n=t.resolve("importers-asana-list-projects"),e.post(n,{token:r}).then(function(t){return Immutable.fromJS(t.data)})},r.listUsers=function(r,n){var i;return i=t.resolve("importers-asana-list-users"),e.post(i,{token:r,project:n}).then(function(t){return Immutable.fromJS(t.data)})},r.importProject=function(r,n,i,o,s,a,c,u){var l,p;return p=t.resolve("importers-asana-import-project"),l={token:r,name:n,description:i,project:o,users_bindings:s.toJS(),keep_external_reference:a,is_private:c,template:u},e.post(p,l)},function(){return{asanaImporter:r}}}).$inject=["$tgUrls","$tgHttp"],(i=angular.module("taigaResources2")).factory("tgTrelloImportResource",n),i.factory("tgJiraImportResource",r),i.factory("tgGithubImportResource",e),i.factory("tgAsanaImportResource",t)}.call(this),function(){var t;(t=function(t,e){var r;return(r={}).listInAllProjects=function(r){var n,i;return i=t.resolve("issues"),n={headers:{"x-disable-pagination":"1"}},e.get(i,r,n).then(function(t){return Immutable.fromJS(t.data)})},function(){return{issues:r}}}).$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgIssuesResource",t)}.call(this),function(){var t;(t=function(t,e,r){var n;return(n={}).create=function(r){var n;return n=t.resolve("projects"),e.post(n,JSON.stringify(r)).then(function(t){return Immutable.fromJS(t.data)})},n.duplicate=function(r,n){var i,o,s;return s=(s=t.resolve("projects"))+"/"+r+"/duplicate",i=n.users.map(function(t){return{id:t}}),o={name:n.name,description:n.description,is_private:n.is_private,users:i},e.post(s,o)},n.getProjects=function(r,n){var i,o;return null==r&&(r={}),null==n&&(n=!0),o=t.resolve("projects"),i={},n||(i={headers:{"x-lazy-pagination":!0}}),e.get(o,r,i)},n.getProjectBySlug=function(r){var n;return n=(n=t.resolve("projects"))+"/by_slug?slug="+r,e.get(n).then(function(t){return Immutable.fromJS(t.data)})},n.getProjectsByUserId=function(r,n){var i,o,s;return null==n&&(n=!1),s=t.resolve("projects"),i={},n||(i.headers={"x-disable-pagination":"1"}),o={member:r,order_by:"user_order"},e.get(s,o,i).then(function(t){return Immutable.fromJS(t.data)})},n.getListProjectsByUserId=function(r,n){var i,o,s;return null==n&&(n=!1),s=t.resolve("projects"),i={},n||(i.headers={"x-disable-pagination":"1"}),o={member:r,order_by:"user_order",slight:!0},e.get(s,o,i).then(function(t){return Immutable.fromJS(t.data)})},n.getProjectStats=function(r){var n;return n=(n=t.resolve("projects"))+"/"+r,e.get(n).then(function(t){return Immutable.fromJS(t.data)})},n.bulkUpdateOrder=function(r){var n;return n=t.resolve("bulk-update-projects-order"),e.post(n,r)},n.getTimeline=function(n,i){var o,s;return o={page:i,only_relevant:!0},s=(s=t.resolve("timeline-project"))+"/"+n,e.get(s,o,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},n.likeProject=function(r){var n;return n=t.resolve("project-like",r),e.post(n)},n.unlikeProject=function(r){var n;return n=t.resolve("project-unlike",r),e.post(n)},n.watchProject=function(r,n){var i,o;return i={notify_level:n,live_notify_level:n},o=t.resolve("project-watch",r),e.post(o,i)},n.unwatchProject=function(r){var n;return n=t.resolve("project-unwatch",r),e.post(n)},n.contactProject=function(r,n){var i,o;return i={project:r,comment:n},o=t.resolve("project-contact"),e.post(o,i)},n.transferValidateToken=function(r,n){var i,o;return i={token:n},o=t.resolve("project-transfer-validate-token",r),e.post(o,i)},n.transferAccept=function(r,n,i){var o,s;return o={token:n,reason:i},s=t.resolve("project-transfer-accept",r),e.post(s,o)},n.transferReject=function(r,n,i){var o,s;return o={token:n,reason:i},s=t.resolve("project-transfer-reject",r),e.post(s,o)},n.transferRequest=function(r){var n;return n=t.resolve("project-transfer-request",r),e.post(n)},n.transferStart=function(r,n,i){var o,s;return o={user:n,reason:i},s=t.resolve("project-transfer-start",r),e.post(s,o)},function(){return{projects:n}}}).$inject=["$tgUrls","$tgHttp","tgPaginateResponseService"],angular.module("taigaResources2").factory("tgProjectsResources",t)}.call(this),function(){var t,e;e=["tgProjectsResources","tgUserResources","tgUsersResources","tgUserstoriesResource","tgTasksResource","tgIssuesResource","tgExternalAppsResource","tgAttachmentsResource","tgStatsResource","tgHistory","tgEpicsResource","tgTrelloImportResource","tgJiraImportResource","tgGithubImportResource","tgAsanaImportResource"],(t=function(t){var r,n,i,o,s,a,c,u,l;for(r=0,i=e.length;r<i;r++)for(u=e[r],c=t.get(u),a=t.invoke(c),n=0,o=(s=Object.keys(a)).length;n<o;n++)this[l=s[n]]&&console.warn("repeated resource "+l),this[l]=a[l];return this}).$inject=["$injector"],angular.module("taigaResources2").service("tgResources",t)}.call(this),function(){var t;(t=function(t,e){var r;return(r={}).discover=function(r,n){var i;return i=t.resolve("stats-discover"),e.get(i).then(function(t){return Immutable.fromJS(t.data)})},function(){return{stats:r}}}).$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgStatsResource",t)}.call(this),function(){var t;(t=function(t,e){var r;return(r={}).listInAllProjects=function(r){var n,i;return i=t.resolve("tasks"),n={headers:{"x-disable-pagination":"1"}},e.get(i,r,n).then(function(t){return Immutable.fromJS(t.data)})},function(){return{tasks:r}}}).$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgTasksResource",t)}.call(this),function(){var t;(t=function(t,e,r){var n;return(n={}).getUserStorage=function(r){var n;return n=t.resolve("user-storage"),r&&(n+="/"+r),{},e.get(n,{}).then(function(t){return t.data.value})},n.setUserStorage=function(r,n){var i,o;return o=t.resolve("user-storage")+"/"+r,i={key:r,value:n},e.put(o,i)},n.createUserStorage=function(r,n){var i,o;return o=t.resolve("user-storage"),i={key:r,value:n},e.post(o,i)},function(){return{user:n}}}).$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgUserResources",t)}.call(this),function(){var t;(t=function(t,e,r){var n;return(n={}).getUserByUsername=function(r){var n,i,o;return o=t.resolve("by_username"),n={headers:{"x-disable-pagination":"1"}},i={username:r},e.get(o,i,n).then(function(t){return Immutable.fromJS(t.data)})},n.getStats=function(r){var n,i;return i=t.resolve("user-stats",r),n={headers:{"x-disable-pagination":"1"}},e.get(i,{},n).then(function(t){return Immutable.fromJS(t.data)})},n.getContacts=function(r,n){var i,o,s;return s=t.resolve("user-contacts",r),o={},null!=n&&(o.exclude_project=n),i={headers:{"x-disable-pagination":"1"}},e.get(s,o,i).then(function(t){return Immutable.fromJS(t.data)})},n.getLiked=function(n,i,o,s){var a,c;return c=t.resolve("user-liked",n),a={},null!=i&&(a.page=i),null!=o&&(a.type=o),null!=s&&(a.q=s),a.only_relevant=!0,e.get(c,a,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},n.getVoted=function(n,i,o,s){var a,c;return c=t.resolve("user-voted",n),a={},null!=i&&(a.page=i),null!=o&&(a.type=o),null!=s&&(a.q=s),e.get(c,a,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},n.getWatched=function(n,i,o,s){var a,c;return c=t.resolve("user-watched",n),a={},null!=i&&(a.page=i),null!=o&&(a.type=o),null!=s&&(a.q=s),e.get(c,a,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},n.getProfileTimeline=function(n,i){var o,s;return o={page:i},s=(s=t.resolve("timeline-profile"))+"/"+n,e.get(s,o,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},n.getUserTimeline=function(n,i){var o,s;return o={page:i,only_relevant:!0},s=(s=t.resolve("timeline-user"))+"/"+n,e.get(s,o,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},n.getNotifications=function(r,n,i){var o,s;return o={page:n},i&&(o.only_unread=!0),s=t.resolve("notifications"),e.get(s,o,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),Immutable.Map({data:t.get("data").get("objects"),next:!!t.get("headers")("x-pagination-next"),prev:!!t.get("headers")("x-pagination-prev"),current:t.get("headers")("x-pagination-current"),count:t.get("headers")("x-pagination-count"),total:t.get("data").get("total")})})},n.setNotificationAsRead=function(r){var n;return n=t.resolve("notifications")+"/"+r+"/set-as-read",e.patch(n).then(function(t){return t})},n.setNotificationsAsRead=function(){var r;return r=t.resolve("notifications")+"/set-as-read",e.post(r).then(function(t){return t})},function(){return{users:n}}}).$inject=["$tgUrls","$tgHttp","tgPaginateResponseService"],angular.module("taigaResources2").factory("tgUsersResources",t)}.call(this),function(){var t;(t=function(t,e){var r;return(r={}).listInAllProjects=function(r,n){var i,o;return null==n&&(n=!1),o=t.resolve("userstories"),n||(i={headers:{"x-disable-pagination":"1"}}),e.get(o,r,i).then(function(t){return Immutable.fromJS(t.data)})},r.listAllInProject=function(r){var n,i,o;return o=t.resolve("userstories"),n={headers:{"x-disable-pagination":"1"}},i={project:r},e.get(o,i,n).then(function(t){return Immutable.fromJS(t.data)})},r.listInEpic=function(r){var n,i,o;return o=t.resolve("userstories"),n={headers:{"x-disable-pagination":"1"}},i={epic:r,order_by:"epic_order",include_tasks:!0},e.get(o,i,n).then(function(t){return Immutable.fromJS(t.data)})},function(){return{userstories:r}}}).$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgUserstoriesResource",t)}.call(this),function(){var t,e,r;e=this.taiga,r=e.truncate,t=function(){function t(t){this.rootScope=t}return t.$inject=["$rootScope"],t.prototype._set=function(t,e){var r;if(t)return"title"===t?(0===(r=$("head title")).length&&(r=$("<title></title>"),$("head").append(r)),r.text(e||"")):0===t.indexOf("og:")?(0===(r=$("head meta[property='"+t+"']")).length&&(r=$("<meta property='"+t+"'/>"),$("head").append(r)),r.attr("content",e||"")):(0===(r=$("head meta[name='"+t+"']")).length&&(r=$("<meta name='"+t+"'/>"),$("head").append(r)),r.attr("content",e||""))},t.prototype.setTitle=function(t){return this._set("title",t)},t.prototype.setDescription=function(t){return this._set("description",r(t,250))},t.prototype.setTwitterMetas=function(t,e){return this._set("twitter:card","summary"),this._set("twitter:site","@taigaio"),this._set("twitter:title",t),this._set("twitter:description",r(e,300)),this._set("twitter:image",window.location.origin+"/"+window._version+"/images/logo-color.png")},t.prototype.setOpenGraphMetas=function(t,e){return this._set("og:type","object"),this._set("og:site_name","Taiga - Love your projects"),this._set("og:title",t),this._set("og:description",r(e,300)),this._set("og:image",window.location.origin+"/"+window._version+"/images/logo-color.png"),this._set("og:url",window.location.href)},t.prototype.setAll=function(t,e){return this.setTitle(t),this.setDescription(e),this.setTwitterMetas(t,e),this.setOpenGraphMetas(t,e)},t.prototype.addMobileViewport=function(){return $("head").append('<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">')},t.prototype.removeMobileViewport=function(){return $('head meta[name="viewport"]').remove()},t.prototype.setfn=function(t){return this.listener&&this._listener(),this._listener=this.rootScope.$watchCollection(t,(e=this,function(t){if(t)return e.setAll(t.title,t.description),e._listener()}));var e},t}(),angular.module("taigaCommon").service("tgAppMetaService",t)}.call(this),function(){var t,e;e=this.taiga.sizeFormat,t=function(){function t(t,r,n,i){this.confirm=t,this.config=r,this.translate=n,this.rs=i,this.maxFileSize=this.getMaxFileSize(),this.maxFileSize&&(this.maxFileSizeFormated=e(this.maxFileSize))}return t.$inject=["$tgConfirm","$tgConfig","$translate","tgResources"],t.prototype.sizeError=function(t){var r;return r=this.translate.instant("ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED",{fileName:t.name,fileSize:e(t.size),maxFileSize:this.maxFileSizeFormated}),this.confirm.notify("error",r)},t.prototype.validate=function(t){return!(this.maxFileSize&&t.size>this.maxFileSize)||(this.sizeError(t),!1)},t.prototype.getMaxFileSize=function(){return this.config.get("maxUploadFileSize",null)},t.prototype.list=function(t,e,r){return this.rs.attachments.list(t,e,r).then(function(t){return t.sortBy(function(t){return t.get("order")})})},t.prototype.delete=function(t,e){return this.rs.attachments.delete(t,e)},t.prototype.saveError=function(t,e){var r;return r="",t&&(r=this.translate.instant("ATTACHMENT.ERROR_UPLOAD_ATTACHMENT",{fileName:t.name,errorMessage:e.data._error_message})),this.confirm.notify("error",r)},t.prototype.upload=function(t,e,r,n,i){var o;return null==i&&(i=!1),(o=this.rs.attachments.create(n,r,e,t,i)).then(null,this.saveError.bind(this,t)),o},t.prototype.patch=function(t,e,r){var n;return(n=this.rs.attachments.patch(e,t,r)).then(null,this.saveError.bind(this,null)),n},t}(),angular.module("taigaCommon").service("tgAttachmentsService",t)}.call(this),function(){var t;t=function(){function t(t){var e,r;this.config=t,r=["/"+window._version+"/images/user-avatars/user-avatar-01.png","/"+window._version+"/images/user-avatars/user-avatar-02.png","/"+window._version+"/images/user-avatars/user-avatar-03.png","/"+window._version+"/images/user-avatars/user-avatar-04.png","/"+window._version+"/images/user-avatars/user-avatar-05.png"],e=["rgba( 178, 176, 204, 1 )","rgba( 183, 203, 131, 1 )","rgba( 210, 198, 139, 1 )","rgba( 214, 161, 212, 1 )","rgba( 247, 154, 154, 1 )"],this.logos=_.cartesianProduct(r,e)}return t.prototype.getDefault=function(t){var e,r,n,i;return n=murmurhash3_32_gc(t,42),i=this.logos.length,e=(+n%(i=+i)+i)%i,{src:(r=this.logos[e])[0],color:r[1]}},t.prototype.getUnnamed=function(){return{url:"/"+window._version+"/images/unnamed.png",username:""}},t.prototype.getAvatar=function(t,e){var r,n,i,o,s,a;return t?(r="photo","avatarBig"===e&&(r="big_photo"),o=null,t instanceof Immutable.Map?(n=t.get("gravatar_id"),o=t.get(r),a="@"+t.get("username")):(n=t.gravatar_id,o=t[r],a="@"+t.username),n?o?{url:o,username:a}:-1===location.host.indexOf("localhost")&&this.config.get("gravatar",!0)?(s=location.protocol+"//"+location.host,i=this.getDefault(n),{url:"https://www.gravatar.com/avatar/"+n+"?s=200&d="+encodeURIComponent(s+i.src),bg:i.color,username:a}):{url:(s=location.protocol+"//"+location.host)+(i=this.getDefault(n)).src,bg:i.color,username:a}:this.getUnnamed()):this.getUnnamed()},t}(),angular.module("taigaCommon").service("tgAvatarService",["$tgConfig",t])}.call(this),function(){var t;this.taiga,t=function(){function t(t){this.projectService=t}return t.$inject=["tgProjectService"],t.prototype.check=function(t){return!!this.projectService.project&&-1!==this.projectService.project.get("my_permissions").indexOf(t)},t}(),angular.module("taigaCommon").service("tgCheckPermissionsService",t)}.call(this),function(){var t,e,r;r=this.taiga,e=this.taiga.groupBy,t=function(){function t(t,e,n){var i;this.projectsService=t,this.storageService=e,this.rs=n,this._user=null,this._projects=Immutable.Map(),this._projectsById=Immutable.Map(),this._joyride=null,r.defineImmutableProperty(this,"projects",(i=this,function(){return i._projects})),r.defineImmutableProperty(this,"projectsById",function(t){return function(){return t._projectsById}}(this))}return t.$inject=["tgProjectsService","$tgStorage","tgResources"],t.prototype.isAuthenticated=function(){return null!==this.getUser()},t.prototype.getUser=function(){var t;return this._user||(t=this.storageService.get("userInfo"))&&(t=Immutable.fromJS(t),this.setUser(t)),this._user},t.prototype.removeUser=function(){return this._user=null,this._projects=Immutable.Map(),this._projectsById=Immutable.Map(),this._joyride=null},t.prototype.setUser=function(t){return this._user=t,this._loadUserInfo()},t.prototype.bulkUpdateProjectsOrder=function(t){return this.projectsService.bulkUpdateProjectsOrder(t).then((e=this,function(){return e.loadProjects()}));var e},t.prototype.loadProjects=function(){return this.projectsService.getProjectsByUserId(this._user.get("id")).then((t=this,function(e){return t.setProjects(e)}));var t},t.prototype.loadProjectsList=function(){return this.projectsService.getListProjectsByUserId(this._user.get("id"),null).then((t=this,function(e){return t.setProjects(e)}));var t},t.prototype.disableJoyRide=function(t){if(this.isAuthenticated())return t?this._joyride[t]=!1:this._joyride={backlog:!1,kanban:!1,dashboard:!1},this.rs.user.setUserStorage("joyride",this._joyride)},t.prototype.loadJoyRideConfig=function(){return new Promise((t=this,function(e){if(null===t._joyride)return t.rs.user.getUserStorage("joyride").then(function(r){return t._joyride=r,e(t._joyride)}).catch(function(){return t._joyride={backlog:!0,kanban:!0,dashboard:!0},t.rs.user.createUserStorage("joyride",t._joyride),e(t._joyride)});e(t._joyride)}));var t},t.prototype._loadUserInfo=function(){return Promise.all([this.loadProjectsList()])},t.prototype.setProjects=function(t){return this._projects=this._projects.set("all",t),this._projects=this._projects.set("recents",t.slice(0,10)),this._projects=this._projects.set("unblocked",t.filter(function(t){return null===t.toJS().blocked_code})),this._projectsById=Immutable.fromJS(e(t.toJS(),function(t){return t.id})),this.projects},t.prototype.canCreatePrivateProjects=function(){var t;return null!==(t=this.getUser()).get("max_private_projects")&&t.get("total_private_projects")>=t.get("max_private_projects")?{valid:!1,reason:"max_private_projects",type:"private_project",current:t.get("total_private_projects"),max:t.get("max_private_projects")}:{valid:!0}},t.prototype.canCreatePublicProjects=function(){var t;return null!==(t=this.getUser()).get("max_public_projects")&&t.get("total_public_projects")>=t.get("max_public_projects")?{valid:!1,reason:"max_public_projects",type:"public_project",current:t.get("total_public_projects"),max:t.get("max_public_projects")}:{valid:!0}},t.prototype.canAddMembersPublicProject=function(t){var e;return null!==(e=this.getUser()).get("max_memberships_public_projects")&&t>e.get("max_memberships_public_projects")?{valid:!1,reason:"max_members_public_projects",type:"public_project",current:t,max:e.get("max_memberships_public_projects")}:{valid:!0}},t.prototype.canAddMembersPrivateProject=function(t){var e;return null!==(e=this.getUser()).get("max_memberships_private_projects")&&t>e.get("max_memberships_private_projects")?{valid:!1,reason:"max_members_private_projects",type:"private_project",current:t,max:e.get("max_memberships_private_projects")}:{valid:!0}},t.prototype.canOwnProject=function(t){var e,r;if(this.getUser(),t.get("is_private")){if(!(r=this.canCreatePrivateProjects()).valid)return r;if(!(e=this.canAddMembersPrivateProject(t.get("total_memberships"))).valid)return e}else{if(!(r=this.canCreatePublicProjects()).valid)return r;if(!(e=this.canAddMembersPublicProject(t.get("total_memberships"))).valid)return e}return{valid:!0}},t}(),angular.module("taigaCommon").service("tgCurrentUserService",t)}.call(this),function(){var t;this.taiga,t=function(){function t(t){this.rootScope=t}return t.$inject=["$rootScope"],t.prototype.init=function(){return this.rootScope.errorHandling={}},t.prototype.notfound=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.notfound=!0},t.prototype.error=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.error=!0},t.prototype.permissionDenied=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.permissionDenied=!0},t.prototype.block=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.blocked=!0},t}(),angular.module("taigaCommon").service("tgErrorHandlingService",t)}.call(this),function(){var t;t=function(){function t(t,e){this.rootScope=t,this.compile=e}return t.$inject=["$rootScope","$compile"],t.prototype.create=function(t,e,r){var n,i,o;o=this.rootScope.$new(),o=_.merge(o,r),n=$("<div>").attr(t,!0).attr("tg-bind-scope",!0),e&&n.attr(e),n.addClass("remove-on-close"),i=this.compile(n)(o),$(document.body).append(i)},t}(),angular.module("taigaCommon").service("tgLightboxFactory",t)}.call(this),function(){var t;t=function(){return function(t){return Immutable.Map({data:t.get("data"),next:!!t.get("headers")("x-pagination-next"),prev:!!t.get("headers")("x-pagination-prev"),current:t.get("headers")("x-pagination-current"),count:t.get("headers")("x-pagination-count")})}},angular.module("taigaCommon").factory("tgPaginateResponseService",t)}.call(this),function(){var t;t=function(){function t(){var t,e;e=["/"+window._version+"/images/project-logos/project-logo-01.png","/"+window._version+"/images/project-logos/project-logo-02.png","/"+window._version+"/images/project-logos/project-logo-03.png","/"+window._version+"/images/project-logos/project-logo-04.png","/"+window._version+"/images/project-logos/project-logo-05.png"],t=["rgba( 153,  214, 220, 1 )","rgba( 213,  156,  156, 1 )","rgba( 214, 161, 212,  1 )","rgba( 164, 162, 219, 1 )","rgba( 152, 224, 168,  1 )"],this.logos=_.cartesianProduct(e,t)}return t.prototype.getDefaultProjectLogo=function(t,e){var r,n,i,o;return i=murmurhash3_32_gc(t+"-"+e,42),o=this.logos.length,r=(+i%(o=+o)+o)%o,{src:(n=this.logos[r])[0],color:n[1]}},t}(),angular.module("taigaCommon").service("tgProjectLogoService",t)}.call(this),function(){var t,e,r=function(t,e){return function(){return t.apply(e,arguments)}};e=this.taiga,t=function(){function t(t,n,i,o,s){var a;this.rootScope=t,this.projectsService=n,this.xhrError=i,this.userActivityService=o,this.interval=s,this.manageProjectSignal=r(this.manageProjectSignal,this),this._project=null,this._section=null,this._sectionsBreadcrumb=Immutable.List(),this._activeMembers=Immutable.List(),e.defineImmutableProperty(this,"project",(a=this,function(){return a._project})),e.defineImmutableProperty(this,"section",function(t){return function(){return t._section}}(this)),e.defineImmutableProperty(this,"sectionsBreadcrumb",function(t){return function(){return t._sectionsBreadcrumb}}(this)),e.defineImmutableProperty(this,"activeMembers",function(t){return function(){return t._activeMembers}}(this)),window.localStorage.e2e||this.autoRefresh(),this.watchSignals()}return t.$inject=["$rootScope","tgProjectsService","tgXhrErrorService","tgUserActivityService","$interval"],t.prototype.watchSignals=function(){var t,e,r,n,i;for(n=[],e=0,r=(t=["admin:project-modules:updated","admin:project-roles:updated","admin:project-default-values:updated","admin:project-values:updated","admin:project-values:move","admin:project-custom-attributes:updated","sprintform:create:success","sprintform:edit:success","sprintform:remove:success","tags:updated"]).length;e<r;e++)i=t[e],n.push(this.rootScope.$on(i,this.manageProjectSignal));return n},t.prototype.manageProjectSignal=function(t){return this.fetchProject()},t.prototype.cleanProject=function(){return this._project=null,this._activeMembers=Immutable.List(),this._section=null,this._sectionsBreadcrumb=Immutable.List()},t.prototype.autoRefresh=function(){var t,e;return t=this.interval((e=this,function(){return e.fetchProject()}),6e5),this.userActivityService.onInactive(function(e){return function(){return e.interval.cancel(t)}}(this)),this.userActivityService.onActive(function(t){return function(){return t.fetchProject(),t.autoRefresh()}}(this))},t.prototype.setSection=function(t){return this._section=t,this._sectionsBreadcrumb=t?this._sectionsBreadcrumb.push(this._section):Immutable.List()},t.prototype.setProject=function(t){return this._project=t,this._activeMembers=this._project.get("members").filter(function(t){return t.get("is_active")})},t.prototype.setProjectBySlug=function(t){return new Promise((e=this,function(r,n){return e.project&&e.project.get("slug")===t?r():e.projectsService.getProjectBySlug(t).then(function(t){return e.setProject(t),r()}).catch(function(t){return e.xhrError.response(t)})}));var e},t.prototype.fetchProject=function(){var t,e;if(this.project)return t=this.project.get("slug"),this.projectsService.getProjectBySlug(t).then((e=this,function(t){return e.setProject(t)}))},t.prototype.hasPermission=function(t){return-1!==this._project.get("my_permissions").indexOf(t)},t.prototype.isEpicsDashboardEnabled=function(){return this._project.get("is_epics_activated")},t}(),angular.module("taigaCommon").service("tgProjectService",t)}.call(this),function(){var t,e,r={}.hasOwnProperty;e=this.taiga,t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(n,e.Service=function(){return{use:function(t){var e;e=$("link[rel='stylesheet']:first");if(e.length===0){e=$("<link rel='stylesheet' href='' type='text/css'>");$("head").append(e)}return e.attr("href","/"+window._version+"/styles/theme-"+t+".css")}}}),n}(),angular.module("taigaCommon").service("tgThemeService",t)}.call(this),function(){var t;this.taiga,this.taiga.groupBy,t=function(){function t(t){if(this.timeout=t,window.localStorage.e2e)return null;window.addEventListener("mousemove",this.resetTimer.bind(this),!1),window.addEventListener("mousedown",this.resetTimer.bind(this),!1),window.addEventListener("keypress",this.resetTimer.bind(this),!1),window.addEventListener("mousewheel",this.resetTimer.bind(this),!1),window.addEventListener("touchmove",this.resetTimer.bind(this),!1),this.subscriptionsActive=[],this.subscriptionsInactive=[],this.isActive=!0,this.startTimer()}return t.$inject=["$timeout"],t.prototype.idleTimeout=3e5,t.prototype.startTimer=function(){return this.timerId=this.timeout(this._fireInactive.bind(this),this.idleTimeout)},t.prototype.resetTimer=function(){return this.isActive||this._fireActive(),this.timeout.cancel(this.timerId),this.startTimer(),this.isActive=!0},t.prototype.onActive=function(t){return this.subscriptionsActive.push(t),this._unSubscriptionsActive.bind(this,t)},t.prototype.onInactive=function(t){return this.subscriptionsInactive.push(t),this._unSubscriptionsInactive.bind(this,t)},t.prototype._fireActive=function(){return this.subscriptionsActive.forEach(function(t){return t()})},t.prototype._fireInactive=function(){return this.isActive=!1,this.subscriptionsInactive.forEach(function(t){return t()})},t.prototype._unSubscriptionsActive=function(t){return this.subscriptionsActive=this.subscriptionsActive.filter(function(e){return e!==t})},t.prototype._unSubscriptionsInactive=function(t){return this.subscriptionsInactive=this.subscriptionsInactive.filter(function(e){return e!==t})},t}(),angular.module("taigaCommon").service("tgUserActivityService",t)}.call(this),function(){var t,e;this.taiga,e=this.taiga.normalizeString,t=function(){function t(t,e){this.currentUserService=t,this.projectService=e}return t.$inject=["tgCurrentUserService","tgProjectService"],t.prototype.filterUsers=function(t,r){var n;return n=r.full_name_display.toUpperCase(),n=e(n),t=t.toUpperCase(),t=e(t),_.includes(n,t)},t.prototype.searchUsers=function(t,e){var r,n;return this.currentUser=this.currentUserService.getUser(),r=_.clone(this.projectService.activeMembers.toJS(),!0),e&&(r=_.reject(r,{id:e.id})),r=_.sortBy(r,(n=this,function(t){var e;return t.id===(null!=(e=n.currentUser)?e.get("id"):void 0)?0:t.id})),null!=t&&(r=_.filter(r,_.partial(this.filterUsers,t))),r},t}(),angular.module("taigaCommon").service("tgUserListService",t)}.call(this),function(){var t,e,r,n={}.hasOwnProperty;r=this.taiga,e=r.bindMethods,t=function(t){function i(t){this.rs=t,e(this)}return function(t,e){for(var r in e)n.call(e,r)&&(t[r]=e[r]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(i,r.Service),i.$inject=["tgResources"],i.prototype.getUserByUserName=function(t){return this.rs.users.getUserByUsername(t)},i.prototype.getContacts=function(t,e){return this.rs.users.getContacts(t,e)},i.prototype.getLiked=function(t,e,r,n){return this.rs.users.getLiked(t,e,r,n)},i.prototype.getVoted=function(t,e,r,n){return this.rs.users.getVoted(t,e,r,n)},i.prototype.getWatched=function(t,e,r,n){return this.rs.users.getWatched(t,e,r,n)},i.prototype.getStats=function(t){return this.rs.users.getStats(t)},i.prototype.attachUserContactsToProjects=function(t,e){return this.getContacts(t).then(function(t){return e=e.map(function(e){var r;return r=t.filter(function(t){var r;return r=t.get("id"),-1!==e.get("members").indexOf(r)}),e=e.set("contacts",r)})})},i}(),angular.module("taigaCommon").service("tgUserService",t)}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t){function r(t,e){this.q=t,this.errorHandlingService=e}return function(t,r){for(var n in r)e.call(r,n)&&(t[n]=r[n]);function i(){this.constructor=t}i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype}(r,taiga.Service),r.$inject=["$q","tgErrorHandlingService"],r.prototype.notFound=function(){return this.errorHandlingService.notfound()},r.prototype.permissionDenied=function(){return this.errorHandlingService.permissionDenied()},r.prototype.response=function(t){return t&&(404===t.status?this.notFound():403===t.status&&this.permissionDenied()),this.q.reject(t)},r}(),angular.module("taigaCommon").service("tgXhrErrorService",t)}.call(this),function(){var t;(t=function(t,e){var r,n;return n=[".jpg",".jpeg",".bmp",".gif",".png"],r=function(t){return t=t.toLowerCase(),_.some(n,function(e){return-1!==t.indexOf(e,t-e.length)})},{link:function(n,i){var o;return o=r(n.attachment.get("url"))?t.get("user-timeline/user-timeline-attachment/user-timeline-attachment-image.html"):t.get("user-timeline/user-timeline-attachment/user-timeline-attachment.html"),i.html(o),e(i.contents())(n),i.find("img").error(function(){return this.remove()})},scope:{attachment:"=tgUserTimelineAttachment"}}}).$inject=["$tgTemplate","$compile"],angular.module("taigaUserTimeline").directive("tgUserTimelineAttachment",t)}.call(this),function(){var t,e;e=this.taiga.unslugify,t=function(){function t(t,e){this.translate=t,this.sce=e}return t.$inject=["$translate","$sce"],t.prototype._fieldTranslationKey={status:"COMMON.FIELDS.STATUS",subject:"COMMON.FIELDS.SUBJECT",description_diff:"COMMON.FIELDS.DESCRIPTION",points:"COMMON.FIELDS.POINTS",assigned_to:"COMMON.FIELDS.ASSIGNED_TO",assigned_users:"COMMON.FIELDS.ASSIGNED_USERS",severity:"ISSUES.FIELDS.SEVERITY",priority:"ISSUES.FIELDS.PRIORITY",type:"ISSUES.FIELDS.TYPE",is_iocaine:"TASK.FIELDS.IS_IOCAINE",is_blocked:"COMMON.FIELDS.IS_BLOCKED",color:"COMMON.FIELDS.COLOR",due_date:"COMMON.FIELDS.DUE_DATE",due_date_reason:"COMMON.FIELDS.DUE_DATE_REASON",milestone:"COMMON.FIELDS.SPRINT"},t.prototype._params={username:function(t,e){var r,n,i;return(i=t.getIn(["data","user"])).get("is_profile_visible")?(r=this.translate.instant("COMMON.SEE_USER_PROFILE",{username:i.get("username")}),n="user-profile:username=timeline.getIn(['data', 'user', 'username'])",this._getLink(n,i.get("name"),r)):this._getUsernameSpan(i.get("name"))},field_name:function(t,e){var r;return r=t.getIn(["data","value_diff","key"]),this.translate.instant(this._fieldTranslationKey[r])},project_name:function(t,e){var r;return r="project:project=timeline.getIn(['data', 'project', 'slug'])",this._getLink(r,t.getIn(["data","project","name"]))},new_value:function(t,e){var r,n,i;return _.isArray(t.getIn(["data","value_diff","value"]).toJS())?(null===(i=t.getIn(["data","value_diff","value"]).get(1))&&"assigned_to"===t.getIn(["data","value_diff","key"])&&(i=this.translate.instant("ACTIVITY.VALUES.UNASSIGNED")),null===i&&"assigned_users"===t.getIn(["data","value_diff","key"])?i=this.translate.instant("ACTIVITY.VALUES.UNASSIGNED"):"due_date"===t.getIn(["data","value_diff","key"])&&(i?(n=this.translate.instant("COMMON.PICKERDATE.FORMAT"),i=moment(i,"YYYY-MM-DD").format(n)):i=this.translate.instant("ACTIVITY.VALUES.NOT_SET")),r=i):r=t.getIn(["data","value_diff","value"]).first().get(1),$("<span>").attr("ng-non-bindable",!0).text(r).prop("outerHTML")},sprint_name:function(t,e){var r;return r="project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])",this._getLink(r,t.getIn(["data","milestone","name"]))},us_name:function(t,e){var r,n,i,o;return n=this._getTimelineObj(t,e).get("userstory"),r={obj:"parent_userstory"},o=this._getDetailObjUrl(r),i="#"+n.get("ref")+" "+n.get("subject"),this._getLink(o,i)},related_us_name:function(t,e){var r,n,i;return i="project-userstories-detail:project=timeline.getIn(['data', 'userstory', 'project', 'slug']),ref=timeline.getIn(['data', 'userstory', 'ref'])",n="#"+(r=t.getIn(["data","userstory"])).get("ref")+" "+r.get("subject"),this._getLink(i,n)},epic_name:function(t,e){var r,n,i;return i="project-epics-detail:project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['data', 'epic', 'ref'])",n="#"+(r=t.getIn(["data","epic"])).get("ref")+" "+r.get("subject"),this._getLink(i,n)},obj_name:function(t,r){var n,i,o;return n=this._getTimelineObj(t,r),o=this._getDetailObjUrl(r),i="wikipage"===r.obj?e(n.get("slug")):"milestone"===r.obj?n.get("name"):"#"+n.get("ref")+" "+n.get("subject"),this._getLink(o,i)},role_name:function(t,e){return _.escape(t.getIn(["data","value_diff","value"]).keySeq().first())}},t.prototype._translateTitleParams=function(t,e,r){return this._params[t].call(this,e,r)},t.prototype._getTimelineObj=function(t,e){return t.getIn(["data",e.obj])},t.prototype._getDetailObjUrl=function(t){var e;return(e={issue:["project-issues-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],wikipage:["project-wiki-page",":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])"],task:["project-tasks-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],userstory:["project-userstories-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],parent_userstory:["project-userstories-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])"],milestone:["project-taskboard",":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])"],epic:["project-epics-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"]})[t.obj][0]+e[t.obj][1]},t.prototype._getLink=function(t,e,r){var n;return r=r||e,n=$("<span>").attr("ng-non-bindable",!0).text(e),$("<a>").attr("tg-nav",t).append(n).prop("outerHTML")},t.prototype._getUsernameSpan=function(t){var e;return e=e||t,$("<span>").addClass("username").text(t).prop("outerHTML")},t.prototype._getParams=function(t,e,r){var n,i;return n={},r.translate_params.forEach((i=this,function(r){return n[r]=i._translateTitleParams(r,t,e)})),n},t.prototype.getTitle=function(t,e,r){var n,i,o;return n=this._getParams(t,e,r),i={},Object.keys(n).forEach(function(t){return i[t]="{{"+t+"}}"}),o=this.translate.instant(r.key,i),Object.keys(n).forEach(function(t){var e;return e="{{"+t+"}}",o=o.replace(new RegExp(e,"g"),n[t])}),o},t}(),angular.module("taigaUserTimeline").service("tgUserTimelineItemTitle",t)}.call(this),function(){var t,e;e=function(t,e){var r;return r=[{check:function(t,e){return"membership"===e.obj},key:"TIMELINE.NEW_MEMBER",translate_params:["project_name"],member:function(t){return Immutable.Map({user:t.getIn(["data","user"]),role:t.getIn(["data","role"])})}},{check:function(t,e){return"project"===e.obj&&"create"===e.type},key:"TIMELINE.NEW_PROJECT",translate_params:["username","project_name"],description:function(t){return t.getIn(["data","project","description"])}},{check:function(t,e){return"change"===e.type&&t.hasIn(["data","value_diff"])&&"attachments"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.UPLOAD_ATTACHMENT",translate_params:["username","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"create"===e.type},key:"TIMELINE.US_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"issue"===e.obj&&"create"===e.type},key:"TIMELINE.ISSUE_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"wikipage"===e.obj&&"create"===e.type},key:"TIMELINE.WIKI_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"create"===e.type&&!t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"create"===e.type&&t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_CREATED_WITH_US",translate_params:["username","project_name","obj_name","us_name"]},{check:function(t,e){return"milestone"===e.obj&&"create"===e.type},key:"TIMELINE.MILESTONE_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"epic"===e.obj&&"create"===e.type},key:"TIMELINE.EPIC_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"relateduserstory"===e.obj&&"create"===e.type},key:"TIMELINE.EPIC_RELATED_USERSTORY_CREATED",translate_params:["username","project_name","related_us_name","epic_name"]},{check:function(t,e){return t.getIn(["data","comment"])&&"userstory"===e.obj},key:"TIMELINE.NEW_COMMENT_US",translate_params:["username","obj_name"],description:function(t){var e;return e=t.getIn(["data","comment_html"]),$($.parseHTML(e)).text()}},{check:function(t,e){return t.getIn(["data","comment"])&&"issue"===e.obj},key:"TIMELINE.NEW_COMMENT_ISSUE",translate_params:["username","obj_name"],description:function(t){var e;return e=t.getIn(["data","comment_html"]),$($.parseHTML(e)).text()}},{check:function(t,e){return t.getIn(["data","comment"])&&"task"===e.obj},key:"TIMELINE.NEW_COMMENT_TASK",translate_params:["username","obj_name"],description:function(t){var e;return e=t.getIn(["data","comment_html"]),$($.parseHTML(e)).text()}},{check:function(t,e){return t.getIn(["data","comment"])&&"epic"===e.obj},key:"TIMELINE.NEW_COMMENT_EPIC",translate_params:["username","obj_name"],description:function(t){var e;return e=t.getIn(["data","comment_html"]),$($.parseHTML(e)).text()}},{check:function(t,e){return t.hasIn(["data","value_diff"])&&"moveInBacklog"===t.getIn(["data","value_diff","key"])&&t.hasIn(["data","value_diff","value","backlog_order"])&&"change"===e.type},key:"TIMELINE.US_MOVED",translate_params:["username","obj_name"]},{check:function(t,e){return!(!t.hasIn(["data","value_diff"])||"moveInBacklog"!==t.getIn(["data","value_diff","key"])||"change"!==e.type||"userstory"!==e.obj)&&null===t.getIn(["data","value_diff","value","milestone"]).get(1)},key:"TIMELINE.US_REMOVED_FROM_MILESTONE",translate_params:["username","obj_name"]},{check:function(t,e){return t.hasIn(["data","value_diff"])&&"moveInBacklog"===t.getIn(["data","value_diff","key"])&&"change"===e.type&&"userstory"===e.obj},key:"TIMELINE.US_ADDED_MILESTONE",translate_params:["username","obj_name","sprint_name"]},{check:function(t,e){return!(!t.hasIn(["data","value_diff"])||"blocked"!==t.getIn(["data","value_diff","key"])||"change"!==e.type)&&!0===t.getIn(["data","value_diff","value","is_blocked"]).get(1)},key:"TIMELINE.BLOCKED",translate_params:["username","obj_name"],description:function(t){var e;return!!t.hasIn(["data","value_diff","value","blocked_note_html"])&&(e=t.getIn(["data","value_diff","value","blocked_note_html"]).get(1),$($.parseHTML(e)).text())}},{check:function(t,e){return!(!t.hasIn(["data","value_diff"])||"blocked"!==t.getIn(["data","value_diff","key"])||"change"!==e.type)&&!1===t.getIn(["data","value_diff","value","is_blocked"]).get(1)},key:"TIMELINE.UNBLOCKED",translate_params:["username","obj_name"]},{check:function(t,e){return"milestone"===e.obj&&"change"===e.type},key:"TIMELINE.MILESTONE_UPDATED",translate_params:["username","obj_name"]},{check:function(t,e){return"wikipage"===e.obj&&"change"===e.type},key:"TIMELINE.WIKI_UPDATED",translate_params:["username","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"points"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.US_UPDATED_POINTS",translate_params:["username","field_name","obj_name","new_value","role_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.US_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type},key:"TIMELINE.US_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"issue"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.ISSUE_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"issue"===e.obj&&"change"===e.type},key:"TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&!t.getIn(["data","task","userstory"])&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.TASK_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&t.getIn(["data","task","userstory"])&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.TASK_UPDATED_WITH_US",translate_params:["username","field_name","obj_name","us_name"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&!t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE",translate_params:["username","field_name","obj_name","us_name","new_value"]},{check:function(t,e){return"epic"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.EPIC_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"epic"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"color"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.EPIC_UPDATED_WITH_NEW_COLOR",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"epic"===e.obj&&"change"===e.type},key:"TIMELINE.EPIC_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"user"===e.obj&&"create"===e.type},key:"TIMELINE.NEW_USER",translate_params:["username"]}],_.find(r,function(r){return r.check(t,e)})},t=function(){function t(){}return t.prototype.getType=function(t,r){return e(t,r)},t}(),angular.module("taigaUserTimeline").service("tgUserTimelineItemType",t)}.call(this),function(){var t;t=function(){return{templateUrl:"user-timeline/user-timeline-item/user-timeline-item.html",scope:{timeline:"=tgUserTimelineItem"}}},angular.module("taigaUserTimeline").directive("tgUserTimelineItem",t)}.call(this),function(){var t;t=function(){var t;return(t={}).generate=function(t){var e,r,n,i;return i=1,r=Immutable.List(),t.minItems=t.minItems||20,n=function(){return r=Immutable.List(),e()},e=function(){return t.fetch(i).then(function(n){var o;return i++,o=n.get("data"),t.filter&&(o=t.filter(o)),t.map&&(o=o.map(t.map)),(r=r.concat(o)).size<t.minItems&&n.get("next")?e():Immutable.Map({items:r,total:n.get("total"),next:n.get("next")})})},{next:function(){return n()}}},t},angular.module("taigaUserTimeline").factory("tgUserTimelinePaginationSequenceService",t)}.call(this),function(){var t,e,r,n={}.hasOwnProperty;r=this.taiga,e=this.taiga.mixOf,t=function(t){function i(t){this.userTimelineService=t,this.timelineList=Immutable.List(),this.scrollDisabled=!1,this.timeline=null,this.projectId?this.timeline=this.userTimelineService.getProjectTimeline(this.projectId):this.currentUser?this.timeline=this.userTimelineService.getProfileTimeline(this.user.get("id")):this.timeline=this.userTimelineService.getUserTimeline(this.user.get("id")),this.loadTimeline()}return function(t,e){for(var r in e)n.call(e,r)&&(t[r]=e[r]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(i,e(r.Controller,r.PageMixin,r.FiltersMixin)),i.$inject=["tgUserTimelineService"],i.prototype.loadTimeline=function(){return this.scrollDisabled=!0,this.timeline.next().then((t=this,function(e){return t.timelineList=t.timelineList.concat(e.get("items")),e.get("next")&&(t.scrollDisabled=!1),t.timelineList}));var t},i}(),angular.module("taigaUserTimeline").controller("UserTimeline",t)}.call(this),function(){var t;t=function(){return{templateUrl:"user-timeline/user-timeline/user-timeline.html",controller:"UserTimeline",controllerAs:"vm",scope:{projectId:"=projectid",user:"=",currentUser:"="},bindToController:!0}},angular.module("taigaProfile").directive("tgUserTimeline",t)}.call(this),function(){var t,e,r={}.hasOwnProperty;e=this.taiga,t=function(t){function n(t,e,r,n){this.rs=t,this.userTimelinePaginationSequenceService=e,this.userTimelineItemType=r,this.userTimelineItemTitle=n}return function(t,e){for(var n in e)r.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(n,e.Service),n.$inject=["tgResources","tgUserTimelinePaginationSequenceService","tgUserTimelineItemType","tgUserTimelineItemTitle"],n.prototype._valid_fields=["status","subject","description_diff","assigned_users","assigned_to","points","severity","priority","type","attachments","is_iocaine","content_diff","name","estimated_finish","estimated_start","blocked","moveInBacklog","milestone","color","due_date","due_date_reason"],n.prototype._invalid=[{check:function(t){var e,r;if(r=t.get("data").get("value_diff")){if(e=r.get("key"),-1===this._valid_fields.indexOf(e))return!0;if("attachments"===e&&0===r.get("value").get("new").size)return!0}return!1}},{check:function(t){var e,r;return e=t.get("event_type").split("."),r=t.get("data").get("value_diff"),"change"===e[2]&&void 0===r}},{check:function(t){return"delete"===t.get("event_type").split(".")[2]}},{check:function(t){var e;return"project"===(e=t.get("event_type").split("."))[1]&&"change"===e[2]}},{check:function(t){return!!t.get("data").get("comment_deleted")}},{check:function(t){var e,r;return e=t.get("event_type").split("."),!(!(r=t.get("data").get("value_diff"))||"task"!==e[1]||"change"!==e[2]||"milestone"!==r.get("key"))&&t.get("data").get("value_diff").get("value")}}],n.prototype._isInValidTimeline=function(t){return _.some(this._invalid,(e=this,function(r){return r.check.call(e,t)}));var e},n.prototype._parseEventType=function(t){return{section:(t=t.split("."))[0],obj:t[1],type:t[2]}},n.prototype._getTimelineObject=function(t,e){if(t.get("data").get(e.obj))return t.get("data").get(e.obj)},n.prototype._attachExtraInfoToTimelineEntry=function(t,e,r){var n;return n=this.userTimelineItemTitle.getTitle(t,e,r),t=(t=t.set("title_html",n)).set("obj",this._getTimelineObject(t,e)),r.description&&(t=t.set("description",r.description(t))),r.member&&(t=t.set("member",r.member(t))),"attachments"===t.getIn(["data","value_diff","key"])&&t.hasIn(["data","value_diff","value","new"])&&(t=t.set("attachments",t.getIn(["data","value_diff","value","new"]))),t},n.prototype._parseTimeline=function(t){var e,r;return e=Immutable.List(),t.get("data").forEach((r=this,function(t){var n,i,o;return n=r._parseEventType(t.get("event_type")),(o=t.get("data").get("values_diff"))&&o.count()?(o.has("is_blocked")&&(o=Immutable.Map({blocked:o})),o.has("milestone")?o="userstory"===n.obj?Immutable.Map({moveInBacklog:o}):o.deleteIn(["values_diff","milestone"]):"milestone"===n.obj&&(o=Immutable.Map({milestone:o})),o.forEach(function(r,n){var i,o;return o=Immutable.Map({key:n,value:r}),i=(i=t.setIn(["data","value_diff"],o)).deleteIn(["data","values_diff"]),e=e.push(i)})):(i=t.deleteIn(["data","values_diff"]),e=e.push(i))})),t.set("data",e)},n.prototype._addEntyAttributes=function(t){var e,r;return e=this._parseEventType(t.get("event_type")),r=this.userTimelineItemType.getType(t,e),this._attachExtraInfoToTimelineEntry(t,e,r)},n.prototype.getProfileTimeline=function(t){var e,r;return(e={}).fetch=(r=this,function(e){return r.rs.users.getProfileTimeline(t,e).then(function(t){return r._parseTimeline(t)})}),e.map=function(t){return function(e){return t._addEntyAttributes(e)}}(this),e.filter=function(t){return function(e){return e.filterNot(function(e){return t._isInValidTimeline(e)})}}(this),this.userTimelinePaginationSequenceService.generate(e)},n.prototype.getUserTimeline=function(t){var e,r;return(e={}).fetch=(r=this,function(e){return r.rs.users.getUserTimeline(t,e).then(function(t){return r._parseTimeline(t)})}),e.map=function(t){return function(e){return t._addEntyAttributes(e)}}(this),e.filter=function(t){return function(e){return e.filterNot(function(e){return t._isInValidTimeline(e)})}}(this),this.userTimelinePaginationSequenceService.generate(e)},n.prototype.getProjectTimeline=function(t){var e,r;return(e={}).fetch=(r=this,function(e){return r.rs.projects.getTimeline(t,e).then(function(t){return r._parseTimeline(t)})}),e.map=function(t){return function(e){return t._addEntyAttributes(e)}}(this),e.filter=function(t){return function(e){return e.filterNot(function(e){return t._isInValidTimeline(e)})}}(this),this.userTimelinePaginationSequenceService.generate(e)},n}(),angular.module("taigaUserTimeline").service("tgUserTimelineService",t)}.call(this),function(){var t;t=function(){return{link:function(t,e,r){return e.on("click",function(t){return t.stopPropagation()})}}},angular.module("taigaUtils").directive("tgIsolateClick",t)}.call(this),function(){var t;t=function(){return{templateUrl:"wiki/history/wiki-history-diff.html",scope:{key:"<",diff:"<"}}},angular.module("taigaWikiHistory").directive("tgWikiHistoryDiff",t)}.call(this),function(){var t;t=function(){return{link:function(t,e,r){return t.singleHistoryEntry=t.historyEntry.toJS()},templateUrl:"wiki/history/wiki-history-entry.html",scope:{historyEntry:"<"}}},angular.module("taigaWikiHistory").directive("tgWikiHistoryEntry",t)}.call(this),function(){var t,e,r;r=this.taiga,e=angular.module("taigaWikiHistory"),t=function(){function t(t){var e;this.activityService=t,r.defineImmutableProperty(this,"historyEntries",(e=this,function(){return e.activityService.entries})),r.defineImmutableProperty(this,"disablePagination",function(t){return function(){return t.activityService.disablePagination}}(this)),this.toggle=!1}return t.$inject=["tgActivityService"],t.prototype.initializeHistory=function(t){return t&&this.activityService.init("wiki",t),this.loadHistory()},t.prototype.loadHistory=function(){return this.activityService.fetchEntries()},t.prototype.nextPage=function(){return this.activityService.nextPage()},t}(),e.controller("WikiHistoryCtrl",t)}.call(this),function(){var t,e;e=this.taiga.bindOnce,t=function(){return{scope:{},bindToController:{wikiId:"<"},controller:"WikiHistoryCtrl",controllerAs:"vm",templateUrl:"wiki/history/wiki-history.html",link:function(t,r,n,i){return e(t,"vm.wikiId",function(t){return i.initializeHistory(t)})}}},angular.module("taigaWikiHistory").directive("tgWikiHistory",t)}.call(this);
//# sourceMappingURL=maps/app.js.map
